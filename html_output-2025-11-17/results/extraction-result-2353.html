<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction extraction-result-2353 - Theorizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="header">
        <a href="../index.html"><i class="fas fa-flask"></i> Theorizer</a>
    </div>

    <div class="content">
        <h1>Extracted Data Details for extraction-result-2353</h1>

        <div class="section">
            <h2>Extracted Data (Header)</h2>
            <div class="info-section">
                <p><strong>Extraction ID:</strong> extraction-result-2353</p>
                <p><strong>Extraction Schema Used (ID):</strong> <a href="../schemas/extraction-schema-63.html">extraction-schema-63</a></p>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI or machine learning methodologies being applied to scientific problems, including details about the problem characteristics (data availability, data structure, complexity, domain maturity, mechanistic understanding requirements) and the outcomes (applicability, effectiveness, impact).</div>
                <p><strong>Paper ID:</strong> paper-f8c306a5e8a19f5806bac9f26de14d09f7686aac</p>
                <p><strong>Paper Title:</strong> <a href="https://www.semanticscholar.org/paper/f8c306a5e8a19f5806bac9f26de14d09f7686aac" target="_blank">“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO</a></p>
                <p><strong>Paper Venue:</strong> Chemical Science</p>
                <p><strong>Paper TL;DR:</strong> Using a text-based representation of molecules, chemical reactions are predicted with a neural machine translation model borrowed from language processing to describe how molecules behave in a graph-based model.</p>
                <p><strong>Paper Abstract:</strong> Using a text-based representation of molecules, chemical reactions are predicted with a neural machine translation model borrowed from language processing.</p>
                <p><strong>Cost:</strong> 0.017</p>
            </div>
        </div>

        <div class="section">
            <h2>Extracted Data (Details)</h2>
            <div class="extraction-instance-container" id="e2353.0">
                <h3 class="extraction-instance">Extracted Data Instance 0 (e2353.0)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI or machine learning methodologies being applied to scientific problems, including details about the problem characteristics (data availability, data structure, complexity, domain maturity, mechanistic understanding requirements) and the outcomes (applicability, effectiveness, impact).</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>Seq2Seq-Attn</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Template-free sequence-to-sequence attention-based model (LSTM encoder-decoder with Luong attention)</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>An end-to-end supervised neural machine-translation model that maps tokenized SMILES sequences of reactants+reagents to product SMILES using a bidirectional LSTM encoder, multilayer LSTM decoder and Luong attention; trained on large patent reaction datasets without templates or explicit atomic features.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td>here</td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>scientific_problem_domain</strong></td>
                            <td>Organic chemistry — reaction outcome prediction (forward reaction prediction)</td>
                        </tr>
                        <tr>
                            <td><strong>problem_description</strong></td>
                            <td>Predict the major product SMILES string given the SMILES of reactants and common reagents; cast as a sequence-to-sequence translation problem from reactant/reagent text to product text.</td>
                        </tr>
                        <tr>
                            <td><strong>data_availability</strong></td>
                            <td>Abundant labeled data from patent-mined reaction corpora: Lowe's grants dataset (~1.8M raw reactions, after deduplication authors used ~1.0M single-product reactions for training/validation/test splits) and Jin's USPTO subset (~479k reactions, ~395k training after filtering). Data are labeled (reactants/reagents -> product), noisy (especially Lowe's), and publicly accessible; single-product reactions were selected (multiple-product cases excluded or treated as false).</td>
                        </tr>
                        <tr>
                            <td><strong>data_structure</strong></td>
                            <td>Discrete sequential text data: canonicalized SMILES strings tokenized atom-wise for reactants and products and reagent-wise tokens for a set of common reagents; sequences are high-dimensional discrete sequences with grammar constraints (SMILES syntax).</td>
                        </tr>
                        <tr>
                            <td><strong>problem_complexity</strong></td>
                            <td>High: requires learning SMILES grammar and canonical representation, mapping long-range dependencies (functional groups, distant reagents) to local structural changes, and handling large combinatorial search space of possible products; complexity somewhat reduced by removing stereochemistry and limiting to single-product reactions.</td>
                        </tr>
                        <tr>
                            <td><strong>domain_maturity</strong></td>
                            <td>Mature scientific domain with extensive prior work (rule/template systems, reaction databases, computational chemistry), but practical prediction remains challenging and data-driven approaches are emerging; substantial domain knowledge exists but manual template creation is time-consuming and incomplete.</td>
                        </tr>
                        <tr>
                            <td><strong>mechanistic_understanding_requirements</strong></td>
                            <td>Medium–low for practical prediction: the model is a black-box predictor trained to output products without explicit mechanistic steps; attention provides some interpretability hints but no mechanistic guarantees. The paper frames acceptable black-box performance for product prediction, while noting mechanistic step datasets are sparse.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_name</strong></td>
                            <td>Sequence-to-sequence neural machine translation with attention (encoder-decoder LSTM with Luong attention)</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_description</strong></td>
                            <td>An encoder-decoder architecture using multilayer LSTMs: a bidirectional LSTM encoder produces context vectors; a stacked LSTM decoder produces product token probabilities conditioned on previous outputs and a per-token context computed with Luong attention (dot/product attention). Input tokens are one-hot embedded; reagent tokens (76 most common) are appended after a separator. Training: supervised cross-entropy loss, teacher forcing, minibatch SGD with learning-rate decay, gradient clipping, dropout; hyperparameters were found via Bayesian/gradient-boosted surrogate-driven search (scikit-optimize) and best model further trained; inference uses beam search (width 10) and outputs are canonicalized post-hoc. Other practical adaptations: canonicalization of SMILES, tokenization choices, removal of stereochemistry for some datasets, and post-processing to improve exact-sequence accuracy.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_category</strong></td>
                            <td>Supervised deep learning (sequence transduction / neural machine translation)</td>
                        </tr>
                        <tr>
                            <td><strong>applicability</strong></td>
                            <td>Applicable and appropriate: model directly fits the text-sequence formulation (SMILES as language). Advantages include template-free prediction and end-to-end training. Limitations: depends on large labeled datasets, sensitive to noisy / multi-product data, may produce invalid SMILES (~1.3% top-1 grammatical errors reported), and currently limited to single-product predictions without further engineering.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_quantitative</strong></td>
                            <td>Top-1 accuracy 80.3% on Jin's USPTO test set (38648 reactions) and 65.4% on Lowe's noisier single-product test set (50258 reactions); BLEU/ROUGE reported (Jin's USPTO: BLEU 95.9, ROUGE 96.0; Lowe's: BLEU 90.3, ROUGE 90.9). Inference decoding time ~25 ms per reaction with beam search (on their hardware). Canonicalization post-processing improved accuracy by ~1.5 percentage points.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_qualitative</strong></td>
                            <td>Worked well overall: the method improved or matched prior template-free state-of-the-art top-1 performance, captures long-range dependencies via attention, and can be trained end-to-end without handcrafted rules. Shortcomings: worse than the comparator (WLDN) on top-3/top-5 ranking metrics, vulnerable to noisy/multiple-product reactions, and produces a small fraction of syntactically invalid SMILES; benefits from careful tokenization and hyperparameter tuning.</td>
                        </tr>
                        <tr>
                            <td><strong>impact_potential</strong></td>
                            <td>High potential impact: could codify chemists' implicit pattern recognition and accelerate/automate forward reaction prediction for synthesis planning; scalable to large patent corpora and transferable to other reaction corpora; much faster and lower-cost at inference than first-principles computations, enabling high-throughput product prediction and downstream use in retrosynthesis or automated planning pipelines. Limitations in coverage/noise reduce immediate industrial readiness without further filtering or multi-product handling.</td>
                        </tr>
                        <tr>
                            <td><strong>comparison_to_alternatives</strong></td>
                            <td>Compared directly to Weissfeiler-Lehman Difference Network (WLDN) from Jin et al.: seq2seq attn achieved slightly higher top-1 accuracy (80.3% vs 79.6%) but lower top-3/top-5 performance; contrasted with template-based and template-extraction + ranking approaches that are limited to reaction spaces covered by templates, and with first-principles computational chemistry which is accurate but prohibitively costly for large-scale coverage.</td>
                        </tr>
                        <tr>
                            <td><strong>success_factors</strong></td>
                            <td>Large labeled datasets (patent corpora), treating SMILES as a language (tokenization and canonicalization), use of attention to capture long-range dependencies, end-to-end training without hand-coded rules, extensive hyperparameter optimization, reagent tokenization that separates reagents from reactants, and post-processing canonicalization to count equivalent outputs as correct.</td>
                        </tr>
                        <tr>
                            <td><strong>key_insight</strong></td>
                            <td>Casting reaction prediction as a language translation problem and using an attention-equipped seq2seq model is effective when abundant labeled SMILES sequence data exist; attention handles long-range chemical dependencies, enabling template-free prediction that matches or slightly exceeds prior top-1 performance on patent-derived datasets, though noisy/multi-product cases and higher-rank retrieval remain challenges.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': '“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO', 'publication_date_yy_mm': '2017-11'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e2353.1">
                <h3 class="extraction-instance">Extracted Data Instance 1 (e2353.1)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI or machine learning methodologies being applied to scientific problems, including details about the problem characteristics (data availability, data structure, complexity, domain maturity, mechanistic understanding requirements) and the outcomes (applicability, effectiveness, impact).</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>WLDN / WLN</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Weisfeiler-Lehman Network (WLN) and Weisfeiler-Lehman Difference Network (WLDN) approach (Jin et al.)</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>A graph-neural-network based, template-free reaction prediction pipeline that (1) uses a Weisfeiler-Lehman Network to score atom-pair reactivity and predict reaction centers, (2) enumerates possible bond-change candidates consistent with valence rules, and (3) ranks candidates with a Weisfeiler-Lehman Difference Network.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>mention</td>
                        </tr>
                        <tr>
                            <td><strong>scientific_problem_domain</strong></td>
                            <td>Organic chemistry — reaction outcome prediction (forward prediction from reactants)</td>
                        </tr>
                        <tr>
                            <td><strong>problem_description</strong></td>
                            <td>Predict products by identifying reaction centers in molecular graphs, enumerating plausible bond-change outcomes and ranking candidates to choose the most likely product(s).</td>
                        </tr>
                        <tr>
                            <td><strong>data_availability</strong></td>
                            <td>Used large patent-derived datasets (Jin et al. trained on ~400k reactions from US patents); such datasets are labeled and publicly available in subsets; the paper references this usage but exact dataset details are in the original Jin et al. work.</td>
                        </tr>
                        <tr>
                            <td><strong>data_structure</strong></td>
                            <td>Graph-structured molecular data (molecular graphs with atoms/nodes and bonds/edges); operates on features derived from atom and bond attributes rather than linear SMILES only.</td>
                        </tr>
                        <tr>
                            <td><strong>problem_complexity</strong></td>
                            <td>High: requires predicting reaction centers (pairwise reactivity), enumerating combinatorial bond-change candidates, and ranking among many possible product graphs under valence/connectivity constraints; computational complexity arises from candidate generation and graph combinatorics.</td>
                        </tr>
                        <tr>
                            <td><strong>domain_maturity</strong></td>
                            <td>Emerging ML approach within a mature chemistry domain; builds on graph neural network methods and leverages structured chemical representations to capture mechanistic-relevant topology.</td>
                        </tr>
                        <tr>
                            <td><strong>mechanistic_understanding_requirements</strong></td>
                            <td>Medium: approach explicitly predicts reaction centers and bond changes, providing interpretable, mechanistically relevant signals (which atom pairs react), thus supporting partial mechanistic insight compared to purely text-based black-box models.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_name</strong></td>
                            <td>Graph neural networks based on Weisfeiler-Lehman (WL) graph isomorphism framework; specifically WLN for reaction center prediction and WLDN for candidate ranking</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_description</strong></td>
                            <td>Two-stage graph-based ML pipeline: (1) WLN computes atom/atom-pair reactivity scores from molecular graphs to identify probable reaction centers; (2) enumerate all plausible product candidates via bond-change permutations that respect valence and connectivity rules; (3) WLDN (a neural network operating on differences between reactant and product graph fingerprints) ranks candidates; trained supervised on atom-mapped reactions (stereochemistry removed in dataset used).</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_category</strong></td>
                            <td>Supervised graph-based deep learning</td>
                        </tr>
                        <tr>
                            <td><strong>applicability</strong></td>
                            <td>Well-suited for problems where molecular graph structure and local bond-change mechanisms are important; applicable to datasets with atom mappings to supervise reaction center prediction. Constraints: requires candidate enumeration and hand-coded valence/connectivity filters; may need augmentation to ensure full product coverage.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_quantitative</strong></td>
                            <td>Reported by Jin et al. (as cited): top-1 accuracy 79.6% on their USPTO test set; top-3 87.7% and top-5 89.2% (these latter were reported as higher than the seq2seq model in this paper). Jin et al. claimed to outperform template-based approaches by ~10% after augmenting product coverage.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_qualitative</strong></td>
                            <td>Strong performance, particularly for top-k ranking metrics (k>1) due to candidate enumeration and ranking; provides interpretable reaction-center predictions. Downsides include dependence on correct candidate generation and necessity of valence/connectivity rules to prune unrealistic candidates.</td>
                        </tr>
                        <tr>
                            <td><strong>impact_potential</strong></td>
                            <td>High: graph-based methods align with chemical structure and can provide mechanistic interpretability (reaction centers), useful for downstream synthesis planning; good top-k coverage makes them attractive where multiple plausible products need ranking.</td>
                        </tr>
                        <tr>
                            <td><strong>comparison_to_alternatives</strong></td>
                            <td>Compared in this paper: WLDN had slightly lower top-1 but superior top-3/top-5 performance relative to the seq2seq attention model; differs from template-based approaches by not relying on extracted templates, and from seq2seq by operating on graph representations with explicit candidate enumeration.</td>
                        </tr>
                        <tr>
                            <td><strong>success_factors</strong></td>
                            <td>Using graph-structured molecular input that reflects chemical topology, explicit reaction-center prediction to focus candidate generation, and a dedicated ranking network for product candidates; training on large atom-mapped patent datasets aided supervision.</td>
                        </tr>
                        <tr>
                            <td><strong>key_insight</strong></td>
                            <td>Graph-based WLN/WLDN approaches leverage molecular topology and explicit reaction-center predictions to achieve strong top-k product ranking performance, trading off the end-to-end simplicity of sequence models for greater mechanistic interpretability and candidate coverage.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': '“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO', 'publication_date_yy_mm': '2017-11'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e2353.2">
                <h3 class="extraction-instance">Extracted Data Instance 2 (e2353.2)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI or machine learning methodologies being applied to scientific problems, including details about the problem characteristics (data availability, data structure, complexity, domain maturity, mechanistic understanding requirements) and the outcomes (applicability, effectiveness, impact).</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>GraphConv+TemplateRanking</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Graph-convolutional neural network for template prioritization (Wei et al.)</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>A pipeline that computes molecular fingerprints via graph-convolutional neural networks and trains a model to predict which reaction templates to apply to given reactants, thus combining learned molecular representations with template-based product generation.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>mention</td>
                        </tr>
                        <tr>
                            <td><strong>scientific_problem_domain</strong></td>
                            <td>Organic chemistry — reaction outcome/retrosynthesis via template selection</td>
                        </tr>
                        <tr>
                            <td><strong>problem_description</strong></td>
                            <td>Given reactants, predict likely reaction templates (rules) to generate candidate products and prioritize them by likelihood using learned molecular representations.</td>
                        </tr>
                        <tr>
                            <td><strong>data_availability</strong></td>
                            <td>Not specified in detail in this paper; referenced work used extracted reaction datasets to learn template priorities. Generally relies on template-labeled reaction databases (patent literature or commercial databases).</td>
                        </tr>
                        <tr>
                            <td><strong>data_structure</strong></td>
                            <td>Graph-structured molecular data used to compute neural fingerprints via graph convolution networks; candidate products are generated via rule/template application.</td>
                        </tr>
                        <tr>
                            <td><strong>problem_complexity</strong></td>
                            <td>Moderate to high: complexity arises from the number and coverage of templates; graph conv nets must learn chemically relevant representations to select appropriate template(s).</td>
                        </tr>
                        <tr>
                            <td><strong>domain_maturity</strong></td>
                            <td>Method builds on relatively mature graph convolution techniques applied in chemoinformatics; the overall template-selection approach is well-established in cheminformatics but improved with learned representations.</td>
                        </tr>
                        <tr>
                            <td><strong>mechanistic_understanding_requirements</strong></td>
                            <td>Medium: template-based frameworks encode local mechanistic transformations; graph convolutions learn features that map to these templates but overall approach remains tied to rule-based mechanistic encodings.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_name</strong></td>
                            <td>Graph-convolutional neural networks (GCNs) for molecular fingerprinting combined with template-ranking neural network</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_description</strong></td>
                            <td>Use GCN (as per Duvenaud et al.) to compute molecular fingerprints of reactants, then train a downstream neural network to predict/prioritize reaction templates; candidate products are produced by applying top-ranked templates and possibly re-ranked.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_category</strong></td>
                            <td>Supervised deep learning (graph neural networks) combined with symbolic/template-based methods</td>
                        </tr>
                        <tr>
                            <td><strong>applicability</strong></td>
                            <td>Applicable when reaction templates are available and one wants to leverage learned molecular features to prioritize templates; limited by template coverage and inherits template-system limitations (cannot predict outside template space).</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_quantitative</strong></td>
                            <td>No direct quantitative results reported in this paper for Wei et al.'s method; this paper cites Wei et al. as a successful prior approach but does not reproduce metrics.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_qualitative</strong></td>
                            <td>Graph-convolution + template ranking improved template prioritization versus hand-designed fingerprints; however, approaches remain constrained by template extraction coverage and can fail outside training domain.</td>
                        </tr>
                        <tr>
                            <td><strong>impact_potential</strong></td>
                            <td>Moderate: improves template selection by learning molecular representations, but limited generalization beyond available templates; useful in settings where template coverage is good.</td>
                        </tr>
                        <tr>
                            <td><strong>comparison_to_alternatives</strong></td>
                            <td>Paper contrasts template-based (including template+ML ranking) vs template-free approaches: template-based methods can be accurate within template coverage but fail outside it; seq2seq and graph-free methods aim to predict outside template space.</td>
                        </tr>
                        <tr>
                            <td><strong>success_factors</strong></td>
                            <td>Leveraging learned graph-based fingerprints that better capture chemical context compared to fixed descriptors, combined with supervised template-prioritization models; quality and coverage of extracted templates remain a limiting factor.</td>
                        </tr>
                        <tr>
                            <td><strong>key_insight</strong></td>
                            <td>Learned graph neural fingerprints can improve template prioritization, but approaches that rely on templates inherit coverage limitations; moving away from templates to fully data-driven models can increase generalization at the expense of interpretability.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': '“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO', 'publication_date_yy_mm': '2017-11'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e2353.3">
                <h3 class="extraction-instance">Extracted Data Instance 3 (e2353.3)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI or machine learning methodologies being applied to scientific problems, including details about the problem characteristics (data availability, data structure, complexity, domain maturity, mechanistic understanding requirements) and the outcomes (applicability, effectiveness, impact).</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>Neural-symbolic / Template-based ML</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Neural-symbolic and template-extraction based reaction prediction (Segler & Waller, Coley et al.)</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>Approaches that extract reaction templates/rules from reaction databases and combine symbolic application of these templates with machine learning (typically neural networks on molecular fingerprints) to prioritize or rank candidate products.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>mention</td>
                        </tr>
                        <tr>
                            <td><strong>scientific_problem_domain</strong></td>
                            <td>Organic chemistry — reaction prediction and retrosynthesis using template/rule systems augmented by ML</td>
                        </tr>
                        <tr>
                            <td><strong>problem_description</strong></td>
                            <td>Extract reaction templates from reaction databases and apply these templates to reactants to produce candidate products; use ML to prioritize templates or rank product candidates.</td>
                        </tr>
                        <tr>
                            <td><strong>data_availability</strong></td>
                            <td>Requires curated reaction databases from patents or commercial sources (e.g., Reaxys) and template extraction; data availability varies and templates are derived from existing reaction examples.</td>
                        </tr>
                        <tr>
                            <td><strong>data_structure</strong></td>
                            <td>Structured templates/rules applied to molecular graphs or SMILES-derived representations; ML components often use molecular fingerprints (vector descriptors).</td>
                        </tr>
                        <tr>
                            <td><strong>problem_complexity</strong></td>
                            <td>Complex in terms of covering chemical space with templates; creation and coverage of templates is laborious and incomplete, leading to failures outside template coverage.</td>
                        </tr>
                        <tr>
                            <td><strong>domain_maturity</strong></td>
                            <td>Well-established class of methods in cheminformatics and computational retrosynthesis, with several commercial and academic systems historically based on templates and symbolic rules.</td>
                        </tr>
                        <tr>
                            <td><strong>mechanistic_understanding_requirements</strong></td>
                            <td>Medium to high: templates encode local mechanistic transformations and are interpretable in chemical terms; mechanistic insight can be encoded explicitly in templates.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_name</strong></td>
                            <td>Template-extraction combined with machine learning ranking (neural-symbolic hybrid)</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_description</strong></td>
                            <td>Extract reaction templates from large reaction corpora; generate candidate products by applying templates to reactants; use ML models (e.g., neural networks trained on molecular fingerprints) to score/prioritize templates or rank candidate products; some approaches incorporate knowledge graphs for search/prioritization.</td>
                        </tr>
                        <tr>
                            <td><strong>ai_methodology_category</strong></td>
                            <td>Hybrid symbolic + supervised ML</td>
                        </tr>
                        <tr>
                            <td><strong>applicability</strong></td>
                            <td>Applicable when templates can be reliably extracted and cover the target chemical space; limited for novel reaction types or domains not represented in the template database.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_quantitative</strong></td>
                            <td>Quantitative comparisons are dataset- and implementation-dependent; this paper reports that template-based methods were outperformed by some template-free approaches outside template coverage and that Jin et al. reported ~10% improvement over template-based after augmentation (reported by Jin et al.). No precise aggregated numbers reported here.</td>
                        </tr>
                        <tr>
                            <td><strong>effectiveness_qualitative</strong></td>
                            <td>Effective within the covered template space and interpretable, but fragile when faced with reactions outside extracted templates and costly to build/maintain; ML ranking improves prioritization but doesn't remove the template-coverage limitation.</td>
                        </tr>
                        <tr>
                            <td><strong>impact_potential</strong></td>
                            <td>Significant for industrial workflows where template coverage aligns with common chemistries; less powerful for novel chemistries or to generalize beyond known templates compared to template-free, data-driven models.</td>
                        </tr>
                        <tr>
                            <td><strong>comparison_to_alternatives</strong></td>
                            <td>Compared qualitatively to template-free methods: template-based are interpretable and mechanistically grounded but cannot predict outside template space; seq2seq and graph-based template-free methods generalize beyond templates but are less explicitly mechanistic.</td>
                        </tr>
                        <tr>
                            <td><strong>success_factors</strong></td>
                            <td>Availability of comprehensive reaction corpora for template extraction, quality of template mining tools, and effectiveness of ML ranking models on learned molecular representations; coverage of templates across chemical space is the key limiting factor.</td>
                        </tr>
                        <tr>
                            <td><strong>key_insight</strong></td>
                            <td>Template-based ML methods combine interpretability and rule-based mechanistic encoding with learned prioritization, but their predictive utility is fundamentally bounded by the coverage of extracted templates, motivating template-free alternatives when broad generalization is needed.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': '“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO', 'publication_date_yy_mm': '2017-11'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>Potentially Relevant New Papers (mentioned by this paper)</h2>
            <ol>
                <li>Linking the Neural Machine Translation and the Prediction of Organic Chemistry Reactions <em>(Rating: 2)</em></li>
                <li>Learning to SMILE(S) <em>(Rating: 1)</em></li>
                <li>SMILES Enumeration as Data Augmentation for Neural Network Modeling of Molecules <em>(Rating: 1)</em></li>
            </ol>
        </div>

        <div class="section">
            <h2>Extracted Data (Debug)</h2>
            <pre><code>{
    "id": "extraction-result-2353",
    "paper_id": "paper-f8c306a5e8a19f5806bac9f26de14d09f7686aac",
    "extraction_schema_id": "extraction-schema-63",
    "extracted_data": [
        {
            "name_short": "Seq2Seq-Attn",
            "name_full": "Template-free sequence-to-sequence attention-based model (LSTM encoder-decoder with Luong attention)",
            "brief_description": "An end-to-end supervised neural machine-translation model that maps tokenized SMILES sequences of reactants+reagents to product SMILES using a bidirectional LSTM encoder, multilayer LSTM decoder and Luong attention; trained on large patent reaction datasets without templates or explicit atomic features.",
            "citation_title": "here",
            "mention_or_use": "use",
            "scientific_problem_domain": "Organic chemistry — reaction outcome prediction (forward reaction prediction)",
            "problem_description": "Predict the major product SMILES string given the SMILES of reactants and common reagents; cast as a sequence-to-sequence translation problem from reactant/reagent text to product text.",
            "data_availability": "Abundant labeled data from patent-mined reaction corpora: Lowe's grants dataset (~1.8M raw reactions, after deduplication authors used ~1.0M single-product reactions for training/validation/test splits) and Jin's USPTO subset (~479k reactions, ~395k training after filtering). Data are labeled (reactants/reagents -&gt; product), noisy (especially Lowe's), and publicly accessible; single-product reactions were selected (multiple-product cases excluded or treated as false).",
            "data_structure": "Discrete sequential text data: canonicalized SMILES strings tokenized atom-wise for reactants and products and reagent-wise tokens for a set of common reagents; sequences are high-dimensional discrete sequences with grammar constraints (SMILES syntax).",
            "problem_complexity": "High: requires learning SMILES grammar and canonical representation, mapping long-range dependencies (functional groups, distant reagents) to local structural changes, and handling large combinatorial search space of possible products; complexity somewhat reduced by removing stereochemistry and limiting to single-product reactions.",
            "domain_maturity": "Mature scientific domain with extensive prior work (rule/template systems, reaction databases, computational chemistry), but practical prediction remains challenging and data-driven approaches are emerging; substantial domain knowledge exists but manual template creation is time-consuming and incomplete.",
            "mechanistic_understanding_requirements": "Medium–low for practical prediction: the model is a black-box predictor trained to output products without explicit mechanistic steps; attention provides some interpretability hints but no mechanistic guarantees. The paper frames acceptable black-box performance for product prediction, while noting mechanistic step datasets are sparse.",
            "ai_methodology_name": "Sequence-to-sequence neural machine translation with attention (encoder-decoder LSTM with Luong attention)",
            "ai_methodology_description": "An encoder-decoder architecture using multilayer LSTMs: a bidirectional LSTM encoder produces context vectors; a stacked LSTM decoder produces product token probabilities conditioned on previous outputs and a per-token context computed with Luong attention (dot/product attention). Input tokens are one-hot embedded; reagent tokens (76 most common) are appended after a separator. Training: supervised cross-entropy loss, teacher forcing, minibatch SGD with learning-rate decay, gradient clipping, dropout; hyperparameters were found via Bayesian/gradient-boosted surrogate-driven search (scikit-optimize) and best model further trained; inference uses beam search (width 10) and outputs are canonicalized post-hoc. Other practical adaptations: canonicalization of SMILES, tokenization choices, removal of stereochemistry for some datasets, and post-processing to improve exact-sequence accuracy.",
            "ai_methodology_category": "Supervised deep learning (sequence transduction / neural machine translation)",
            "applicability": "Applicable and appropriate: model directly fits the text-sequence formulation (SMILES as language). Advantages include template-free prediction and end-to-end training. Limitations: depends on large labeled datasets, sensitive to noisy / multi-product data, may produce invalid SMILES (~1.3% top-1 grammatical errors reported), and currently limited to single-product predictions without further engineering.",
            "effectiveness_quantitative": "Top-1 accuracy 80.3% on Jin's USPTO test set (38648 reactions) and 65.4% on Lowe's noisier single-product test set (50258 reactions); BLEU/ROUGE reported (Jin's USPTO: BLEU 95.9, ROUGE 96.0; Lowe's: BLEU 90.3, ROUGE 90.9). Inference decoding time ~25 ms per reaction with beam search (on their hardware). Canonicalization post-processing improved accuracy by ~1.5 percentage points.",
            "effectiveness_qualitative": "Worked well overall: the method improved or matched prior template-free state-of-the-art top-1 performance, captures long-range dependencies via attention, and can be trained end-to-end without handcrafted rules. Shortcomings: worse than the comparator (WLDN) on top-3/top-5 ranking metrics, vulnerable to noisy/multiple-product reactions, and produces a small fraction of syntactically invalid SMILES; benefits from careful tokenization and hyperparameter tuning.",
            "impact_potential": "High potential impact: could codify chemists' implicit pattern recognition and accelerate/automate forward reaction prediction for synthesis planning; scalable to large patent corpora and transferable to other reaction corpora; much faster and lower-cost at inference than first-principles computations, enabling high-throughput product prediction and downstream use in retrosynthesis or automated planning pipelines. Limitations in coverage/noise reduce immediate industrial readiness without further filtering or multi-product handling.",
            "comparison_to_alternatives": "Compared directly to Weissfeiler-Lehman Difference Network (WLDN) from Jin et al.: seq2seq attn achieved slightly higher top-1 accuracy (80.3% vs 79.6%) but lower top-3/top-5 performance; contrasted with template-based and template-extraction + ranking approaches that are limited to reaction spaces covered by templates, and with first-principles computational chemistry which is accurate but prohibitively costly for large-scale coverage.",
            "success_factors": "Large labeled datasets (patent corpora), treating SMILES as a language (tokenization and canonicalization), use of attention to capture long-range dependencies, end-to-end training without hand-coded rules, extensive hyperparameter optimization, reagent tokenization that separates reagents from reactants, and post-processing canonicalization to count equivalent outputs as correct.",
            "key_insight": "Casting reaction prediction as a language translation problem and using an attention-equipped seq2seq model is effective when abundant labeled SMILES sequence data exist; attention handles long-range chemical dependencies, enabling template-free prediction that matches or slightly exceeds prior top-1 performance on patent-derived datasets, though noisy/multi-product cases and higher-rank retrieval remain challenges.",
            "uuid": "e2353.0",
            "source_info": {
                "paper_title": "“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO",
                "publication_date_yy_mm": "2017-11"
            }
        },
        {
            "name_short": "WLDN / WLN",
            "name_full": "Weisfeiler-Lehman Network (WLN) and Weisfeiler-Lehman Difference Network (WLDN) approach (Jin et al.)",
            "brief_description": "A graph-neural-network based, template-free reaction prediction pipeline that (1) uses a Weisfeiler-Lehman Network to score atom-pair reactivity and predict reaction centers, (2) enumerates possible bond-change candidates consistent with valence rules, and (3) ranks candidates with a Weisfeiler-Lehman Difference Network.",
            "citation_title": "",
            "mention_or_use": "mention",
            "scientific_problem_domain": "Organic chemistry — reaction outcome prediction (forward prediction from reactants)",
            "problem_description": "Predict products by identifying reaction centers in molecular graphs, enumerating plausible bond-change outcomes and ranking candidates to choose the most likely product(s).",
            "data_availability": "Used large patent-derived datasets (Jin et al. trained on ~400k reactions from US patents); such datasets are labeled and publicly available in subsets; the paper references this usage but exact dataset details are in the original Jin et al. work.",
            "data_structure": "Graph-structured molecular data (molecular graphs with atoms/nodes and bonds/edges); operates on features derived from atom and bond attributes rather than linear SMILES only.",
            "problem_complexity": "High: requires predicting reaction centers (pairwise reactivity), enumerating combinatorial bond-change candidates, and ranking among many possible product graphs under valence/connectivity constraints; computational complexity arises from candidate generation and graph combinatorics.",
            "domain_maturity": "Emerging ML approach within a mature chemistry domain; builds on graph neural network methods and leverages structured chemical representations to capture mechanistic-relevant topology.",
            "mechanistic_understanding_requirements": "Medium: approach explicitly predicts reaction centers and bond changes, providing interpretable, mechanistically relevant signals (which atom pairs react), thus supporting partial mechanistic insight compared to purely text-based black-box models.",
            "ai_methodology_name": "Graph neural networks based on Weisfeiler-Lehman (WL) graph isomorphism framework; specifically WLN for reaction center prediction and WLDN for candidate ranking",
            "ai_methodology_description": "Two-stage graph-based ML pipeline: (1) WLN computes atom/atom-pair reactivity scores from molecular graphs to identify probable reaction centers; (2) enumerate all plausible product candidates via bond-change permutations that respect valence and connectivity rules; (3) WLDN (a neural network operating on differences between reactant and product graph fingerprints) ranks candidates; trained supervised on atom-mapped reactions (stereochemistry removed in dataset used).",
            "ai_methodology_category": "Supervised graph-based deep learning",
            "applicability": "Well-suited for problems where molecular graph structure and local bond-change mechanisms are important; applicable to datasets with atom mappings to supervise reaction center prediction. Constraints: requires candidate enumeration and hand-coded valence/connectivity filters; may need augmentation to ensure full product coverage.",
            "effectiveness_quantitative": "Reported by Jin et al. (as cited): top-1 accuracy 79.6% on their USPTO test set; top-3 87.7% and top-5 89.2% (these latter were reported as higher than the seq2seq model in this paper). Jin et al. claimed to outperform template-based approaches by ~10% after augmenting product coverage.",
            "effectiveness_qualitative": "Strong performance, particularly for top-k ranking metrics (k&gt;1) due to candidate enumeration and ranking; provides interpretable reaction-center predictions. Downsides include dependence on correct candidate generation and necessity of valence/connectivity rules to prune unrealistic candidates.",
            "impact_potential": "High: graph-based methods align with chemical structure and can provide mechanistic interpretability (reaction centers), useful for downstream synthesis planning; good top-k coverage makes them attractive where multiple plausible products need ranking.",
            "comparison_to_alternatives": "Compared in this paper: WLDN had slightly lower top-1 but superior top-3/top-5 performance relative to the seq2seq attention model; differs from template-based approaches by not relying on extracted templates, and from seq2seq by operating on graph representations with explicit candidate enumeration.",
            "success_factors": "Using graph-structured molecular input that reflects chemical topology, explicit reaction-center prediction to focus candidate generation, and a dedicated ranking network for product candidates; training on large atom-mapped patent datasets aided supervision.",
            "key_insight": "Graph-based WLN/WLDN approaches leverage molecular topology and explicit reaction-center predictions to achieve strong top-k product ranking performance, trading off the end-to-end simplicity of sequence models for greater mechanistic interpretability and candidate coverage.",
            "uuid": "e2353.1",
            "source_info": {
                "paper_title": "“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO",
                "publication_date_yy_mm": "2017-11"
            }
        },
        {
            "name_short": "GraphConv+TemplateRanking",
            "name_full": "Graph-convolutional neural network for template prioritization (Wei et al.)",
            "brief_description": "A pipeline that computes molecular fingerprints via graph-convolutional neural networks and trains a model to predict which reaction templates to apply to given reactants, thus combining learned molecular representations with template-based product generation.",
            "citation_title": "",
            "mention_or_use": "mention",
            "scientific_problem_domain": "Organic chemistry — reaction outcome/retrosynthesis via template selection",
            "problem_description": "Given reactants, predict likely reaction templates (rules) to generate candidate products and prioritize them by likelihood using learned molecular representations.",
            "data_availability": "Not specified in detail in this paper; referenced work used extracted reaction datasets to learn template priorities. Generally relies on template-labeled reaction databases (patent literature or commercial databases).",
            "data_structure": "Graph-structured molecular data used to compute neural fingerprints via graph convolution networks; candidate products are generated via rule/template application.",
            "problem_complexity": "Moderate to high: complexity arises from the number and coverage of templates; graph conv nets must learn chemically relevant representations to select appropriate template(s).",
            "domain_maturity": "Method builds on relatively mature graph convolution techniques applied in chemoinformatics; the overall template-selection approach is well-established in cheminformatics but improved with learned representations.",
            "mechanistic_understanding_requirements": "Medium: template-based frameworks encode local mechanistic transformations; graph convolutions learn features that map to these templates but overall approach remains tied to rule-based mechanistic encodings.",
            "ai_methodology_name": "Graph-convolutional neural networks (GCNs) for molecular fingerprinting combined with template-ranking neural network",
            "ai_methodology_description": "Use GCN (as per Duvenaud et al.) to compute molecular fingerprints of reactants, then train a downstream neural network to predict/prioritize reaction templates; candidate products are produced by applying top-ranked templates and possibly re-ranked.",
            "ai_methodology_category": "Supervised deep learning (graph neural networks) combined with symbolic/template-based methods",
            "applicability": "Applicable when reaction templates are available and one wants to leverage learned molecular features to prioritize templates; limited by template coverage and inherits template-system limitations (cannot predict outside template space).",
            "effectiveness_quantitative": "No direct quantitative results reported in this paper for Wei et al.'s method; this paper cites Wei et al. as a successful prior approach but does not reproduce metrics.",
            "effectiveness_qualitative": "Graph-convolution + template ranking improved template prioritization versus hand-designed fingerprints; however, approaches remain constrained by template extraction coverage and can fail outside training domain.",
            "impact_potential": "Moderate: improves template selection by learning molecular representations, but limited generalization beyond available templates; useful in settings where template coverage is good.",
            "comparison_to_alternatives": "Paper contrasts template-based (including template+ML ranking) vs template-free approaches: template-based methods can be accurate within template coverage but fail outside it; seq2seq and graph-free methods aim to predict outside template space.",
            "success_factors": "Leveraging learned graph-based fingerprints that better capture chemical context compared to fixed descriptors, combined with supervised template-prioritization models; quality and coverage of extracted templates remain a limiting factor.",
            "key_insight": "Learned graph neural fingerprints can improve template prioritization, but approaches that rely on templates inherit coverage limitations; moving away from templates to fully data-driven models can increase generalization at the expense of interpretability.",
            "uuid": "e2353.2",
            "source_info": {
                "paper_title": "“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO",
                "publication_date_yy_mm": "2017-11"
            }
        },
        {
            "name_short": "Neural-symbolic / Template-based ML",
            "name_full": "Neural-symbolic and template-extraction based reaction prediction (Segler & Waller, Coley et al.)",
            "brief_description": "Approaches that extract reaction templates/rules from reaction databases and combine symbolic application of these templates with machine learning (typically neural networks on molecular fingerprints) to prioritize or rank candidate products.",
            "citation_title": "",
            "mention_or_use": "mention",
            "scientific_problem_domain": "Organic chemistry — reaction prediction and retrosynthesis using template/rule systems augmented by ML",
            "problem_description": "Extract reaction templates from reaction databases and apply these templates to reactants to produce candidate products; use ML to prioritize templates or rank product candidates.",
            "data_availability": "Requires curated reaction databases from patents or commercial sources (e.g., Reaxys) and template extraction; data availability varies and templates are derived from existing reaction examples.",
            "data_structure": "Structured templates/rules applied to molecular graphs or SMILES-derived representations; ML components often use molecular fingerprints (vector descriptors).",
            "problem_complexity": "Complex in terms of covering chemical space with templates; creation and coverage of templates is laborious and incomplete, leading to failures outside template coverage.",
            "domain_maturity": "Well-established class of methods in cheminformatics and computational retrosynthesis, with several commercial and academic systems historically based on templates and symbolic rules.",
            "mechanistic_understanding_requirements": "Medium to high: templates encode local mechanistic transformations and are interpretable in chemical terms; mechanistic insight can be encoded explicitly in templates.",
            "ai_methodology_name": "Template-extraction combined with machine learning ranking (neural-symbolic hybrid)",
            "ai_methodology_description": "Extract reaction templates from large reaction corpora; generate candidate products by applying templates to reactants; use ML models (e.g., neural networks trained on molecular fingerprints) to score/prioritize templates or rank candidate products; some approaches incorporate knowledge graphs for search/prioritization.",
            "ai_methodology_category": "Hybrid symbolic + supervised ML",
            "applicability": "Applicable when templates can be reliably extracted and cover the target chemical space; limited for novel reaction types or domains not represented in the template database.",
            "effectiveness_quantitative": "Quantitative comparisons are dataset- and implementation-dependent; this paper reports that template-based methods were outperformed by some template-free approaches outside template coverage and that Jin et al. reported ~10% improvement over template-based after augmentation (reported by Jin et al.). No precise aggregated numbers reported here.",
            "effectiveness_qualitative": "Effective within the covered template space and interpretable, but fragile when faced with reactions outside extracted templates and costly to build/maintain; ML ranking improves prioritization but doesn't remove the template-coverage limitation.",
            "impact_potential": "Significant for industrial workflows where template coverage aligns with common chemistries; less powerful for novel chemistries or to generalize beyond known templates compared to template-free, data-driven models.",
            "comparison_to_alternatives": "Compared qualitatively to template-free methods: template-based are interpretable and mechanistically grounded but cannot predict outside template space; seq2seq and graph-based template-free methods generalize beyond templates but are less explicitly mechanistic.",
            "success_factors": "Availability of comprehensive reaction corpora for template extraction, quality of template mining tools, and effectiveness of ML ranking models on learned molecular representations; coverage of templates across chemical space is the key limiting factor.",
            "key_insight": "Template-based ML methods combine interpretability and rule-based mechanistic encoding with learned prioritization, but their predictive utility is fundamentally bounded by the coverage of extracted templates, motivating template-free alternatives when broad generalization is needed.",
            "uuid": "e2353.3",
            "source_info": {
                "paper_title": "“Found in Translation”: predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models† †Electronic supplementary information (ESI) available: Time-split test set and example predictions, together with attention weights, confidence and token probabilities. See DO",
                "publication_date_yy_mm": "2017-11"
            }
        }
    ],
    "potentially_relevant_new_papers": [
        {
            "paper_title": "Linking the Neural Machine Translation and the Prediction of Organic Chemistry Reactions",
            "rating": 2
        },
        {
            "paper_title": "Learning to SMILE(S)",
            "rating": 1
        },
        {
            "paper_title": "SMILES Enumeration as Data Augmentation for Neural Network Modeling of Molecules",
            "rating": 1
        }
    ],
    "cost": 0.0165095,
    "model_str": "gpt-5-mini"
}</code></pre>
        </div>
        <div class="section">
            <h2>Paper</h2>
            <div class="paper-content"><h1>"Found in Translation": predicting outcomes of complex organic chemistry reactions using neural sequence-to-sequence models $\dagger$</h1>
<p>Philippe Schwaller, ${ }^{1}$ * Théophile Gaudin, $\ddagger$ Dávid Lányi, Costas Bekas and Teodoro Laino</p>
<p>There is an intuitive analogy of an organic chemist's understanding of a compound and a language speaker's understanding of a word. Based on this analogy, it is possible to introduce the basic concepts and analyze potential impacts of linguistic analysis to the world of organic chemistry. In this work, we cast the reaction prediction task as a translation problem by introducing a template-free sequence-to-sequence model, trained end-to-end and fully data-driven. We propose a tokenization, which is arbitrarily extensible with</p>
<p>Received 28th May 2018
Accepted 20th June 2018
DOI: 10.1039/c8sc02339e
rsc.li/chemical-science
reaction information. Using an attention-based model borrowed from human language translation, we improve the state-of-the-art solutions in reaction prediction on the top-1 accuracy by achieving $80.3 \%$ without relying on auxiliary knowledge, such as reaction templates or explicit atomic features. Also, a top-1 accuracy of $65.4 \%$ is reached on a larger and noisier dataset.</p>
<h2>1 Introduction</h2>
<p>After nearly 200 years of documented research, the synthesis of organic molecules remains one of the most important tasks in organic chemistry. The construction of a target molecule from a set of existing reactants and reagents via chemical reactions is attracting much attention because of its economical implications.</p>
<p>Multiple efforts have been made in the past 50 years to rationalize the large number of chemical compounds and reactions identified, which form the large knowledge bases for solving synthetic problems. In 1969, Corey and Wipke ${ }^{\dagger}$ demonstrated that both synthesis and retrosynthesis could be performed by a machine. Their pioneering contribution involved the use of handcrafted rules made by experts, which are commonly known as reaction templates. The templates encode the local changes to the atoms' connectivity under certain conditions accounting for various subtleties of retrosynthesis. A similar algorithm emerged in the late $1970 \mathrm{~s}^{3}$ which also requires a set of expert rules. Unfortunately, rules writing is a tedious task, both time and labor-intensive, and may not cover the entire domain for complex organic chemistry problems. In such cases, profound chemical expertise is still required, and the solutions are usually developed by trained organic chemists. However, it can be extremely challenging even for them to</p>
<p><sup id="fnref:0"><a class="footnote-ref" href="#fn:0">1</a></sup>synthesize a relatively complex molecule, which may take several reaction steps to construct. In fact, navigating the chemical space of drug-related compounds by relying only on intuition may turn a synthesis into a nearly impossible task, especially if the problem is slightly outside the expert's knowledge.</p>
<p>Other approaches extract reaction templates directly from data. ${ }^{3-6}$ In this specific context, candidate products are generated from the templates and then are ranked according to their likelihood. Satoh and Funatsu ${ }^{1,4}$ used various hard-coded criterion to perform the ranking whereas more recent approaches ${ }^{5,6}$ used a deep neural network. However, these types of approaches are fundamentally dependent on the rule-based system component and thus inherit some of its major limitations. In particular, these approaches do not produce sufficiently accurate predictions outside of the training domain.</p>
<p>Nevertheless, the class of algorithms ${ }^{1-6}$ that is based on rules manually encoded by human experts or automatically derived from a reaction database is not the only way to approach the problem of organic synthesis. A second approach for predicting chemical reactions exploits the advancements in computational chemistry to evaluate the energy barriers of a reaction, based on first-principle calculations. ${ }^{7-9}$ Although it is possible to reach very accurate levels of predictions for small systems (chemical reactions involving few hundred atoms), it is still a very computationally daunting task which limits, among other things, the sampling of the solvent degrees of freedom, possibly resulting in unrealistic entropy contributions. Therefore, while computational chemistry may intrinsically solve the problem of reaction prediction, its prohibitive cost does prevent the systematic treatment of all those degrees of freedom that may</p>
<p>drive the chemical reaction along a specific route. For such reasons, its current field of applicability in industry is mainly limited to problems that may have a purely academic interest.</p>
<p>One way to view the reaction prediction task is to cast it as a translation problem, where the objective is to map a text sequence that represents the reactants to a text sequence representing the product. Molecules can equivalently be expressed as text sequences in line notation format, such as the simplified molecular-input line-entry system (SMILES). ${ }^{10}$ Intuitively, there is an analogy between a chemist's understanding of a compound and a language speaker's understanding of a word. No matter how imaginative such an analogy is, it was only very recently that a formal verification was proved. ${ }^{11}$ Cadeddu et al. ${ }^{11}$ showed that organic molecules contain fragments whose rank distribution is essentially identical to that of sentence fragments. Moreover, it has already been shown that a text representation of molecules has been effective in chemoinformatics. ${ }^{12-16}$ This has strengthened our belief that the methods of computational linguistics can have an immense impact on the analysis of organic molecules and reactions.</p>
<p>In this work, we build on the idea of relating organic chemistry to a language and explore the application of state-of-the-art neural machine translation methods, which are sequence-to-sequence (seq2seq) models. We intend to solve the forward-reaction prediction problem, where the starting materials are known and the interest is in generating the products. This approach was first pioneered by Nam and Kim. ${ }^{17}$ Here, we propose a model with higher capacity and a different attention mechanism, which better captures the relation between reactants and products. For the tokenization, we combine an atomwise tokenization for the reactants similar to the work of Nam and $\mathrm{Kim}^{17}$ with a one-hot reagent tokenization suggested by Schneider et al. ${ }^{18}$ Given that training data for reaction condition were available, the tokenization would be arbitrarily extensible with tokens describing those conditions. In this work, we only use a set of the most common reagents. ${ }^{19}$ The overall network architecture is simple, and the model is trained end-to-end, fully data-driven and without additional external information. With this approach, we improved the top-1 accuracy by $0.7 \%$ compared to current template-free solutions, achieving a value of $80.3 \%$ using their own training and test data sets. ${ }^{20}$ The model presented set also a first score of $65.4 \%$ on a noisy single product reactions dataset extracted from US patents.</p>
<h2>2 Related work</h2>
<h3>2.1 Template-based reaction prediction</h3>
<p>Template-based reaction prediction methods have been widely researched in the past couple of years. ${ }^{5,6,21}$ Wei et al. ${ }^{21}$ used a graph-convolution neural network proposed by Duvenaud et al. ${ }^{22}$ to infer fingerprints of the reactants and reagents. They trained a network on the fingerprints to predict which reaction templates to apply to the reactants. Segler and Waller ${ }^{5}$ built a knowledge graph using reaction templates and discovered novel reactions by searching for missing nodes in the graph. Coley et al. ${ }^{6}$ generated for a given set of reactants all possible product candidates from a set of reaction templates extracted
from US patents ${ }^{23}$ and predicted the outcome of the reaction by ranking the candidates with a neural network. One major advancement by Segler and Waller ${ }^{5}$ and Coley et al. ${ }^{6}$ was to consider alternative products as negative examples. Recently, Segler and Waller ${ }^{24}$ introduced a neural-symbolic approach. They extracted reaction rules from the commercially available Reaxys database. Then, they trained a neural network on molecular fingerprints to prioritize templates. The reaction products were generated using the top-ranked templates. In any case, template-based methods have the limitation that they cannot predict anything outside the space covered by the previously extracted templates.</p>
<h3>2.2 Template-free reaction prediction</h3>
<p>While template-free approaches existed for decades, ${ }^{25-28}$ a first rule-free approach was introduced by Kayala et al. ${ }^{29}$ Using fingerprints and hand-crafted features, they predicted a series of mechanistic steps to obtain one reaction outcome. Owing to the sparsity of data on such mechanistic reaction steps, the dataset was self-generated with a template-based expert system. Recently, Jin et al. ${ }^{20}$ used a novel approach based on WeisfeilerLehman Networks (WLN). They trained two independent networks on a set of 400000 reactions extracted from US patents. The first WLN scored the reactivity between atom pairs and predicted the reaction center. All possible bond configuration changes were enumerated to generate product candidates. The candidates that were not removed by hard-coded valence and connectivity rules are then ranked by a WeisfeilerLehman Difference Network (WLDN). Their method achieved a top-1 accuracy of $79.6 \%$ on a test set of 40000 reactions. Jin et al. ${ }^{20}$ claimed to outperform template-based approaches by a margin of $10 \%$ after augmenting the model with the unknown products of the initial prediction to have a product coverage of $100 \%$ on the test set. The dataset with the exact training, validation and test split have been released. $\S$ The complexity of the reaction prediction problem was significantly reduced by removing the stereochemical information.</p>
<h3>2.3 Seq2seq models in organic reaction prediction and retrosynthesis</h3>
<p>The closest work to ours is that of Nam and Kim, ${ }^{17}$ who also used a template-free seq2seq model to predict reaction outcomes. Whereas their network was trained end-to-end on patent data and self-generated reaction examples, they limited their predictions to textbook reactions. Their model was based on the Tensorflow translate model (v0.10.0), ${ }^{30}$ from which they took the default values for most of the hyperparameters. Compared to Nam and Kim, ${ }^{17}$ our model uses Luong's attention mechanism, ${ }^{31}$ through which a mapping between input and output tokens is obtained.</p>
<p>Retrosynthesis is the opposite of reaction prediction. Given a product molecule, the goal is to find possible reactants. In contrast to major product prediction, in retrosynthesis more than one target string might be correct, e.g. a product could be the result of two different reactant pairs. Having no distinct target, the training of a seq2seq model can be more difficult.</p>
<p>The first attempt of using a seq2seq model in retrosynthesis was achieved by Liu et al. ${ }^{32}$ They used a set of 50000 reactions extracted and curated by Schneider et al. ${ }^{19}$ The reactions from that set include stereochemical information and are classified into ten different reactions classes. Overall, none of the previous works was able to demonstrate the full potential of seq2seq models.</p>
<h2>3 Dataset</h2>
<p>All the openly available chemical reaction datasets were derived in some form from the patent text-mining work of Daniel M. Lowe. ${ }^{23}$ Lowe's dataset has recently been updated and contains data extracted from US patents grants and applications dating from 1976 to September 2016. ${ }^{33}$ What makes the dataset particularly interesting is that the quality and noise may be similar to the data a chemical company might own. The portion of granted patents is made of 1808938 reactions, which are described using SMILES. ${ }^{34}$</p>
<p>Looking at the original patent data, it is surprising that a complex chemical synthesis process consisting of multiple steps, performed over hours or days, can be summarized in a simple string. Such reaction strings are composed of three groups of molecules: the reactants, the reagents, and the products, which are separated by a ' $&gt;$ ' sign. The process actions and reaction conditions, for example, have been neglected so far.</p>
<p>To date, there is no standard way of filtering duplicates, incomplete or erroneous reactions in Lowe's dataset. We kept the filtering to a minimum to show that our network is able to handle noisy data. We removed 720768 duplicates by comparing reaction strings without atom mapping and an additional 780 reactions, because the SMILES string could not be canonicalized with RDKit, ${ }^{34}$ as the explicit number of valence electrons for one of the atoms was greater than permitted. We took only single product reactions, corresponding to $92 \%$ of the dataset, to have distinct prediction targets. Although this is a current limitation in the training procedure of our model, it could be easily overcome in the future, for example by defining a specific order for the product molecules. Finally, the dataset was randomly split into training, validation and test sets (18:1:1).!| Reactions with the same reactants, but different reagents and products were kept in the same set.</p>
<p>To compare our model and results with the current state of the art, we used the USPTO set recently published by Jin et al. ${ }^{20}$ It was extracted from Lowe's grants dataset ${ }^{33}$ and contains 479035 atom-mapped reactions without stereochemical information. We restricted ourselves to single product reactions, corresponding to $97 \%$ of the reactions in Jin's USPTO set. An overview of the datasets taken as ground truths for this work is shown in Table 1.</p>
<p>In general, we observe that if reactions that do not work well with the model are removed under the assumption that they are erroneous, the model's accuracy will improve suggesting the presence of a specific tradeoff between coverage and accuracy. This calls for open datasets. The only fair way to compare models is to use datasets to which identical filtering was applied</p>
<p>Table 1 Overview of the datasets used in this work. Jin's is derived from Lowe's grants dataset</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Reactions in</th>
<th style="text-align: left;">Train</th>
<th style="text-align: left;">Valid</th>
<th style="text-align: left;">Test</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Lowe's grants set ${ }^{33}$ no <br> duplicates single product</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">1808938</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">902581</td>
<td style="text-align: left;">50131</td>
<td style="text-align: left;">50258</td>
<td style="text-align: left;">1002970</td>
</tr>
<tr>
<td style="text-align: left;">Jin's USPTO set ${ }^{20}$</td>
<td style="text-align: left;">409035</td>
<td style="text-align: left;">30000</td>
<td style="text-align: left;">40000</td>
<td style="text-align: left;">479035</td>
</tr>
<tr>
<td style="text-align: left;">single product</td>
<td style="text-align: left;">395496</td>
<td style="text-align: left;">29075</td>
<td style="text-align: left;">38647</td>
<td style="text-align: left;">463218</td>
</tr>
</tbody>
</table>
<p>or where the reactions that the model is unable to predict are counted as false predictions.</p>
<h3>3.1 Data preprocessing</h3>
<p>To prepare the reactions, we first used the atom mappings to separate reagents from reactants. Input molecules with atoms appearing in the product were classified as reactants and the others without atoms in the product as reagents. Then, we removed the hydrogen atoms and the atom mappings from the reaction string, and canonicalized the molecules. Afterwards, we tokenized reactants and products atom-wise using the following regular expression:</p>
<p>$$
\begin{aligned}
&amp; \text { token_regex }="({[\wedge} \mid+\mid[B r ?] C T ?[N] O[\$] P[F] I] b|c| n|o|s|p[\backslash{\backslash} \mid . \
&amp; \quad|=|#|-\mid+\mid \backslash \backslash \backslash \backslash \mid:|\sim| \in \mid \backslash ?|&gt;\mid * \mid \backslash \$ \mid \backslash \backslash \mid[0-9]{2}[[0-9]) " .
\end{aligned}
$$</p>
<p>As reagent atoms are never mapped into product atoms, we employed a reagent-wise tokenization using a set of the 76 most common reagents, according to the analysis in ref. 19. Reagents belonging to this set were added as distinct tokens after the first ' $&gt;$ ' sign, ordered by occurrence. Other reagents, which were not in the set, were neglected and removed completely from the reaction string. The separate tokenization would allow us to extend the reaction information and add tokens for reaction conditions without changing the model architecture. The final source sequences were made up of tokenized "reactants &gt; common reagents" and the target sequence of a tokenized "product". The tokens were separated by space characters. The preprocessing steps together with examples are summarized in Table 2. The same preprocessing steps were applied to all datasets.</p>
<h2>4 Model</h2>
<p>To map the sequence of the reactants/reagents to the sequence of the products, we adapted an existing implementation ${ }^{35}$ with minor modifications. Our model architecture, illustrated in Fig. 1, consists of two distinct recurrent neural networks (RNN) working together: (1) an encoder that processes the input sequence and emits its context vector $C$, and (2) a decoder that uses this representation to output a probability over a prediction. For these two RNNs, we rely on specific variants of long short-term memory (LSTM) ${ }^{36}$ because they are able to handle long-range relations in sequences. An LSTM consists of units that process the input data sequentially. Each unit at each time</p>
<p>Table 2 Data preparation steps to obtain source and target sequences. The tokens are separated by a space and individual molecules by a point token</p>
<table>
<thead>
<tr>
<th style="text-align: center;"></th>
<th style="text-align: center;">Step</th>
<th style="text-align: center;">Example (entry 23 738, Jin's USPTO test set ${ }^{20}$ ): reactants &gt; reagents &gt; products</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">(1)</td>
<td style="text-align: center;">Original string</td>
<td style="text-align: center;">$[\mathrm{Cl}: 1][\mathrm{c}: 2] 1[\mathrm{cH}: 3][\mathrm{c}: 4][\mathrm{CH} 3: 8]][\mathrm{n}: 5][\mathrm{n}: 6] 1[\mathrm{CH} 3: 7]-[\mathrm{OH}: 14][\mathrm{N}+: 15]][\mathrm{O}-: 16])=[\mathrm{O}: 17]-<a href="=[\mathrm{O}: 10]">\mathrm{S}: 9</a>(=[\mathrm{O}: 11])$ ([OH:12])[OH:13] $] \rightarrow[\mathrm{Cl}: 1][\mathrm{c}: 2] 1[\mathrm{c}: 3][<a href="=[\mathrm{O}: 14]">\mathrm{N}+: 15</a>[\mathrm{O}-: 16])[\mathrm{c}: 4][[\mathrm{CH} 3: 8]][\mathrm{n}: 5][\mathrm{n}: 6] 1[\mathrm{CH} 3: 7]$</td>
</tr>
<tr>
<td style="text-align: center;">(2)</td>
<td style="text-align: center;">Reactants and reagent separation</td>
<td style="text-align: center;">$[\mathrm{Cl}: 1][\mathrm{c}: 2] 1[\mathrm{cH}: 3][\mathrm{c}: 4][\mathrm{CH} 3: 8]][\mathrm{n}: 5][\mathrm{n}: 6] 1[\mathrm{CH} 3: 7]-[\mathrm{OH}: 14][\mathrm{N}+: 15]][\mathrm{O}-: 16])=[\mathrm{O}: 17]+<a href="=[\mathrm{O}: 10]">\mathrm{S}: 9</a>(=[\mathrm{O}: 11])$ ([OH:12])[OH:13]+[Cl:1][c:2])[c:3][<a href="=[O:14]">N+:15</a>[O-:16])[C:4][CH3:8][\mathrm{n}: 5][n:6]1[CH3:7]</td>
</tr>
<tr>
<td style="text-align: center;">(3)</td>
<td style="text-align: center;">Atom-mapping removal and canonicalization</td>
<td style="text-align: center;">$\mathrm{Cc} 1 \mathrm{cc}(\mathrm{Cl}) \mathrm{n}(\mathrm{C}) \mathrm{n} 1 . \mathrm{O}=\left[\mathrm{N}^{+}\right][[\mathrm{O}-] \mathrm{O}=\mathrm{O}=\mathrm{S}(=\mathrm{O})(\mathrm{O}) \mathrm{O}=\mathrm{Cc} 1 \mathrm{nn}(\mathrm{C}) \mathrm{c}(\mathrm{Cl}) \mathrm{c} 1<a href="=\mathrm{O}">\mathrm{~N}+</a>[\mathrm{O}-]$</td>
</tr>
<tr>
<td style="text-align: center;">(4)</td>
<td style="text-align: center;">Tokenization <br> Source <br> Target</td>
<td style="text-align: center;">$\begin{aligned} &amp; \mathrm{Cc} 1 \mathrm{cc}(\mathrm{Cl}) \mathrm{n}(\mathrm{C}) \mathrm{n} 1 . \mathrm{O}=\left[\mathrm{N}^{+}\right]\left([\mathrm{O}-]\right) \mathrm{O}&gt;\mathrm{A}<em _mathrm_t="\mathrm{t">{\mathrm{t}}&gt;\mathrm{Cc} 1 \mathrm{nn}(\mathrm{C}) \mathrm{c}(\mathrm{Cl}) \mathrm{c} 1\left<a href="=\mathrm{O}">\mathrm{~N}^{+}\right</a>[\mathrm{O}-] \ &amp; \mathrm{Cc} 1 \mathrm{cc}(\mathrm{Cl}) \mathrm{n}(\mathrm{C}) \mathrm{n} 1 . \mathrm{O}=\left[\mathrm{N}^{+}\right]\left([\mathrm{O}-]\right) \mathrm{O}&gt;\mathrm{A}</em> 1\left}} \ &amp; \mathrm{Cc} 1 \mathrm{nn}(\mathrm{C}) \mathrm{c}(\mathrm{Cl}) \mathrm{c<a href="=\mathrm{O}">\mathrm{~N}^{+}\right</a>[\mathrm{O}-] \end{aligned}$</td>
</tr>
</tbody>
</table>
<p><img alt="img-0.jpeg" src="img-0.jpeg" /></p>
<p>Fig. 1 Illustration of an attention-based seq2seq model.
step $t$ processes an element of the input $x_{t}$ and the network's previous hidden state $h_{t-1}$. The output and the hidden state transition is defined by</p>
<p>$$
\begin{gathered}
i_{t}=\sigma\left(W_{i} x_{t}+U_{i} h_{t-1}+b_{i}\right) \
f_{t}=\sigma\left(W_{f} x_{t}+U_{f} h_{t-1}+b_{f}\right) \
o_{t}=\sigma\left(W_{o} x_{t}+U_{o} h_{t-1}+b_{o}\right) \
c_{t}=f_{t} \otimes c_{t-1}+i_{t} \otimes \tanh \left(W_{c} x_{t}+U_{c} h_{t-1}+b_{c}\right) \
h_{t}=o_{t} \otimes \tanh \left(c_{t-1}\right)
\end{gathered}
$$</p>
<p>where $i_{t}, f_{t}$ and $o_{t}$ are the input, forget, and output gates; $c$ is the cell state vector; $W, U$ and $b$ are model parameters learned during training; $\sigma$ is the sigmoid function and $\otimes$ is the entrywise product. For the encoder, we used a bidirectional LSTM (BLSTM). ${ }^{47}$ A BLSTM processes the input sequence in both directions, so they have context not only from the past but also from the future. They comprise two LSTMs: one that processes the sequence forward and the other backward, with their forward and backward hidden states $\hat{h}<em t="t">{t}$ and $\hat{h}</em>$ for each time step. The hidden states of a BLSTM are defined as</p>
<p>$$
h_{t}=\left{\hat{h}<em t="t">{t} ; \hat{h}</em>\right}
$$</p>
<p>Thus we can formalize our encoder as</p>
<p>$$
C=f\left(W_{o} x_{t}, h_{t-1}\right)
$$</p>
<p>where $f$ is a multilayered BLSTM; $h_{t} \in \mathbb{R}^{n}$ are the hidden states at time $t ; x_{t}$ is an element of an input sequence $x=\left{x_{0}, \ldots, x_{T}\right}$, which is a one-hot encoding of our vocabulary; and $W_{o}$ are the learned embedding weights. Generally, $C$ is simply the last of the encoder's hidden states:</p>
<p>$$
C=h_{T}
$$</p>
<p>The second part of the model - the decoder - predicts the probability of observing a product $\hat{y}=\left{\hat{y}<em M="M">{1}, \ldots, \hat{y}</em>\right}$ :</p>
<p>$$
P(\hat{y})=\prod_{i=0}^{M} p\left(\hat{y}<em 1="1">{i} \mid\left{\hat{y}</em>\right}\right)
$$}, \ldots, \hat{y}_{i-1</p>
<p>and for a single token $\hat{y}_{i}$ :</p>
<p>$$
p\left(\hat{y}<em 1="1">{i} \mid\left{\hat{y}</em>}, \ldots, \hat{y<em i="i">{i-1}\right}, c</em>}\right)=g\left(\hat{y<em i="i">{i-1}, x</em>\right)
$$}, c_{i</p>
<p>where $g$ is a stack of LSTM, which outputs the probability $\hat{y}<em i="i">{i}$ for a single token; $s</em>$. We performed experiments using both models and describe Luong's method, which yielded the best overall results.}$ are the decoder's hidden states; and $c_{i}$ is a different context vector for each target token $y_{i}$. Bahdanau et al. ${ }^{48}$ and Luong et al. ${ }^{44}$ proposed attention mechanisms, i.e., different ways for computing the $c_{i}$ vector rather than taking the last hidden state of the encoder $h_{i</p>
<h3>4.1 Luong's attention mechanism</h3>
<p>To compute the context vector, we first have to compute the attention weights $\alpha$ :</p>
<p>$$
\begin{gathered}
\alpha_{o}=\frac{\exp \left(s_{i}^{\top} W_{o} h_{i}\right)}{\sum_{i^{\prime}=0}^{T} \exp \left(s_{i}^{\top} W_{o} h_{i^{\prime}}\right)} \
c_{i}=\sum_{t=0}^{T} \alpha_{o} h_{t}
\end{gathered}
$$</p>
<p>The attention vector is then defined by</p>
<p>$$
a_{i}=\tanh \left(W_{a}\left{c_{i} ; x_{i}\right}\right)
$$</p>
<p>Both $W_{a}$ and $W_{a}$ are learned weights. Then $a$ can be used to compute the probability for a particular token:</p>
<p>$$
p\left(y_{i} \mid\left{y_{1}, \ldots, y_{i-1}\right}, c_{i}\right)=\operatorname{softmax}\left(W_{\mathrm{p}} a_{i}\right)
$$</p>
<p>where $W_{\mathrm{p}}$ are also the learned projection weights.</p>
<h3>4.2 Training details</h3>
<p>During training, all parameters of the network were trained jointly using a stochastic gradient descent. The loss function was a cross-entropy function, expressed as</p>
<p>$$
H(y, \hat{y})=-\sum_{i} y_{i} \log \left(\hat{y}_{i}\right)
$$</p>
<p>for a particular training sequence. The loss was computed over an entire minibatch and then normalized. The weights were initialized using a random uniform distribution ranging from -0.1 to 0.1 . Every 3 epochs, the learning rate was multiplied by a decay factor. The minibatch size was 128 . Gradient clipping was applied when the norm of the gradient exceeded 5.0. The teacher forcing method ${ }^{39}$ was used during training.</p>
<h2>5 Architecture \&amp; hyperparameter search</h2>
<p>Finding the best-performing set of hyperparameters for a deep neural network is not trivial. As mentioned in Section 4, our model has numerous parameters that can influence both its training and its architecture. Depending on those parameters, the performance of the model can vary notably. In order to select the best parameters efficiently, we build a framework around scikit-optimize. ${ }^{40}$ After the evaluation of 10 random sets, a gradient-boosted tree model ${ }^{41}$ was used as surrogate model together with expected improvement as acquisition function ${ }^{42}$ to guide the hyperparameter search on a space defined in Table 3. The sets of hyperparameters were evaluated according to their accuracy on the validation set. In total, we trained 100 models for 30 epochs. The set of best hyperparameters found with this method is highlighted in bold. This model has been further trained to 80 epochs to improve its final accuracy.</p>
<h2>6 Experiments</h2>
<h3>6.1 Reaction prediction</h3>
<p>We evaluated our model on two data sets and compared the performance with other state-of-the-art results. After the</p>
<p>Table 3 Hyperparameters space, parameters for the best model in bold</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Possible values</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Number of units</td>
<td style="text-align: left;">$128,256,512$ or $\mathbf{1 0 2 4}$</td>
</tr>
<tr>
<td style="text-align: left;">Number of layers</td>
<td style="text-align: left;">$\mathbf{2 , 4}$ or 6</td>
</tr>
<tr>
<td style="text-align: left;">Type of encoder</td>
<td style="text-align: left;">LSTM, BLSTM</td>
</tr>
<tr>
<td style="text-align: left;">Output dropout</td>
<td style="text-align: left;">$0-0.9(\mathbf{0 . 7 6 7 6 )}$</td>
</tr>
<tr>
<td style="text-align: left;">State dropout</td>
<td style="text-align: left;">$0-0.9(\mathbf{0 . 5 3 7 4})$</td>
</tr>
<tr>
<td style="text-align: left;">Learning rate</td>
<td style="text-align: left;">$0.1-5(\mathbf{0 . 3 5 5 )}$</td>
</tr>
<tr>
<td style="text-align: left;">Decay factor</td>
<td style="text-align: left;">$0.85-0.99(\mathbf{0 . 8 5 4})$</td>
</tr>
<tr>
<td style="text-align: left;">Type of attention</td>
<td style="text-align: left;">"Luong" or</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">"Badhanau"</td>
</tr>
</tbody>
</table>
<p>hyperparameter optimization, we continued to train our best model on the 395496 reactions in Jin's USPTO train set and tested the fully trained model on Jin's USPTO test set. Additionally, we trained a second model with the same hyperparameters on 902581 randomly chosen single-product reactions from the more complex and noisy Lowe dataset and tested it on a set of 50258 reactions. As molecules are discrete data, changing a single character, such as in source code or arithmetic expressions, can lead to completely different meanings or even invalidate the entire string. Therefore we use fullsequence accuracy, the strictest criteria possible, as our evaluation metric by which a test prediction is considered correct only if all tokens are identical to the ground truth.</p>
<p>The network had to solve three major challenges. First, it had to memorize the SMILES grammar to predict synthetically correct sequences. Second, because we trained it on canonicalized molecules, the network had to learn the canonical representation. Third, the network had to map the reactants plus reagents space to the product space.</p>
<p>Although the training was performed without a beam search, we used a beam width of 10 without length penalty for the inference. Therefore the 10 most probable sequences were kept at every time step. This allowed us to know what probability the network assigned to each of the sequences. We used the top-1 probabilities to analyze the prediction confidence of the network.</p>
<p>The final step was to canonicalize the network output. This simple and deterministic reordering of the tokens improved the accuracy by $1.5 \%$. Thus, molecules that were correctly predicted, but whose tokens were not enumerated in the canonical order, were still counted as correct. The prediction accuracies of our model on different datasets are reported in Table 4. For single product reactions, we achieved an accuracy of $83.2 \%$ on Jin's USPTO test dataset and $65.4 \%$ on Lowe's test set.</p>
<p>An additional validation can be found in the ESI, ${ }^{\ddagger}$ were we used the model trained on Lowe's dataset to predict reactions from pistachio, ${ }^{43}$ a commercial database of chemical reactions extracted from the patent literature. Because the Lowe's dataset used to train the model contained reactions until September 2016, we only predicted the reactions from 2017 and hence, we had a time split.</p>
<h3>6.2 Comparison with the state of the art</h3>
<p>To the best of our knowledge, no previous work has attempted to predict reactions on the complete US patent dataset of Lowe. ${ }^{33}$ Table 5 shows a comparison with the Weisfeiler-Lehman difference networks (WLDN) from Jin et al. ${ }^{20}$ on their USPTO test set.</p>
<p>Table 4 Scores of our model on different single product datasets</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">Accuracies in [\%]</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Test set</td>
<td style="text-align: left;">Size</td>
<td style="text-align: left;">BLEU, ${ }^{43}$ ROUGE $^{44}$</td>
<td style="text-align: left;">Top-1</td>
<td style="text-align: left;">Top-2</td>
<td style="text-align: left;">Top-3</td>
</tr>
<tr>
<td style="text-align: left;">Jin's USPTO ${ }^{20}$</td>
<td style="text-align: left;">38648</td>
<td style="text-align: left;">$95.9,96.0$</td>
<td style="text-align: left;">$\mathbf{8 3 . 2}$</td>
<td style="text-align: left;">87.7</td>
<td style="text-align: left;">89.2</td>
</tr>
<tr>
<td style="text-align: left;">Lowe's ${ }^{33}$</td>
<td style="text-align: left;">50258</td>
<td style="text-align: left;">$90.3,90.9$</td>
<td style="text-align: left;">$\mathbf{6 5 . 4}$</td>
<td style="text-align: left;">71.8</td>
<td style="text-align: left;">74.1</td>
</tr>
</tbody>
</table>
<p>Table 5 Comparison with Jin et al. ${ }^{20}$ The 1352 multiple product reactions ( $3.4 \%$ of the test set) are counted as false predictions for our model</p>
<p>Jin's USPTO test set, ${ }^{20}$ accuracies in [\%]</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Top-1</th>
<th style="text-align: left;">Top-2</th>
<th style="text-align: left;">Top-3</th>
<th style="text-align: left;">Top-5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">WLDN $^{20}$</td>
<td style="text-align: left;">79.6</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">$\mathbf{8 7 . 7}$</td>
<td style="text-align: left;">$\mathbf{8 9 . 2}$</td>
</tr>
<tr>
<td style="text-align: left;">Our model</td>
<td style="text-align: left;">$\mathbf{8 0 . 3}$</td>
<td style="text-align: left;">$\mathbf{8 4 . 7}$</td>
<td style="text-align: left;">86.2</td>
<td style="text-align: left;">87.5</td>
</tr>
</tbody>
</table>
<p>To make a fair comparison, we count all the multiple product reactions in the test set as false predictions for our model because we trained only on the single product reactions. By achieving $80.3 \%$ top-1 accuracy, we perform quantitatively nearly identical. As our model does not rank candidates, but was trained on accurately predicting the top-1 outcome, it is not surprising that the WLDN beats our model in the top-3 and top-5 accuracy. The decoding of the 38648 USPTO test set reactions takes on average 25 ms per reaction, inferred with a beam search. Our model can therefore compete with the state of the art.</p>
<h3>6.3 Prediction confidence</h3>
<p>We analyzed the top-1 beam search probability to obtain information about prediction confidence and to observe how this
probability was related to accuracy. Fig. 2a illustrates the distribution of the top-1 probability for Lowe's test set in cases where the top-1 prediction is correct (left) and where it is wrong (right). A clear difference can be observed and used to define a threshold under which we determine that the network does not know what to predict. Fig. 2b shows the top-1 accuracy and coverage depending on the confidence threshold. For example, for a confidence threshold of 0.83 the model would predict the outcome of $70.2 \%$ of the reactions with an accuracy of $83.0 \%$ and for the remaining $29.8 \%$ of the reaction it would not know the outcome.</p>
<h3>6.4 Attention</h3>
<p>Attention is the key to take into account complex long-range dependencies between multiple tokens. Specific functional groups, solvents or catalysts have an impact on the outcome of a reaction, even if they are far from the reaction center in the molecular graph and therefore also in the SMILES string. Fig. 3 shows how the network learned to focus first on the $\mathrm{C}\left[\mathrm{O}^{-}\right]$ molecule, to map the $\left[\mathrm{O}^{-}\right]$in the input correctly to the O in the target, and to ignore the Br , which is replaced in the target. A few more reaction predictions together with the attention weights, confidence and token probabilities are found in the ESI. $\dagger$
<img alt="img-1.jpeg" src="img-1.jpeg" /></p>
<p>Fig. 2 Top-1 prediction confidence plots for Lowe's test set inferred with a beam search of 10.
<img alt="img-2.jpeg" src="img-2.jpeg" /></p>
<p>Fig. 3 Attention weights of reaction 120 from Jin's USPTO test set. The atom mapping between reactants and product is highlighted. SMILES: $\mathrm{Brc1cncc}(\mathrm{Br}) \mathrm{c} 1 . \mathrm{C}[\mathrm{O}-]&gt;\mathrm{CN}(\mathrm{C}) \mathrm{C}=\mathrm{O} .[\mathrm{Na}+]&gt;\mathrm{COc1cncc}(\mathrm{Br}) \mathrm{c} 1$. Reaction plotted with RDKit. ${ }^{34}$</p>
<h3>6.5 Limitations</h3>
<p>Our model is not without limitations. An obvious disadvantage compared to template-based methods is that the strings are not guaranteed to be a valid SMILES. Incorporating a context-free grammar layer, as was done in ref. 12, could bring minor improvements. Fortunately, only $1.3 \%$ of the top-1 predictions are grammatically erroneous for our model.</p>
<p>Another limitation of the training procedure are multiple product reactions. In contrast to words in a sentence, the exact order in which the molecules in the target string are enumerated does not matter. A viable option would be to include in the training set all possible permutations of the product molecules.</p>
<p>Our hyperparameter space during optimization was restricted to a maximum of 1024 units for the encoder. Using more units could have led to improvements. On Jin's USPTO dataset, the training plateaued because an accuracy of $99.9 \%$ was reached and the network had memorized almost the entire training set. Even on Lowe's noisier dataset, a training accuracy of $94.5 \%$ was observed. A hyperparameter optimization could be performed on Lowe's dataset to improve the prediction accuracy.</p>
<h2>7 Conclusion</h2>
<p>Predicting reaction outcomes is a routine task of many organic chemists trained to recognize structural and reactivity patterns reported in a wide number of publications. Not only did we show that a seq2seq model with correctly tuned hyperparameters can learn the language of organic chemistry, our approach also improved the current state-of-the-art in patent reaction outcome prediction by achieving $80.3 \%$ on Jin's USPTO dataset and $65.4 \%$ on single product reactions of Lowe's dataset. Similar to the work of Nam and Kim, ${ }^{17}$ our approach is fully data driven and free of chemical knowledge/rules and compared to their work, ${ }^{17}$ we take full advantage of the attention mechanism. Also worth mentioning is the overall simplicity of our model that jointly trains the encoder, decoder and attention layers end-to-end. Our hope is that, with this type of model, chemists can codify and perhaps one day fully automate the art of organic synthesis.</p>
<h2>Conflicts of interest</h2>
<p>There are no conflicts to declare.</p>
<h2>Acknowledgements</h2>
<p>We thank Nadine Schneider, Greg Landrum and Roger Sayle for the helpful discussions on RDKit and the datasets. We also would like to acknowledge Marwin Segler and Hiroko Satoh for useful feedback on our approach.</p>
<h2>Notes and references</h2>
<p><sup id="fnref2:0"><a class="footnote-ref" href="#fn:0">1</a></sup>1 E. J. Corey and W. T. Wipke, Science, 1969, 166, 178-192.
2 T. D. Salatin and W. L. Jorgensen, J. Org. Chem., 1980, 45(11), 2043-2051.
3 H. Satoh and K. Funatsu, J. Chem. Inf. Comput. Sci., 1995, 35, $34-44$.
4 H. Satoh and K. Funatsu, J. Chem. Inf. Comput. Sci., 1996, 36, 173-184.
5 M. H. S. Segler and M. P. Waller, Chem.-Eur. J., 2017, 23, 6118-6128.
6 C. W. Coley, R. Barzilay, T. S. Jaakkola, W. H. Green and K. F. Jensen, ACS Cent. Sci., 2017, 3, 434-443.</p>
<p>7 W. R. J. Dolbier, K. Henryk, K. Houk and S. Chimin, Acc. Chem. Res., 1996, 29, 471-477.
8 D. Mondal, S. Y. Li, L. Bellucci, T. Laino, A. Tafi, S. Guccione and S. D. Lepore, J. Org. Chem., 2013, 78, 2118-2127.
9 O. Engkvist, P.-O. Norrby, N. Selmi, Y.-h. Lam, Z. Peng, E. C. Sherer, W. Amberg, T. Erhard and L. A. Smyth, Drug Discovery Today, 2018, 23(6), 1203-1218.
10 D. Weininger, J. Chem. Inf. Comput. Sci., 1988, 281413, 31-36.
11 A. Cadeddu, E. K. Wylie, J. Jurczak, M. Wampler-Doty and B. A. Grzybowski, Angew. Chem., Int. Ed., 2014, 53, 8108-8112.</p>
<p>12 R. Gómez-Bombarelli, J. N. Wei, D. Duvenaud, J. M. Hernández-Lobato, B. Sánchez-Lengeling, D. Sheberla, J. Aguilera-Iparraguirre, T. D. Hirzel, R. P. Adams and A. Aspuru-Guzik, ACS Cent. Sci., 2018, 4, 268-276.</p>
<p>13 S. Jastrzębski, D. Leśniak and W. M. Czarnecki, Learning to SMILE(S), 2016, http://arxiv.org/abs/1602.06289.
14 M. J. Kusner, B. Paige and J. M. Hernández-Lobato, ICML, 2017.</p>
<p>15 E. J. Bjerrum, SMILES Enumeration as Data Augmentation for Neural Network Modeling of Molecules, 2017, http://arxiv.org/ abs/1703.07076.
16 M. H. S. Segler, T. Kogej, C. Tyrchan and M. P. Waller, ACS Cent. Sci., 2018, 4, 120-131.
17 J. Nam and J. Kim, Linking the Neural Machine Translation and the Prediction of Organic Chemistry Reactions, 2016, https://arxiv.org/pdf/1612.09529.pdf.
18 N. Schneider, D. M. Lowe, R. A. Sayle and G. A. Landrum, J. Chem. Inf. Model., 2015, 55, 39-53.</p>
<p>19 N. Schneider, N. Stiefl and G. A. Landrum, J. Chem. Inf. Model., 2016, 56, 2336-2346.
20 W. Jin, C. Coley, R. Barzilay and T. Jaakkola, NIPS, 2017, pp. 2607-2616.
21 J. N. Wei, D. Duvenaud and A. Aspuru-Guzik, ACS Cent. Sci., 2016, 2, 725-723.
22 D. K. Duvenaud, D. Maclaurin, J. Iparraguirre, R. Bombarell, T. Hirzel, A. Aspuru-Guzik and R. P. Adams, NIPS, 2015.</p>
<p>23 D. M. Lowe, Ph.D. thesis, University of Cambridge, 2012.
24 M. H. S. Segler and M. P. Waller, Chem.-Eur. J., 2017, 23, 5966-5971.
25 J. Bauer, E. Fontain, D. Forstmeyer and I. Ugi, Tetrahedron Comput. Methodol., 1988, 1, 129-132.
26 P. Röse and J. Gasteiger, Anal. Chim. Acta, 1990, 235, 163168.</p>
<p>27 W. L. Jorgensen, E. R. Laird, A. J. Gushurst, J. M. Fleischer, S. A. Gothe, H. E. Helson, G. D. Paderes and S. Sinclair, Pure Appl. Chem., 1990, 62, 1921-1932.</p>
<p>28 W. A. Warr, Mol. Inf., 2014, 33, 469-476.
29 M. A. Kayala and P. Baldi, J. Chem. Inf. Model., 2012, 52, 2526-2540.
30 M. Abadi, P. Barham, J. Chen, Z. Chen, A. Davis, J. Dean, M. Devin, S. Ghemawat, G. Irving, M. Isard, M. Kudlur, J. Levenberg, R. Monga, S. Moore, D. G. Murray, B. Steiner, P. Tucker, V. Vasudevan, P. Warden, M. Wicke, Y. Yu, X. Zheng and G. Brain, OSDI, 2016.</p>
<p>31 M.-T. Luong, H. Pham and C. D. Manning, EMNLP, 2015.
32 B. Liu, B. Ramsundar, P. Kawthekar, J. Shi, J. Gomes, Q. Luu Nguyen, S. Ho, J. Sloane, P. Wender and V. Pande, ACS Cent. Sci., 2017, 3, 1103-1113.
33 D. M. Lowe, Chemical reactions from US pat. (1976-Sep2016), 2017, https://figshare.com/articles/Chemical_reactions_from_ US_patents_1976-Sep2016_/5104873.
34 G. Landrum, B. Kelley, P. Tosco, S. Riniker, Gedeck, N. Schneider, R. Vianello, A. Dalke, S. Alexander, S. Turk, M. Swain, B. Cole, J. P, Strets123, JLVarjo, A. Pahl, P. Fuller, G. Doliath, M. Wójcikowski, D. Cosgrove, G. Sforna, M. Nowotka, J. H. Jensen, J. Domański, D. Hall, N. O'Boyle, W.-G. Bolick, Nhfechner and S. Roughley,</p>
<p>Rdkit/Rdkit: 2017_09_1 (Q3 2017) Release, 2017, https:// zenodo.org/record/1004356#.Wd3LDY6I2EI.
35 R. Zhao, T. Luong and E. Brevdo, Neural Machine Translation (seq2seq) Tutorial, 2017, https://github.com/tensorflow/nmt.
36 S. Hochreiter and J. Schmidhuber, Neural Comput., 1997, 9, 1735-1780.
37 A. Graves and J. Schmidhuber, Neural Network., 2005, 18, 602-610.
38 D. Bahdanau, K. Cho and Y. Bengio, ICLR, 2015.
39 R. J. Williams and D. Zipser, Neural Comput., 1989, 1, 270280.</p>
<p>40 T. Head, N. Campos, M. Cherti, A. Fabisch, T. Fan, M. Kumar, G. Louppe, K. Malone, M. Pak, I. Shcherbatyi, T. Smith and Z. Vinicius, Scikit-Optimize, 2017, http://scikitoptimize.github.io/.
41 J. H. Friedman, Ann. Stat., 2001, 29(5), 1189-1232.
42 J. Mockus, J. Global Optim., 1994, 4, 347-365.
43 K. Papineni, S. Roukos, T. Ward and W.-J. Zhu, ACL, 2001.
44 C.-Y. Lin, ACL, 2004.
45 N. Schneider, D. M. Lowe, R. A. Sayle, M. A. Tarselli and G. A. Landrum, J. Med. Chem., 2016, 59, 4385-4402.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:0">
<p>§ https://github.com/wengong-jin/nips17-rexgen.
$\mathbb{\square}$ https://ibm.box.com/v/ReactionSeq2SeqDataset.&#160;<a class="footnote-backref" href="#fnref:0" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:0" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>            </div>
        </div>

    </div>
</body>
</html>