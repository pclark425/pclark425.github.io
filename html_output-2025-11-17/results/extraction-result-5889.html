<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction extraction-result-5889 - Theorizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="header">
        <a href="../index.html"><i class="fas fa-flask"></i> Theorizer</a>
    </div>

    <div class="content">
        <h1>Extracted Data Details for extraction-result-5889</h1>

        <div class="section">
            <h2>Extracted Data (Header)</h2>
            <div class="info-section">
                <p><strong>Extraction ID:</strong> extraction-result-5889</p>
                <p><strong>Extraction Schema Used (ID):</strong> <a href="../schemas/extraction-schema-118.html">extraction-schema-118</a></p>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of large language models (LLMs) being used to distill qualitative laws, principles, or generalizable rules from large numbers of scholarly or scientific papers, including methods, results, limitations, and examples.</div>
                <p><strong>Paper ID:</strong> paper-18b06e896c9a203f30b85c1a3f453dccc766ae68</p>
                <p><strong>Paper Title:</strong> <a href="https://www.semanticscholar.org/paper/18b06e896c9a203f30b85c1a3f453dccc766ae68" target="_blank">Foresight -- Generative Pretrained Transformer (GPT) for Modelling of Patient Timelines using EHRs</a></p>
                <p><strong>Paper TL;DR:</strong> Foresight is a general-purpose model for biomedical concept modelling that can be used for real-world risk forecasting, virtual trials and clinical research to study the progression of disorders, simulate interventions and counterfactuals, and educational purposes.</p>
                <p><strong>Paper Abstract:</strong> Background: Electronic Health Records hold detailed longitudinal information about each patient's health status and general clinical history, a large portion of which is stored within the unstructured text. Existing approaches focus mostly on structured data and a subset of single-domain outcomes. We explore how temporal modelling of patients from free text and structured data, using deep generative transformers can be used to forecast a wide range of future disorders, substances, procedures or findings. Methods: We present Foresight, a novel transformer-based pipeline that uses named entity recognition and linking tools to convert document text into structured, coded concepts, followed by providing probabilistic forecasts for future medical events such as disorders, substances, procedures and findings. We processed the entire free-text portion from three different hospital datasets totalling 811336 patients covering both physical and mental health. Findings: On tests in two UK hospitals (King's College Hospital, South London and Maudsley) and the US MIMIC-III dataset precision@10 0.68, 0.76 and 0.88 was achieved for forecasting the next disorder in a patient timeline, while precision@10 of 0.80, 0.81 and 0.91 was achieved for forecasting the next biomedical concept. Foresight was also validated on 34 synthetic patient timelines by five clinicians and achieved relevancy of 97% for the top forecasted candidate disorder. As a generative model, it can forecast follow-on biomedical concepts for as many steps as required. Interpretation: Foresight is a general-purpose model for biomedical concept modelling that can be used for real-world risk forecasting, virtual trials and clinical research to study the progression of disorders, simulate interventions and counterfactuals, and educational purposes.</p>
                <p><strong>Cost:</strong> 0.005</p>
            </div>
        </div>

        <div class="section">
            <h2>Extracted Data (Details)</h2>
            <p class="empty-note">No extracted data.</p>
        </div>

        <div class="section">
            <h2>Potentially Relevant New Papers (mentioned by this paper)</h2>
            <p class="empty-note">No potentially relevant new papers extracted.</p>
        </div>

        <div class="section">
            <h2>Extracted Data (Debug)</h2>
            <pre><code>{
    "id": "extraction-result-5889",
    "paper_id": "paper-18b06e896c9a203f30b85c1a3f453dccc766ae68",
    "extraction_schema_id": "extraction-schema-118",
    "extracted_data": [],
    "potentially_relevant_new_papers": [],
    "cost": 0.005084249999999999,
    "model_str": "gpt-5-mini"
}</code></pre>
        </div>
        <div class="section">
            <h2>Paper</h2>
            <div class="paper-content"><h1>Foresight - Generative Pretrained Transformer (GPT) for Modelling of Patient Timelines using EHRs</h1>
<p>Zeljko Kraljevic ${ }^{1,6}$, Dan Bean ${ }^{1,6}$, Anthony Shek ${ }^{2,3}$, Rebecca Bendayan ${ }^{1,6}$, Harry Hemingway ${ }^{4,5,7}$, Joshua Au Yeung ${ }^{2,3}$, Alexander Deng ${ }^{1}$, Alfred Baston ${ }^{3}$, Jack Ross ${ }^{2}$, Esther Idowu ${ }^{2}$, James T Teo ${ }^{w, 2,3}$ and Richard JB Dobson ${ }^{w, 1,4,5,6,7}$</p>
<h2>Affiliations:</h2>
<p>1 Department of Biostatistics and Health Informatics, Institute of Psychiatry, Psychology and Neuroscience, King's College London, London, U.K. London
2 Department of Neurology, King's College Hospital NHS Foundation Trust, Denmark Hill, London, London, U.K.
3 Guy's and St Thomas' NHS Foundation Trust
4 Health Data Research UK London, University College London, London, U.K.
5 Institute of Health Informatics, University College London, London, UK
6 NIHR Biomedical Research Centre at South London and Maudsley NHS Foundation Trust and King's College London, London, U.K.
7 NIHR Biomedical Research Centre at University College London Hospitals NHS Foundation Trust, London, $U K$</p>
<p>Evidence before this study: We reviewed published evidence using Google Scholar and PubMed for studies using transformer-based models for forecasting patient timelines. We used the terms ("transformer" OR "bert" OR "generative pretrained transformer") AND ("forecasting" OR "temporal modelling" OR "trajectory") AND ("ehr" OR "health records" OR "medical records" OR "healthcare" OR "medicine" OR "patients" OR "hospital" OR "clinical"), the scope was anywhere in the text, published in 2018 or later. We found many CoVid-19 studies, or studies that focus on a specific biomedical concept or set of concepts. A few studies focus on forecasting a wider range of biomedical concepts, but still require structured data, work with specific timeframes or can only forecast one step into the future.</p>
<p>Added value of this study: Foresight can use unstructured and structured data, can work with different temporal resolutions (e.g. day, week, month) and because it is a generative model, in theory, it can simulate the patient's journey until death. Foresight was tested across hospitals, covering both physical and mental health, and 5 clinicians performed an independent test by simulating patients and outcomes. The tests were not focused on specific disorders or biomedical concepts but cover a broad range of concepts from the SNOMED ontology with 18 different concept types (e.g. Disorders, Substances, Findings and Procedures).</p>
<p>Implications of all the available evidence: Foresight is a powerful tool for forecasting medical concepts with application for medical education, simulation of patient journeys and causal inference research. Being derived from real-world data and modelling historical common practice, it is not expected to be perfectly consistent with contemporary recommended best practice clinical guidelines, so it should not be used for clinical decision support in its current form. As an iterative model, Foresight will improve with more realworld data and improved language processing.</p>
<p>Background: Electronic Health Records hold detailed longitudinal information about each patient's health status and general clinical history, a large portion of which is stored within the unstructured text. Existing approaches focus mostly on structured data and a subset of single-domain outcomes. We explore how temporal modelling of patients from free text and structured data, using deep generative transformers can be used to forecast a wide range of future disorders, substances, procedures or findings.</p>
<p>Methods: We present Foresight, a novel transformer-based pipeline that uses named entity recognition and linking tools to convert document text into structured, coded concepts, followed by providing probabilistic forecasts for future medical events such as disorders, substances, procedures and findings. We processed the entire free-text portion from three different hospital datasets totalling 811336 patients covering both physical and mental health.</p>
<p>Findings: On tests in two UK hospitals (King's College Hospital, South London and Maudsley) and the US MIMIC-III dataset precision@10 0-68, 0-76 and 0-88 was achieved for forecasting the next disorder in a patient timeline, while precision@10 of $0-80,0-81$ and $0-91$ was achieved for forecasting the next biomedical concept. Foresight was also validated on 34 synthetic patient timelines by five clinicians and achieved relevancy of $97 \%$ for the top forecasted candidate disorder. As a generative model, it can forecast follow-on biomedical concepts for as many steps as required.</p>
<p>Interpretation: Foresight is a general-purpose model for biomedical concept modelling that can be used for real-world risk forecasting, virtual trials and clinical research to study the progression of disorders, simulate interventions and counterfactuals, and educational purposes.</p>
<p>Funding: Part of a programme of work that received funding from the NHS AI Lab, National Institute of Health Research BRC and Health Data Research UK. Infrastructure support from KCH, SLaM Biomedical Research Centre and the London AI Centre for Value-Based Healthcare.</p>
<h1>Introduction</h1>
<p>Electronic Health Records (EHRs) contain detailed, longitudinal information about patients' health status and clinical history, much of which is stored in unstructured clinical notes. Previous research on forecasting using EHRs has primarily focused on structured data within EHRs and has often been limited to forecasting specific outcomes within a specific time frame. However, structured datasets are not always available, and even when they are, they can provide a limited view of a patient's journey, as approximately $80 \%$ of patient data is found in free text(1,2). Many previous studies are building upon BERT(3). One example is BEHRT(4) which uses a limited subset of disorders ( 301 in total) available in the structured portion of EHRs. BEHRT is limited to forecasts of disorders occurring in the next patient hospital visit or a specific predefined time frame, consequently requiring that the information is grouped into patient visits. In addition, we note that the approach is a multi-label approach, which can cause difficulties as the number of concepts to be forecasted increases. Another example is G-BERT(5) the inputs for this model are all single-visit samples, which are insufficient to capture long-term contextual information in the EHR. Like in BEHRT, only structured data is used. Lastly, Med-BERT(6) is trained on structured diagnosis data, coded using the International Classification of Diseases (ICD). The model is not directly trained on the target task of forecasting a new disorder but is fine-tuned after the standard Masked Language Modelling (MLM) task. The model is limited to ICD-10 codes and evaluated on a small subset of disorders which may be insufficient for estimating general performance. Apart from BERTbased models, we also note Long Short Term Memory (LSTM) models, like the one proposed by Steinberg et al. LM-LSTM(7). Like other models, they only use structured data and fine-tune their model to forecast limited future events.</p>
<p>We use the unstructured and structured data within the EHR to train a novel model, Foresight, for disorder and more generally biomedical concept forecasting. This work, to some extent, follows the approach outlined in</p>
<p>GPTv3(8) where different tasks are implicit in the dataset; for example, one GPTv3 model can generate HTML code, answer questions, write stories and much more without any fine-tuning. We see the same in Foresight because the same model can be used to forecast the risk of disorders, offer differential diagnosis, suggest substances to be used and more. We test the model across multiple hospitals covering both physical and mental health and make it publicly available via a web application (https://foresight.sites.er.kcl.ac.uk/).</p>
<h1>Methods</h1>
<h2>Overview of the Foresight Pipeline</h2>
<p>The Foresight pipeline (Figure 1) has four main components 1) $\operatorname{CogStack}(1)$, for data retrieval and the first step of data pre-processing; 2) MedCAT(9), for structuring of the free text information from EHRs; 3) Foresight Core, the deep learning model for biomedical concept modelling; and 4) Foresight web-app for interacting with the trained model.
<img alt="img-0.jpeg" src="img-0.jpeg" /></p>
<p>Figure 1. The foresight pipeline.</p>
<h1>Data Collection</h1>
<p>We used three datasets to train/test Foresight: 1) King's College Hospital (KCH) NHS Foundation Trust - all available free text from EHRs from 1999 to January 2021); 2) South London and Maudsley (SLaM) NHS Foundation Trust - all available free text for patients with a serious mental illness diagnosed prior to August 2019. SLaM is one of Europe's largest providers of secondary mental healthcare, serving a geographical catchment of approximately 1.32 million residents, and providing almost complete coverage of secondary mental healthcare provision to all age groups; 3) MIMIC-III - a publicly available dataset developed by the MIT Lab for Computational Physiology, consisting of data associated with patients who stayed in critical care units of the Beth Israel Deaconess Medical Center between 2001 and 2012.</p>
<h2>KCH Dataset</h2>
<p>At KCH we collected a total of 18436789 documents from 1459802 patients (both inpatients and outpatients) from the Allscripts Sunrise EHR using the CogStack platform(1). We retained document types known to be clinically information-rich and removed documents with OCR issues, incomplete triage checklists, questionnaires and forms. Documents have a timestamp representing the time they was written. Some documents were continuous, meaning more information was added to them over time (e.g. clinical notes). These were split into fragments, each containing a time of writing.</p>
<p>The project operated under London Southeast Research Ethics Committee (reference 18/LO/2048) approval granted to the King's Electronic Records Research Interface (KERRI); specific approval for the use of NLP on unstructured clinical text for extraction of standardised biomedical Codes for patient record structuring was reviewed with expert patient input on a patient-led committee with Caldicott Guardian oversight and granted Feb 2020.</p>
<h2>SLaM and MIMIC-III Datasets</h2>
<p>Both SLaM and MIMIC-III datasets were already organised and cleaned. At SLaM, we collected 14995092 documents from 27929 patients with a serious mental illness diagnosis using the CRIS system(10). While the number of documents at SLaM is comparable to KCH , the documents at SLaM are significantly shorter. For MIMIC-III, we used all available free text from clinical notes totalling 2083179 documents from 46520 patients.</p>
<p>This project was approved by the CRIS Oversight Committee, responsible for ensuring all research applications comply with ethical and legal guidelines.</p>
<h2>Named Entity Recognition and Linking</h2>
<p>The Medical Concept Annotation Toolkit (MedCAT) was used to extract biomedical concepts from free text and link them to the SNOMED-CT UK Clinical Edition and Drug Extension (hereafter referred to as SNOMED) concept database. MedCAT uses self-supervised learning to train a Named Entity Recognition and Linking (NER+L) model for any concept database (here SNOMED). MedCAT also supports concept contextualisation e.g. Negation detection (is the concept negated or not), which was important for this work as we were only interested in biomedical concepts from free text that are not negated and that are related to the patient. To train and validate MedCAT we manually annotated 17282 concept mentions from 698 randomly sampled documents from the full KCH dataset. The annotations were done by clinicians using MedCATtrainer(11) and were then used to fine-tune the base MedCAT model. The NER+L models were finetuned with a high precision bias, this was done due to the high level of redundancy in real-world health record data(12), so correct detection was more important as intrinsic redundancies make up for the occasionally missed concept.
We trained two new MedCAT contextualisation models (experiencer and negation) on the 17282 annotations. We then combined the contextualization and NER+L MedCAT models and annotated the entire datasets at KCH/MIMIC/SLaM. To test the patient-level Precision, 100 patients from each dataset were randomly sampled,</p>
<p>and from each one we randomly picked a concept and manually verified whether it was correctly or incorrectly detected. We used the $&gt;1$ occurrences rule, meaning a concept is only considered if it appears at least two times for a patient. MedCAT was not used with the full SNOMED ontology but a subset including Disorder, Substance, Finding and Procedure concepts (full list in Appendix 1). We ended up with 195416 different biomedical concepts from SNOMED.</p>
<p>Once the concepts were extracted, we removed all concepts that occurred $&lt;100$ times in the whole dataset (to remove rare concepts that could identify patients) and grouped them by patient and organised into a timeline (Table 1 and 2). The datasets were split randomly into a train set ( $95 \%$ ) and a test set ( $5 \%$ ). We improved the quality and enriched the timeline by: 1) Keeping a concept that appeared at least twice in the patient's timeline, increasing the precision of our NER+L tool at the cost of recall; 2) Prepending age, sex and ethnicity to the timelines; 3) Adding a token denoting patient's age changes between concepts; 4) Removed concepts that are parents of concepts already in the timeline (i.e. in the past) to denoise the timeline, as in most cases, a parent of an existing concept does not bring any new information; 5) Appending <patient has died> token if the patient had died (only in our largest dataset at KCH ); 6) Splitting the timeline into fragments of length N (also known as buckets, set to 1 day in our case) and removing duplicates within each fragment; 7) appending $&lt;$ SEP $&gt;$ tokens between fragments; and 8) Splitting timelines longer than $\mathrm{L}(\mathrm{L}=256$ concepts in our case) and removing if shorter than 10 concepts; lastly</p>
<table>
<thead>
<tr>
<th></th>
<th>KCH</th>
<th></th>
<th>SLaM</th>
<th></th>
<th>MIMIC-III</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>Train</td>
<td>Test</td>
<td>Train</td>
<td>Test</td>
<td>Train</td>
<td>Test</td>
</tr>
<tr>
<td>Patients</td>
<td>710194</td>
<td>37301</td>
<td>21910</td>
<td>1155</td>
<td>38749</td>
<td>2027</td>
</tr>
<tr>
<td>Patients by Ethnicity</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Asian</td>
<td>34616 (5\%)</td>
<td>1764 (5\%)</td>
<td>1405 (6\%)</td>
<td>63 (6\%)</td>
<td>1031 (3\%)</td>
<td>58 (3\%)</td>
</tr>
<tr>
<td>Black</td>
<td>$\begin{aligned} &amp; 131216 \ &amp; (18 \%) \end{aligned}$</td>
<td>6980 (19\%)</td>
<td>4822 (22\%)</td>
<td>281 (24\%)</td>
<td>3127 (8\%)</td>
<td>146 (7\%)</td>
</tr>
<tr>
<td>Mixed</td>
<td>8484 (1\%)</td>
<td>441 (1\%)</td>
<td>572 (3\%)</td>
<td>28 (2\%)</td>
<td>82 (0\%)</td>
<td>6 (0\%)</td>
</tr>
<tr>
<td>Other</td>
<td>34434 (5\%)</td>
<td>1798 (5\%)</td>
<td>4167 (19\%)</td>
<td>213 (19\%)</td>
<td>2428 (6\%)</td>
<td>120 (6\%)</td>
</tr>
<tr>
<td>Unknown</td>
<td>$\begin{aligned} &amp; 154132 \ &amp; (22 \%) \end{aligned}$</td>
<td>8071 (21\%)</td>
<td>1150 (5\%)</td>
<td>48 (4\%)</td>
<td>4581 (12\%)</td>
<td>263 (13\%)</td>
</tr>
<tr>
<td>White</td>
<td>$\begin{aligned} &amp; 347312 \ &amp; (49 \%) \end{aligned}$</td>
<td>$\begin{aligned} &amp; 18247 \ &amp; (49 \%) \end{aligned}$</td>
<td>9794 (45\%)</td>
<td>522 (45\%)</td>
<td>$\begin{aligned} &amp; 27500 \ &amp; (71 \%) \end{aligned}$</td>
<td>1434 (71\%)</td>
</tr>
<tr>
<td>Patients by Sex</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Female</td>
<td>$\begin{aligned} &amp; 381155 \ &amp; (54 \%) \end{aligned}$</td>
<td>$\begin{aligned} &amp; 19873 \ &amp; (53 \%) \end{aligned}$</td>
<td>$\begin{aligned} &amp; 10054 \ &amp; (46 \%) \end{aligned}$</td>
<td>544 (47\%)</td>
<td>$\begin{aligned} &amp; 16869 \ &amp; (44 \%) \end{aligned}$</td>
<td>868 (43\%)</td>
</tr>
<tr>
<td>Male</td>
<td>$\begin{aligned} &amp; 328866 \ &amp; (46 \%) \end{aligned}$</td>
<td>$\begin{aligned} &amp; 17422 \ &amp; (47 \%) \end{aligned}$</td>
<td>$\begin{aligned} &amp; 11777 \ &amp; (54 \%) \end{aligned}$</td>
<td>607 (53\%)</td>
<td>$\begin{aligned} &amp; 21880 \ &amp; (56 \%) \end{aligned}$</td>
<td>1159 (57\%)</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Unknown</th>
<th style="text-align: left;">$173(0 \%)$</th>
<th style="text-align: left;">$6(0 \%)$</th>
<th style="text-align: left;">$79(0 \%)$</th>
<th style="text-align: left;">$4(0 \%)$</th>
<th style="text-align: left;">$0(0 \%)$</th>
<th style="text-align: left;">$0(0 \%)$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Patients by Age</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">$0-18$</td>
<td style="text-align: left;">$119297$ <br> $(14 \%)$</td>
<td style="text-align: left;">$6402(14 \%)$</td>
<td style="text-align: left;">$1437(4 \%)$</td>
<td style="text-align: left;">$81(4 \%)$</td>
<td style="text-align: left;">$3639(9 \%)$</td>
<td style="text-align: left;">$187(9 \%)$</td>
</tr>
<tr>
<td style="text-align: left;">$18-30$</td>
<td style="text-align: left;">$122137$ <br> $(14 \%)$</td>
<td style="text-align: left;">$6435(15 \%)$</td>
<td style="text-align: left;">$7372(21 \%)$</td>
<td style="text-align: left;">$378(20 \%)$</td>
<td style="text-align: left;">$1727(4 \%)$</td>
<td style="text-align: left;">$90(4 \%)$</td>
</tr>
<tr>
<td style="text-align: left;">$30-41$</td>
<td style="text-align: left;">$138706$ <br> $(16 \%)$</td>
<td style="text-align: left;">$7232(17 \%)$</td>
<td style="text-align: left;">$9009(26 \%)$</td>
<td style="text-align: left;">$500(27 \%)$</td>
<td style="text-align: left;">$2355(6 \%)$</td>
<td style="text-align: left;">$105(5 \%)$</td>
</tr>
<tr>
<td style="text-align: left;">$41-50$</td>
<td style="text-align: left;">$120187$ <br> $(15 \%)$</td>
<td style="text-align: left;">$6390(14 \%)$</td>
<td style="text-align: left;">$7283(21 \%)$</td>
<td style="text-align: left;">$393(21 \%)$</td>
<td style="text-align: left;">$3895(10 \%)$</td>
<td style="text-align: left;">$207(10 \%)$</td>
</tr>
<tr>
<td style="text-align: left;">$51-64$</td>
<td style="text-align: left;">$161799$ <br> $(19 \%)$</td>
<td style="text-align: left;">$8391(19 \%)$</td>
<td style="text-align: left;">$6044(18 \%)$</td>
<td style="text-align: left;">$345(19 \%)$</td>
<td style="text-align: left;">$9481(24 \%)$</td>
<td style="text-align: left;">$496(24 \%)$</td>
</tr>
<tr>
<td style="text-align: left;">$64+$</td>
<td style="text-align: left;">$183423$ <br> $(22 \%)$</td>
<td style="text-align: left;">$9489(21 \%)$</td>
<td style="text-align: left;">$3346(10 \%)$</td>
<td style="text-align: left;">$170(9 \%)$</td>
<td style="text-align: left;">$18648$ <br> $(47 \%)$</td>
<td style="text-align: left;">$990(48 \%)$</td>
</tr>
</tbody>
</table>
<p>Table 1. Selected characteristics from KCH, SLaM and MIMIC-III after preprocessing and timeline creation. For the number of patients by age, we multi-counted if one patient had data which spanned across more than one age group and the percentages in this case refer to the number of timelines instead of patients.</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: center;">KCH</th>
<th style="text-align: center;">SLaM</th>
<th style="text-align: center;">MIMIC-III</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Annotations (Unique)</td>
<td style="text-align: center;">$56736380(10512)$</td>
<td style="text-align: center;">$8958567(2182)$</td>
<td style="text-align: center;">$5046821(2951)$</td>
</tr>
<tr>
<td style="text-align: left;">Annotations per Semantic Type - <br> Total (Unique)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: left;">Disorder</td>
<td style="text-align: center;">$19003851(5632)$</td>
<td style="text-align: center;">$1743625(674)$</td>
<td style="text-align: center;">$2212841(1376)$</td>
</tr>
<tr>
<td style="text-align: left;">Substance</td>
<td style="text-align: center;">$12191307(1185)$</td>
<td style="text-align: center;">$2245368(255)$</td>
<td style="text-align: center;">$891764(472)$</td>
</tr>
<tr>
<td style="text-align: left;">Finding</td>
<td style="text-align: center;">$17282165(2868)$</td>
<td style="text-align: center;">$4747863(929)$</td>
<td style="text-align: center;">$1422286(755)$</td>
</tr>
<tr>
<td style="text-align: left;">Procedure</td>
<td style="text-align: center;">$3056147(63)$</td>
<td style="text-align: center;">$45189(26)$</td>
<td style="text-align: center;">$181254(34)$</td>
</tr>
</tbody>
</table>
<p>Table 2. Four common clinically relevant semantic types after dataset annotation from KCH, SLaM and MIMIC-III. Everything is calculated after data preprocessing and timeline formation.</p>
<h1>Foresight - biomedical concept forecasting</h1>
<p>Foresight is a transformer-based pipeline for modelling biomedical concepts from clinical narratives (Figure 2). It is built on top of the Generative Pretrained Transformer v2(14) architecture allowing causal language modelling (CLM). EHR data is sequentially ordered in time, and this sequential order is important(15). As such Masked Language Modelling (MLM) approaches like BERT(3) were not a good fit because when forecasting</p>
<p>the masked token, BERT models can also look into the future (i.e. they are bi-directional). Formally the task at hand can be defined as given a corpus of patients $U=\left{u_{1}, u_{2}, u_{3}, \ldots\right}$ where each patient is defined as a sequence of tokens $u_{i}=\left{w_{1}, w_{2}, w_{3}, \ldots\right}$ and each token is medically relevant and temporally defined piece of patient data, our objective is the standard language modelling objective:</p>
<p>$$
\mathrm{L}(\mathrm{U})=\sum_{i} \sum_{j} \log P\left(w^{i}{ }<em j-1="j-1">{j} \mid w^{i}{ }</em>}, w^{i}{ <em 0="0">{j-2}, \ldots w^{i}{ }</em> 1
$$}\right) \quad \text { Eq. </p>
<p>In this work each of the tokens w represents a biomedical concept such as disorder, substance or finding (full list in Appendix 1) or patient demographics such as age, gender and ethnicity.
<img alt="img-1.jpeg" src="img-1.jpeg" /></p>
<p>Figure 2. The left portion of the timeline represents the existing/historical data for a patient and the right portion are forecasts from Foresight for different biomedical concept types.</p>
<p>To find the optimal training hyperparameters for the Foresight transformer, we used Population Based Training(16) at KCH on the validation set ( $5 \%$ of the train set), the best result was achieved with n_layers=16, n_attention_heads=16, embedding_dim=512, weight_decay $=1 \mathrm{e}-2, \mathrm{lr}=3 \cdot 14 \mathrm{e}-4$, batch_size $=32$, and warmup_ratio $=0.01$, scheduler used was linear and we run the training for 10 epochs.</p>
<h1>Foresight web app</h1>
<p>To enable easier interaction with the model, the Foresight web app is available at https://foresight.sites.er.kcl.ac.uk/. It can be used to evaluate the model for forecasting biomedical concepts by manually creating a patient timeline or loading an existing timeline. To understand why a certain concept was forecasted, we have added a gradient-based saliency method(17) to the web app allowing calculation and visualision of concept importance for forecasting the next concept in sequence. The web app is also integrated with MedCAT, to enable analysis of unstructured text as input.</p>
<h2>Metrics</h2>
<p>The performance of models is measured using custom metrics that are an extension of the standard precision (TP / TP + FP) and recall (TP / TP + FN) aiming to replicate what the model will be used for but also consider the limitations of the training data.</p>
<p>At each point in a patient's timeline, the model forecasts the next concept. When measuring precision/recall, if the model forecasts that concept X will occur next while it should be concept Y , this forecast is not necessarily wrong. Several factors can influence what exactly is the next concept including a) The way the patient data is entered can significantly change the order of concepts in our timeline (albeit only on a short-time scale); b) Delayed diagnosis; c) Order of how the concept data is recorded in the EHR; and d) Concepts like chronic disorders, that do not have a precise starting point in a patient timeline but can appear a year before/after the real onset. Because of this, when determining whether the forecast is correct, we must evaluate forecasted concepts appearing in a certain time range. We define the following time ranges: 30 days, 1 year, and infinity (meaning all remaining data for a specific patient). For example, if we take the 30-day time range, a forecast is considered</p>
<p>correct if the forecasted concept appears anywhere in that 30-day time range. We did not change the task at hand, and the model is still forecasting the next concept in the timeline, only the way we calculate metrics is modified.</p>
<p>As the model can be used for risk or diagnosis forecast, we are interested in how likely one of the top N forecasts is correct or, in other words, will appear in a patient's future. We used top-k @ {1, 5, 10}</p>
<p>To prevent the model from always forecasting the commonest group of concepts every forecasted concept must match the 'type' of the ground truth concept at that position in the timeline. For example, if for a patient, the next concept in a timeline is 'Diabetes Mellitus (disorder)' the output of the model will be filtered to only concepts of the type 'disorder'.</p>
<p>Finally, for each concept, we keep track of whether the forecasted concept is a new concept or a recurring one in that patient's timeline. A new concept means it has never appeared in the patient's timeline until now, and recurring means it has appeared at least once in past. We also filter the model output so that the forecasts are new/recurring concepts depending on what the ground truth is.</p>
<h1>Results</h1>
<h2>Named Entity Recognition and Linking</h2>
<p>For the extraction of biomedical concepts (disorders, substances, procedures and findings) from clinical text using MedCAT we achieved a precision of $0 \cdot 9549$, recall of $0 \cdot 8077$ and F1 of $0 \cdot 8752$ while the models without precision bias achieved precision of $0 \cdot 9314$, recall of $0 \cdot 8959$ and F1 of $0 \cdot 9133$. For the contextualization, the F1 scores were $0 \cdot 9280$ for Patient and $0 \cdot 9490$ for Negation. The patient level MedCAT precision for each datasets and concept tyle is in Table 3.</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">Precision (True positive / False positive)</th>
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">KCH</td>
<td style="text-align: left;">SLaM</td>
<td style="text-align: left;">MIMIC-III</td>
</tr>
<tr>
<td style="text-align: left;">Overall</td>
<td style="text-align: left;">$97 \%(97 / 3)$</td>
<td style="text-align: left;">$98 \%(98 / 2)$</td>
<td style="text-align: left;">$95 \%(95 / 5)$</td>
</tr>
<tr>
<td style="text-align: left;">Disorder</td>
<td style="text-align: left;">$96 \%(48 / 2)$</td>
<td style="text-align: left;">$100 \%(27 / 0)$</td>
<td style="text-align: left;">$91 \%(44 / 3)$</td>
</tr>
<tr>
<td style="text-align: left;">Substance</td>
<td style="text-align: left;">$95 \%(19 / 1)$</td>
<td style="text-align: left;">$100 \%(26 / 0)$</td>
<td style="text-align: left;">$94 \%(17 / 1)$</td>
</tr>
<tr>
<td style="text-align: left;">Finding</td>
<td style="text-align: left;">$100 \%(24 / 0)$</td>
<td style="text-align: left;">$96 \%(44 / 2)$</td>
<td style="text-align: left;">$97 \%(31 / 1)$</td>
</tr>
<tr>
<td style="text-align: left;">Procedure</td>
<td style="text-align: left;">NA $(0 / 0)$</td>
<td style="text-align: left;">$100 \%(1 / 0)$</td>
<td style="text-align: left;">$100 \%(3 / 0)$</td>
</tr>
</tbody>
</table>
<p>Table 3. Patient-level precision for randomly selected 100 concepts from each of the three datasets. Each concept was required to have $\geq 2$ occurrences in a timeline to be considered as present.</p>
<h2>Foresight - biomedical concept forecasting</h2>
<p>The average precision and recall for forecasting disorders in the largest dataset $(\mathrm{KCH})$ is $0 \cdot 55 / 0 \cdot 47$. Increasing the Time Range, in other words allowing for the forecasted concept to appear anywhere in a patient's future, increases the precision and recall to $0 \cdot 64 / 0 \cdot 54$. Using Top-K of 10 instead of 1 (number of candidates we</p>
<p>consider) results in a precision and recall of 0.84/0.76. Forecasting of recurring concepts works significantly better than forecasting of new concepts. Detailed results are in Table 4.</p>
<p>Regarding the size of the network, we find that adding more layers or increasing the heads x layers up to 32x32 did not make a difference, beyond which there was significant performance deterioration. Increasing the bucket size did not improve the performance; the model trained on bucket size of 1 day outperformed all other models trained on bucket sizes of $3,7,14,30$ and 365 days.</p>
<table>
<thead>
<tr>
<th>Concept <br> Type</th>
<th>Time <br> Range ( <br> days)</th>
<th>Top-K</th>
<th>Precision/Recall</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td>KCH <br> New</td>
<td>KCH <br> Recurring</td>
<td>SLaM <br> New</td>
<td>SLaM <br> Recurring</td>
<td>MIMIC- <br> III New</td>
<td>MIMIC- <br> III <br> Recurring</td>
</tr>
<tr>
<td>All</td>
<td>30</td>
<td>1</td>
<td>$0.43 / 0.32$</td>
<td>$0.83 / 0.77$</td>
<td>$0.38 / 0.23$</td>
<td>$0.77 / 0.67$</td>
<td>$0.52 / 0.32$</td>
<td>$0.83 / 0.67$</td>
</tr>
<tr>
<td>All</td>
<td>30</td>
<td>5</td>
<td>$0.71 / 0.57$</td>
<td>$0.99 / 0.97$</td>
<td>$0.71 / 0.48$</td>
<td>$0.97 / 0.92$</td>
<td>$0.84 / 0.59$</td>
<td>$0.98 / 0.92$</td>
</tr>
<tr>
<td>All</td>
<td>30</td>
<td>10</td>
<td>$\mathbf{0 . 8 0 / 0 . 6 7}$</td>
<td>$\mathbf{1 . 0 0 / 0 . 9 9}$</td>
<td>$\mathbf{0 . 8 1 / 0 . 6 0}$</td>
<td>$\mathbf{0 . 9 9 / 0 . 9 7}$</td>
<td>$\mathbf{0 . 9 1 / 0 . 7 0}$</td>
<td>$\mathbf{1 . 0 0 / 0 . 9 7}$</td>
</tr>
<tr>
<td>All</td>
<td>365</td>
<td>1</td>
<td>$0.47 / 0.33$</td>
<td>$0.88 / 0.83$</td>
<td>$0.51 / 0.25$</td>
<td>$0.86 / 0.77$</td>
<td>$0.54 / 0.33$</td>
<td>$0.85 / 0.70$</td>
</tr>
<tr>
<td>All</td>
<td>inf</td>
<td>1</td>
<td>$0.51 / 0.34$</td>
<td>$0.89 / 0.86$</td>
<td>$0.56 / 0.26$</td>
<td>$0.88 / 0.80$</td>
<td>$0.55 / 0.33$</td>
<td>$0.86 / 0.70$</td>
</tr>
<tr>
<td>Disorders</td>
<td>30</td>
<td>1</td>
<td>$0.30 / 0.21$</td>
<td>$0.80 / 0.72$</td>
<td>$0.34 / 0.24$</td>
<td>$0.78 / 0.72$</td>
<td>$0.46 / 0.26$</td>
<td>$0.79 / 0.60$</td>
</tr>
<tr>
<td>Disorders</td>
<td>30</td>
<td>5</td>
<td>$0.57 / 0.43$</td>
<td>$0.98 / 0.96$</td>
<td>$0.65 / 0.49$</td>
<td>$0.98 / 0.96$</td>
<td>$0.79 / 0.51$</td>
<td>$0.98 / 0.89$</td>
</tr>
<tr>
<td>Disorders</td>
<td>30</td>
<td>10</td>
<td>$\mathbf{0 . 6 8 / 0 . 5 3}$</td>
<td>$\mathbf{1 . 0 0 / 0 . 9 9}$</td>
<td>$\mathbf{0 . 7 6 / 0 . 6 0}$</td>
<td>$\mathbf{1 . 0 0 / 1 . 0 0}$</td>
<td>$\mathbf{0 . 8 8 / 0 . 6 2}$</td>
<td>$\mathbf{0 . 9 9 / 0 . 9 6}$</td>
</tr>
<tr>
<td>Disorders</td>
<td>365</td>
<td>1</td>
<td>$0.35 / 0.23$</td>
<td>$0.87 / 0.81$</td>
<td>$0.44 / 0.26$</td>
<td>$0.86 / 0.80$</td>
<td>$0.49 / 0.26$</td>
<td>$0.83 / 0.64$</td>
</tr>
<tr>
<td>Disorders</td>
<td>inf</td>
<td>1</td>
<td>$0.38 / 0.23$</td>
<td>$0.89 / 0.84$</td>
<td>$0.49 / 0.27$</td>
<td>$0.87 / 0.83$</td>
<td>$0.50 / 0.26$</td>
<td>$0.84 / 0.65$</td>
</tr>
<tr>
<td>Findings</td>
<td>30</td>
<td>1</td>
<td>$0.41 / 0.26$</td>
<td>$0.77 / 0.70$</td>
<td>$0.39 / 0.19$</td>
<td>$0.72 / 0.59$</td>
<td>$0.52 / 0.29$</td>
<td>$0.83 / 0.66$</td>
</tr>
<tr>
<td>Findings</td>
<td>30</td>
<td>5</td>
<td>$0.70 / 0.51$</td>
<td>$0.98 / 0.95$</td>
<td>$0.72 / 0.42$</td>
<td>$0.95 / 0.87$</td>
<td>$0.85 / 0.58$</td>
<td>$0.99 / 0.93$</td>
</tr>
<tr>
<td>Findings</td>
<td>30</td>
<td>10</td>
<td>$\mathbf{0 . 8 0 / 0 . 6 3}$</td>
<td>$\mathbf{1 . 0 0 / 0 . 9 9}$</td>
<td>$\mathbf{0 . 8 2 / 0 . 5 5}$</td>
<td>$\mathbf{0 . 9 9 / 0 . 9 5}$</td>
<td>$\mathbf{0 . 9 2 / 0 . 7 0}$</td>
<td>$\mathbf{1 . 0 0 / 0 . 9 8}$</td>
</tr>
<tr>
<td>Findings</td>
<td>365</td>
<td>1</td>
<td>$0.46 / 0.27$</td>
<td>$0.82 / 0.76$</td>
<td>$0.55 / 0.22$</td>
<td>$0.82 / 0.71$</td>
<td>$0.54 / 0.29$</td>
<td>$0.85 / 0.67$</td>
</tr>
<tr>
<td>Findings</td>
<td>inf</td>
<td>1</td>
<td>$0.51 / 0.28$</td>
<td>$0.84 / 0.80$</td>
<td>$0.61 / 0.22$</td>
<td>$0.85 / 0.74$</td>
<td>$0.55 / 0.29$</td>
<td>$0.85 / 0.68$</td>
</tr>
<tr>
<td>Substances</td>
<td>30</td>
<td>1</td>
<td>$0.46 / 0.34$</td>
<td>$0.87 / 0.79$</td>
<td>$0.36 / 0.25$</td>
<td>$0.85 / 0.78$</td>
<td>$0.52 / 0.32$</td>
<td>$0.84 / 0.70$</td>
</tr>
<tr>
<td>Substances</td>
<td>30</td>
<td>5</td>
<td>$0.77 / 0.63$</td>
<td>$0.99 / 0.98$</td>
<td>$0.70 / 0.55$</td>
<td>$0.99 / 0.98$</td>
<td>$0.85 / 0.61$</td>
<td>$0.99 / 0.94$</td>
</tr>
<tr>
<td>Substances</td>
<td>30</td>
<td>10</td>
<td>$\mathbf{0 . 8 6 / 0 . 7 4}$</td>
<td>$\mathbf{1 . 0 0 / 1 . 0 0}$</td>
<td>$\mathbf{0 . 8 2 / 0 . 6 9}$</td>
<td>$\mathbf{1 . 0 0 / 1 . 0 0}$</td>
<td>$\mathbf{0 . 9 2 / 0 . 7 3}$</td>
<td>$\mathbf{1 . 0 0 / 0 . 9 9}$</td>
</tr>
<tr>
<td>Substances</td>
<td>365</td>
<td>1</td>
<td>$0.49 / 0.35$</td>
<td>$0.90 / 0.86$</td>
<td>$0.43 / 0.277$</td>
<td>$0.91 / 0.87$</td>
<td>$0.53 / 0.32$</td>
<td>$0.85 / 0.71$</td>
</tr>
<tr>
<td>Substances</td>
<td>inf</td>
<td>1</td>
<td>$0.52 / 0.36$</td>
<td>$0.91 / 0.89$</td>
<td>$0.46 / 0.28$</td>
<td>$0.92 / 0.89$</td>
<td>$0.54 / 0.32$</td>
<td>$0.85 / 0.71$</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Procedures</th>
<th style="text-align: left;">30</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">$0.68 / 0.61$</th>
<th style="text-align: left;">$0.92 / 0.91$</th>
<th style="text-align: left;">$0.53 / 0.51$</th>
<th style="text-align: left;">$0.97 / 0.97$</th>
<th style="text-align: left;">$0.80 / 0.67$</th>
<th style="text-align: left;">$0.93 / 0.92$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Procedures</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">$0.93 / 0.91$</td>
<td style="text-align: left;">$1.00 / 1.00$</td>
<td style="text-align: left;">$0.87 / 0.86$</td>
<td style="text-align: left;">$1.00 / 1.00$</td>
<td style="text-align: left;">$0.97 / 0.94$</td>
<td style="text-align: left;">$1.00 / 1.00$</td>
</tr>
<tr>
<td style="text-align: left;">Procedures</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">$\mathbf{0 . 9 7 / 0 . 9 7}$</td>
<td style="text-align: left;">$\mathbf{1 . 0 0 / 1 . 0 0}$</td>
<td style="text-align: left;">$\mathbf{0 . 9 6 / 0 . 9 6}$</td>
<td style="text-align: left;">$\mathbf{1 . 0 0 / 1 . 0 0}$</td>
<td style="text-align: left;">$\mathbf{0 . 9 9 / 0 . 9 9}$</td>
<td style="text-align: left;">$\mathbf{1 . 0 0 / 1 . 0 0}$</td>
</tr>
<tr>
<td style="text-align: left;">Procedures</td>
<td style="text-align: left;">365</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">$0.71 / 0.61$</td>
<td style="text-align: left;">$0.94 / 0.95$</td>
<td style="text-align: left;">$0.54 / 0.51$</td>
<td style="text-align: left;">$0.98 / 0.98$</td>
<td style="text-align: left;">$0.81 / 0.67$</td>
<td style="text-align: left;">$0.95 / 0.94$</td>
</tr>
<tr>
<td style="text-align: left;">Procedures</td>
<td style="text-align: left;">inf</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">$0.73 / 0.62$</td>
<td style="text-align: left;">$0.95 / 0.96$</td>
<td style="text-align: left;">$0.55 / 0.51$</td>
<td style="text-align: left;">$0.98 / 0.98$</td>
<td style="text-align: left;">$0.82 / 0.67$</td>
<td style="text-align: left;">$0.95 / 0.94$</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Table 4. Precision and Recall for next biomedical concept forecast.</p>
<h1>Clinical evaluation of the generated next biomedical concept</h1>
<p>5 clinicians produced 34 synthetic timelines for simulated scenarios similar to a 'clinical'; Each timeline was processed by Foresight ( KCH model) and 5 forecasted Disorder concepts were presented back to the clinicians. In each example, the clinicians were asked to score the relevancy of each of the forecasted concepts. 'Relevancy of forecasted concepts' was chosen over 'Accuracy' as there were frequent disagreements on ground truth on which forecasted concept is most 'correct' (Table 5). Multiple answer relevancy is also more compatible with real-world clinical practice, which is geared towards concurrently considering and managing for multiple possible diagnoses, multiple investigations and multiple interventions rather than the classical "Single Best Answer" commonly used in UK medical examinations( 18,19 ).</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
<th style="text-align: left;">3</th>
<th style="text-align: left;">4</th>
<th style="text-align: left;">5</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Percentage of relevant concepts</td>
<td style="text-align: left;">$97 \%$</td>
<td style="text-align: left;">$96 \%$</td>
<td style="text-align: left;">$90 \%$</td>
<td style="text-align: left;">$89 \%$</td>
<td style="text-align: left;">$88 \%$</td>
</tr>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>Table 5. Results of the manual clinician verification, the columns represent how many concept suggestions from the Foresight KCH model were evaluated, and how many of the suggestions were relevant.</p>
<p>Most concepts forecasted were relevant in sequence. The overall inter-annotator agreement is $86 \%$ (among the 5 clinicians). For cases where all clinicians agree, the percentage of relevant concepts out of the top 5 is $93 \%$, where 4 out of 5 clinicians agree it is $81 \%$, and where 3 out of 5 clinicians agree $62 \%$. An example of a 'clinical vignette' with an error is presented in Figure 3 where 4 out of the 5 forecasted concepts ("normal pressure hydrocephalus", "hydrocephalus", "dementia" and "Alzheimer's disease") were relevant.
<img alt="img-2.jpeg" src="img-2.jpeg" /></p>
<p>Figure 3. An example of a patient timeline with forecasted disorders. Saliency (weight) is shown for the first candidate - Normal Pressure Hydrocephalus. Irrelevant forecast in grey.</p>
<p>This is compatible with clinician heuristic reasoning to expect that the diagnosis was reached as a result of the last concept in the timeline - the "lumbar puncture" procedure (whether by CSF removal or molecular biomarkers) combined in the context of preceding symptoms. The single irrelevant concept of "hypertensive disorder, systemic arterial" failed to take this contextual cue and forecasted a diagnosis that though statistically very common in the age group was highly irrelevant in the context of the other concepts. As per Table 5, most concepts forecasted were relevant showing the contribution of the contextual attentional transformer mechanism in Foresight. For all other timelines and outputs, please review the Foresight repository at https://github.com/CogStack/Foresight .</p>
<h1>Examples of generating multiple synthetic concepts into the future</h1>
<p>Next we demonstrate that Foresight can forecast multiple concepts into the future and create whole patient timelines given a short prompt, in this case, 43-year-old, black, female (Figure 4). We use top-k sampling with k $=100$ and generate timelines of 21 ( 6 base +15 new) concepts.
<img alt="img-3.jpeg" src="img-3.jpeg" /></p>
<p>Figure 4. Generated synthetic timeline examples for input: 43-year-old, black, female (top - KCH model, middle - SLAM model, bottom - MIMIC-III model). The right side of the timelines (orange part) was forecasted by Foresight to simulate the medical future of a 43-year-old black female according to the 3 different models. The distances in the figures do not represent real temporal distances, only the order of concepts in the timelines is important.</p>
<h1>Discussion</h1>
<p>We propose a novel deep-learning generative model of patient timelines within secondary care across mental and physical health, incorporating interoperable disorder, procedure, substance and finding concepts. Foresight is a system wide approach that targets entire hospitals and encompasses all patients together with any biomedical concepts (e.g. disorders) that can be found in both structured and unstructured parts of an EHR. One advantage of Foresight is that it can easily scale to more patients, hospital or disorders with minimal or no modifications, and the more data it receives the better it gets. As a generative model, Foresight is not limited to forecasting the next step, or patient episode; it can continue generating a patient timeline for any desired duration.</p>
<p>Foresight allows simulation of a patient future from single time-steps during a time-constrained inpatient episode all the way to a multi-year timeline of chronic conditions. This opens the door for research into "What if?" scenarios in Health Digital Twins. Digital Twins provide a way to estimate the impact of existing interventions on historical real-world data, beyond a purely dichotomous outcome incorporating how comorbidities (both physical and mental health) may interact with each other and the primary outcome(20,21). Simulations with Foresight provide a route for counterfactual modelling to allow causal inference(22). Such a digital twin could also be used for medical education, where symptoms and medical histories are provided, and differential diagnoses and relevant investigations are quizzed against. This could also be played out into forecasted learning scenarios - the traditional 'clinical vignette' teaching method enhanced by deep learning for the digital era(23). Future work in this area should explore extended timeline simulation in more detail as well as improve on the generated timelines with, for example, a learning-to-rank model similar to how the CLIP(24) model works with DALL-E(25).</p>
<p>The ability to forecast diagnoses/ substances/ procedures is useful for education and exploring the impact in previous real-world practice. While there is a temptation to imagine the forecasted output to be used for clinical care or decision support - this is premature as Foresight is derived from historical common practice so would not be expected to be consistent with contemporary recommended best practice clinical guidelines. Clinical practice and disease patterns drift over time leading to treatments or diagnoses patterns that are era-specific - simulation of a patient with an upper respiratory tract infection in an Influenza-dominant era would be misguided in a Covid-dominant era. Availability of new treatments or interventions would also be under-represented in Foresight, and disease profile would be weighted to conditions and scenarios in secondary and tertiary care, i.e. it would be weighted towards more comorbidity as patients with lower complexity or early-stage conditions who are completely dealt with in primary care would be under-represented in our dataset(26).</p>
<p>Foresight prioritises probability of a concept over urgency and impact of a concept, while real-world clinical practice and heuristic clinical reasoning is often geared towards high impact, high urgency, low probability events over low impact, low urgency, high probability events. This can produce a scenario where forecasted concepts are common but irrelevant to the context, e.g. an elderly patient with a timeline culminating in "central crushing chest pain", is incidentally forecasted to have "cataracts" next, which is irrelevant to the more pressing scenario of the chest pain. This relevancy could be introduced through 'prompt engineering' to filter to only certain disease types or organ systems, types of medications, or to provide a separate relevancy signal. Finally, hallucinations are also well-described in Transformer-based generative models(27) including the recent ChatGPT, so such relevancy and mitigation systems would need to be built before any suitability for clinical decision support.</p>
<p>Due to the modular architecture of the system, the individual subcomponents can be improved or extended: (1) further tuning of the concept capture of the natural language processing; (2) inclusion of quantitative data like blood pressure measurements or blood test results; (3) expansion of dataset for greater coverage of Rare Disease while preserving privacy; and (4) representation of 'external knowledge' from published clinical guidelines, academic publications</p>
<p>We present a novel deep learning generative model of patients using EHRs that is composed of both natural language processing and a longitudinal forecasting, with broad utility across many healthcare domains. We anticipate further iterative improvements as all subcomponents are improvable. Foresight opens the door for digital health twins, synthetic dataset generation, real world risk forecasting, longitudinal research, emulation of virtual trials, medical education and more.</p>
<h1>Code and Data availability statement</h1>
<ul>
<li>SLAM: Due to the confidential nature of free-text data, we are unable to make patient-level data available. CRIS was developed with extensive involvement from service users and adheres to strict governance frameworks managed by service users. It has passed a robust ethics approval process acutely attentive to the use of patient data. Specifically, this system was approved as a dataset for secondary data analysis on this basis by Oxfordshire Research Ethics Committee C (08/H06060/71). The data are deidentified and used in a data-secure format and all patients have the choice to opt-out of their anonymised data being used. Approval for data access can only be provided from the CRIS Oversight Committee at SLaM.</li>
<li>KCH: Source patient-level dataset is not available for privacy reasons. The source dataset is described in the Health Data Research UK Innovation Gateway
https://web.www.healthdatagateway.org/dataset/4e8d4fed-69d6-402c-bd0a-163c23d6b0ee with a wider timeframe (2010-2022).</li>
<li>MIMIC-III data availability statement: MIMIC-III is available publicly at https://physionet.org</li>
<li>Foresight: the code is available on GitHub at https://github.com/CogStack/Foresight and the web app can be accessed on https://foresight.sites.er.kcl.ac.uk/</li>
</ul>
<h2>Disclaimer</h2>
<p>This material includes SNOMED Clinical Terms (SNOMED CT) which is used by permission of the International Health Terminology Standards Development Organisation (IHTSDO). All rights reserved. SNOMED CT, was originally created by The College of American Pathologists. "SNOMED" and "SNOMED CT" are registered trademarks of the IHTSDO.</p>
<h2>Author Contribution</h2>
<p>Conceptualization: ZK, RJBD, DB, JTT, RB
Data curation: ZK, AS, JTT, JAY
Methodology: ZK
Supervision: RJBD, DB, RB
Clinical Validation: JTT, JAY, AD, AB, JR, EI
Software: ZK
Writing - original draft: ZK
Writing - review \&amp; editing: HH, JTT, RJBD, JTT, JAY, AD, AB, JR, EI, DB, RB</p>
<h2>Conflict of Interest</h2>
<p>No conflict of interest.</p>
<h2>Acknowledgements</h2>
<p>RD's work is supported by RJBD is supported by the following: (1) NIHR Biomedical Research Centre at South London and Maudsley NHS Foundation Trust and King's College London, London, UK; (2) Health Data</p>
<p>Research UK, which is funded by the UK Medical Research Council, Engineering and Physical Sciences Research Council, Economic and Social Research Council, Department of Health and Social Care (England), Chief Scientist Office of the Scottish Government Health and Social Care Directorates, Health and Social Care Research and Development Division (Welsh Government), Public Health Agency (Northern Ireland), British Heart Foundation and Wellcome Trust; (3) The BigData@Heart Consortium, funded by the Innovative Medicines Initiative-2 Joint Undertaking under grant agreement No. 116074. This Joint Undertaking receives support from the European Union's Horizon 2020 research and innovation programme and EFPIA; it is chaired by DE Grobbee and SD Anker, partnering with 20 academic and industry partners and ESC; (4) the National Institute for Health Research University College London Hospitals Biomedical Research Centre; (5) the National Institute for Health Research (NIHR) Biomedical Research Centre at South London and Maudsley NHS Foundation Trust and King's College London; (6) the UK Research and Innovation London Medical Imaging \&amp; Artificial Intelligence Centre for Value Based Healthcare; (7) the National Institute for Health Research (NIHR) Applied Research Collaboration South London (NIHR ARC South London) at King's College Hospital NHS Foundation Trust.
DB is funded by a UKRI Innovation Fellowship as part of Health Data Research UK MR/S00310X/1 (https://www.hdruk.ac.uk).
RB is funded in part by grant MR/R016372/1 for the King's College London MRC Skills Development Fellowship programme funded by the UK Medical Research Council (MRC, https://mrc.ukri.org) and by grant ISBRC-1215-20018 for the National Institute for Health Research (NIHR, https://www.nihr.ac.uk) Biomedical Research Centre at South London and Maudsley NHS Foundation Trust and King's College London. THIS Institute.
This paper represents independent research part funded by the National Institute for Health Research (NIHR) Biomedical Research Centre at South London and Maudsley NHS Foundation Trust, The UK Research and Innovation London Medical Imaging \&amp; Artificial Intelligence Centre for Value Based Healthcare (AI4VBH); the National Institute for Health Research (NIHR) Applied Research Collaboration South London (NIHR ARC South London) and King's College London. The views expressed are those of the author(s) and not necessarily those of the NHS, MRC, NIHR or the Department of Health and Social Care. We thank the patient experts of the KERRI committee, Professor Irene Higginson, Professor Alastair Baker, Professor Jules Wendon, Professor Ajay Shah, Dan Persson and Damian Lewsley for their support.</p>
<h1>References</h1>
<ol>
<li>Jackson R, Kartoglu I, Stringer C, Gorrell G, Roberts A, Song X, et al. CogStack - Experiences of deploying integrated information retrieval and extraction services in a large National Health Service Foundation Trust hospital. BMC Med Inform Decis Mak [Internet]. 2018 Jun 25 [cited 2022 Dec 13];18(1):1-13. Available from:
https://bmcmedinformdecismak.biomedcentral.com/articles/10.1186/s12911-018-0623-9</li>
<li>Hardy F, Heyl J, Tucker K, Hopper A, March MJ, Briggs TWR, et al. Data consistency in the English Hospital Episodes Statistics database. BMJ Health Care Inform [Internet]. 2022 Oct 1 [cited 2022 Dec 13];29(1):e100633. Available from: https://informatics.bmj.com/content/29/1/e100633</li>
<li>Devlin J, Chang MW, Lee K, Toutanova K. BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding. NAACL HLT 2019 - 2019 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies - Proceedings of the Conference [Internet]. 2018 Oct 11 [cited 2022 Dec 13];1:4171-86. Available from: https://arxiv.org/abs/1810.04805v2</li>
<li>Li Y, Rao S, Solares JRA, Hassaine A, Ramakrishnan R, Canoy D, et al. BEHRT: Transformer for Electronic Health Records. Scientific Reports 2020 10:1 [Internet]. 2020 Apr 28 [cited 2022 Dec 13];10(1):1-12. Available from: https://www.nature.com/articles/s41598-020-62922-y</li>
<li>
<p>Shang J, Ma T, Xiao C, Sun J. Pre-training of graph augmented transformers for medication recommendation. IJCAI International Joint Conference on Artificial Intelligence [Internet]. 2019 Jun 2 [cited 2022 Dec 13];2019-August:5953-9. Available from: https://arxiv.org/abs/1906.00346v2</p>
</li>
<li>
<p>Rasmy L, Xiang Y, Xie Z, Tao C, Zhi D. Med-BERT: pretrained contextualized embeddings on largescale structured electronic health records for disease prediction. NPJ Digit Med [Internet]. 2021 Dec 1 [cited 2022 Dec 13];4(1). Available from: https://arxiv.org/abs/2005.12833v1</p>
</li>
<li>Steinberg E, Jung K, Fries JA, Corbin CK, Pfohl SR, Shah NH. Language Models Are An Effective Patient Representation Learning Technique For Electronic Health Record Data. J Biomed Inform [Internet]. 2020 Jan 6 [cited 2022 Dec 13];113. Available from: https://arxiv.org/abs/2001.05295v2</li>
<li>Brown TB, Mann B, Ryder N, Subbiah M, Kaplan J, Dhariwal P, et al. Language Models are Few-Shot Learners. Adv Neural Inf Process Syst [Internet]. 2020 May 28 [cited 2022 Dec 13];2020-December. Available from: https://arxiv.org/abs/2005.14165v4</li>
<li>Kraljevic Z, Searle T, Shek A, Roguski L, Noor K, Bean D, et al. Multi-domain clinical natural language processing with MedCAT: The Medical Concept Annotation Toolkit. Artif Intell Med [Internet]. 2021 Jul 1 [cited 2022 Dec 13];117. Available from: https://arxiv.org/abs/2010.01165v2</li>
<li>Stewart R, Soremekun M, Perera G, Broadbent M, Callard F, Denis M, et al. The South London and Maudsley NHS Foundation Trust Biomedical Research Centre (SLAM BRC) case register: Development and descriptive data. BMC Psychiatry [Internet]. 2009 Aug 12 [cited 2022 Dec 13];9(1):1-12. Available from: https://bmcpsychiatry.biomedcentral.com/articles/10.1186/1471-244X-9-51</li>
<li>Searle T, Kraljevic Z, Bendayan R, Bean D, Dobson R. MedCATTrainer: A biomedical free text annotation interface with active learning and research use case specific customisation. EMNLP-IJCNLP 2019 - 2019 Conference on Empirical Methods in Natural Language Processing and the 9th International Joint Conference on Natural Language Processing, Proceedings of System Demonstrations [Internet]. 2019 Jul 16 [cited 2022 Dec 13];139-44. Available from: https://arxiv.org/abs/1907.07322v1</li>
<li>Searle T, Ibrahim Z, Teo J, Dobson R. Estimating redundancy in clinical text. J Biomed Inform [Internet]. 2021 Dec 1 [cited 2022 Dec 13];124. Available from: https://pubmed.ncbi.nlm.nih.gov/34695581/</li>
<li>Wang C, Cho K, Gu J. Neural machine translation with byte-level subwords. AAAI 2020 - 34th AAAI Conference on Artificial Intelligence [Internet]. 2020 Sep 7 [cited 2023 Jan 7];9154-60. Available from: https://arxiv.org/abs/1909.03341v2</li>
<li>Radford A, Wu J, Child R, Luan D, Amodei D, Sutskever I. Language Models are Unsupervised Multitask Learners. [cited 2022 Dec 13]; Available from: https://github.com/codelucas/newspaper</li>
<li>Singh A, Nadkarni G, Gottesman O, Ellis SB, Bottinger EP, Guttag J v. Incorporating temporal EHR data in predictive models for risk stratification of renal function deterioration. J Biomed Inform [Internet]. 2015 Feb 1 [cited 2022 Dec 13];53:220-8. Available from: https://pubmed.ncbi.nlm.nih.gov/25460205/</li>
<li>Jaderberg M, Dalibard V, Osindero S, Czarnecki WM, Donahue J, Razavi A, et al. Population Based Training of Neural Networks. 2017 Nov 27 [cited 2022 Dec 13]; Available from: https://arxiv.org/abs/1711.09846v2</li>
<li>Atanasova P, Simonsen JG, Lioma C, Augenstein I. A diagnostic study of explainability techniques for text classification. EMNLP 2020 - 2020 Conference on Empirical Methods in Natural Language Processing, Proceedings of the Conference [Internet]. 2020 Sep 25 [cited 2022 Dec 13];3256-74. Available from: https://arxiv.org/abs/2009.13295v1</li>
<li>Sam AH, Westacott R, Gurnell M, Wilson R, Meeran K, Brown C. Comparing single-best-answer and very-short-answer questions for the assessment of applied medical knowledge in 20 UK medical schools: Cross-sectional study. BMJ Open [Internet]. 2019 Sep 1 [cited 2022 Dec 13];9(9):e032550. Available from: https://bmjopen.bmj.com/content/9/9/e032550</li>
<li>Sam AH, Hameed S, Harris J, Meeran K. Validity of very short answer versus single best answer questions for undergraduate assessment. BMC Med Educ [Internet]. 2016 Oct 13 [cited 2022 Dec 13];16(1):1-4. Available from: https://bmcmededuc.biomedcentral.com/articles/10.1186/s12909-016-0793-z</li>
<li>Coorey G, Figtree GA, Fletcher DF, Snelson VJ, Vernon ST, Winlaw D, et al. The health digital twin to tackle cardiovascular disease - a review of an emerging interdisciplinary field. npj Digital Medicine</li>
</ol>
<p>2022 5:1 [Internet]. 2022 Aug 26 [cited 2022 Dec 13];5(1):1-12. Available from: https://www.nature.com/articles/s41746-022-00640-7
21. Venkatesh KP, Raza MM, Kvedar JC. Health digital twins as tools for precision medicine: Considerations for computation, implementation, and regulation. npj Digital Medicine 2022 5:1 [Internet]. 2022 Sep 22 [cited 2022 Dec 13];5(1):1-2. Available from: https://www.nature.com/articles/s41746-022-00694-7
22. Hfler M. Causal inference based on counterfactuals. BMC Med Res Methodol [Internet]. 2005 Sep 13 [cited 2022 Dec 13];5(1):1-12. Available from: https://bmcmedresmethodol.biomedcentral.com/articles/10.1186/1471-2288-5-28
23. Jeffries C, Maeder DW. Using Vignettes To Build and Assess Teacher Understanding of Instructional Strategies. Professional Educator. 2005;27:17-28.
24. Radford A, Kim JW, Hallacy C, Ramesh A, Goh G, Agarwal S, et al. Learning Transferable Visual Models From Natural Language Supervision. 2021 Feb 26 [cited 2022 Dec 13]; Available from: https://arxiv.org/abs/2103.00020v1
25. Ramesh A, Pavlov M, Goh G, Gray S, Voss C, Radford A, et al. Zero-Shot Text-to-Image Generation. 2021 Feb 24 [cited 2022 Dec 13]; Available from: https://arxiv.org/abs/2102.12092v2
26. Bean D, Kraljevic Z, Shek A, Teo J, Dobson R. Hospital-wide Natural Language Processing summarising the health data of 1 million patients. medRxiv [Internet]. 2022 Sep 16 [cited 2022 Dec 13];2022.09.15.22279981. Available from:
https://www.medrxiv.org/content/10.1101/2022.09.15.22279981v2
27. Ji Z, Lee N, Frieske R, Yu T, Su D, Xu Y, et al. Survey of Hallucination in Natural Language Generation. ACM Comput Surv [Internet]. 2022 Feb 7 [cited 2022 Dec 13]; Available from: http://arxiv.org/abs/2202.03629
28. Vasey B, Nagendran M, Campbell B, Clifton DA, Collins GS, Denaxas S, et al. Reporting guideline for the early stage clinical evaluation of decision support systems driven by artificial intelligence: DECIDEAI. BMJ [Internet]. 2022 May 18 [cited 2022 Dec 13];377. Available from:
https://www.bmj.com/content/377/bmj-2022-070904</p>
<h1>Appendix 1</h1>
<p>A list of all concept types that were selected from the SNOMED ontology: Occupation; Disorder; Clinical drug; Tumour staging; Record artifact; Medicinal product form; Organism; Situation; Observable entity; Substance; Finding; Assessment scale; Medicinal product; Body structure; Physical object; Morphologic abnormality; Regime/Therapy; Product; Procedure.</p>
<h2>Appendix 2</h2>
<table>
<thead>
<tr>
<th style="text-align: center;">KCH</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">SLaM</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;">MIMIC-III</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Name</td>
<td style="text-align: center;">TP</td>
<td style="text-align: center;">FP</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">TP</td>
<td style="text-align: center;">FP</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">TP</td>
<td style="text-align: center;">FP</td>
</tr>
<tr>
<td style="text-align: center;">Fast Alcohol Screening Test (assessment scale)"</td>
<td style="text-align: center;">51</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Cardiac pacemaker, device (physical object)</td>
<td style="text-align: center;">22</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Care plan (record artifact)</td>
<td style="text-align: center;">341</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Cellulitis of eyelid (disorder)</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Conservative therapy (regime/therapy)</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Cardiac pacemaker, device (physical object)</td>
<td style="text-align: center;">166</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Deficiency of transaldolase (disorder)</td>
<td style="text-align: center;">41</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Left kidney structure (body structure)</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Anoxic encephalopathy (disorder)</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Congenital disease (disorder)</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Product containing antigen of whole cell pertussis and diphtheria toxoid and tetanus toxoid adsorbed (medicinal product)</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Conservative therapy (regime/therapy)</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Alpha-methylacyl-CoA racemase deficiency disorder (disorder)</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Moderate pain (finding)</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Product containing benzocaine in cutaneous dose form (medicinal product form)</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Ichthyosis (disorder)</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Sickle cell-hemoglobin SS disease (disorder)</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Human immunodeficiency virus (organism)</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">McCune Albright syndrome (disorder)</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Human immunodeficiency virus (organism)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Pseudocyst of pancreas (disorder)</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Human immunodeficiency virus (organism)</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Allergies and adverse reaction (record artifact)</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Poor muscle tone (finding)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Polymyxin (substance)</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Vasovagal syncope (disorder)</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Status epilepticus (disorder)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">Hepatitis C antibody test negative (finding)</td>
<td style="text-align: center;">28</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Diurnal variation of mood (finding)</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">Fracture of pubic rami (disorder)</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">Sprain of ligament (disorder)</td>
<td style="text-align: center;">145</td>
<td style="text-align: center;">1236</td>
<td style="text-align: center;">Victim of neglect (finding)</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">116</td>
<td style="text-align: center;">Urinary tract infectious disease (disorder)</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">107</td>
</tr>
<tr>
<td style="text-align: center;">Radiating pain (finding)</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">339</td>
<td style="text-align: center;">Smartly dressed (finding)</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">268</td>
<td style="text-align: center;">Hyperlipidemia (disorder)</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">250</td>
</tr>
<tr>
<td style="text-align: center;">Varicella (disorder)</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">410</td>
<td style="text-align: center;">Omeprazole (substance)</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">120</td>
<td style="text-align: center;">Traumatic tear of skin (disorder)</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">134</td>
</tr>
<tr>
<td style="text-align: center;">Fibromyalgia (disorder)</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">295</td>
<td style="text-align: center;">Backache (finding)</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">171</td>
<td style="text-align: center;">Hypercholesterolemia (disorder)</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">118</td>
</tr>
<tr>
<td style="text-align: center;">Generally unwell (finding)</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">192</td>
<td style="text-align: center;">Non-smoker (finding)</td>
<td style="text-align: center;">19</td>
<td style="text-align: center;">161</td>
<td style="text-align: center;">Dry cough (finding)</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">103</td>
</tr>
<tr>
<td style="text-align: center;">Acne vulgaris (disorder)</td>
<td style="text-align: center;">67</td>
<td style="text-align: center;">752</td>
<td style="text-align: center;">Visual hallucinations (finding)</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">124</td>
<td style="text-align: center;">Depressive disorder (disorder)</td>
<td style="text-align: center;">68</td>
<td style="text-align: center;">239</td>
</tr>
<tr>
<td style="text-align: center;">Sprain of ankle (disorder)</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">626</td>
<td style="text-align: center;">Low blood pressure (disorder)</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">130</td>
<td style="text-align: center;">Left atrial abnormality (disorder)</td>
<td style="text-align: center;">33</td>
<td style="text-align: center;">121</td>
</tr>
<tr>
<td style="text-align: center;">Right bundle branch block (disorder)</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">103</td>
<td style="text-align: center;">Feeling mixed emotions (finding)</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">255</td>
<td style="text-align: center;">Oxycodone (substance)</td>
<td style="text-align: center;">43</td>
<td style="text-align: center;">174</td>
</tr>
<tr>
<td style="text-align: center;">Fracture of hand (disorder)</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">228</td>
<td style="text-align: center;">Lethargy (finding)</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">108</td>
<td style="text-align: center;">Abscess (disorder)</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">109</td>
</tr>
<tr>
<td style="text-align: center;">Open wound of hand (disorder)</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">167</td>
<td style="text-align: center;">Adequately dressed (finding)</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">106</td>
<td style="text-align: center;">Calculus in biliary tract (disorder)</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">113</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">KCH</th>
<th style="text-align: left;">SLaM</th>
<th style="text-align: left;">MIMIC-III</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Table A1. Top and bottom 10 best/worst performing concepts with respect to precision, and the associated count in the test set. Precision from NEW concepts. TP - number of true positives and FP - number of false positives on the test set.
*These concepts are inaccuracies of disambiguation in the NER+L to be removed by further fine-tuning.</p>
<h1>Appendix 3</h1>
<table>
<thead>
<tr>
<th style="text-align: center;"></th>
<th style="text-align: center;">KCH</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">SLaM</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">MIMIC-III</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"></td>
<td style="text-align: center;">Train</td>
<td style="text-align: center;">Test</td>
<td style="text-align: center;">Train</td>
<td style="text-align: center;">Test</td>
<td style="text-align: center;">Train</td>
<td style="text-align: center;">Test</td>
</tr>
<tr>
<td style="text-align: center;">Mean Timeline Length in concepts (in years from first to last admission)</td>
<td style="text-align: center;">75 (3.3)</td>
<td style="text-align: center;">75 (3.3)</td>
<td style="text-align: center;">387 (6.9)</td>
<td style="text-align: center;">414 (7.3)</td>
<td style="text-align: center;">$123(0.5)$</td>
<td style="text-align: center;">$121(0.5)$</td>
</tr>
<tr>
<td style="text-align: center;">Mean Timeline Length by Ethnicity in concepts (in years from first to last admission)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">Asian</td>
<td style="text-align: center;">80 (3.6)</td>
<td style="text-align: center;">78 (3.5)</td>
<td style="text-align: center;">361 (6.9)</td>
<td style="text-align: center;">344 (7.4)*</td>
<td style="text-align: center;">116 (0.5)</td>
<td style="text-align: center;">102 (0.3)*</td>
</tr>
<tr>
<td style="text-align: center;">Black</td>
<td style="text-align: center;">77 (4.7)</td>
<td style="text-align: center;">79 (4.6)</td>
<td style="text-align: center;">524 (8.9)</td>
<td style="text-align: center;">596 (9.2)</td>
<td style="text-align: center;">141 (0.8)</td>
<td style="text-align: center;">157 (0.7)</td>
</tr>
<tr>
<td style="text-align: center;">Mixed</td>
<td style="text-align: center;">55 (3.7)</td>
<td style="text-align: center;">58 (3.6)</td>
<td style="text-align: center;">516 (7.7)</td>
<td style="text-align: center;">307 (6.9)*</td>
<td style="text-align: center;">120 (0.5)*</td>
<td style="text-align: center;">71 (0.1)*</td>
</tr>
<tr>
<td style="text-align: center;">Other</td>
<td style="text-align: center;">66 (3.2)</td>
<td style="text-align: center;">65 (3.2)</td>
<td style="text-align: center;">372 (6.3)</td>
<td style="text-align: center;">367 (6.6)</td>
<td style="text-align: center;">122 (0.5)</td>
<td style="text-align: center;">131 (0.5)</td>
</tr>
<tr>
<td style="text-align: center;">Unknown</td>
<td style="text-align: center;">55 (2.1)</td>
<td style="text-align: center;">55 (2.0)</td>
<td style="text-align: center;">92 (1.6)</td>
<td style="text-align: center;">58 (1.0)*</td>
<td style="text-align: center;">91 (0.1)</td>
<td style="text-align: center;">96 (0.1)</td>
</tr>
<tr>
<td style="text-align: center;">White</td>
<td style="text-align: center;">86 (3.4)</td>
<td style="text-align: center;">85 (3.3)</td>
<td style="text-align: center;">357 (6.7)</td>
<td style="text-align: center;">382 (7.4)</td>
<td style="text-align: center;">128 (0.5)</td>
<td style="text-align: center;">122 (0.5)</td>
</tr>
<tr>
<td style="text-align: center;">Mean Timeline Length by Sex in concepts (in years from first to last admission)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">Female</td>
<td style="text-align: center;">74 (3.5)</td>
<td style="text-align: center;">74 (3.4)</td>
<td style="text-align: center;">369 (6.8)</td>
<td style="text-align: center;">394 (7.3)</td>
<td style="text-align: center;">125 (0.5)</td>
<td style="text-align: center;">123 (0.5)</td>
</tr>
<tr>
<td style="text-align: center;">Male</td>
<td style="text-align: center;">78 (3.2)</td>
<td style="text-align: center;">77 (3.2)</td>
<td style="text-align: center;">404 (7.0)</td>
<td style="text-align: center;">434 (7.4)</td>
<td style="text-align: center;">123 (0.5)</td>
<td style="text-align: center;">119 (0.5)</td>
</tr>
<tr>
<td style="text-align: center;">Unknown</td>
<td style="text-align: center;">88 (1.5)</td>
<td style="text-align: center;">16 (0.4)*</td>
<td style="text-align: center;">238 (5.0)*</td>
<td style="text-align: center;">109 (3.8)*</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr>
<td style="text-align: center;">Mean Timeline Length by Age in concepts (in years</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>from first to last admission)</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>$0-18$</td>
<td>$47(3.2)$</td>
<td>$48(3.2)$</td>
<td>$237(1.6)$</td>
<td>$226(1.6)^{*}$</td>
<td>$73(0.1)$</td>
<td>$31(0.0)$</td>
</tr>
<tr>
<td>$18-30$</td>
<td>$43(2.8)$</td>
<td>$42(2.7)$</td>
<td>$359(3.6)$</td>
<td>$373(3.6)$</td>
<td>$87(0.3)$</td>
<td>$73(0.2)^{*}$</td>
</tr>
<tr>
<td>$30-41$</td>
<td>$50(3.2)$</td>
<td>$49(3.2)$</td>
<td>$405(6.2)$</td>
<td>$438(6.7)$</td>
<td>$103(0.5)$</td>
<td>$105(0.5)$</td>
</tr>
<tr>
<td>$41-50$</td>
<td>$67(3.7)$</td>
<td>$66(3.5)$</td>
<td>$414(8.1)$</td>
<td>$448(8.0)$</td>
<td>$119(0.6)$</td>
<td>$112(0.6)$</td>
</tr>
<tr>
<td>$51-64$</td>
<td>$87(3.8)$</td>
<td>$88(3.8)$</td>
<td>$432(9.5)$</td>
<td>$444(10.2)$</td>
<td>$126(0.6)$</td>
<td>$123(0.6)$</td>
</tr>
<tr>
<td>$64+$</td>
<td>$122(3.4)$</td>
<td>$121(3.4)$</td>
<td>$321(7.7)$</td>
<td>$365(8.4)$</td>
<td>$132(0.6)$</td>
<td>$128(0.5)$</td>
</tr>
<tr>
<td>Mean Number of Concepts of Certain Type per Timeline</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Disorder</td>
<td>25</td>
<td>25</td>
<td>75</td>
<td>81</td>
<td>54</td>
<td>53</td>
</tr>
<tr>
<td>Substance</td>
<td>16</td>
<td>16</td>
<td>97</td>
<td>102</td>
<td>21</td>
<td>21</td>
</tr>
<tr>
<td>Finding</td>
<td>23</td>
<td>23</td>
<td>205</td>
<td>221</td>
<td>35</td>
<td>34</td>
</tr>
<tr>
<td>Procedure</td>
<td>4</td>
<td>4</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Table A2. Selected timeline characteristics from KCH, SLaM and MIMIC-III. For mean timeline length by age, we took the most recent age of a patient and used that to determine the age group. If a number is marked with an * it means the calculation was done on less than 100 timelines (patients).</p>            </div>
        </div>

    </div>
</body>
</html>