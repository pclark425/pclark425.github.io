<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction extraction-result-508 - Theorizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="header">
        <a href="../index.html"><i class="fas fa-flask"></i> Theorizer</a>
    </div>

    <div class="content">
        <h1>Extracted Data Details for extraction-result-508</h1>

        <div class="section">
            <h2>Extracted Data (Header)</h2>
            <div class="info-section">
                <p><strong>Extraction ID:</strong> extraction-result-508</p>
                <p><strong>Extraction Schema Used (ID):</strong> <a href="../schemas/extraction-schema-15.html">extraction-schema-15</a></p>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of how language models encode, represent, or utilize spatial knowledge, procedural knowledge, or object-relational knowledge for embodied planning, navigation, or manipulation tasks, particularly when the model operates without direct sensory input.</div>
                <p><strong>Paper ID:</strong> paper-289fb3709475f5c87df8d97f129af54029d27fee</p>
                <p><strong>Paper Title:</strong> <a href="https://www.semanticscholar.org/paper/289fb3709475f5c87df8d97f129af54029d27fee" target="_blank">Compositional Attention Networks for Machine Reasoning</a></p>
                <p><strong>Paper Venue:</strong> International Conference on Learning Representations</p>
                <p><strong>Paper TL;DR:</strong> The MAC network is presented, a novel fully differentiable neural network architecture, designed to facilitate explicit and expressive reasoning that is computationally-efficient and data-efficient, in particular requiring 5x less data than existing models to achieve strong results.</p>
                <p><strong>Paper Abstract:</strong> We present the MAC network, a novel fully differentiable neural network architecture, designed to facilitate explicit and expressive reasoning. MAC moves away from monolithic black-box neural architectures towards a design that encourages both transparency and versatility. The model approaches problems by decomposing them into a series of attention-based reasoning steps, each performed by a novel recurrent Memory, Attention, and Composition (MAC) cell that maintains a separation between control and memory. By stringing the cells together and imposing structural constraints that regulate their interaction, MAC effectively learns to perform iterative reasoning processes that are directly inferred from the data in an end-to-end approach. We demonstrate the model's strength, robustness and interpretability on the challenging CLEVR dataset for visual reasoning, achieving a new state-of-the-art 98.9% accuracy, halving the error rate of the previous best model. More importantly, we show that the model is computationally-efficient and data-efficient, in particular requiring 5x less data than existing models to achieve strong results.</p>
                <p><strong>Cost:</strong> 0.012</p>
            </div>
        </div>

        <div class="section">
            <h2>Extracted Data (Details)</h2>
            <div class="extraction-instance-container" id="e508.0">
                <h3 class="extraction-instance">Extracted Data Instance 0 (e508.0)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of how language models encode, represent, or utilize spatial knowledge, procedural knowledge, or object-relational knowledge for embodied planning, navigation, or manipulation tasks, particularly when the model operates without direct sensory input.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>MAC</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Memory, Attention and Composition (MAC) network</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>A recurrent, fully-differentiable architecture for multi-step reasoning that explicitly separates control (question-driven operations) from memory (intermediate results) and uses iterative attention to read from a knowledge base (image features) and compose answers.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td>here</td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>model_name</strong></td>
                            <td>MAC network</td>
                        </tr>
                        <tr>
                            <td><strong>model_size</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>model_description</strong></td>
                            <td>A sequence of p identical recurrent MAC cells (default p=12), each with dual hidden states: a control state (attention over contextual question word vectors) and a memory state (intermediate visual result). Each cell has three sub-units: Control Unit (attends to question words to produce an operation embedding), Read Unit (two-stage attention over knowledge-base elements conditioned on control and prior memory, includes multiplicative interactions between memory and KB elements), and Write Unit (integrates read content with prior memory; optional self-attention across previous memory states and a sigmoid memory gate to skip or interpolate). Image features are precomputed conv features (ResNet101 conv4 then additional CNN layers); word embeddings are learned and question processed via biLSTM.</td>
                        </tr>
                        <tr>
                            <td><strong>task_name</strong></td>
                            <td>CLEVR visual question answering (VQA)</td>
                        </tr>
                        <tr>
                            <td><strong>task_description</strong></td>
                            <td>Given a rendered synthetic 3D scene (image) and a compositional natural-language question about objects/properties/relations in the scene, predict the correct answer from a fixed candidate set. Questions test transitive relations (e.g., 'object left of X and behind Y'), counting, comparisons, attribute queries, and compositional reasoning. Knowledge base is an HxWxd grid of region features (H=W=14).</td>
                        </tr>
                        <tr>
                            <td><strong>task_type</strong></td>
                            <td>multi-step visual reasoning / visual question answering (relational reasoning over object properties and spatial relations)</td>
                        </tr>
                        <tr>
                            <td><strong>knowledge_type</strong></td>
                            <td>object-relational + spatial + procedural (procedural in the sense of multi-step reasoning operations sequenced over iterations)</td>
                        </tr>
                        <tr>
                            <td><strong>knowledge_source</strong></td>
                            <td>supervised end-to-end training on CLEVR (question-answer pairs) with pre-trained CNN visual features (ImageNet-pretrained ResNet101) and learned language embeddings; knowledge about relations emerges from training data and parameter weights (no program supervision used)</td>
                        </tr>
                        <tr>
                            <td><strong>has_direct_sensory_input</strong></td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td><strong>elicitation_method</strong></td>
                            <td>end-to-end supervised learning (cross-entropy on answers); internal usage via iterative attention (control driven by question attention) and recurrent memory updates; interpretability via inspection of attention maps; ablations probing architectural choices</td>
                        </tr>
                        <tr>
                            <td><strong>knowledge_representation</strong></td>
                            <td>Control state: explicit attention-weighted sum over contextual question word vectors (soft attention anchors operations in linguistic tokens); Memory state: continuous vector holding intermediate visual result aggregated via attention over image-region feature vectors; Read interactions: multiplicative element-wise interactions between previous memory and KB region vectors followed by attention; procedural decomposition implicitly encoded as ordered sequence of MAC cells; optional self-attention over prior memory states permits soft DAG-like non-sequential composition. Overall knowledge is both implicit in weights and explicitly mediated by attention distributions (interpretable soft attention maps) rather than symbolic graph structures.</td>
                        </tr>
                        <tr>
                            <td><strong>performance_metric</strong></td>
                            <td>Accuracy (categorical accuracy on CLEVR answer classes), per-question-type accuracies reported (e.g., counting, existence, attribute queries, comparisons)</td>
                        </tr>
                        <tr>
                            <td><strong>performance_result</strong></td>
                            <td>MAC achieves 98.9% overall accuracy on CLEVR (validation/test reported), with 97.1% on counting, 99.5% on existence, 99.1% on numerical comparison, 99.5% on query attribute, and 99.5% on attribute comparison; on CLEVR-Humans after fine-tuning MAC obtains 81.5%.</td>
                        </tr>
                        <tr>
                            <td><strong>success_patterns</strong></td>
                            <td>The model succeeds at: (1) Transitive object-relational reasoning by chaining attention across iterations (e.g., resolving 'the object left of the ball that is behind the cube' by sequentially attending to referenced objects); (2) Spatial relations encoded via attention over image regions (in front of/behind/left/right are resolved by focusing on correct spatial regions conditioned on prior memory); (3) Counting and aggregation by summing attention activations across regions and using iterative accumulation across steps (noted to nearly halve counting errors relative to prior models); (4) Logical composition (OR/AND) and set operations via combination of direct KB element consideration and memory interactions; (5) Generalization from limited data due to strong structural prior (maintaining separate control and memory spaces and attention over question words).</td>
                        </tr>
                        <tr>
                            <td><strong>failure_patterns</strong></td>
                            <td>Failure modes include: (1) Off-by-one counting errors and undercounting under heavy occlusion (model sometimes underestimates counts when objects occluded); (2) Errors due to heavy object occlusion causing misrecognition of material/shape; (3) On CLEVR-Humans, errors for reasoning skills not in CLEVR training such as physical properties (stability, shadows, reflections), fine relative distance judgments (e.g., 'almost touching', 'closest to'), relative amounts/superlatives, uniqueness/commonality queries and negative questions; (4) Some misinterpretations of novel lexical items in human questions (e.g., 'caramel' color ambiguity). The paper does not evaluate language-only (no sensory input) embodied planning, so it lacks evidence for purely text-driven embodied behavior.</td>
                        </tr>
                        <tr>
                            <td><strong>baseline_comparison</strong></td>
                            <td>Compared to prior methods on CLEVR: FiLM (Perez et al., 2017) 97.7% overall, Relation Network (Santoro et al., 2017) 95.5%, PG+EE strongly-supervised variants up to 96.9% (9k/18k/700k program supervision variants achieved 88.6->95.4->96.9+), CNN+LSTM+SA baselines much lower (~73.2). MAC outperforms these in overall and per-category metrics.</td>
                        </tr>
                        <tr>
                            <td><strong>ablation_results</strong></td>
                            <td>Key ablations reported: (1) Removing question-word attention (using whole question vector) drops overall accuracy by 18.5% (example: 'question vector as control' yields 80.7% vs 98.9%); (2) Removing control unit ('w/o control') yields 55.6% (major collapse); (3) Removing memory-control separation ('w/o memory-control separation') reduces to 93.9%; (4) Using attention over raw word vectors instead of contextual biLSTM words reduces performance (98.3% vs 98.9%); (5) Unshared weights across cells reduces to 97.8% (and more on limited data); (6) Self-attention and memory gating raise performance modestly on CLEVR (self-attention: 99.23%, memory gate: 99.36%, both: 99.48%); (7) On 10% subset, many ablations incur large drops (e.g., attention over word vectors 61.4%, w/o word-attention 63.2%, unshared weights 67.5%), demonstrating which architectural elements (question attention, weight sharing, control-memory separation) are critical for data-efficiency and correct relational/spatial reasoning.</td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>MAC demonstrates that (1) explicit separation of control (linguistic operations anchored to question words via attention) and memory (recurrent visual intermediate results) provides an effective inductive bias for encoding procedural multi-step reasoning and object-relational/spatial relations; (2) spatial and object-relational knowledge is represented not as an explicit symbolic spatial map but as attention distributions over image-region feature vectors combined with multiplicative memory-KB interactions enabling transitive relation traversal; (3) procedural knowledge is instantiated as a learned sequence of operations (control states) that guide where to read from the KB and how to update memory, permitting navigation of indirect references and multi-hop relations; (4) these mechanisms yield strong interpretability (attention maps correlate with intermediate steps) and strong data efficiency, but the paper does not provide evidence for purely language-only operation in embodied planning (it suggests applicability to textual QA/reading comprehension but evaluates only on visual QA with images as sensory input).</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Compositional Attention Networks for Machine Reasoning', 'publication_date_yy_mm': '2018-02'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>Potentially Relevant New Papers (mentioned by this paper)</h2>
            <ol>
                <li>Inferring and executing programs for visual reasoning <em>(Rating: 2)</em></li>
                <li>FiLM: Visual reasoning with a general conditioning layer <em>(Rating: 2)</em></li>
                <li>A simple neural network module for relational reasoning <em>(Rating: 2)</em></li>
                <li>Neural module networks <em>(Rating: 2)</em></li>
                <li>Dynamic memory networks for visual and textual question answering <em>(Rating: 2)</em></li>
                <li>Hybrid computing using a neural network with dynamic external memory <em>(Rating: 1)</em></li>
            </ol>
        </div>

        <div class="section">
            <h2>Extracted Data (Debug)</h2>
            <pre><code>{
    "id": "extraction-result-508",
    "paper_id": "paper-289fb3709475f5c87df8d97f129af54029d27fee",
    "extraction_schema_id": "extraction-schema-15",
    "extracted_data": [
        {
            "name_short": "MAC",
            "name_full": "Memory, Attention and Composition (MAC) network",
            "brief_description": "A recurrent, fully-differentiable architecture for multi-step reasoning that explicitly separates control (question-driven operations) from memory (intermediate results) and uses iterative attention to read from a knowledge base (image features) and compose answers.",
            "citation_title": "here",
            "mention_or_use": "use",
            "model_name": "MAC network",
            "model_size": null,
            "model_description": "A sequence of p identical recurrent MAC cells (default p=12), each with dual hidden states: a control state (attention over contextual question word vectors) and a memory state (intermediate visual result). Each cell has three sub-units: Control Unit (attends to question words to produce an operation embedding), Read Unit (two-stage attention over knowledge-base elements conditioned on control and prior memory, includes multiplicative interactions between memory and KB elements), and Write Unit (integrates read content with prior memory; optional self-attention across previous memory states and a sigmoid memory gate to skip or interpolate). Image features are precomputed conv features (ResNet101 conv4 then additional CNN layers); word embeddings are learned and question processed via biLSTM.",
            "task_name": "CLEVR visual question answering (VQA)",
            "task_description": "Given a rendered synthetic 3D scene (image) and a compositional natural-language question about objects/properties/relations in the scene, predict the correct answer from a fixed candidate set. Questions test transitive relations (e.g., 'object left of X and behind Y'), counting, comparisons, attribute queries, and compositional reasoning. Knowledge base is an HxWxd grid of region features (H=W=14).",
            "task_type": "multi-step visual reasoning / visual question answering (relational reasoning over object properties and spatial relations)",
            "knowledge_type": "object-relational + spatial + procedural (procedural in the sense of multi-step reasoning operations sequenced over iterations)",
            "knowledge_source": "supervised end-to-end training on CLEVR (question-answer pairs) with pre-trained CNN visual features (ImageNet-pretrained ResNet101) and learned language embeddings; knowledge about relations emerges from training data and parameter weights (no program supervision used)",
            "has_direct_sensory_input": true,
            "elicitation_method": "end-to-end supervised learning (cross-entropy on answers); internal usage via iterative attention (control driven by question attention) and recurrent memory updates; interpretability via inspection of attention maps; ablations probing architectural choices",
            "knowledge_representation": "Control state: explicit attention-weighted sum over contextual question word vectors (soft attention anchors operations in linguistic tokens); Memory state: continuous vector holding intermediate visual result aggregated via attention over image-region feature vectors; Read interactions: multiplicative element-wise interactions between previous memory and KB region vectors followed by attention; procedural decomposition implicitly encoded as ordered sequence of MAC cells; optional self-attention over prior memory states permits soft DAG-like non-sequential composition. Overall knowledge is both implicit in weights and explicitly mediated by attention distributions (interpretable soft attention maps) rather than symbolic graph structures.",
            "performance_metric": "Accuracy (categorical accuracy on CLEVR answer classes), per-question-type accuracies reported (e.g., counting, existence, attribute queries, comparisons)",
            "performance_result": "MAC achieves 98.9% overall accuracy on CLEVR (validation/test reported), with 97.1% on counting, 99.5% on existence, 99.1% on numerical comparison, 99.5% on query attribute, and 99.5% on attribute comparison; on CLEVR-Humans after fine-tuning MAC obtains 81.5%.",
            "success_patterns": "The model succeeds at: (1) Transitive object-relational reasoning by chaining attention across iterations (e.g., resolving 'the object left of the ball that is behind the cube' by sequentially attending to referenced objects); (2) Spatial relations encoded via attention over image regions (in front of/behind/left/right are resolved by focusing on correct spatial regions conditioned on prior memory); (3) Counting and aggregation by summing attention activations across regions and using iterative accumulation across steps (noted to nearly halve counting errors relative to prior models); (4) Logical composition (OR/AND) and set operations via combination of direct KB element consideration and memory interactions; (5) Generalization from limited data due to strong structural prior (maintaining separate control and memory spaces and attention over question words).",
            "failure_patterns": "Failure modes include: (1) Off-by-one counting errors and undercounting under heavy occlusion (model sometimes underestimates counts when objects occluded); (2) Errors due to heavy object occlusion causing misrecognition of material/shape; (3) On CLEVR-Humans, errors for reasoning skills not in CLEVR training such as physical properties (stability, shadows, reflections), fine relative distance judgments (e.g., 'almost touching', 'closest to'), relative amounts/superlatives, uniqueness/commonality queries and negative questions; (4) Some misinterpretations of novel lexical items in human questions (e.g., 'caramel' color ambiguity). The paper does not evaluate language-only (no sensory input) embodied planning, so it lacks evidence for purely text-driven embodied behavior.",
            "baseline_comparison": "Compared to prior methods on CLEVR: FiLM (Perez et al., 2017) 97.7% overall, Relation Network (Santoro et al., 2017) 95.5%, PG+EE strongly-supervised variants up to 96.9% (9k/18k/700k program supervision variants achieved 88.6-&gt;95.4-&gt;96.9+), CNN+LSTM+SA baselines much lower (~73.2). MAC outperforms these in overall and per-category metrics.",
            "ablation_results": "Key ablations reported: (1) Removing question-word attention (using whole question vector) drops overall accuracy by 18.5% (example: 'question vector as control' yields 80.7% vs 98.9%); (2) Removing control unit ('w/o control') yields 55.6% (major collapse); (3) Removing memory-control separation ('w/o memory-control separation') reduces to 93.9%; (4) Using attention over raw word vectors instead of contextual biLSTM words reduces performance (98.3% vs 98.9%); (5) Unshared weights across cells reduces to 97.8% (and more on limited data); (6) Self-attention and memory gating raise performance modestly on CLEVR (self-attention: 99.23%, memory gate: 99.36%, both: 99.48%); (7) On 10% subset, many ablations incur large drops (e.g., attention over word vectors 61.4%, w/o word-attention 63.2%, unshared weights 67.5%), demonstrating which architectural elements (question attention, weight sharing, control-memory separation) are critical for data-efficiency and correct relational/spatial reasoning.",
            "key_findings": "MAC demonstrates that (1) explicit separation of control (linguistic operations anchored to question words via attention) and memory (recurrent visual intermediate results) provides an effective inductive bias for encoding procedural multi-step reasoning and object-relational/spatial relations; (2) spatial and object-relational knowledge is represented not as an explicit symbolic spatial map but as attention distributions over image-region feature vectors combined with multiplicative memory-KB interactions enabling transitive relation traversal; (3) procedural knowledge is instantiated as a learned sequence of operations (control states) that guide where to read from the KB and how to update memory, permitting navigation of indirect references and multi-hop relations; (4) these mechanisms yield strong interpretability (attention maps correlate with intermediate steps) and strong data efficiency, but the paper does not provide evidence for purely language-only operation in embodied planning (it suggests applicability to textual QA/reading comprehension but evaluates only on visual QA with images as sensory input).",
            "uuid": "e508.0",
            "source_info": {
                "paper_title": "Compositional Attention Networks for Machine Reasoning",
                "publication_date_yy_mm": "2018-02"
            }
        }
    ],
    "potentially_relevant_new_papers": [
        {
            "paper_title": "Inferring and executing programs for visual reasoning",
            "rating": 2
        },
        {
            "paper_title": "FiLM: Visual reasoning with a general conditioning layer",
            "rating": 2
        },
        {
            "paper_title": "A simple neural network module for relational reasoning",
            "rating": 2
        },
        {
            "paper_title": "Neural module networks",
            "rating": 2
        },
        {
            "paper_title": "Dynamic memory networks for visual and textual question answering",
            "rating": 2
        },
        {
            "paper_title": "Hybrid computing using a neural network with dynamic external memory",
            "rating": 1
        }
    ],
    "cost": 0.0120065,
    "model_str": "gpt-5-mini"
}</code></pre>
        </div>
        <div class="section">
            <h2>Paper</h2>
            <div class="paper-content"><h1>COMPOSITIONAL ATTENTION NETWORKS FOR MACHINE REASONING</h1>
<p>Drew A. Hudson<br>Department of Computer Science<br>Stanford University<br>dorarad@cs.stanford.edu</p>
<p>Christopher D. Manning<br>Department of Computer Science<br>Stanford University<br>manning@cs.stanford.edu</p>
<h4>Abstract</h4>
<p>We present the MAC network, a novel fully differentiable neural network architecture, designed to facilitate explicit and expressive reasoning. MAC moves away from monolithic black-box neural architectures towards a design that encourages both transparency and versatility. The model approaches problems by decomposing them into a series of attention-based reasoning steps, each performed by a novel recurrent Memory, Attention, and Composition (MAC) cell that maintains a separation between control and memory. By stringing the cells together and imposing structural constraints that regulate their interaction, MAC effectively learns to perform iterative reasoning processes that are directly inferred from the data in an end-to-end approach. We demonstrate the model's strength, robustness and interpretability on the challenging CLEVR dataset for visual reasoning, achieving a new state-of-the-art $98.9 \%$ accuracy, halving the error rate of the previous best model. More importantly, we show that the model is computationally-efficient and data-efficient, in particular requiring 5x less data than existing models to achieve strong results.</p>
<h2>1 INTRODUCTION</h2>
<p>Reasoning, the ability to manipulate previously acquired knowledge to draw novel inferences or answer new questions, is one of the fundamental building blocks of the intelligent mind. As we seek to advance neural networks beyond their current great success with sensory perception towards tasks that require more deliberate thinking, conferring them with the ability to move from facts to conclusions is thus of crucial importance. To this end, we consider here how best to design a neural network to perform the structured and iterative reasoning necessary for complex problem solving.</p>
<p>Concretely, we develop a novel model that we apply to the CLEVR task (Johnson et al., 2017a) of visual question answering (VQA). VQA (Antol et al., 2015; Gupta, 2017) is a challenging multimodal task that requires responding to natural language questions about images. However, Agrawal et al. (2016) show how the first generation of successful VQA models tends to acquire only superficial comprehension of both the image and the question, exploiting dataset biases rather than capturing a sound perception and reasoning process that would lead to the correct answer (cf. Sturm (2014)). CLEVR was created to address this problem. As illustrated in figure 1, the dataset features unbiased, highly compositional questions that require an array of challenging reasoning skills, such as transitive and logical relations, counting and comparisons, without allowing any shortcuts around such reasoning.
<img alt="img-0.jpeg" src="img-0.jpeg" /></p>
<p>Q: Do the block in front of the tiny yellow cylinder and the tiny thing that is to the right of the large green shiny object have the same color? A: No
Figure 1: A CLEVR example. Color added for illustration.</p>
<p>However, deep learning approaches often struggle to perform well on tasks with a compositional and structured nature (Garnelo et al., 2016; Lake et al., 2017). Most neural networks are essentially very large correlation engines that will hone in on any statistical, potentially spurious pattern that allows them to model the observed data more accurately. The depth, size and statistical nature that allows them to cope with noisy and diverse data often limits their interpretability and hinders their capacity</p>
<p><img alt="img-1.jpeg" src="img-1.jpeg" /></p>
<p>Figure 2: Model Overview. The MAC network consists of an input unit, a core recurrent network and an output unit. (1) The input unit transforms the raw image and question into distributed vector representations. (2) The core recurrent network reasons sequentially over the question by decomposing it into a series of operations (control) that retrieve information from the image (knowledge base) and aggregate the results into a recurrent memory. (3) The output classifier computes the final answer using the question and the final memory state.
to perform explicit and sound inference procedures that are vital for problem solving tasks. To mitigate this issue, some recent approaches adopt symbolic structures, resembling the expression trees of programming languages, that compose neural modules from a fixed predefined collection (Andreas et al., 2016a; Johnson et al., 2017b). However, they consequently rely on externally provided structured representations and functional programs, brittle handcrafted parsers or expert demonstrations, and require relatively complex multi-stage reinforcement learning training schemes. The rigidity of these models' structure and the use of an inventory of specialized operation-specific modules ultimately undermines their robustness and generalization capacities.</p>
<p>Seeking a balance between the versatility and robustness of end-to-end neural approaches on the one hand and the need to support more explicit and structured reasoning on the other, we propose the MAC network, a novel fully differentiable architecture for reasoning tasks. Our model performs structured and explicit reasoning by sequencing a new recurrent Memory, Attention and Composition (MAC) cell. The MAC cell was deliberately designed to capture the inner workings of an elementary, yet general-purpose reasoning step, drawing inspiration from the design principles of computer architectures. The cell explicitly separates out memory from control, both represented recurrently, and consists of three operational units that work in tandem to perform a reasoning step: the control unit updates the control state to attend at each iteration to some aspect of a given question; the read unit extracts information out of a knowledge base, guided by the control and memory states; and the write unit integrates the retrieved information into the memory state, iteratively computing the answer. This universal design of the MAC cell serves as a structural prior that encourages the network to solve problems by decomposing them into a sequence of attention-based reasoning operations that are directly inferred from the data, without resorting to any strong supervision. With self-attention connections between the cells, the MAC network is capable of representing arbitrarily complex acyclic reasoning graphs in a soft manner, while still featuring a physically sequential structure and end-to-end differentiabillity, amenable to training simply by backpropagation.</p>
<p>We demonstrate the model's quantitative and qualitative performance on the CLEVR task and its associated datasets. The model achieves state-of-the-art accuracy across a variety of reasoning tasks and settings, both for the primary dataset as well as the more difficult human-authored questions. Notably, it performs particularly well on questions that involve counting and aggregation skills, which tend to be remarkably challenging for other VQA models (Santoro et al., 2017; Hu et al., 2017; Johnson et al., 2017b). Moreover, we show that the MAC network learns rapidly and generalizes effectively from an order of magnitude less data than other approaches. Finally, extensive ablation studies and error analysis demonstrate MAC's robustness, versatility and generalization capacity. These results highlight the significance and value of imposing strong structural priors to guide the network towards compositional reasoning. The model contains structures that encourage it to explicitly perform a chain of operations that build upon each other, allowing MAC to develop reasoning skills from the ground up, realizing the vision of an algebraic, compositional model of inference as proposed by Bottou (2014). Although each cell's functionality has only a limited range of possible continuous behaviors, geared to perform a simple reasoning operation, when chained together in a MAC network, the whole system becomes expressive and powerful. TensorFlow implementation of the model is available at https://github.com/stanfordnlp/mac-network.</p>
<p><img alt="img-2.jpeg" src="img-2.jpeg" /></p>
<p>Figure 3: The MAC cell architecture. The MAC recurrent cell consists of a control unit, read unit, and write unit, that operate over dual control and memory hidden states. The control unit successively attends to different parts of the task description (question), updating the control state to represent at each timestep the reasoning operation the cell intends to perform. The read unit extracts information out of a knowledge base (here, image), guided by the control state. The write unit integrates the retrieved information into the memory state, yielding the new intermediate result that follows from applying the current reasoning operation.</p>
<h1>2 THE MAC NETWORK</h1>
<p>A MAC network is an end-to-end differentiable architecture primed to perform an explicit multi-step reasoning process, by stringing together $p$ recurrent MAC cells, each responsible for performing one reasoning step. Given a knowledge base $K$ (for VQA, an image) and a task description $q$ (for VQA, a question), the model infers a decomposition into a series of $p$ reasoning operations that interact with the knowledge base, iteratively aggregating and manipulating information to perform the task at hand. It consists of three components: (1) an input unit, (2) the core recurrent network, composed out of $p$ MAC cells, and (3) an output unit, all described below.</p>
<h3>2.1 THE INPUT UNIT</h3>
<p>The input unit transforms the raw inputs given to the model into distributed vector representations. Naturally, this unit is tied to the specifics of the task we seek to perform. For the particular case of VQA, it receives a question and an image and processes each of them respectively:</p>
<p>The question string, of length $S$, is converted into a sequence of learned word embeddings that is further processed by a $d$-dimensional biLSTM yielding: (1) contextual words: a series of output states $\boldsymbol{c w}<em S="S">{1}, \ldots, \boldsymbol{c w}</em>}$ that represent each word in the context of the question, and (2) the question representation: $q=\left[\overline{\boldsymbol{c w}<em S="S">{1}, \overline{\boldsymbol{c w}}</em>}^{T}\right]$, the concatenation of the final hidden states from the backward and forward LSTM passes. Subsequently, for each step $i=1, \ldots, p$, the question $q$ is transformed through a learned linear transformation into a position-aware vector $\boldsymbol{q<em i="i">{\boldsymbol{i}}=W</em>$ reasoning step.}^{d+2 d} q+b_{i}^{d}$, representing the aspects of the question that are relevant to the $i^{t h</p>
<p>The image is first processed by a fixed feature extractor pre-trained on ImageNet (Russakovsky et al., 2015) that outputs conv4 features from ResNet101 (He et al., 2016), matching prior work for CLEVR (Hu et al., 2017; Santoro et al., 2017; Perez et al., 2017). The resulting tensor is then passed through two CNN layers with $d$ output channels to obtain a final image representation, the knowledge base $\boldsymbol{K}^{H \times W \times d}=\left{\boldsymbol{k}<em h_="h," w="1,1">{\boldsymbol{h}, \boldsymbol{w}}^{d} \mid</em>\right}$, where $H=W=14$ are the height and width of the processed image, corresponding to each of its regions.}^{H, W</p>
<h3>2.2 THE MAC CELL</h3>
<p>The MAC cell is a recurrent cell designed to capture the notion of an atomic and universal reasoning operation and formulate its mechanics. For each step $i=1, \ldots, p$ in the reasoning process, the $i^{t h}$ cell maintains dual hidden states: control $\boldsymbol{c}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ and memory $\boldsymbol{m}</em>}}$, of dimension $d$, initialized to learned parameters $\boldsymbol{m<em _mathbf_0="\mathbf{0">{\mathbf{0}}$ and $\boldsymbol{c}</em>$, respectively.
The control $\boldsymbol{c}}<em s="s">{\boldsymbol{i}}$ represents the reasoning operation the cell should accomplish in the $i^{t h}$ step, selectively focusing on some aspect of the question. Concretely, it is represented by a soft attention-based weighted average of the question words $\boldsymbol{c} \boldsymbol{w}</em> ; s=1, \ldots, S$.</p>
<p><img alt="img-3.jpeg" src="img-3.jpeg" /></p>
<p>Figure 4: The Control Unit (CU) architecture. The control unit attends at each iteration to some part of the question, by applying soft attention over the question words, and updates the control state accordingly. The unit's inputs and outputs are in bold. See section 2.2.1 for details.</p>
<p>The memory $\boldsymbol{m}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ holds the intermediate result obtained from the reasoning process up to the $i^{t h}$ step, computed recurrently by integrating the preceding hidden state $\boldsymbol{m}</em>}-\mathbf{1}}$ with new information $\boldsymbol{r<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ retrieved from the image, performing the $i^{t h}$ reasoning operation $\boldsymbol{c}</em>}}$. Analogously to the control, $\boldsymbol{r<em _boldsymbol_h="\boldsymbol{h">{\boldsymbol{i}}$ is a weighted average over its regions $\left{\boldsymbol{k}</em>\right}$.}, \boldsymbol{w}} \mid_{h, w=1,1}^{H, W</p>
<p>Building on the design principles of computer organization, the MAC cell consists of three operational units: control unit CU, read unit RU and write unit WU, that work together to accomplish tasks by performing an iterative reasoning process: The control unit identifies a series of operations, represented by a recurrent control state; the read unit extracts relevant information from a given knowledge base to perform each operation, and the write unit iteratively integrates the information into the cell's memory state, producing a new intermediate result.</p>
<p>Through their operation, the three units together impose an interface that regulates the interaction between the control and memory states. Specifically, the control state, which is a function of the question, guides the integration of content from the image into the memory state only through indirect means: soft-attention maps and sigmoidal gating mechanisms. Consequently, the interaction between these two modalities - visual and textual, or knowledge base and query - is mediated through probability distributions only. This stands in stark contrast to common approaches that fuse the question and image together into the same vector space through linear combinations, multiplication, or concatenation. As we will see in section 4, maintaining a strict separation between the representational spaces of question and image, which can interact only through interpretable discrete distributions, greatly enhances the generalizability of the network and improves its transparency.</p>
<p>In the following, we describe the cell's three components: control, read and write units, and detail their formal specification. Unless otherwise stated, all the vectors are of dimension $d$.</p>
<h1>2.2.1 THE CONTROL UNIT</h1>
<p>The control unit (see figure 4) determines the reasoning operation that should be performed at each step $i$, attending to some part of the question and updating the control state $\boldsymbol{c}<em 1="1">{\boldsymbol{i}}$ accordingly. It receives the contextual question words $\boldsymbol{c w}</em>}, \ldots, \boldsymbol{c w<em _boldsymbol_i="\boldsymbol{i">{S}$, the question position-aware representation $\boldsymbol{q}</em>$ and consists of two stages:}}$, and the control state from the preceding step $\boldsymbol{c}_{\boldsymbol{i}-\mathbf{1}</p>
<ol>
<li>First, we combine $\boldsymbol{q}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ and $\boldsymbol{c}</em>}-\mathbf{1}}$ through a linear transformation into $c q_{i}$, taking into account both the overall question representation $\boldsymbol{q<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$, biased towards the $i^{t h}$ reasoning step, as well as the preceding reasoning operation $\boldsymbol{c}</em>}-\mathbf{1}}$. This allows the cell to base its decision for the $i^{t h}$ reasoning operation $\boldsymbol{c<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ on the previously performed operation $\boldsymbol{c}</em>$.}-\mathbf{1}</li>
<li>Subsequently, we cast $c q_{i}$ onto the space of the question words. Specifically, this is achieved by measuring the similarity between $c q_{i}$ and each question word $\boldsymbol{c w}<em 1="1">{s}$ and passing the result through a softmax layer, yielding an attention distribution over the question words $\boldsymbol{c w}</em>}, \ldots, \boldsymbol{c w<em _boldsymbol_i="\boldsymbol{i">{S}$. Finally, we sum the words according to this distribution to produce the reasoning operation $\boldsymbol{c}</em>$, represented in terms of the question words.}</li>
</ol>
<p>The casting of $c q_{i}$ onto question words serves as a form of regularization that restricts the space of the valid reasoning operations by anchoring them back in the original question words, and due to the use of soft attention may also improve the MAC cell transparency, since we can interpret the control state content and the cell's consequent behavior based on the words it attends to.</p>
<p><img alt="img-4.jpeg" src="img-4.jpeg" /></p>
<p>$$
\begin{gathered}
I_{i, h, w}=\left[W_{m}^{d \times d} \boldsymbol{m}<em m="m">{\boldsymbol{i}-\mathbf{1}}+b</em>\right] \odot \
{\left[W_{k}^{d \times d} \boldsymbol{k}}^{d<em k="k">{h, w}+b</em> \
I_{i, h, w}^{\prime}=W^{d \times 2 d}\left[I_{i, h, w}, \boldsymbol{k}}^{d}\right]<em h_="h," i_="i," w="w">{h, w}\right]+b^{d} \
r a</em>}=W^{d \times d}\left(\boldsymbol{c<em h_="h," i_="i," w="w">{\boldsymbol{i}} \odot I</em> \
r v_{i, h, w}=\operatorname{softmax}\left(r a_{i, h, w}\right) \
\boldsymbol{r}}^{\prime}\right)+b^{d<em h_="h," w="1,1">{\boldsymbol{i}}=\sum</em>
\end{gathered}
$$}^{H, W} r v_{i, h, w} \cdot \boldsymbol{k}_{h, w</p>
<p>Figure 5: The Read Unit (RU) architecture. The read unit retrieves information from the knowledge base that is necessary for performing the current reasoning operation (control) and potentially related to previously obtained intermediate results (memory). It extracts the information by performing a two-stage attention process over the knowledge base elements. See section 2.2.2 for details.</p>
<h1>2.2.2 The Read Unit</h1>
<p>For the $i^{\text {th }}$ step, the read unit (see figure 5) inspects the knowledge base (the image) and retrieves the information $\boldsymbol{r}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ that is required for performing the $i^{\text {th }}$ reasoning operation $\boldsymbol{c}</em>}}$. The content's relevance is measured by an attention distribution $\boldsymbol{r} \boldsymbol{v<em h_="h," w="w">{\boldsymbol{i}}$ that assigns a probability to each element in the knowledge base $\boldsymbol{k}</em>}^{d}$, taking into account the current reasoning operation $\boldsymbol{c<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ and the prior memory $\boldsymbol{m}</em>$, the intermediate result produced by the preceding reasoning step. The attention distribution is computed in several stages:}-\mathbf{1}</p>
<ol>
<li>First, we compute the direct interaction between the knowledge-base element $\boldsymbol{k}<em _boldsymbol_i="\boldsymbol{i">{h, w}$ and the memory $\boldsymbol{m}</em>$. This term measures the relevance of the element to the preceding intermediate result, allowing the model to perform transitive reasoning by considering content that now seems important in light of information obtained from the prior computation step.}-\mathbf{1}}$, resulting in $I_{i, h, w</li>
<li>Then, we concatenate the element $\boldsymbol{k}<em h_="h," i_="i," w="w">{h, w}$ to $I</em>$. This allows us to also consider new information that is not directly related to the prior intermediate result, as sometimes a cogent reasoning process has to combine together independent facts to arrive at the answer (e.g., for a logical OR operation, set union and counting).}$ and pass the result through a linear transformation, yielding $I_{i, h, w}^{\prime</li>
<li>Finally, aiming to retrieve information that is relevant for the reasoning operation $\boldsymbol{c}<em h_="h," i_="i," w="w">{\boldsymbol{i}}$, we measure its similarity to each of the interactions $I</em>$.}$ and pass the result through a softmax layer. This produces an attention distribution over the knowledge base elements, which we then use to compute a weighted average over them $-\boldsymbol{r}_{\boldsymbol{i}</li>
</ol>
<p>To give an example of the read unit operation, consider the question in figure 6, which refers to the purple cylinder in the image. Initially, no cue is provided to the model to attend to the cylinder, since no direct mention of it is given in the question. Instead, the model approaches the question in steps: in the first iteration it attends to the "tiny blue block", updating $\boldsymbol{m}<em _mathbf_2="\mathbf{2">{\mathbf{1}}$ accordingly to the visual representation of the block. At the following step, the control unit realizes it should now look for "the sphere in front" of the block, storing that in $\boldsymbol{c}</em>}}$. Then, when considering both $\boldsymbol{m<em _mathbf_2="\mathbf{2">{\mathbf{1}}$ and $\boldsymbol{c}</em>}}$, the read unit realizes it should look for "the sphere in front" $\left(\boldsymbol{c<em _mathbf_1="\mathbf{1">{\mathbf{2}}\right)$ of the blue block (stored in $\boldsymbol{m}</em>$. Finally, a similar process repeats in the next iteration, allowing the model to traverse from the cyan ball to the final objective - the purple cylinder, and answer the question correctly.
}}$ ), thus finding the cyan sphere and updating $\boldsymbol{m}_{\mathbf{2}<img alt="img-5.jpeg" src="img-5.jpeg" /></p>
<p>Figure 6: Attention maps produced by a MAC network of length 3.</p>
<p><img alt="img-6.jpeg" src="img-6.jpeg" /></p>
<p>Figure 7: The Write Unit (WU) architecture. The write unit integrates the information retrieved from the knowledge base into the recurrent memory state, producing a new intermediate result $\boldsymbol{m}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ that corresponds to the reasoning operation $\boldsymbol{c}</em>$. See section 2.2.3 for details.}</p>
<h1>2.2.3 The Write Unit</h1>
<p>The write unit (see figure 7) is responsible for computing the $i^{t h}$ intermediate result of the reasoning process and storing it in the memory state $\boldsymbol{m}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$. Specifically, it integrates the information retrieved from the read unit $\boldsymbol{r}</em>}}$ with the preceding intermediate result $\boldsymbol{m<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}-\mathbf{1}}$, guided by the $i^{t h}$ reasoning operation $\boldsymbol{c}</em>$ :}}$. The integration proceeds in three steps, the first mandatory while the others are optional ${ }^{1</p>
<ol>
<li>First, we combine the new information $\boldsymbol{r}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ with the prior intermediate result $\boldsymbol{m}</em>$.}-\mathbf{1}}$ by a linear transformation, resulting in $m_{i}^{\text {info }</li>
<li>Self-Attention (Optional). To support non-sequential reasoning processes, such as trees or graphs, we allow each cell to consider all previous intermediate results, rather than just the preceding one $\boldsymbol{m}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}-\mathbf{1}}$ : We compute the similarity between the $i^{t h}$ operation $\boldsymbol{c}</em>}}$ and the previous ones $\boldsymbol{c<em i-1="i-1">{1}, \ldots, \boldsymbol{c}</em>$. Note that while we compute the attention based on the control states, we use it to average over the memory states, in a way that resembles Key-Value Memory Networks (Miller et al., 2016).}$ and use it to derive an attention distribution over the prior reasoning steps $s a_{i, j}$ for $j=0, \ldots, i-1$. The distribution represents the relevance of each previous step $j$ to the current one $i$, and is used to compute a weighted average of the memory states, yielding $m_{i}^{s a}$, which is then combined with $m_{i}^{\text {info }}$ to produce $m_{i}^{\prime</li>
<li>Memory Gate (Optional). Not all questions are equally complex - some are simpler while others are more difficult. To allow the model to dynamically adjust the reasoning process length to the given question, we add a sigmoidal gate over the memory state that interpolates between the previous memory state $\boldsymbol{m}<em i="i">{\boldsymbol{i}-\mathbf{1}}$ and the new candidate $m</em>$. The gate allows the cell to skip a reasoning step if necessary, passing the previous memory value further along the network, dynamically reducing the effective length of the reasoning process as demanded by the question.}^{\prime}$, conditioned on the reasoning operation $\boldsymbol{c}_{\boldsymbol{i}</li>
</ol>
<h3>2.3 The Output Unit</h3>
<p>The output unit predicts the final answer to the question based on the question representation $q$ and the final memory $\boldsymbol{m}<em _boldsymbol_p="\boldsymbol{p">{\boldsymbol{p}}$, which represents the final intermediate result of the reasoning process, holding relevant information from the knowledge base. ${ }^{2}$ For CLEVR, where there is a fixed set of possible answers, the unit processes the concatenation of $q$ and $\boldsymbol{m}</em>$ through a 2-layer fully-connected softmax classifier that produces a distribution over the candidate answers.
}<img alt="img-7.jpeg" src="img-7.jpeg" /></p>
<p>Figure 8: The output unit. A classifier that predicts an answer based on the question and the final memory state.</p>
<p><sup id="fnref:0"><a class="footnote-ref" href="#fn:0">1</a></sup></p>
<p>Table 1: CLEVR and CLEVR-Humans Accuracy by baseline methods, previous methods, and our method (MAC). For CLEVR-Humans, we show results before and after fine-tuning. (*) denotes use of extra supervisory information through program labels. ( $\left.{ }^{}\right)$ denotes use of data augmentation. ( $\left.{ }^{1}\right)$ denotes training from raw pixels.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Model</th>
<th style="text-align: center;">CLEVR <br> Overall</th>
<th style="text-align: center;">Count</th>
<th style="text-align: center;">Exist</th>
<th style="text-align: center;">Compare <br> Numbers</th>
<th style="text-align: center;">Query <br> Attribute</th>
<th style="text-align: center;">Compare <br> Attribute</th>
<th style="text-align: center;">Humans <br> before FT</th>
<th style="text-align: center;">Humans <br> after FT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Human (Johnson et al., 2017b)</td>
<td style="text-align: center;">92.6</td>
<td style="text-align: center;">86.7</td>
<td style="text-align: center;">96.6</td>
<td style="text-align: center;">86.5</td>
<td style="text-align: center;">95.0</td>
<td style="text-align: center;">96.0</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">Q-type baseline (Johnson et al., 2017b)</td>
<td style="text-align: center;">41.8</td>
<td style="text-align: center;">34.6</td>
<td style="text-align: center;">50.2</td>
<td style="text-align: center;">51.0</td>
<td style="text-align: center;">36.0</td>
<td style="text-align: center;">51.3</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">LSTM (Johnson et al., 2017b)</td>
<td style="text-align: center;">46.8</td>
<td style="text-align: center;">41.7</td>
<td style="text-align: center;">61.1</td>
<td style="text-align: center;">69.8</td>
<td style="text-align: center;">36.8</td>
<td style="text-align: center;">51.8</td>
<td style="text-align: center;">27.5</td>
<td style="text-align: center;">36.5</td>
</tr>
<tr>
<td style="text-align: left;">CNN+LSTM (Johnson et al., 2017b)</td>
<td style="text-align: center;">52.3</td>
<td style="text-align: center;">43.7</td>
<td style="text-align: center;">65.2</td>
<td style="text-align: center;">67.1</td>
<td style="text-align: center;">49.3</td>
<td style="text-align: center;">53.0</td>
<td style="text-align: center;">37.7</td>
<td style="text-align: center;">43.2</td>
</tr>
<tr>
<td style="text-align: left;">CNN+LSTM+SA+MLP (Johnson et al., 2017a)</td>
<td style="text-align: center;">73.2</td>
<td style="text-align: center;">59.7</td>
<td style="text-align: center;">77.9</td>
<td style="text-align: center;">75.1</td>
<td style="text-align: center;">80.9</td>
<td style="text-align: center;">70.8</td>
<td style="text-align: center;">50.4</td>
<td style="text-align: center;">57.6</td>
</tr>
<tr>
<td style="text-align: left;">N2NMN* (Hu et al., 2017)</td>
<td style="text-align: center;">83.7</td>
<td style="text-align: center;">68.5</td>
<td style="text-align: center;">85.7</td>
<td style="text-align: center;">84.9</td>
<td style="text-align: center;">90.0</td>
<td style="text-align: center;">88.7</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">PG+EE (9K prog.)* (Johnson et al., 2017b)</td>
<td style="text-align: center;">88.6</td>
<td style="text-align: center;">79.7</td>
<td style="text-align: center;">89.7</td>
<td style="text-align: center;">79.1</td>
<td style="text-align: center;">92.6</td>
<td style="text-align: center;">96.0</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">PG+EE (18K prog.)* (Johnson et al., 2017b)</td>
<td style="text-align: center;">95.4</td>
<td style="text-align: center;">90.1</td>
<td style="text-align: center;">97.3</td>
<td style="text-align: center;">96.5</td>
<td style="text-align: center;">97.4</td>
<td style="text-align: center;">98.0</td>
<td style="text-align: center;">54.0</td>
<td style="text-align: center;">66.6</td>
</tr>
<tr>
<td style="text-align: left;">PG+EE (700K prog.)* (Johnson et al., 2017b</td>
<td style="text-align: center;">96.9</td>
<td style="text-align: center;">92.7</td>
<td style="text-align: center;">97.1</td>
<td style="text-align: center;">98.7</td>
<td style="text-align: center;">98.1</td>
<td style="text-align: center;">98.9</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">CNN+LSTM+RN ${ }^{\text {T }}$ (Santoro et al., 2017)</td>
<td style="text-align: center;">95.5</td>
<td style="text-align: center;">90.1</td>
<td style="text-align: center;">97.8</td>
<td style="text-align: center;">93.6</td>
<td style="text-align: center;">97.9</td>
<td style="text-align: center;">97.1</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">CNN+GRU+FiLM (Perez et al., 2017)</td>
<td style="text-align: center;">97.7</td>
<td style="text-align: center;">94.3</td>
<td style="text-align: center;">99.1</td>
<td style="text-align: center;">96.8</td>
<td style="text-align: center;">99.1</td>
<td style="text-align: center;">99.1</td>
<td style="text-align: center;">56.6</td>
<td style="text-align: center;">75.9</td>
</tr>
<tr>
<td style="text-align: left;">CNN+GRU+FiLM ${ }^{\text {T }}$ (Perez et al., 2017)</td>
<td style="text-align: center;">97.6</td>
<td style="text-align: center;">94.3</td>
<td style="text-align: center;">99.3</td>
<td style="text-align: center;">93.4</td>
<td style="text-align: center;">99.3</td>
<td style="text-align: center;">99.3</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
</tr>
<tr>
<td style="text-align: left;">MAC</td>
<td style="text-align: center;">$\mathbf{9 8 . 9}$</td>
<td style="text-align: center;">$\mathbf{9 7 . 1}$</td>
<td style="text-align: center;">$\mathbf{9 9 . 5}$</td>
<td style="text-align: center;">$\mathbf{9 9 . 1}$</td>
<td style="text-align: center;">$\mathbf{9 9 . 5}$</td>
<td style="text-align: center;">$\mathbf{9 9 . 5}$</td>
<td style="text-align: center;">$\mathbf{5 7 . 4}$</td>
<td style="text-align: center;">$\mathbf{8 1 . 5}$</td>
</tr>
</tbody>
</table>
<h1>3 Related Work</h1>
<p>There have been several prominent models that address the CLEVR task. By and large they can be partitioned into two groups: module networks, which in practice have all used the strong supervision provided in the form of structured functional programs that accompany each data instance, and large, relatively unstructured end-to-end differentiable networks that complement a fairly standard stack of CNNs with components that aid them in performing reasoning tasks. In contrast to modular approaches (Andreas et al., 2016a;b; Hu et al., 2017; Johnson et al., 2017b), our model is fully differentiable and does not require additional supervision, making use of a single computational cell chained in sequence rather than a collection of custom modules deployed in a rigid tree structure. In contrast to augmented CNN approaches (Santoro et al., 2017; Perez et al., 2017), we suggest that our approach provides an ability for relational reasoning with better generalization capacity, higher computational efficiency and enhanced transparency. These approaches and other related work are discussed and contrasted in more detail in the supplementary material in appendix D.</p>
<h2>4 EXPERIMENTS</h2>
<p>We evaluate our model on the recent CLEVR task for visual reasoning (Johnson et al., 2017a). The dataset consists of rendered images featuring 3D-objects of various shapes, materials, colors and sizes, coupled with machine-generated compositional multi-step questions that measure performance on an array of challenging reasoning skills such as following transitive relations, counting objects and comparing their properties. Each question is also associated with a tree-structured functional program that was used to generate it, specifying the reasoning operations that should be performed to compute the answer.
In the following experiments, our model's training is cast as a supervised classification problem to minimize the cross-entropy loss of the predicted candidate answer out of the 28 possibilities. The model uses a hidden state size of $d=512$ and, unless otherwise stated, length of $p=12$ MAC cells. ${ }^{3}$ While some prior work uses the functional programs associated with each question as additional supervisory information at training time (see table 1), we intentionally do not use these structured representations to train our model, aiming to infer coherent reasoning strategies directly from the question and answer pairs in an end-to-end approach.
We first perform experiments on the primary 700k dataset. As shown in table 1, our model outperforms all prior work both in overall accuracy, as well as in each of the categories of specific reasoning skills. In particular, for the overall performance, we achieve $98.94 \%$ accuracy, more than halving the error rate of the best prior model, FiLM (Perez et al., 2017).
Counting and Numerical Comparison. In particular, our performance on questions about counting and numerical comparisons is significantly higher than existing models, which consistently struggle</p>
<p><sup id="fnref2:0"><a class="footnote-ref" href="#fn:0">1</a></sup></p>
<p><img alt="img-8.jpeg" src="img-8.jpeg" /></p>
<p>Figure 9: From left to right: (1) Learning curve of MAC and alternative approaches (accuracy / epoch). (2) Models' performance as a function of the CLEVR subset size used for training, ranging from $1 \%$ to $100 \%$. (3),(4) Learning curves for ablated MAC variants. See section 4.3 for details.
on these question types. Again, we nearly halve the corresponding error rate. These are significant results, as counting and aggregations are known to be particularly challenging in the area of VQA (Chattopadhyay et al., 2017). In contrast to CNNs, using attention enhances our model's ability to perform reasoning operations such as counting that pertain to the global aggregation of information across different regions of the image.</p>
<h1>4.1 CLEVR Humans and Error Analysis</h1>
<p>We analyze our model's performance on the CLEVR-Humans dataset (Johnson et al., 2017b), consisting of natural language questions collected through crowdsourcing. As such, the dataset has a diverse vocabulary and linguistic variations, and it also demands more varied reasoning skills. Since the training set is relatively small, comprising 18 k samples, we use it to finetune a model pre-trained on the primary CLEVR dataset, following prior work.</p>
<p>As shown in table 1, our model achieves state-of-the-art performance on CLEVR-Humans both before and after fine-tuning. It surpasses the nextbest model by $5.6 \%$ percent, achieving $81.5 \%$. The results substantiate the model's robustness against linguistic variations and noise as well as its ability to adapt to new and more diverse vocabulary and reasoning skills. The soft attention performed over the question allows the model to focus on the words that are most critical to answer the question while paying less attention to irrelevant linguistic variations. See figure 11, and figures 16 and 17 in the appendix for examples.</p>
<p>In order to gain insight into the nature of the mistakes our model makes, we perform an error analysis for the CLEVR and CLEVR-Humans datasets (See figure 10). Overall, we see that most of the errors in the CLEVR dataset are either off-by-one counting mistakes or result from heavy object occlusions. For CLEVR-Humans, we observe many errors that involve new reasoning skills that the model has not been trained for, such as ones that relate to physical properties (stability and reflections), relative distances and amounts, commonalities and uniqueness of objects, or negative questions. See appendix B for further details. Nevertheless, the model does respond correctly to many of the questions that fall under these reasoning skills, as illustrated in figures 11 and 16, and so we speculate that the errors the model makes stem in part from the small size of the CLEVR-Human dataset.</p>
<h3>4.2 COMPUTATIONAL and Data Efficiency</h3>
<p>We examine the learning curves of MAC and compare them to previous models ${ }^{4}$ : specifically, FiLM (Perez et al., 2017), the strongly-supervised PG+EE (Johnson et al., 2017b), and stacked-attention</p>
<p><sup id="fnref3:0"><a class="footnote-ref" href="#fn:0">1</a></sup></p>
<p><img alt="img-9.jpeg" src="img-9.jpeg" /></p>
<p>Figure 11: CLEVR-Humans examples showing the model performs novel reasoning skills that do not appear in CLEVR, including: obstructions, object uniqueness, relative distances, superlatives and new concepts.
networks (SA) (Johnson et al., 2017b; Yang et al., 2016). As shown in figure 9, our model learns significantly faster than other approaches. While we do not have learning curves for the recent Relation Network model, Santoro et al. (2017) report 1.4 million iterations (equivalent to 125 epochs) to achieve $95.5 \%$ accuracy, whereas our model achieves a comparable accuracy after only 3 epochs, yielding a 40x reduction in the length of the training process. Likewise, Perez et al. (2017) report a training time of 4 days, equivalent to 80 epochs, to reach accuracy of $97.7 \%$. In contrast, we achieve higher accuracy in 6 epochs, 9.5 hours overall, leading to a 10x reduction in training time.</p>
<p>In order to study the ability of MAC to generalize from a smaller amount of data, we explore its performance on subsets of CLEVR, sampled at random from the original 700k dataset. As shown in figure 9, MAC outperforms the other models by a wide margin: For $50 \%$ of the data, equivalent to 350 k samples, other models obtain accuracies ranging between $70 \%$ and $93 \%$, while our model achieves $97.6 \%$. The gap becomes larger as the dataset size reduces: for $25 \%$ of the data, equivalent to 175 k samples, the performance of other models is between $50 \%$ and $77 \%$, while MAC maintains a high $94.3 \%$ accuracy.</p>
<p>Finally, for just $10 \%$ of the data, amounting to 70 k samples, our model is the only one to generalize well, with performance of $85.5 \%$ on average, whereas the other leading models fail, achieving $49.0 \%-54.9 \%$. Note that, as pointed out by Johnson et al. (2017a), a simple baseline that predicts the most frequent answer for each question type already achieves $42.1 \%$, suggesting that answering only half of the questions correctly means that the other models barely learn to generalize from this smaller subset. These results demonstrate the robustness and generalization capacity of our architecture and its key role as a structural prior guiding MAC to learn the intended reasoning skills.</p>
<h1>4.3 Ablations</h1>
<p>To gain better insight into the relative contribution of the design choices we made, we perform extensive ablation studies. See figure 9 and appendix C for accuracies and learning curves. The experiments demonstrate the robustness of the model to hyperparameter variations such as network dimension and length, and shed light on the significance of various aspects and components of the model, as discussed below:</p>
<p>Question Attention. The ablations show that using attention over the question words (see section 2.2.1) is highly effective in accelerating learning and enhancing generalization capacity. Using the complete question $q$ instead of the attention-based control state leads to a significant drop of $18.5 \%$ in the overall accuracy. Likewise, using unconstrained recurrent control states, without casting them back onto the question words space (step (3) in section 2.2.1) leads to a 6 x slowdown in the model convergence rate. These results illustrate the importance and usefulness of decomposing the question into a series of simple operations, such that a single cell is faced with learning the semantics of one or a few words at a time, rather than grasping all of the question at once. They provide evidence for the efficacy of using attention as a regularization mechanism, by restricting the input and output spaces of each MAC cell.</p>
<p>Control and Memory. Maintaining separation between control and memory proves to be another key property that contributes significantly to the model's accuracy, learning rate and data efficiency. We perform experiments for a variant of the MAC cell in which we maintain one hidden state that</p>
<p><img alt="img-10.jpeg" src="img-10.jpeg" /></p>
<p>Figure 14: Attention maps produced by MAC which provide some evidence for the ability of the model to perform counting and summation of small numbers. Note how the first iterations focus on the key structural question words "many" and "or" that inform the model of the required reasoning operation it has to perform.
plays both the roles of the control and memory, iteratively attending and integrating information from both the question and the image. While this approach achieves a final accuracy of $93.75 \%$, it leads to a sharp drop in the convergence rate, as shown in figure 9, and a $20.2 \%$ reduction in the final accuracy for a smaller $10 \%$ subset of CLEVR. The results make a strong case for our model's main design choice, namely, splitting the computation into two dual paths: one that decomposes the linguistic information and another that reconstructs the corresponding visual information.</p>
<p>The design choices discussed above were found to be the most significant to the model's overall accuracy, convergence rate and generalization. Other design choices that were found beneficial include (1) predicting the final answer based on both the final memory state and the question (see section 2.3), and (2) considering knowledge base elements directly (step (2) in section 2.2.2), resulting in $19.8 \%$ and $11.1 \%$ improvement for a $10 \%$ subset of CLEVR, respectively. Please refer to appendix C for further discussion and results.</p>
<h1>4.4 INTERPRETABILITY</h1>
<p>To obtain better insight into the underlying reasoning processes MAC learns to perform, we study visualizations of the attention distributions produced by the model during its iterative computation, and provide examples in figures 13, 14, 17, and 18. Examining the sequence of attention maps over the image and the question reveals several qualitative patterns and properties that characterize MAC's mode of operation.</p>
<p>First, we observe that both the linguistic and visual attentions of the model are very focused on specific terms or regions in the image, and commonly refer to concrete objects ("the shiny red cube" or the "metallic cylinder") or question structural keywords ("or", "and" or "how many"). More importantly, the attention maps give evidence of the ability of the model to capture the underlying semantic structure of the question, traversing the correct transitive relations between the objects it refers to. For instance, we see in figure 13 how the model explicitly decomposes the question into the correct reasoning steps: first identifying the green ball, then focusing on the red cylinder that is located left of the ball, and finally attending to the yellow cylinder. In the second step, note how the model attends only to the relevant red cylinder and not to other red rubber things, correctly resolving the indirect reference in the question. This shows strong evidence of the ability of the model to perform transitive reasoning, integrating information from prior steps that allows it to focus only on the relevant objects, even when they are not mentioned explicitly.</p>
<p>In figure 14, we further see how the model interprets a multi-step counting question, apparently summing up the amounts of two referenced object groups to produce the correct overall count. These observations suggest that the model infers and effectively performs complex reasoning processes in a transparent manner.</p>
<h1>5 CONCLUSION</h1>
<p>We have introduced the Memory, Attention and Composition (MAC) network, an end-to-end differentiable architecture for machine reasoning. The model solves problems by decomposing them into a series of inferred reasoning steps that are performed successively to accomplish the task at hand. It uses a novel recurrent MAC cell that aims to formulate the inner workings of a single universal reasoning operation by maintaining a separation between memory and control. These MAC cells are chained together to produce explicit and structured multi-step reasoning processes. We demonstrate the versatility, robustness and transparency of the model through quantitative and qualitative studies, achieving state-of-the-art results on the CLEVR task for visual reasoning, and generalizing well even from a $10 \%$ subset of the data. The experimental results further show that the model can adapt to novel situations and diverse language, and generate interpretable attention-based rationales that reveal the underlying reasoning it performs. While CLEVR provides a natural testbed for our approach, we believe that the architecture will prove beneficial for other multi-step reasoning and inference tasks, including reading comprehension, textual question answering, and real-world VQA.</p>
<h2>6 ACKNOWLEDGMENTS</h2>
<p>We wish to thank Justin Johnson, Aaron Courville, Ethan Perez, Harm de Vries, Mateusz Malinowski, Jacob Andreas, and the anonymous reviewers for the helpful suggestions, comments and discussions. Stanford University gratefully acknowledges the support of the Defense Advanced Research Projects Agency (DARPA) Communicating with Computers (CwC) program under ARO prime contract no. W911NF15-1-0462 for supporting this work.</p>
<h1>REFERENCES</h1>
<p>Aishwarya Agrawal, Dhruv Batra, and Devi Parikh. Analyzing the behavior of visual question answering models. In Proceedings of the 2016 Conference on Empirical Methods in Natural Language Processing, pp. 1955-1960, 2016.</p>
<p>Jacob Andreas, Marcus Rohrbach, Trevor Darrell, and Dan Klein. Neural module networks. In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, pp. 39-48, 2016a.</p>
<p>Jacob Andreas, Marcus Rohrbach, Trevor Darrell, and Dan Klein. Learning to compose neural networks for question answering. In Proceedings of NAACL-HLT, pp. 1545-1554, 2016b.</p>
<p>Stanislaw Antol, Aishwarya Agrawal, Jiasen Lu, Margaret Mitchell, Dhruv Batra, C Lawrence Zitnick, and Devi Parikh. VQA: Visual question answering. In Proceedings of the IEEE International Conference on Computer Vision, pp. 2425-2433, 2015.</p>
<p>Jimmy Lei Ba, Jamie Ryan Kiros, and Geoffrey E Hinton. Layer normalization. arXiv preprint arXiv:1607.06450, 2016.</p>
<p>Dzmitry Bahdanau, Kyunghyun Cho, and Yoshua Bengio. Neural machine translation by jointly learning to align and translate. 2015.</p>
<p>Lon Bottou. From machine learning to machine reasoning. Machine learning, 94(2):133-149, 2014.</p>
<p>Prithvijit Chattopadhyay, Ramakrishna Vedantam, Ramprasaath R Selvaraju, Dhruv Batra, and Devi Parikh. Counting everyday objects in everyday scenes. In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, pp. 1135-1144, 2017.</p>
<p>Marta Garnelo, Kai Arulkumaran, and Murray Shanahan. Towards deep symbolic reinforcement learning. arXiv preprint arXiv:1609.05518, 2016.</p>
<p>Alex Graves, Greg Wayne, and Ivo Danihelka. Neural turing machines. arXiv preprint arXiv:1410.5401, 2014.</p>
<p>Alex Graves, Greg Wayne, Malcolm Reynolds, Tim Harley, Ivo Danihelka, Agnieszka GrabskaBarwiska, Sergio Gmez Colmenarejo, Edward Grefenstette, Tiago Ramalho, John Agapiou, et al. Hybrid computing using a neural network with dynamic external memory. Nature, 538 (7626):471-476, 2016.</p>
<p>Akshay Kumar Gupta. Survey of visual question answering: Datasets and techniques. arXiv preprint arXiv:1705.03865, 2017.</p>
<p>Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun. Deep residual learning for image recognition. In Proceedings of the IEEE conference on computer vision and pattern recognition, pp. $770-778,2016$.</p>
<p>Ronghang Hu, Jacob Andreas, Marcus Rohrbach, Trevor Darrell, and Kate Saenko. Learning to reason: End-to-end module networks for visual question answering. In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, pp. 804-813, 2017.</p>
<p>Sergey Ioffe and Christian Szegedy. Batch normalization: Accelerating deep network training by reducing internal covariate shift. In International Conference on Machine Learning, pp. 448-456, 2015.</p>
<p>Justin Johnson, Bharath Hariharan, Laurens van der Maaten, Li Fei-Fei, C Lawrence Zitnick, and Ross Girshick. CLEVR: A diagnostic dataset for compositional language and elementary visual reasoning. In Computer Vision and Pattern Recognition (CVPR), 2017 IEEE Conference on, pp. 1988-1997. IEEE, 2017a.</p>
<p>Justin Johnson, Bharath Hariharan, Laurens van der Maaten, Judy Hoffman, Li Fei-Fei, C Lawrence Zitnick, and Ross Girshick. Inferring and executing programs for visual reasoning. In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, pp. 2989-2998, 2017b.</p>
<p>Diederik Kingma and Jimmy Ba. Adam: A method for stochastic optimization. arXiv preprint arXiv:1412.6980, 2014.</p>
<p>Ankit Kumar, Ozan Irsoy, Peter Ondruska, Mohit Iyyer, James Bradbury, Ishaan Gulrajani, Victor Zhong, Romain Paulus, and Richard Socher. Ask me anything: Dynamic memory networks for natural language processing. In International Conference on Machine Learning, pp. 1378-1387, 2016.</p>
<p>Brenden M Lake, Tomer D Ullman, Joshua B Tenenbaum, and Samuel J Gershman. Building machines that learn and think like people. Behavioral and Brain Sciences, 40, 2017.</p>
<p>Jiasen Lu, Jianwei Yang, Dhruv Batra, and Devi Parikh. Hierarchical question-image co-attention for visual question answering. In Advances In Neural Information Processing Systems, pp. 289297, 2016.</p>
<p>Alexander Miller, Adam Fisch, Jesse Dodge, Amir-Hossein Karimi, Antoine Bordes, and Jason Weston. Key-value memory networks for directly reading documents. In Proceedings of the 2016 Conference on Empirical Methods in Natural Language Processing, pp. 1400-1409, 2016.</p>
<p>Ethan Perez, Florian Strub, Harm de Vries, Vincent Dumoulin, and Aaron Courville. FiLM: Visual reasoning with a general conditioning layer. arXiv preprint arXiv:1709.07871, 2017.</p>
<p>Olga Russakovsky, Jia Deng, Hao Su, Jonathan Krause, Sanjeev Satheesh, Sean Ma, Zhiheng Huang, Andrej Karpathy, Aditya Khosla, Michael Bernstein, et al. Imagenet large scale visual recognition challenge. International Journal of Computer Vision, 115(3):211-252, 2015.</p>
<p>Adam Santoro, David Raposo, David G Barrett, Mateusz Malinowski, Razvan Pascanu, Peter Battaglia, and Tim Lillicrap. A simple neural network module for relational reasoning. In Advances in neural information processing systems, pp. 4974-4983, 2017.</p>
<p>Bob L Sturm. A simple method to determine if a music information retrieval system is a horse. IEEE Transactions on Multimedia, 16(6):1636-1644, 2014.</p>
<p>Caiming Xiong, Stephen Merity, and Richard Socher. Dynamic memory networks for visual and textual question answering. In International Conference on Machine Learning, pp. 2397-2406, 2016.</p>
<p>Zichao Yang, Xiaodong He, Jianfeng Gao, Li Deng, and Alex Smola. Stacked attention networks for image question answering. In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, pp. 21-29, 2016.</p>
<p><img alt="img-11.jpeg" src="img-11.jpeg" /></p>
<p>Figure 15: Learning curves for ablated MAC variants (accuracy / epoch). See appendix C for details.</p>
<h1>SUPPLEMENTARY MATERIAL</h1>
<h2>A IMPLEMENTATION AND TRAINING DETAILS</h2>
<p>We train our model using Adam (Kingma \&amp; Ba, 2014), with a learning rate of $10^{-4}$ and a batch size of 64 . We use gradient clipping, and employ early stopping based on the validation accuracy, resulting in a training process of 10-20 epochs, equivalent to roughly 15-30 hours on a single Maxwell Titan X GPU. Word vectors have dimension 300 and were initialized randomly using a standard uniform distribution. The exponential moving averages of the model weights are maintained during training, with a decay rate of 0.999 , and used at test time instead of the raw weights. We use variational dropout of 0.15 across the network, along with ELU as non-linearity, which, in our experience, accelerates training and performs favorably compared to the more standard ReLU.</p>
<h2>B Error Analysis</h2>
<p>To gain insight into the model's failure cases, we perform error analysis for the CLEVR and CLEVRHumans datasets. For CLEVR, we see that many of the errors arise from object occlusions, which may make it harder for the model to recognize the objects' material or shape. Most of the other errors are off-by-one counting mistakes, oftentimes for questions that ask to sum up two groups of objects (see examples in figure 16). Interestingly, we noticed that when the model is required to count objects that are heavily occluded, it may lead the model to slightly underestimate the correct number of objects, suggesting that it may perform some sort of "continuous" counting rather than discrete.</p>
<p>For CLEVR-Humans, the errors made by the model are more diverse. About half of the errors result from questions about reasoning skills that the model has not been exposed to while training on CLEVR. These include questions about physical properties: lighting and shadows, reflections and objects stability ("How many of the items are casting a shadow?", "Can a ball stay still on top of one another?"); relative distances ("How many objects... are almost touching?", "What color is the sphere positioned closest to...", "What object is in between..."); relative amounts ("Are half the items...", "Are the objects mainly..."); commonalities ("What color are the identical objects?", "What shape do the items that ... have in common?"); and negative questions, which refer to objects that do not maintain some property ("How many items do not..."). In addition, we observed some cases where the model misinterprets unseen words, capturing plausible but incorrect semantics: for instance, in some cases it interpreted a "caramel" object as yellow whereas the original question referred to a brown one, or considered a cylinder to be "circle" while the question referred to the spheres only. We believe that these errors may arise from diversity in the semantics of these words across the dataset, making the model learn those potentially valid but incorrect interpretations. Similarly to CLEVR, we observed some off-by-one errors in CLEVR-Humans. Finally, in one fifth of the cases, the errors result from faulty or ambiguous questions, which may mistakenly regard a cyan object as blue or mention references that cannot be uniquely resolved to a specific object.</p>
<h2>C Ablation STUDIES</h2>
<p>Based on the validation set, we have conducted an ablation study for MAC to better understand the impact of each of its components on the overall performance. We have tested each setting for the primary 700K CLEVR dataset as well as on a $10 \%$ subset of it. See table 2, figure 9 and figure 15 for</p>
<p>final accuracies and training curves. The following discussion complements the main conclusions presented in section 4.3:
Network Length. We observe a positive correlation between the network length and its performance, with significant improvements up to length $p=8$. These results stand out from other multi-hop architectures that tend to benefit from a lower number of iterations, commonly 2-3 only (Yang et al., 2016; Kumar et al., 2016), and suggest that MAC makes effective use of the recurrent cells to perform compositional reasoning.
Weight Sharing. Weight sharing across the $p$ cell instances has also proven to be useful both for the primary CLEVR task as well as for settings with limited data. In contrast to alternative approaches that apply specialized modules for different parts of the reasoning, these results provide some evidence for the ability of the same MAC cell to adapt its behavior to the task at hand and demonstrate different behaviors as inferred from the context.</p>
<p>Control Unit. We have performed several ablations in the control unit architecture to identify its contribution to the model behavior and performance. First, we observe that, as would be expected, an ablated model that reasons over the image alone with no access to the question, performs poorly, achieving accuracy of $51.1 \%$. As discussed in section 4.3, the ablations further show the importance of applying attention over the question words to decompose it into an explicit sequence of steps. Finally, we find that using the "contextual words" - the output states of a biLSTM processing the question - results in better performance and faster learning than attending directly to the learned word vectors. This implies that the model benefits from interpreting the word semantics and entailed behaviors in the broader context of the question rather than as a sequence of independent entities.
Write Unit. The basic MAC write unit integrates new information $\boldsymbol{r}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ with the previous memory state $\boldsymbol{m}</em>$ through a linear transformation (step (1) in section 2.2.3). In this experiment, we explore other variants of the unit. We begin by measuring the impact of the self-attention and gating mechanisms, both aiming to reduce long-range dependencies in the reasoning process. Compared to the basic MAC model, which achieves $98.94 \%$ on the validation set, self-attention yields an accuracy of $99.23 \%$, memory gating $-99.36 \%$, and adding both results in $99.48 \%$. While we can see some gain from using these components for CLEVR, we speculate that they may prove more useful for tasks that necessitate longer or more complex reasoning processes over larger knowledge bases.
Next, we examine ablated write unit variants that assign the newly retrieved information $\boldsymbol{r}}-\mathbf{1}<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ (or its linear transformation) to $\boldsymbol{m}</em>}}$ directly, ignoring the prior memory content $\boldsymbol{m<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}-\mathbf{1}}$. Notably, the results show that in fact such variants are only slightly worse than the default basic write unit, reducing accuracy by $0.4 \%$ only. We perform further experiments in which we compute the new memory state $\boldsymbol{m}</em>}}$ by averaging the retrieved information $\boldsymbol{r<em _boldsymbol_i="\boldsymbol{i">{\boldsymbol{i}}$ with the previous memory state $\boldsymbol{m}</em>$ using a sigmoidal gate alone. This architecture results in equivalent performance to that of the standard basic write unit variant.
Gate Bias Initialization. Finally, we test the impact of the gate bias (step (3) in section 2.2.3), initializing it to either $-1,0$ or 1 . Intuitively, initialization of -1 amounts to biasing the model to retain previous memory states and thereby shortening the effective reasoning process, while initialization of 1 is equivalent to using all new intermediate results derived by each of the cells. The experiments show that a bias of 1 is optimal for training on the full dataset while 0 is ideal for settings of limited data (training on $10 \%$ of the data). These results demonstrate that when enough data is available, the MAC network benefits from utilizing its full capacity, whereas biasing the model towards using less cells helps to mitigate overfitting when data is more scarce.}-\mathbf{1}</p>
<h1>D Related Work</h1>
<p>In this section we provide detailed discussion of related work. Several models have been applied to the CLEVR task. These can be partitioned into two groups, module networks that use the strong supervision provided as a tree-structured functional program associated with each instance, and end-to-end, fully differentiable networks that combine a fairly standard stack of CNNs with components that aid them in performing reasoning tasks. We also discuss the relation of MAC to other approaches, such as memory networks and neural computers.</p>
<p>Table 2: Accuracies for ablated MAC models, measured for the validation set after training on the full CLEVR dataset (left) and $10 \%$ subset of it (right).</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Model</th>
<th style="text-align: center;">Standard CLEVR</th>
<th style="text-align: center;">$\mathbf{1 0 \%}$ CLEVR</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">MAC</td>
<td style="text-align: center;">98.9</td>
<td style="text-align: center;">84.5</td>
</tr>
<tr>
<td style="text-align: left;">state dimension 256</td>
<td style="text-align: center;">98.4</td>
<td style="text-align: center;">76.3</td>
</tr>
<tr>
<td style="text-align: left;">state dimension 128</td>
<td style="text-align: center;">97.6</td>
<td style="text-align: center;">77.0</td>
</tr>
<tr>
<td style="text-align: left;">unshared weights</td>
<td style="text-align: center;">97.8</td>
<td style="text-align: center;">67.5</td>
</tr>
<tr>
<td style="text-align: left;">attention over word vectors</td>
<td style="text-align: center;">98.3</td>
<td style="text-align: center;">61.4</td>
</tr>
<tr>
<td style="text-align: left;">w/o word-attention</td>
<td style="text-align: center;">95.3</td>
<td style="text-align: center;">63.2</td>
</tr>
<tr>
<td style="text-align: left;">question vector as control</td>
<td style="text-align: center;">80.7</td>
<td style="text-align: center;">65.0</td>
</tr>
<tr>
<td style="text-align: left;">w/o control</td>
<td style="text-align: center;">55.6</td>
<td style="text-align: center;">51.5</td>
</tr>
<tr>
<td style="text-align: left;">w/o memory-control separation</td>
<td style="text-align: center;">93.9</td>
<td style="text-align: center;">64.7</td>
</tr>
<tr>
<td style="text-align: left;">w/o direct KB elements</td>
<td style="text-align: center;">98.4</td>
<td style="text-align: center;">73.4</td>
</tr>
<tr>
<td style="text-align: left;">retrieved $\rightarrow$ memory</td>
<td style="text-align: center;">98.2</td>
<td style="text-align: center;">84.5</td>
</tr>
<tr>
<td style="text-align: left;">W - retrieved + b $\rightarrow$ memory</td>
<td style="text-align: center;">98.5</td>
<td style="text-align: center;">83.7</td>
</tr>
<tr>
<td style="text-align: left;">only memory gate</td>
<td style="text-align: center;">99.3</td>
<td style="text-align: center;">83.1</td>
</tr>
<tr>
<td style="text-align: left;">w/ self-attention</td>
<td style="text-align: center;">99.2</td>
<td style="text-align: center;">83.2</td>
</tr>
<tr>
<td style="text-align: left;">w/ memory gate</td>
<td style="text-align: center;">99.4</td>
<td style="text-align: center;">83.1</td>
</tr>
<tr>
<td style="text-align: left;">w/ self-attention and memory gate</td>
<td style="text-align: center;">99.5</td>
<td style="text-align: center;">85.5</td>
</tr>
<tr>
<td style="text-align: left;">gate bias 0</td>
<td style="text-align: center;">98.7</td>
<td style="text-align: center;">84.9</td>
</tr>
<tr>
<td style="text-align: left;">gate bias 1</td>
<td style="text-align: center;">99.4</td>
<td style="text-align: center;">68.5</td>
</tr>
<tr>
<td style="text-align: left;">gate bias -1</td>
<td style="text-align: center;">99.0</td>
<td style="text-align: center;">77.1</td>
</tr>
<tr>
<td style="text-align: left;">prediction w/o question</td>
<td style="text-align: center;">97.8</td>
<td style="text-align: center;">64.7</td>
</tr>
</tbody>
</table>
<h1>D. 1 Module Networks</h1>
<p>The modular approach (Andreas et al., 2016a;b; Hu et al., 2017; Johnson et al., 2017b) first translates a given question into a tree-structured action plan, aiming to imitate the question underlying structural representation externally provided as strong supervision. Then, it constructs a tailor-made network that progressively executes the plan over the image. The network is composed of discrete units selected out of a fixed collection of predefined "modules", each responsible for an elementary reasoning operation, such as identifying an object's color, filtering them for their shape, or comparing their amounts. Each module has its own set of learned parameters (Johnson et al., 2017b), or even a hand-crafted design (Andreas et al., 2016a) that guides it towards its intended behavior. Overall, this approach makes discrete choices at two levels: the identity of each module - the behavior it should learn among a fixed set of possible behavior types, and the network layout - the way in which the modules are wired together to compute the answer. The model differentiability is thus confined to the boundaries of a single module.</p>
<p>Several key differences exist between our approaches. First, MAC replaces the fixed and specialized modules inventory with one universal cell that adapts its operation to the task at hand, selected from a continuous range of reasoning behaviors. Therefore, in contrast to module networks, our cell can be applied across all the reasoning steps, sharing both its parameters and architecture. Second, we replace the dynamic recursive tree structures with a sequential topology, augmented by soft attention mechanisms, inspired by Bahdanau et al. (2015). This confers the network with the capacity to represent arbitrarily complex Directed Acyclic Graphs (DAGs) in a soft way, while still having efficient and readily deployed physical sequential structure. Together, these relaxations allow us to effectively train our model end-to-end by backpropagation alone, whereas module networks demand more involved training schemes that rely on the strongly-supervised programs at the first stage, and on various reinforcement learning (RL) techniques at the second. Finally, since the only source of supervision in training our model arises from the answer to each question, MAC is free to acquire more robust and adaptive reasoning strategies from the bottom up - inferred directly form the data, rather than trying to imitate the behaviors dictated by brittle parsers or closed domain functional programs, and is thus more applicable to real-world settings.</p>
<h2>D. 2 Augmented Convolutional Neural Networks</h2>
<p>Alternative approaches for the CLEVR task that do not rely on the provided programs as a strong supervision signal are Santoro et al. (2017) and Perez et al. (2017). Both complement standard multi-layer Convolutional Neural Networks (CNNs) with components that aid them in handling compositional and relational questions.</p>
<p>Relation Networks. Santoro et al. (2017) appends a Relation Network (RN) layer to the CNN. This layer inspects all pairs of pixels in the image, thereby enhancing the network capacity to reason over binary relations between objects. While this approach is very simple and elegant conceptually, it</p>
<p>suffers from quadratic computational complexity, in contrast to our approach, which is linear. But beyond that, closer inspection reveals that this direct pairwise comparison might be unnecessary. Based on the analogy suggested by Santoro et al. (2017), according to which pixels are equivalent to objects and their pairwise interactions to relations, an RN layer attempts to grasp the induced graph between objects all at once in one shallow and broad layer. Conversely, our attention-based model proceeds in steps, iteratively comparing the image to a memory state that had aggregated information from the image in prior iterations. By the same analogy, MAC traverses a narrow and deep reasoning "path" that progressively follows transitive relations. Consequently, our model exhibits a relational capacity while circumventing the computational inefficiency.</p>
<p>FiLM. Perez et al. (2017) proposes a model for visual reasoning that interleaves standard CNN layers with linear layers, reminiscent of layer normalization techniques (Ba et al., 2016; Ioffe \&amp; Szegedy, 2015). Each of these layers, called FiLM, is conditioned on the question, which is translated into matching bias and variance terms that tilt the layer's activations to reflect the specifics of the given question, thus influencing the computation done over the image. Similarly to our model, this approach features distant modulation between the question and the image, where the former can affect the latter only through constrained means. However, since the same normalization is applied across all the activations homogeneously, agnostic to both their spatial location as well as their feature values, FiLM does not allow the question to differentiate between regions in the image based on their semantics - the objects or concepts they represent.</p>
<p>This stands in stark contrast to our attention-based model, which readily allows and actually encourages the question to inform the model about relevant regions to focus on. As supported by section 4, this more selective interaction between the question and the image facilitates learning and increases the model's generalizability. Indeed, since attention is commonly used in models designed for standard VQA (Antol et al., 2015; Gupta, 2017; Lu et al., 2016; Yang et al., 2016), it is reasonable to assume that it would be beneficial to incorporate such methods into visual reasoning systems for the CLEVR task as well. In fact, attention mechanisms should be especially useful for multi-step reasoning questions such as those present in CLEVR. Such questions refer to several relations between different objects in the image and feature compositional structure that may be approached one step at a time. Thus, it should be beneficial for a cogent responder to have the capacity to selectively focus on one or some objects at each step, traversing the relevant relational links one after the other, both at the image level, and at the question level.</p>
<h1>D. 3 MEMORY AND ATTENTION</h1>
<p>Our architecture draws inspiration from recent research on mechanisms for neural memory and attention (Kumar et al., 2016; Xiong et al., 2016; Graves et al., 2014; 2016). Kumar et al. (2016) and Xiong et al. (2016) propose the Dynamic Memory Network (DMN) model that proceeds in an iterative process, attending to relevant information from a given knowledge base, which is then successively accumulated into the model's memory state. However, the DMN views the question as one atomic unit, whereas our model decomposes it into a multi-step action plan that informs each cell of its specific objective. Another key difference is the distant interaction between the question and the knowledge base that characterizes our model. Conversely, DMN fuses their representations together into the same vector space.</p>
<p>Graves et al. $(2014 ; 2016)$ complement a neural network with an external memory it can interact with through the means of soft attention. Similarly to our approach, the model consists of a controller that performs read and write operations over a fixed-size memory array. However, in contrast to Graves et al. $(2014 ; 2016)$, we employ a recurrent memory structure, where each MAC cell is associated with its own memory state. Rather than reading and writing iteratively into multiple slots in a shared memory resource, each cell creates a new memory, building upon the contents of the prior ones. This allows us to avoid potential issues of content blurring due to multiple global write operations, while still supporting the emergence of complex reasoning processes that progressively interact with preceding memories and intermediate results to accomplish the task at hand.</p>
<p><img alt="img-12.jpeg" src="img-12.jpeg" />
<img alt="img-13.jpeg" src="img-13.jpeg" /></p>
<p>Q: How many gray objects are shown? A: $3 \checkmark$
<img alt="img-14.jpeg" src="img-14.jpeg" /></p>
<p>Q: What is the tan object made of? A: rubber $\checkmark$
<img alt="img-15.jpeg" src="img-15.jpeg" /></p>
<p>Q: How many other objects are the same size as the blue ball? A: $7 \checkmark$
<img alt="img-16.jpeg" src="img-16.jpeg" /></p>
<p>Q: Are half the items shown green? A: yes (no) #
<img alt="img-17.jpeg" src="img-17.jpeg" /></p>
<p>Q: What is the shape of the object that is to the left of the red rubber cube and behind the metallic cylinder? A: sphere (cylinder) #</p>
<p>Q: What object looks like a caramel? A: cube $\checkmark$
<img alt="img-18.jpeg" src="img-18.jpeg" /></p>
<p>Q: What object looks like a caramel? A: cube $\checkmark$
<img alt="img-19.jpeg" src="img-19.jpeg" /></p>
<p>Q: How many small objects are rubber? A: $2 \checkmark$
<img alt="img-20.jpeg" src="img-20.jpeg" /></p>
<p>Q: Are half the items shown green? A: yes (no) #
<img alt="img-21.jpeg" src="img-21.jpeg" /></p>
<p>Q: How many other objects are the same size as the blue ball? A: $7 \checkmark$
<img alt="img-22.jpeg" src="img-22.jpeg" /></p>
<p>Q: What is the shape of the object that is to the left of the red rubber cube and behind the metallic cylinder? A: sphere (cylinder) #</p>
<p>Q: What color is the target cube? A: yellow $\checkmark$
<img alt="img-23.jpeg" src="img-23.jpeg" /></p>
<p>Q: What color is the largest cube? A: yellow $\checkmark$
<img alt="img-24.jpeg" src="img-24.jpeg" /></p>
<p>Q: What is the shape of the object that is to the left of the red rubber cube and behind the metallic cylinder? A: sphere (cylinder) #</p>
<p>Q: What color is the target cube? A: yellow $\checkmark$
<img alt="img-25.jpeg" src="img-25.jpeg" /></p>
<p>Q: What color is the largest cube? A: yellow $\checkmark$
<img alt="img-26.jpeg" src="img-26.jpeg" /></p>
<p>Q: What is the shape of the object that is to the left of the red rubber cube and behind the metallic cylinder? A: sphere (cylinder) #</p>
<p>Q: How many tiny objects are green things or red objects? A: $4 \checkmark$</p>
<p>Figure 16: The first five rows show examples of the final attention map produced by the model for CLEVRHuman questions, demonstrating the ability of the model to perform novel reasoning skills and cope with new concepts that have not been introduced in CLEVR. These include in particular: obstructions, object uniqueness, relative distances, superlatives and new terms. The final row shows examples from CLEVR with object occlusions and summation.</p>
<p><img alt="img-27.jpeg" src="img-27.jpeg" /></p>
<p>Figure 17: Attention maps produced by MAC networks of lengths 4 and 6, providing evidence for the ability of the model to track transitive relations and perform logical operations. Note how the model tends to proceed from the end of the question backwards, tracking the relevant objects iteratively.</p>
<p><img alt="img-28.jpeg" src="img-28.jpeg" /></p>
<p>Figure 18: Attention maps produced by a MAC network of length 6, providing evidence for the ability of the model to track transitive relations, and perform logical operations, counting and summation. Note how the first iterations focus on the key structural question words "many" and "or" that serve as indicators for the model of the required reasoning operation it has to perform. Also note how the model correctly sums up two object groups in the second example, while correctly accounting for the intersection between them.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:0">
<p>${ }^{4}$ For previous models, we use the author's original publicly available implementations. All the models were trained with an equal batch size of 64 (as in the original implementations) and using the same hardware - a single Maxwell Titan X GPU per model. To make sure the results are statistically significant, we run each model multiple (10) times, and plot the averages and confidence intervals.&#160;<a class="footnote-backref" href="#fnref:0" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:0" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:0" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>            </div>
        </div>

    </div>
</body>
</html>