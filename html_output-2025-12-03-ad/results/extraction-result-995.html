<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction extraction-result-995 - Theorizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="header">
        <a href="../index.html"><i class="fas fa-flask"></i> Theorizer</a>
    </div>

    <div class="content">
        <h1>Extracted Data Details for extraction-result-995</h1>

        <div class="section">
            <h2>Extracted Data (Header)</h2>
            <div class="info-section">
                <p><strong>Extraction ID:</strong> extraction-result-995</p>
                <p><strong>Extraction Schema Used (ID):</strong> <a href="../schemas/extraction-schema-20.html">extraction-schema-20</a></p>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <p><strong>Paper ID:</strong> paper-753b7a701adc1b6072378bd048cfa8567885d9c7</p>
                <p><strong>Paper Title:</strong> <a href="https://www.semanticscholar.org/paper/753b7a701adc1b6072378bd048cfa8567885d9c7" target="_blank">Invariant Risk Minimization</a></p>
                <p><strong>Paper Venue:</strong> arXiv.org</p>
                <p><strong>Paper TL;DR:</strong> This work introduces Invariant Risk Minimization, a learning paradigm to estimate invariant correlations across multiple training distributions and shows how the invariances learned by IRM relate to the causal structures governing the data and enable out-of-distribution generalization.</p>
                <p><strong>Paper Abstract:</strong> We introduce Invariant Risk Minimization (IRM), a learning paradigm to estimate invariant correlations across multiple training distributions. To achieve this goal, IRM learns a data representation such that the optimal classifier, on top of that data representation, matches for all training distributions. Through theory and experiments, we show how the invariances learned by IRM relate to the causal structures governing the data and enable out-of-distribution generalization.</p>
                <p><strong>Cost:</strong> 0.021</p>
            </div>
        </div>

        <div class="section">
            <h2>Extracted Data (Details)</h2>
            <div class="extraction-instance-container" id="e995.0">
                <h3 class="extraction-instance">Extracted Data Instance 0 (e995.0)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>IRM</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Invariant Risk Minimization</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>A learning paradigm that seeks data representations whose optimal classifier is the same across multiple training environments, enforcing invariance to discard spurious correlations and enable out-of-distribution generalization.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td>here</td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>method_name</strong></td>
                            <td>Invariant Risk Minimization (IRM / IRMv1)</td>
                        </tr>
                        <tr>
                            <td><strong>method_description</strong></td>
                            <td>Find a representation Φ such that there exists a classifier w that is simultaneously optimal across all training environments. Practically (IRMv1) optimizes: minimize sum_e R^e(Φ) + λ * ||∇_{w | w=1.0} R^e(w·Φ)||^2, where the gradient-norm penalty measures how far a fixed scalar classifier (w=1.0) is from being optimal per environment. For linear least-squares the paper derives an equivalent polynomial penalty (D_lin) that avoids matrix inversion pathologies. The method learns to discard features whose predictive relationship with Y varies across environments, thereby recovering (under assumptions) causal/invariant features.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>Synthetic SEM experiments; Colored MNIST</td>
                        </tr>
                        <tr>
                            <td><strong>environment_description</strong></td>
                            <td>Offline simulated environments: (1) Synthetic SEM setups where X is generated from latent Z=(Z1,Z2) with multiple training environments produced by interventions/noise changes and optional scrambling (orthogonal S), including fully/partially-observed and homo-/heteroskedastic variants; (2) Colored MNIST synthetic classification with two training environments (different color-label correlations) and a held-out test environment where the correlation is reversed. These are not interactive or actively experimental in the paper—they are multiple static simulated environments.</td>
                        </tr>
                        <tr>
                            <td><strong>handles_distractors</strong></td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td><strong>distractor_handling_technique</strong></td>
                            <td>Representation learning with invariance penalty: enforces that the optimal classifier is identical across environments so features whose conditional relationship P(Y|Φ(X)) changes across environments (spurious/distractor features) are not useful and are suppressed; uses D_lin analytic penalty for linear case and gradient-norm penalty ||∇_w R^e||^2 (evaluated at w=1.0) for general losses.</td>
                        </tr>
                        <tr>
                            <td><strong>spurious_signal_types</strong></td>
                            <td>Spurious correlations between features and label (non-causal predictors / effects), confounding via latent variables, selection biases across environments, heteroskedastic noise (addressed in discussion/experiments).</td>
                        </tr>
                        <tr>
                            <td><strong>detection_method</strong></td>
                            <td>Detects spurious signals by measuring lack of invariance: computes per-environment optimality violation via the gradient-norm penalty (||∇_{w|w=1} R^e(w·Φ)||^2) or D_lin (norm of violation of normal equations). Differences in conditional expectations P(Y|Φ(X)) across environments indicate spuriousness.</td>
                        </tr>
                        <tr>
                            <td><strong>downweighting_method</strong></td>
                            <td>Indirect downweighting through representation learning: penalizing non-invariance forces Φ to produce features for which a single classifier works across all envs, effectively reducing the influence (weights) of features whose predictive coefficients vary across environments; λ controls tradeoff and is cross-validated.</td>
                        </tr>
                        <tr>
                            <td><strong>refutation_method</strong></td>
                            <td>Refutes spurious predictors by demonstrating they violate invariance across environments (nonzero penalty) and therefore cannot be part of the invariant predictor; theoretical results show that, under assumptions, only direct causal parents remain as invariant predictors across all valid interventions.</td>
                        </tr>
                        <tr>
                            <td><strong>uses_active_learning</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>inquiry_strategy</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_robustness</strong></td>
                            <td>Colored MNIST: IRM (with invariance penalty tuned) achieved test accuracy 66.9 ± 2.5% (train acc 70.8 ± 0.9%); Synthetic SEM experiments: IRM recovers causal weights far more accurately than ERM and outperforms ICP (authors report IRM is often orders of magnitude more accurate on causal-weight recovery; exact numeric summaries for all variants are in paper figures).</td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_robustness</strong></td>
                            <td>Baseline ERM on Colored MNIST: train accuracy 87.4 ± 0.2% but test accuracy 17.1 ± 0.6% demonstrating severe failure OOD when spurious color correlation is reversed; ICP (comparison) is reported as conservative and worse than IRM on causal-weight recovery in synthetic setups (no single scalar numbers provided for all setups).</td>
                        </tr>
                        <tr>
                            <td><strong>has_ablation_study</strong></td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td><strong>number_of_distractors</strong></td>
                            <td>Synthetic setups: 10-dimensional non-causal block (Z2 of dimension 10) in experiments; Colored MNIST: a single dominant color distractor; experiments include variants with hidden confounder H (10-d).</td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>IRM successfully identifies and discards spurious, environment-dependent features by enforcing invariance across environments, yielding strong OOD performance where ERM fails (e.g., Colored MNIST). IRM outperforms prior ICP baselines in synthetic SEM and scrambled observation settings and is robust to some model misspecification (scrambling S ≠ I). The gradient-norm penalty (IRMv1) and the D_lin construction for linear cases produce smooth optimization landscapes compared to naive distance-to-optima penalties. IRM requires sufficiently diverse environments to guarantee recovery (theory requires number of environments scaling with representation rank), but empirically often succeeds with only two training environments.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Invariant Risk Minimization', 'publication_date_yy_mm': '2019-07'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e995.1">
                <h3 class="extraction-instance">Extracted Data Instance 1 (e995.1)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>ERM</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Empirical Risk Minimization</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>Standard learning principle that minimizes pooled training loss across data; commonly used baseline that may exploit any correlation present in the pooled training distribution, including spurious ones.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>method_name</strong></td>
                            <td>Empirical Risk Minimization (ERM)</td>
                        </tr>
                        <tr>
                            <td><strong>method_description</strong></td>
                            <td>Pool all training environments and minimize average (or total) empirical risk across pooled data. Does not consider environment structure or invariance and therefore will exploit correlations that minimize pooled training error, including spurious correlations that vary across environments.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>Synthetic SEM experiments; Colored MNIST</td>
                        </tr>
                        <tr>
                            <td><strong>environment_description</strong></td>
                            <td>Same offline simulated datasets as used to evaluate IRM and ICP; ERM is applied by pooling training data across environments.</td>
                        </tr>
                        <tr>
                            <td><strong>handles_distractors</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>distractor_handling_technique</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>spurious_signal_types</strong></td>
                            <td>Prone to exploit spurious correlations, selection biases, confounding effects present in pooled data.</td>
                        </tr>
                        <tr>
                            <td><strong>detection_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>downweighting_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>refutation_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>uses_active_learning</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>inquiry_strategy</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_robustness</strong></td>
                            <td>Colored MNIST: ERM achieved high training accuracy (87.4 ± 0.2%) but catastrophic OOD test performance (17.1 ± 0.6%) because it relied on spurious color correlations.</td>
                        </tr>
                        <tr>
                            <td><strong>has_ablation_study</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>number_of_distractors</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>Pooling environments (ERM) can destroy information about which correlations are stable across environments and therefore leads models to rely on spurious, non-generalizing features; ERM can achieve low training error yet fail badly OOD.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Invariant Risk Minimization', 'publication_date_yy_mm': '2019-07'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e995.2">
                <h3 class="extraction-instance">Extracted Data Instance 2 (e995.2)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>ICP</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Invariant Causal Prediction</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>A causal discovery method that searches for subsets of covariates whose regression residuals have invariant distribution across environments, used to identify direct causal parents of a target variable under certain assumptions.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td>Invariant Causal Prediction</td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>method_name</strong></td>
                            <td>Invariant Causal Prediction (ICP)</td>
                        </tr>
                        <tr>
                            <td><strong>method_description</strong></td>
                            <td>Search over subsets S of covariates and test whether the conditional distribution (typically regression residuals) of Y given X_S is identical across environments; covariates that survive the invariance tests are considered causal parents. Relies on statistical hypothesis tests and is designed for linear/Gaussian settings in the referenced literature.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>Synthetic SEM experiments</td>
                        </tr>
                        <tr>
                            <td><strong>environment_description</strong></td>
                            <td>Evaluated on the paper's synthetic SEM datasets (multiple training environments produced by interventions and noise variations, with optional scrambling). These are offline simulation datasets rather than interactive labs.</td>
                        </tr>
                        <tr>
                            <td><strong>handles_distractors</strong></td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td><strong>distractor_handling_technique</strong></td>
                            <td>Variable selection by testing invariance of residual distributions across environments; variables producing non-invariant residuals are rejected as non-causal/distractors.</td>
                        </tr>
                        <tr>
                            <td><strong>spurious_signal_types</strong></td>
                            <td>Spurious correlations and non-causal variables that cause environment-dependent residual distributions; ICP assumes noise structure (centered, independent) and may not handle changing noise variance well.</td>
                        </tr>
                        <tr>
                            <td><strong>detection_method</strong></td>
                            <td>Statistical hypothesis testing on residual distributions across environments (tests for equality of residual distributions).</td>
                        </tr>
                        <tr>
                            <td><strong>downweighting_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>refutation_method</strong></td>
                            <td>Refutes candidate covariates by rejecting the null hypothesis of invariant residual distribution across environments, thereby excluding variables considered spurious.</td>
                        </tr>
                        <tr>
                            <td><strong>uses_active_learning</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>inquiry_strategy</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_robustness</strong></td>
                            <td>Reported as conservative in experiments: tends to reject many covariates and therefore produces large errors on estimating causal weights while keeping small weights on non-causal features; outperformed by IRM on synthetic setups in the paper (no uniform numeric summary provided).</td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>has_ablation_study</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>number_of_distractors</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>ICP is a principled invariance-based causal discovery method but is conservative in finite-sample settings; it can fail when noise variance in Y changes across environments (residual-distribution matching becomes unsuited) and is outperformed by IRM in the paper's synthetic and scrambled-observation experiments.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Invariant Risk Minimization', 'publication_date_yy_mm': '2019-07'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e995.3">
                <h3 class="extraction-instance">Extracted Data Instance 3 (e995.3)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>Robust learning</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Robust (minimax) learning / distributional robustness</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>Robust objectives minimize worst-case (or baseline-shifted) risk across environments, often formulated as max_e (R^e(f) - r_e); discussed as an alternative but shown to reduce to weighted ERM under KKT conditions.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>mention</td>
                        </tr>
                        <tr>
                            <td><strong>method_name</strong></td>
                            <td>Robust learning (minimax / worst-case risk with environment baselines)</td>
                        </tr>
                        <tr>
                            <td><strong>method_description</strong></td>
                            <td>Formulations that minimize the maximum environment risk (possibly after subtracting environment-specific baselines r_e), i.e., R^rob(f) = max_e [R^e(f) - r_e]. The paper shows (Proposition 2) that, under KKT differentiability and qualification conditions, solutions are first-order stationary points of a weighted average of environment risks (∑_e λ_e R^e(f)), making robust learning effectively a reweighting of ERM.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>theoretical / general</td>
                        </tr>
                        <tr>
                            <td><strong>environment_description</strong></td>
                            <td>Discussed theoretically; not run as a standalone experimental method in the paper's empirical section.</td>
                        </tr>
                        <tr>
                            <td><strong>handles_distractors</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>distractor_handling_technique</strong></td>
                            <td>Environment reweighting (via baselines r_e and implied λ_e) — not a per-feature distractor handling mechanism.</td>
                        </tr>
                        <tr>
                            <td><strong>spurious_signal_types</strong></td>
                            <td>Attempts to account for noisy or difficult environments by downweighting them via baselines, but not designed to eliminate feature-level spurious signals.</td>
                        </tr>
                        <tr>
                            <td><strong>detection_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>downweighting_method</strong></td>
                            <td>Downweights whole environments (via baselines r_e or implied λ_e), but this does not guarantee removal of feature-level spurious correlations and can still lead to mixture solutions that exploit spurious features.</td>
                        </tr>
                        <tr>
                            <td><strong>refutation_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>uses_active_learning</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>inquiry_strategy</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>has_ablation_study</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>number_of_distractors</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>Robust learning objectives that minimize maximum environment error are equivalent (under common conditions) to optimizing a weighted average of environment risks; this equivalence implies such methods will generally not discover invariances needed to exclude spurious features (they can still exploit spurious correlations present in weighted mixtures of environments).</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Invariant Risk Minimization', 'publication_date_yy_mm': '2019-07'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e995.4">
                <h3 class="extraction-instance">Extracted Data Instance 4 (e995.4)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>Domain adaptation</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Domain adaptation / distribution matching methods</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>Methods that learn representations whose distributions match across environments (marginal or conditional), e.g., adversarial or moment-matching approaches, with limitations when matching the wrong distributional object.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>mention</td>
                        </tr>
                        <tr>
                            <td><strong>method_name</strong></td>
                            <td>Domain adaptation (feature distribution matching; conditional domain adaptation)</td>
                        </tr>
                        <tr>
                            <td><strong>method_description</strong></td>
                            <td>Approaches that learn a representation Φ(X) such that the marginal distribution P(Φ(X)) (or conditional P(Φ(X)|Y)) is aligned across environments, e.g., via adversarial training or kernel-based moment matching. The paper notes these can fail to find causal invariances because matching feature marginals can enforce the wrong invariance when the causal conditional P(Y|Φ(X)) itself changes across environments; conditional matching P(Φ|Y) could solve special cases (e.g., Colored MNIST) but is less general than IRM.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>general mention; Colored MNIST discussion</td>
                        </tr>
                        <tr>
                            <td><strong>environment_description</strong></td>
                            <td>Considered in the context of offline dataset shifts; not implemented as an evaluated method in the paper's experiments (except conceptual discussion comparing to IRM on Colored MNIST).</td>
                        </tr>
                        <tr>
                            <td><strong>handles_distractors</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>distractor_handling_technique</strong></td>
                            <td>Distribution matching (marginal or conditional) — can indirectly reduce influence of distractors if their distributions are aligned but may force the wrong invariance.</td>
                        </tr>
                        <tr>
                            <td><strong>spurious_signal_types</strong></td>
                            <td>Covariate shift, spurious feature correlations that manifest as distributional differences between domains.</td>
                        </tr>
                        <tr>
                            <td><strong>detection_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>downweighting_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>refutation_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>uses_active_learning</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>inquiry_strategy</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>has_ablation_study</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>number_of_distractors</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>Matching feature distributions across domains can enforce incorrect invariances (failing when causal conditionals change); conditional domain adaptation (matching P(h|y,e)) could succeed in special constructed cases (e.g., Colored MNIST) but is brittle when the distribution of causal features changes across environments — IRM addresses a different invariance (P(y|h) matching) and is more generally applicable in the paper's examples.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Invariant Risk Minimization', 'publication_date_yy_mm': '2019-07'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="extraction-instance-container" id="e995.5">
                <h3 class="extraction-instance">Extracted Data Instance 5 (e995.5)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of causal discovery methods, especially those that handle distractors or spurious correlations in virtual labs or interactive environments, including techniques for detecting, downweighting, or refuting spurious signals.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>Invariance penalties (D_lin / D_dist / gradient-norm)</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Invariance penalty constructions: D_dist, D_lin, and gradient-norm penalty</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>Penalty formulations to operationalize the IRM constraint that a classifier be optimal in every environment: naive distance-to-optima (D_dist), normal-equation violation (D_lin) for linear least-squares, and the general gradient-norm penalty ||∇_{w|w=1.0} R^e||^2 used in IRMv1.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>method_name</strong></td>
                            <td>D_dist, D_lin, and gradient-norm invariant penalties</td>
                        </tr>
                        <tr>
                            <td><strong>method_description</strong></td>
                            <td>D_dist measures ||w - w_Φ^e||^2 (distance to per-environment least-squares optimum) but is discontinuous and numerically unstable. D_lin measures the norm of the violation of normal equations: ||E[ΦΦ^T] w - E[Φ Y]||^2, which is smooth and zero iff w is optimal for that environment in least-squares. The general gradient-norm penalty is ||∇_{w|w=1.0} R^e(w·Φ)||^2, applicable to convex losses (including cross-entropy) and used in IRMv1.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>used inside IRMv1 on Synthetic SEM and Colored MNIST experiments</td>
                        </tr>
                        <tr>
                            <td><strong>environment_description</strong></td>
                            <td>These are penalty terms applied during offline SGD optimization of IRM objectives on static simulated datasets.</td>
                        </tr>
                        <tr>
                            <td><strong>handles_distractors</strong></td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td><strong>distractor_handling_technique</strong></td>
                            <td>By penalizing per-environment optimality violations, features that produce environment-dependent optimal classifiers (distractors/spurious features) incur penalty and are suppressed in the learned representation.</td>
                        </tr>
                        <tr>
                            <td><strong>spurious_signal_types</strong></td>
                            <td>Environment-dependent predictive features, effects that correlate with Y differently across envs, and features producing unstable regression coefficients.</td>
                        </tr>
                        <tr>
                            <td><strong>detection_method</strong></td>
                            <td>Nonzero penalty values indicate that a candidate classifier/representation is not simultaneously optimal across environments, signaling presence of spurious/inconsistent features.</td>
                        </tr>
                        <tr>
                            <td><strong>downweighting_method</strong></td>
                            <td>Optimization with the penalty forces Φ to reduce reliance on features that produce large per-environment optimality violations, effectively downweighting spurious signals.</td>
                        </tr>
                        <tr>
                            <td><strong>refutation_method</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>uses_active_learning</strong></td>
                            <td>False</td>
                        </tr>
                        <tr>
                            <td><strong>inquiry_strategy</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_robustness</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>has_ablation_study</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>number_of_distractors</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>key_findings</strong></td>
                            <td>D_lin yields a smooth objective that avoids the discontinuities of D_dist and is zero exactly when w is per-environment optimal in the linear least-squares case; the gradient-norm penalty generalizes this idea to arbitrary convex losses and is the practical instrument used in IRMv1 to detect and remove spurious, environment-dependent features.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'Invariant Risk Minimization', 'publication_date_yy_mm': '2019-07'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>Potentially Relevant New Papers (mentioned by this paper)</h2>
            <ol>
                <li>Invariant Causal Prediction <em>(Rating: 2)</em></li>
            </ol>
        </div>

        <div class="section">
            <h2>Extracted Data (Debug)</h2>
            <pre><code>{
    "id": "extraction-result-995",
    "paper_id": "paper-753b7a701adc1b6072378bd048cfa8567885d9c7",
    "extraction_schema_id": "extraction-schema-20",
    "extracted_data": [
        {
            "name_short": "IRM",
            "name_full": "Invariant Risk Minimization",
            "brief_description": "A learning paradigm that seeks data representations whose optimal classifier is the same across multiple training environments, enforcing invariance to discard spurious correlations and enable out-of-distribution generalization.",
            "citation_title": "here",
            "mention_or_use": "use",
            "method_name": "Invariant Risk Minimization (IRM / IRMv1)",
            "method_description": "Find a representation Φ such that there exists a classifier w that is simultaneously optimal across all training environments. Practically (IRMv1) optimizes: minimize sum_e R^e(Φ) + λ * ||∇_{w | w=1.0} R^e(w·Φ)||^2, where the gradient-norm penalty measures how far a fixed scalar classifier (w=1.0) is from being optimal per environment. For linear least-squares the paper derives an equivalent polynomial penalty (D_lin) that avoids matrix inversion pathologies. The method learns to discard features whose predictive relationship with Y varies across environments, thereby recovering (under assumptions) causal/invariant features.",
            "environment_name": "Synthetic SEM experiments; Colored MNIST",
            "environment_description": "Offline simulated environments: (1) Synthetic SEM setups where X is generated from latent Z=(Z1,Z2) with multiple training environments produced by interventions/noise changes and optional scrambling (orthogonal S), including fully/partially-observed and homo-/heteroskedastic variants; (2) Colored MNIST synthetic classification with two training environments (different color-label correlations) and a held-out test environment where the correlation is reversed. These are not interactive or actively experimental in the paper—they are multiple static simulated environments.",
            "handles_distractors": true,
            "distractor_handling_technique": "Representation learning with invariance penalty: enforces that the optimal classifier is identical across environments so features whose conditional relationship P(Y|Φ(X)) changes across environments (spurious/distractor features) are not useful and are suppressed; uses D_lin analytic penalty for linear case and gradient-norm penalty ||∇_w R^e||^2 (evaluated at w=1.0) for general losses.",
            "spurious_signal_types": "Spurious correlations between features and label (non-causal predictors / effects), confounding via latent variables, selection biases across environments, heteroskedastic noise (addressed in discussion/experiments).",
            "detection_method": "Detects spurious signals by measuring lack of invariance: computes per-environment optimality violation via the gradient-norm penalty (||∇_{w|w=1} R^e(w·Φ)||^2) or D_lin (norm of violation of normal equations). Differences in conditional expectations P(Y|Φ(X)) across environments indicate spuriousness.",
            "downweighting_method": "Indirect downweighting through representation learning: penalizing non-invariance forces Φ to produce features for which a single classifier works across all envs, effectively reducing the influence (weights) of features whose predictive coefficients vary across environments; λ controls tradeoff and is cross-validated.",
            "refutation_method": "Refutes spurious predictors by demonstrating they violate invariance across environments (nonzero penalty) and therefore cannot be part of the invariant predictor; theoretical results show that, under assumptions, only direct causal parents remain as invariant predictors across all valid interventions.",
            "uses_active_learning": false,
            "inquiry_strategy": null,
            "performance_with_robustness": "Colored MNIST: IRM (with invariance penalty tuned) achieved test accuracy 66.9 ± 2.5% (train acc 70.8 ± 0.9%); Synthetic SEM experiments: IRM recovers causal weights far more accurately than ERM and outperforms ICP (authors report IRM is often orders of magnitude more accurate on causal-weight recovery; exact numeric summaries for all variants are in paper figures).",
            "performance_without_robustness": "Baseline ERM on Colored MNIST: train accuracy 87.4 ± 0.2% but test accuracy 17.1 ± 0.6% demonstrating severe failure OOD when spurious color correlation is reversed; ICP (comparison) is reported as conservative and worse than IRM on causal-weight recovery in synthetic setups (no single scalar numbers provided for all setups).",
            "has_ablation_study": true,
            "number_of_distractors": "Synthetic setups: 10-dimensional non-causal block (Z2 of dimension 10) in experiments; Colored MNIST: a single dominant color distractor; experiments include variants with hidden confounder H (10-d).",
            "key_findings": "IRM successfully identifies and discards spurious, environment-dependent features by enforcing invariance across environments, yielding strong OOD performance where ERM fails (e.g., Colored MNIST). IRM outperforms prior ICP baselines in synthetic SEM and scrambled observation settings and is robust to some model misspecification (scrambling S ≠ I). The gradient-norm penalty (IRMv1) and the D_lin construction for linear cases produce smooth optimization landscapes compared to naive distance-to-optima penalties. IRM requires sufficiently diverse environments to guarantee recovery (theory requires number of environments scaling with representation rank), but empirically often succeeds with only two training environments.",
            "uuid": "e995.0",
            "source_info": {
                "paper_title": "Invariant Risk Minimization",
                "publication_date_yy_mm": "2019-07"
            }
        },
        {
            "name_short": "ERM",
            "name_full": "Empirical Risk Minimization",
            "brief_description": "Standard learning principle that minimizes pooled training loss across data; commonly used baseline that may exploit any correlation present in the pooled training distribution, including spurious ones.",
            "citation_title": "",
            "mention_or_use": "use",
            "method_name": "Empirical Risk Minimization (ERM)",
            "method_description": "Pool all training environments and minimize average (or total) empirical risk across pooled data. Does not consider environment structure or invariance and therefore will exploit correlations that minimize pooled training error, including spurious correlations that vary across environments.",
            "environment_name": "Synthetic SEM experiments; Colored MNIST",
            "environment_description": "Same offline simulated datasets as used to evaluate IRM and ICP; ERM is applied by pooling training data across environments.",
            "handles_distractors": false,
            "distractor_handling_technique": null,
            "spurious_signal_types": "Prone to exploit spurious correlations, selection biases, confounding effects present in pooled data.",
            "detection_method": null,
            "downweighting_method": null,
            "refutation_method": null,
            "uses_active_learning": false,
            "inquiry_strategy": null,
            "performance_with_robustness": null,
            "performance_without_robustness": "Colored MNIST: ERM achieved high training accuracy (87.4 ± 0.2%) but catastrophic OOD test performance (17.1 ± 0.6%) because it relied on spurious color correlations.",
            "has_ablation_study": false,
            "number_of_distractors": null,
            "key_findings": "Pooling environments (ERM) can destroy information about which correlations are stable across environments and therefore leads models to rely on spurious, non-generalizing features; ERM can achieve low training error yet fail badly OOD.",
            "uuid": "e995.1",
            "source_info": {
                "paper_title": "Invariant Risk Minimization",
                "publication_date_yy_mm": "2019-07"
            }
        },
        {
            "name_short": "ICP",
            "name_full": "Invariant Causal Prediction",
            "brief_description": "A causal discovery method that searches for subsets of covariates whose regression residuals have invariant distribution across environments, used to identify direct causal parents of a target variable under certain assumptions.",
            "citation_title": "Invariant Causal Prediction",
            "mention_or_use": "use",
            "method_name": "Invariant Causal Prediction (ICP)",
            "method_description": "Search over subsets S of covariates and test whether the conditional distribution (typically regression residuals) of Y given X_S is identical across environments; covariates that survive the invariance tests are considered causal parents. Relies on statistical hypothesis tests and is designed for linear/Gaussian settings in the referenced literature.",
            "environment_name": "Synthetic SEM experiments",
            "environment_description": "Evaluated on the paper's synthetic SEM datasets (multiple training environments produced by interventions and noise variations, with optional scrambling). These are offline simulation datasets rather than interactive labs.",
            "handles_distractors": true,
            "distractor_handling_technique": "Variable selection by testing invariance of residual distributions across environments; variables producing non-invariant residuals are rejected as non-causal/distractors.",
            "spurious_signal_types": "Spurious correlations and non-causal variables that cause environment-dependent residual distributions; ICP assumes noise structure (centered, independent) and may not handle changing noise variance well.",
            "detection_method": "Statistical hypothesis testing on residual distributions across environments (tests for equality of residual distributions).",
            "downweighting_method": null,
            "refutation_method": "Refutes candidate covariates by rejecting the null hypothesis of invariant residual distribution across environments, thereby excluding variables considered spurious.",
            "uses_active_learning": false,
            "inquiry_strategy": null,
            "performance_with_robustness": "Reported as conservative in experiments: tends to reject many covariates and therefore produces large errors on estimating causal weights while keeping small weights on non-causal features; outperformed by IRM on synthetic setups in the paper (no uniform numeric summary provided).",
            "performance_without_robustness": null,
            "has_ablation_study": false,
            "number_of_distractors": null,
            "key_findings": "ICP is a principled invariance-based causal discovery method but is conservative in finite-sample settings; it can fail when noise variance in Y changes across environments (residual-distribution matching becomes unsuited) and is outperformed by IRM in the paper's synthetic and scrambled-observation experiments.",
            "uuid": "e995.2",
            "source_info": {
                "paper_title": "Invariant Risk Minimization",
                "publication_date_yy_mm": "2019-07"
            }
        },
        {
            "name_short": "Robust learning",
            "name_full": "Robust (minimax) learning / distributional robustness",
            "brief_description": "Robust objectives minimize worst-case (or baseline-shifted) risk across environments, often formulated as max_e (R^e(f) - r_e); discussed as an alternative but shown to reduce to weighted ERM under KKT conditions.",
            "citation_title": "",
            "mention_or_use": "mention",
            "method_name": "Robust learning (minimax / worst-case risk with environment baselines)",
            "method_description": "Formulations that minimize the maximum environment risk (possibly after subtracting environment-specific baselines r_e), i.e., R^rob(f) = max_e [R^e(f) - r_e]. The paper shows (Proposition 2) that, under KKT differentiability and qualification conditions, solutions are first-order stationary points of a weighted average of environment risks (∑_e λ_e R^e(f)), making robust learning effectively a reweighting of ERM.",
            "environment_name": "theoretical / general",
            "environment_description": "Discussed theoretically; not run as a standalone experimental method in the paper's empirical section.",
            "handles_distractors": false,
            "distractor_handling_technique": "Environment reweighting (via baselines r_e and implied λ_e) — not a per-feature distractor handling mechanism.",
            "spurious_signal_types": "Attempts to account for noisy or difficult environments by downweighting them via baselines, but not designed to eliminate feature-level spurious signals.",
            "detection_method": null,
            "downweighting_method": "Downweights whole environments (via baselines r_e or implied λ_e), but this does not guarantee removal of feature-level spurious correlations and can still lead to mixture solutions that exploit spurious features.",
            "refutation_method": null,
            "uses_active_learning": null,
            "inquiry_strategy": null,
            "performance_with_robustness": null,
            "performance_without_robustness": null,
            "has_ablation_study": null,
            "number_of_distractors": null,
            "key_findings": "Robust learning objectives that minimize maximum environment error are equivalent (under common conditions) to optimizing a weighted average of environment risks; this equivalence implies such methods will generally not discover invariances needed to exclude spurious features (they can still exploit spurious correlations present in weighted mixtures of environments).",
            "uuid": "e995.3",
            "source_info": {
                "paper_title": "Invariant Risk Minimization",
                "publication_date_yy_mm": "2019-07"
            }
        },
        {
            "name_short": "Domain adaptation",
            "name_full": "Domain adaptation / distribution matching methods",
            "brief_description": "Methods that learn representations whose distributions match across environments (marginal or conditional), e.g., adversarial or moment-matching approaches, with limitations when matching the wrong distributional object.",
            "citation_title": "",
            "mention_or_use": "mention",
            "method_name": "Domain adaptation (feature distribution matching; conditional domain adaptation)",
            "method_description": "Approaches that learn a representation Φ(X) such that the marginal distribution P(Φ(X)) (or conditional P(Φ(X)|Y)) is aligned across environments, e.g., via adversarial training or kernel-based moment matching. The paper notes these can fail to find causal invariances because matching feature marginals can enforce the wrong invariance when the causal conditional P(Y|Φ(X)) itself changes across environments; conditional matching P(Φ|Y) could solve special cases (e.g., Colored MNIST) but is less general than IRM.",
            "environment_name": "general mention; Colored MNIST discussion",
            "environment_description": "Considered in the context of offline dataset shifts; not implemented as an evaluated method in the paper's experiments (except conceptual discussion comparing to IRM on Colored MNIST).",
            "handles_distractors": null,
            "distractor_handling_technique": "Distribution matching (marginal or conditional) — can indirectly reduce influence of distractors if their distributions are aligned but may force the wrong invariance.",
            "spurious_signal_types": "Covariate shift, spurious feature correlations that manifest as distributional differences between domains.",
            "detection_method": null,
            "downweighting_method": null,
            "refutation_method": null,
            "uses_active_learning": null,
            "inquiry_strategy": null,
            "performance_with_robustness": null,
            "performance_without_robustness": null,
            "has_ablation_study": null,
            "number_of_distractors": null,
            "key_findings": "Matching feature distributions across domains can enforce incorrect invariances (failing when causal conditionals change); conditional domain adaptation (matching P(h|y,e)) could succeed in special constructed cases (e.g., Colored MNIST) but is brittle when the distribution of causal features changes across environments — IRM addresses a different invariance (P(y|h) matching) and is more generally applicable in the paper's examples.",
            "uuid": "e995.4",
            "source_info": {
                "paper_title": "Invariant Risk Minimization",
                "publication_date_yy_mm": "2019-07"
            }
        },
        {
            "name_short": "Invariance penalties (D_lin / D_dist / gradient-norm)",
            "name_full": "Invariance penalty constructions: D_dist, D_lin, and gradient-norm penalty",
            "brief_description": "Penalty formulations to operationalize the IRM constraint that a classifier be optimal in every environment: naive distance-to-optima (D_dist), normal-equation violation (D_lin) for linear least-squares, and the general gradient-norm penalty ||∇_{w|w=1.0} R^e||^2 used in IRMv1.",
            "citation_title": "",
            "mention_or_use": "use",
            "method_name": "D_dist, D_lin, and gradient-norm invariant penalties",
            "method_description": "D_dist measures ||w - w_Φ^e||^2 (distance to per-environment least-squares optimum) but is discontinuous and numerically unstable. D_lin measures the norm of the violation of normal equations: ||E[ΦΦ^T] w - E[Φ Y]||^2, which is smooth and zero iff w is optimal for that environment in least-squares. The general gradient-norm penalty is ||∇_{w|w=1.0} R^e(w·Φ)||^2, applicable to convex losses (including cross-entropy) and used in IRMv1.",
            "environment_name": "used inside IRMv1 on Synthetic SEM and Colored MNIST experiments",
            "environment_description": "These are penalty terms applied during offline SGD optimization of IRM objectives on static simulated datasets.",
            "handles_distractors": true,
            "distractor_handling_technique": "By penalizing per-environment optimality violations, features that produce environment-dependent optimal classifiers (distractors/spurious features) incur penalty and are suppressed in the learned representation.",
            "spurious_signal_types": "Environment-dependent predictive features, effects that correlate with Y differently across envs, and features producing unstable regression coefficients.",
            "detection_method": "Nonzero penalty values indicate that a candidate classifier/representation is not simultaneously optimal across environments, signaling presence of spurious/inconsistent features.",
            "downweighting_method": "Optimization with the penalty forces Φ to reduce reliance on features that produce large per-environment optimality violations, effectively downweighting spurious signals.",
            "refutation_method": null,
            "uses_active_learning": false,
            "inquiry_strategy": null,
            "performance_with_robustness": null,
            "performance_without_robustness": null,
            "has_ablation_study": null,
            "number_of_distractors": null,
            "key_findings": "D_lin yields a smooth objective that avoids the discontinuities of D_dist and is zero exactly when w is per-environment optimal in the linear least-squares case; the gradient-norm penalty generalizes this idea to arbitrary convex losses and is the practical instrument used in IRMv1 to detect and remove spurious, environment-dependent features.",
            "uuid": "e995.5",
            "source_info": {
                "paper_title": "Invariant Risk Minimization",
                "publication_date_yy_mm": "2019-07"
            }
        }
    ],
    "potentially_relevant_new_papers": [
        {
            "paper_title": "Invariant Causal Prediction",
            "rating": 2
        }
    ],
    "cost": 0.02063325,
    "model_str": "gpt-5-mini"
}</code></pre>
        </div>
        <div class="section">
            <h2>Paper</h2>
            <div class="paper-content"><h1>Invariant Risk Minimization</h1>
<p>Martin Arjovsky, Léon Bottou, Ishaan Gulrajani, David Lopez-Paz</p>
<h2>1 Introduction</h2>
<p>Machine learning suffers from a fundamental problem. While machines are able to learn complex prediction rules by minimizing their training error, data are often marred by selection biases, confounding factors, and other peculiarities [49, 48, 23]. As such, machines justifiably inherit these data biases. This limitation plays an essential role in the situations where machine learning fails to fulfill the promises of artificial intelligence. More specifically, minimizing training error leads machines into recklessly absorbing all the correlations found in training data. Understanding which patterns are useful has been previously studied as a correlation-versus-causation dilemma, since spurious correlations stemming from data biases are unrelated to the causal explanation of interest $[31,27,35,52]$. Following this line, we leverage tools from causation to develop the mathematics of spurious and invariant correlations, in order to alleviate the excessive reliance of machine learning systems on data biases, allowing them to generalize to new test distributions.</p>
<p>As a thought experiment, consider the problem of classifying images of cows and camels [4]. To address this task, we label images of both types of animals. Due to a selection bias, most pictures of cows are taken in green pastures, while most pictures of camels happen to be in deserts. After training a convolutional neural network on this dataset, we observe that the model fails to classify easy examples of images of cows when they are taken on sandy beaches. Bewildered, we later realize that our neural network successfully minimized its training error using a simple cheat: classify green landscapes as cows, and beige landscapes as camels.</p>
<p>To solve the problem described above, we need to identify which properties of the training data describe spurious correlations (landscapes and contexts), and which properties represent the phenomenon of interest (animal shapes). Intuitively, a correlation is spurious when we do not expect it to hold in the future in the same manner as it held in the past. In other words, spurious correlations do not appear to be stable properties [54]. Unfortunately, most datasets are not provided in a form amenable to discover stable properties. Because most machine learning algorithms depend on the assumption that training and testing data are sampled independently from the same distribution [51], it is common practice to shuffle at random the training and testing examples. For instance, whereas the original NIST handwritten data was collected from different writers under different conditions [19], the popular MNIST training and testing sets [8] were carefully shuffled to represent similar mixes of writers. Shuffling brings the training and testing distributions closer together, but</p>
<p>discards what information is stable across writers. However, shuffling the data is something that we do, not something that Nature does for us. When shuffling, we destroy information about how the data distribution changes when one varies the data sources or collection specifics. Yet, this information is precisely what tells us whether a property of the data is spurious or stable.</p>
<p>Here we take a step back, and assume that the training data is collected into distinct, separate environments. These could represent different measuring circumstances, locations, times, experimental conditions, external interventions, contexts, and so forth. Then, we promote learning correlations that are stable across training environments, as these should (under conditions that we will study) also hold in novel testing environments.</p>
<p>Returning to our motivational example, we would like to label pictures of cows and camels under different environments. For instance, the pictures of cows taken in the first environment may be located in green pastures $80 \%$ of the time. In the second environment, this proportion could be slightly different, say $90 \%$ of the time (since pictures were taken in a different country). These two datasets reveal that "cow" and "green background" are linked by a strong, but varying (spurious) correlation, which should be discarded in order to generalize to new environments. Learning machines which pool the data from the two environments together may still rely on the background bias when addressing the prediction task. But, we believe that all cows exhibit features that allow us to recognize them as so, regardless of their context.</p>
<p>This suggests that invariant descriptions of objects relate to the causal explanation of the object itself ("Why is it a cow?") [32]. As shown by [40, 22], there exists an intimate link between invariance and causation useful for generalization. However, [40] assumes a meaningful causal graph relating the observed variables, an awkward assumption when dealing with perceptual inputs such as pixels. Furthermore, [40] only applies to linear models, and scales exponentially with respect to the number of variables in the learning problem. As such, the seamless integration of causation tools [41] into machine learning pipelines remains cumbersome, disallowing what we believe to be a powerful synergy. Here, we work to address these concerns.</p>
<p>Contributions We propose Invariant Risk Minimization (IRM), a novel learning paradigm that estimates nonlinear, invariant, causal predictors from multiple training environments, to enable out-of-distribution (OOD) generalization. To this end, we first analyze in Section 2 how different learning techniques fail to generalize OOD. From this analysis, we derive our IRM principle in Section 3:</p>
<p>To learn invariances across environments, find a data representation such that the optimal classifier on top of that representation matches for all environments.</p>
<p>Section 4 examines the fundamental links between causation, invariance, and OOD generalization. Section 5 contains basic numerical simulations to validate our claims empirically. Section 6 concludes with a Socratic dialogue discussing directions for future research.</p>
<h1>2 The many faces of generalization</h1>
<p>Following [40], we consider datasets $D_{e}:=\left{\left(x_{i}^{e}, y_{i}^{e}\right)\right}<em e="e">{i=1}^{n</em>}}$ collected under multiple training environments $e \in \mathcal{E<em e="e">{\text {tr }}$. These environments describe the same pair of random variables measured under different conditions. The dataset $D</em>}$, from environment $e$, contains examples identically and independently distributed according to some probability distribution $P\left(X^{e}, Y^{e}\right) .{ }^{1}$ Then, our goal is to use these multiple datasets to learn a predictor $Y \approx f(X)$, which performs well across a large set of unseen but related environments $\mathcal{E<em _text="\text" _tr="{tr">{\text {all }} \supset \mathcal{E}</em>$. Namely, we wish to minimize}</p>
<p>$$
R^{\mathrm{OOD}}(f)=\max <em _mathrm_all="\mathrm{all">{e \in \mathcal{E}</em>(f)
$$}}} R^{e</p>
<p>where $R^{e}(f):=\mathbb{E}<em _all="{all" _text="\text">{X^{e}, Y^{e}}\left[\ell\left(f\left(X^{e}\right), Y^{e}\right)\right]$ is the risk under environment $e$. Here, the set of all environments $\mathcal{E}</em>$ contains all possible experimental conditions concerning our system of variables, both observable and hypothetical. This is in the spirit of modal realism and possible worlds [29], where we could consider, for instance, environments where we switch off the Sun. An example clarifies our intentions.}</p>
<p>Example 1. Consider the structural equation model [55]:</p>
<p>$$
\begin{aligned}
X_{1} &amp; \leftarrow \operatorname{Gaussian}\left(0, \sigma^{2}\right) \
Y &amp; \leftarrow X_{1}+\operatorname{Gaussian}\left(0, \sigma^{2}\right) \
X_{2} &amp; \leftarrow Y+\operatorname{Gaussian}(0,1)
\end{aligned}
$$</p>
<p>As we formalize in Section 4, the set of all environments $\mathcal{E}<em 1="1">{\text {all }}$ contains all modifications of the structural equations for $X</em>}$ and $X_{2}$, and those varying the noise of $Y$ within a finite range $\left[0, \sigma_{\mathrm{MAX}}^{2}\right]$. For instance, $e \in \mathcal{E<em 2="2">{\text {all }}$ may replace the equation of $X</em>$ within this finite range. To ease exposition consider:}$ by $X_{2}^{c} \leftarrow 10^{6}$, or vary $\sigma^{2</p>
<p>$$
\mathcal{E}_{\mathrm{tr}}=\left{\text { replace } \sigma^{2} \text { by } 10, \text { replace } \sigma^{2} \text { by } 20\right}
$$</p>
<p>Then, to predict $Y$ from $\left(X_{1}, X_{2}\right)$ using a least-squares predictor $\hat{Y}^{e}=X_{1}^{e} \hat{\alpha}<em 2="2">{1}+X</em>$ for environment $e$, we can:}^{e} \hat{\alpha}_{2</p>
<ul>
<li>regress from $X_{1}^{e}$, to obtain $\hat{\alpha}<em 2="2">{1}=1$ and $\hat{\alpha}</em>=0$,</li>
<li>regress from $X_{2}^{e}$, to obtain $\hat{\alpha}<em 2="2">{1}=0$ and $\hat{\alpha}</em>\right)$,}=\sigma(e)^{2} /\left(\sigma(e)^{2}+\frac{1}{2</li>
<li>regress from $\left(X_{1}^{e}, X_{2}^{c}\right)$, to obtain $\hat{\alpha}<em 2="2">{1}=1 /\left(\sigma(e)^{2}+1\right)$ and $\hat{\alpha}</em>+1\right)$.}=\sigma(e)^{2} /\left(\sigma(e)^{2</li>
</ul>
<p>The regression using $X_{1}$ is our first example of an invariant correlation: this is the only regression whose coefficients do not depend on the environment $e$. Conversely, the second and third regressions exhibit coefficients that vary from environment to environment. These varying (spurious) correlations would not generalize well to novel test environments. Also, not all invariances are interesting: the regression from the empty set of features into $Y$ is invariant, but of weak predictive power.</p>
<p><sup id="fnref:0"><a class="footnote-ref" href="#fn:0">1</a></sup></p>
<p>The invariant rule $\hat{Y}=1 \cdot X_{1}+0 \cdot X_{2}$ is the only predictor with finite $R^{\mathrm{OOD}}$ across $\mathcal{E}<em 2="2">{\text {all }}$ (to see this, let $X</em> \rightarrow \infty$ ). Furthermore, this predictor is the causal explanation about how the target variable takes values across environments. In other words, it provides the correct description about how the target variable reacts in response to interventions on each of the inputs. This is compelling, as invariance is a statistically testable quantity that we can measure to discover causation. We elaborate on the relationship between invariance and causation in Section 4. But first, how can we learn the invariant, causal regression? Let us review four techniques commonly discussed in prior work, as well as their limitations.</p>
<p>First, we could merge the data from all the training environments and learn a predictor that minimizes the training error across the pooled data, using all features. This is the ubiquitous Empirical Risk Minimization (ERM) principle [50]. In this example, ERM would grant a large positive coefficient to $X_{2}$ if the pooled training environments lead to large $\sigma^{2}(e)$ (as in our example), departing from invariance.</p>
<p>Second, we could minimize $R^{\text {rob }}(f)=\max <em _epsilon__epsilon="\epsilon_{\epsilon">{e \in \mathcal{E}</em>\right]$ to maximize the minimal explained variance across environments. While promising, robust learning turns out to be equivalent to minimizing a weighted average of environment training errors:}}} R^{e}(f)-r_{e}$, a robust learning objective where the constants $r_{e}$ serve as environment baselines [2, 6, 15, 46]. Setting these baselines to zero leads to minimizing the maximum error across environments. Selecting these baselines adequately prevents noisy environments from dominating optimization. For example, [37] selects $r_{e}=\mathbb{V}\left[Y^{e</p>
<p>Proposition 2. Given KKT differentiability and qualification conditions, $\exists \lambda_{e} \geq 0$ such that the minimizer of $R^{\mathrm{rob}}$ is a first-order stationary point of $\sum_{e \in \mathcal{E}<em e="e">{i}} \lambda</em>(f)$.} R^{e</p>
<p>This proposition shows that robust learning and ERM (a special case of robust learning with $\left.\lambda_{e}=\frac{1}{\mid \mathcal{E}<em i="i">{\epsilon</em>(e)$.}}}\right)$ would never discover the desired invariance, obtaining infinite $R^{\mathrm{OOD}}$. This is because minimizing the risk of any mixture of environments associated to large $\sigma^{2}(e)$ yields a predictor with a large weight on $X_{2}$. Unfortunately, this correlation will vanish for testing environments associated to small $\sigma^{2</p>
<p>Third, we could adopt a domain adaptation strategy, and estimate a data representation $\Phi\left(X_{1}, X_{2}\right)$ that follows the same distribution for all environments [16, 33]. This would fail to find the true invariance in Example 1, since the distribution of the true causal feature $X_{1}$ (and the one of the target $Y$ ) can change across environments. This illustrates why techniques matching feature distributions sometimes attempt to enforce the wrong type of invariance, as discussed in Appendix C.</p>
<p>Fourth, we could follow invariant causal prediction techniques [40]. These search for the subset of variables that, when used to estimate individual regressions for each environment, produce regression residuals with equal distribution across all environments. Matching residual distributions is unsuited for our example, since the noise variance in $Y$ may change across environments.</p>
<p>In sum, finding invariant predictors even on simple problems such as Example 1 is surprisingly difficult. To address this issue, we propose Invariant Risk Minimization (IRM), a learning paradigm to extract nonlinear invariant predictors across multiple environments, enabling OOD generalization.</p>
<h1>3 Algorithms for invariant risk minimization</h1>
<p>In statistical parlance, our goal is to learn correlations invariant across training environments. For prediction problems, this means finding a data representation such that the optimal classifier, ${ }^{2}$ on top of that data representation, is the same for all environments. More formally:</p>
<p>Definition 3. We say that a data representation $\Phi: \mathcal{X} \rightarrow \mathcal{H}$ elicits an invariant predictor $w \circ \Phi$ across environments $\mathcal{E}$ if there is a classifier $w: \mathcal{H} \rightarrow \mathcal{Y}$ simultaneously optimal for all environments, that is, $w \in \arg \min _{\bar{w}: \mathcal{H} \rightarrow \mathcal{Y}} R^{e}(\bar{w} \circ \Phi)$ for all $e \in \mathcal{E}$.</p>
<p>Why is Definition 3 equivalent to learning features whose correlations with the target variable are stable? For loss functions such as the mean squared error and the cross-entropy, optimal classifiers can be written as conditional expectations. In these cases, a data representation function $\Phi$ elicits an invariant predictor across environments $\mathcal{E}$ if and only if for all $h$ in the intersection of the supports of $\Phi\left(X^{v}\right)$ we have $\mathbb{E}\left[Y^{v} \mid \Phi\left(X^{v}\right)=h\right]=\mathbb{E}\left[Y^{v^{\prime}} \mid \Phi\left(X^{v^{\prime}}\right)=h\right]$, for all $e, e^{\prime} \in \mathcal{E}$.</p>
<p>We believe that this concept of invariance clarifies common induction methods in science. Indeed, some scientific discoveries can be traced to the realization that distinct but potentially related phenomena, once described with the correct variables, appear to obey the same exact physical laws. The precise conservation of these laws suggests that they remain valid on a far broader range of conditions. If both Newton's apple and the planets obey the same equations, chances are that gravitation is a thing.</p>
<p>To discover these invariances from empirical data, we introduce Invariant Risk Minimization (IRM), a learning paradigm to estimate data representations eliciting invariant predictors $w \circ \Phi$ across multiple environments. To this end, recall that we have two goals in mind for the data representation $\Phi$ : we want it to be useful to predict well, and elicit an invariant predictor across $\mathcal{E}_{\mathrm{tr}}$. Mathematically, we phrase these goals as the constrained optimization problem:</p>
<p>$$
\begin{array}{ll}
\min <em _in="\in" _mathcal_E="\mathcal{E" e="e">{\substack{\Phi: \mathcal{X} \rightarrow \mathcal{H} \
w: \mathcal{H} \rightarrow \mathcal{Y}}} &amp; \sum</em><em _mathrm_tr="\mathrm{tr">{\mathrm{tr}}} R^{e}(w \circ \Phi) \
\text { subject to } &amp; w \in \underset{\bar{w}: \mathcal{H} \rightarrow \mathcal{Y}}{\arg \min } R^{e}(\bar{w} \circ \Phi) \text {, for all } e \in \mathcal{E}</em>
\end{array}
$$}</p>
<p>This is a challenging, bi-leveled optimization problem, since each constraint calls an inner optimization routine. So, we instantiate (IRM) into the practical version:</p>
<p>$$
\min <em _in="\in" _mathcal_E="\mathcal{E" e="e">{\Phi: \mathcal{X} \rightarrow \mathcal{Y}} \sum</em><em _mid="\mid" w="1.0">{\mathrm{tr}}} R^{e}(\Phi)+\lambda \cdot\left|\nabla</em>
$$} R^{e}(w \cdot \Phi)\right|^{2</p>
<p>(IRMv1)
where $\Phi$ becomes the entire invariant predictor, $w=1.0$ is a scalar and fixed "dummy" classifier, the gradient norm penalty is used to measure the optimality of the dummy classifier at each environment $e$, and $\lambda \in[0, \infty)$ is a regularizer balancing between predictive power (an ERM term), and the invariance of the predictor $1 \cdot \Phi(x)$.</p>
<p><sup id="fnref2:0"><a class="footnote-ref" href="#fn:0">1</a></sup></p>
<h1>3.1 From (IRM) to (IRMv1)</h1>
<p>This section is a voyage circumventing the subtle optimization issues lurking behind the idealistic objective (IRM), to arrive to the efficient proposal (IRMv1).</p>
<h3>3.1.1 Phrasing the constraints as a penalty</h3>
<p>We translate the hard constraints in (IRM) into the penalized loss</p>
<p>$$
L_{\mathrm{IRM}}(\Phi, w)=\sum_{e \in \mathcal{E}_{\mathrm{tr}}} R^{e}(w \circ \Phi)+\lambda \cdot \mathbb{D}(w, \Phi, e)
$$</p>
<p>where $\Phi: \mathcal{X} \rightarrow \mathcal{H}$, the function $\mathbb{D}(w, \Phi, e)$ measures how close $w$ is to minimizing $R^{e}(w \circ \Phi)$, and $\lambda \in[0, \infty)$ is a hyper-parameter balancing predictive power and invariance. In practice, we would like $\mathbb{D}(w, \Phi, e)$ to be differentiable with respect to $\Phi$ and $w$. Next, we consider linear classifiers $w$ to propose one alternative.</p>
<h3>3.1.2 Choosing a penalty $\mathbb{D}$ for linear classifiers $w$</h3>
<p>Consider learning an invariant predictor $w \circ \Phi$, where $w$ is a linear-least squares regression, and $\Phi$ is a nonlinear data representation. In the sequel, all vectors $v \in \mathbb{R}^{d}$ are by default in column form, and we denote by $v^{\top} \in \mathbb{R}^{1 \times d}$ the row form. By the normal equations, and given a fixed data representation $\Phi$, we can write $w_{\Phi}^{e} \in \arg \min _{\bar{w}} R^{e}(\bar{w} \circ \Phi)$ as:</p>
<p>$$
w_{\Phi}^{e}=\mathbb{E}<em X_e="X^{e">{X^{e}}\left[\Phi\left(X^{e}\right) \Phi\left(X^{e}\right)^{\top}\right]^{-1} \mathbb{E}</em>\right]
$$}, Y^{e}}\left[\Phi\left(X^{e}\right) Y^{e</p>
<p>where we assumed invertibility. This analytic expression would suggest a simple discrepancy between two linear least-squares classifiers:</p>
<p>$$
\mathbb{D}<em _Phi="\Phi">{\text {dist }}(w, \Phi, e)=\left|w-w</em>
$$}^{e}\right|^{2</p>
<p>Figure 1 uses Example 1 to show why $\mathbb{D}<em 2="2">{\text {dist }}$ is a poor discrepancy. The blue curve shows (3) as we vary the coefficient $c$ for a linear data representation $\Phi(x)=$ $x \cdot \operatorname{Diag}([1, c])$, and $w=(1,0)$. The coefficient $c$ controls how much the representation depends on the variable $X</em>$ whose second coefficient grows to infinity. This causes a second problem, the penalty approaching zero as $|c| \rightarrow \infty$. The orange curve shows that adding severe regularization to the least-squares regression does not fix these numerical problems.}$, responsible for the spurious correlations in Example 1. We observe that (3) is discontinuous at $c=0$, the value eliciting the invariant predictor. This happens because when $c$ approaches zero without being exactly zero, the least-squares rule (2) compensates this change by creating vectors $w_{\Phi}^{e</p>
<p>To circumvent these issues, we can undo the matrix inversion in (2) to construct:</p>
<p>$$
\mathbb{D}<em X_e="X^{e">{\text {lin }}(w, \Phi, e)=\left|\mathbb{E}</em>
$$}}\left[\Phi\left(X^{e}\right) \Phi\left(X^{e}\right)^{\top}\right] w-\mathbb{E}_{X^{e}, Y^{e}}\left[\Phi\left(X^{e}\right) Y^{e}\right]\right|^{2</p>
<p>which measures how much does the classifier $w$ violate the normal equations. The green curve in Figure 1 shows $\mathbb{D}_{\text {lin }}$ as we vary $c$, when setting $w=(1,0)$. The</p>
<p><img alt="img-0.jpeg" src="img-0.jpeg" /></p>
<p>Figure 1: Different measures of invariance lead to different optimization landscapes in our Example 1. The naïve approach of measuring the distance between optimal classifiers $\mathbb{D}<em _lin="{lin" _text="\text">{\text {dist }}$ leads to a discontinuous penalty (solid blue unregularized, dashed orange regularized). In contrast, the penalty $\mathbb{D}</em>$ does not exhibit these problems.
penalty $\mathbb{D}}<em _lin="{lin" _text="\text">{\text {lin }}$ is smooth (it is a polynomial on both $\Phi$ and $w$ ), and achieves an easy-to-reach minimum at $c=0$-the data representation eliciting the invariant predictor. Furthermore, $\mathbb{D}</em>(w, \Phi, e)=0$ if and only if $w \in \arg \min }<em _lin="{lin" _text="\text">{\bar{w}} R^{e}(\bar{w} \circ \Phi)$. As a word of caution, we note that the penalty $\mathbb{D}</em>$ is non-convex for general $\Phi$.}</p>
<h1>3.1.3 Fixing the linear classifier $w$</h1>
<p>Even when minimizing (1) over $(\Phi, w)$ using $\mathbb{D}<em _lin="{lin" _text="\text">{\text {lin }}$, we encounter one issue. When considering a pair $\left(\gamma \Phi, \frac{1}{\gamma} w\right)$, it is possible to let $\mathbb{D}</em>$ tend to zero without impacting the ERM term, by letting $\gamma$ tend to zero. This problem arises because (1) is severely over-parametrized. In particular, for any invertible mapping $\Psi$, we can re-write our invariant predictor as}</p>
<p>$$
w \circ \Phi=\underbrace{\left(w \circ \Psi^{-1}\right)}<em _Phi="\Phi">{\tilde{w}} \circ \underbrace{(\Psi \circ \Phi)}</em>
$$</p>
<p>This means that we can re-parametrize our invariant predictor as to give $w$ any non-zero value $\tilde{w}$ of our choosing. Thus, we may restrict our search to the data representations for which all the environment optimal classifiers are equal to the same fixed vector $\tilde{w}$. In words, we are relaxing our recipe for invariance into finding a data representation such that the optimal classifier, on top of that data representation, is " $\tilde{w}$ " for all environments. This turns (1) into a relaxed version of IRM, where optimization only happens over $\Phi$ :</p>
<p>$$
L_{\mathrm{IRM}, w=\tilde{w}}(\Phi)=\sum_{e \in \mathcal{E}<em _mathrm_lin="\mathrm{lin">{\mathrm{tr}}} R^{e}(\tilde{w} \circ \Phi)+\lambda \cdot \mathbb{D}</em>, \Phi, e)
$$}}(\tilde{w</p>
<p>As $\lambda \rightarrow \infty$, solutions $\left(\Phi_{\lambda}^{<em>}, \tilde{w}\right)$ of (5) tend to solutions $\left(\Phi^{</em>}, \tilde{w}\right)$ of (IRM) for linear $\tilde{w}$.</p>
<h1>3.1.4 Scalar fixed classifiers $\tilde{w}$ are sufficient to monitor invariance</h1>
<p>Perhaps surprisingly, the previous section suggests that $\tilde{w}=(1,0, \ldots, 0)$ would be a valid choice for our fixed classifier. In this case, only the first component of the data representation would matter! We illustrate this apparent paradox by providing a complete characterization for the case of linear invariant predictors. In the following theorem, matrix $\Phi \in \mathbb{R}^{p \times d}$ parametrizes the data representation function, vector $w \in \mathbb{R}^{p}$ the simultaneously optimal classifier, and $v=\Phi^{\top} w$ the predictor $w \circ \Phi$.</p>
<p>Theorem 4. For all $e \in \mathcal{E}$, let $R^{e}: \mathbb{R}^{d} \rightarrow \mathbb{R}$ be convex differentiable cost functions. A vector $v \in \mathbb{R}^{d}$ can be written $v=\Phi^{\top} w$, where $\Phi \in \mathbb{R}^{p \times d}$, and where $w \in \mathbb{R}^{p}$ simultaneously minimize $R^{e}(w \circ \Phi)$ for all $e \in \mathcal{E}$, if and only if $v^{\top} \nabla R^{e}(v)=0$ for all $e \in \mathcal{E}$. Furthermore, the matrices $\Phi$ for which such a decomposition exists are the matrices whose nullspace $\operatorname{Ker}(\Phi)$ is orthogonal to $v$ and contains all the $\nabla R^{e}(v)$.</p>
<p>So, any linear invariant predictor can be decomposed as linear data representations of different ranks. In particular, we can restrict our search to matrices $\Phi \in \mathbb{R}^{1 \times d}$ and let $\tilde{w} \in \mathbb{R}^{1}$ be the fixed scalar 1.0. This translates (5) into:</p>
<p>$$
L_{\mathrm{IRM}, w=1.0}\left(\Phi^{\top}\right)=\sum_{e \in \mathcal{E}<em _mathrm_lin="\mathrm{lin">{\mathrm{tr}}} R^{e}\left(\Phi^{\top}\right)+\lambda \cdot \mathbb{D}</em>, e\right)
$$}}\left(1.0, \Phi^{\top</p>
<p>Section 4 shows that the existence of decompositions with high-rank data representation matrices $\Phi^{\top}$ are key to out-of-distribution generalization, regardless of whether we restrict IRM to search for rank-1 $\Phi^{\top}$.</p>
<p>Geometrically, each orthogonality condition $v^{\top} \nabla R^{e}(v)=0$ in Theorem 4 defines a $(d-1)$-dimensional manifold in $\mathbb{R}^{d}$. Their intersection is itself a manifold of dimension greater than $d-m$, where $m$ is the number of environments. When using the squared loss, each condition is a quadratic equation whose solutions form an ellipsoid in $\mathbb{R}^{d}$. Figure 2 shows how their intersection is composed of multiple connected components, one of which contains the trivial solution $v=0$. This shows that (6) remains nonconvex, and therefore sensitive to initialization.</p>
<h3>3.1.5 Extending to general losses and multivariate outputs</h3>
<p>Continuing from (6), we obtain our final algorithm (IRMv1) by realizing that the invariance penalty (4), introduced for the least-squares case, can be written as a general function of the risk, namely $\mathbb{D}(1.0, \Phi, e)=\left|\nabla_{w \mid w=1.0} R^{e}(w \cdot \Phi)\right|^{2}$, where $\Phi$ is again a possibly nonlinear data representation. This expression measures the optimality of the fixed scalar classifier $w=1.0$ for any convex loss, such as the cross-entropy. If the target space $\mathcal{Y}$ returned by $\Phi$ has multiple outputs, we multiply all of them by the fixed scalar classifier $w=1.0$.</p>
<p><img alt="img-1.jpeg" src="img-1.jpeg" /></p>
<p>Figure 2: The solutions of the invariant linear predictors $v=\Phi^{\top} w$ coincide with the intersection of the ellipsoids representing the orthogonality condition $v^{\top} \nabla R^{e}(v)=0$.</p>
<h1>3.2 Implementation details</h1>
<p>When estimating the objective (IRMv1) using mini-batches for stochastic gradient descent, one can obtain an unbiased estimate of the squared gradient norm as</p>
<p>$$
\sum_{k=1}^{k}\left[\nabla_{w \mid w=1.0} \ell\left(w \cdot \Phi\left(X_{k}^{e, i}\right), Y_{k}^{e, i}\right) \cdot \nabla_{w \mid w=1.0} \ell\left(w \cdot \Phi\left(X_{k}^{e, j}\right), Y_{k}^{e, j}\right)\right]
$$</p>
<p>where $\left(X^{e, i}, Y^{e, i}\right)$ and $\left(X^{e, j}, Y^{e, j}\right)$ are two random mini-batches of size $b$ from environment $e$, and $\ell$ is a loss function. We offer a PyTorch example in Appendix D.</p>
<h3>3.3 About nonlinear invariances $w$</h3>
<p>How restrictive is it to assume that the invariant optimal classifier $w$ is linear? One may argue that given a sufficiently flexible data representation $\Phi$, it is possible to write any invariant predictor as $1.0 \cdot \Phi$. However, enforcing a linear invariance may grant non-invariant predictors a penalty $\mathbb{D}<em 0="0">{\text {lin }}$ equal to zero. For instance, the null data representation $\Phi</em>$ is linear.}\left(X^{e}\right)=0$ admits any $w$ as optimal amongst all the linear classifiers for all environments. But, the elicited predictor $w \circ \Phi_{0}$ is not invariant in cases where $\mathbb{E}\left[Y^{e}\right] \neq 0$. Such null predictor would be discarded by the ERM term in the IRM objective. In general, minimizing the ERM term $R^{e}(\tilde{w} \circ \Phi)$ will drive $\Phi$ so that $\tilde{w}$ is optimal amongst all predictors, even if $\tilde{w</p>
<p>We leave for future work several questions related to this issue. Are there noninvariant predictors that would not be discarded by either the ERM or the invariance term in IRM? What are the benefits of enforcing non-linear invariances $w$ belonging to larger hypothesis classes $\mathcal{W}$ ? How can we construct invariance penalties $\mathbb{D}$ for non-linear invariances?</p>
<h1>4 Invariance, causality and generalization</h1>
<p>The newly introduced IRM principle promotes low error and invariance across training environments $\mathcal{E}<em _all="{all" _text="\text">{\text {tr }}$. When do these conditions imply invariance across all environments $\mathcal{E}</em>$, and consequently out-of-distribution generalization? And at a more fundamental level, how does statistical invariance and out-of-distribution generalization relate to concepts from the theory of causation?}}$ ? More importantly, when do these conditions lead to low error across $\mathcal{E}_{\text {all }</p>
<p>So far, we have omitted how different environments should relate to enable out-of-distribution generalization. The answer to this question is rooted in the theory of causation. We begin by assuming that the data from all the environments share the same underlying Structural Equation Model, or SEM [55, 39]:</p>
<p>Definition 5. $A$ Structural Equation Model (SEM) $\mathcal{C}:=(\mathcal{S}, N)$ governing the random vector $X=\left(X_{1}, \ldots, X_{d}\right)$ is a set of structural equations:</p>
<p>$$
\mathcal{S}<em i="i">{i}: X</em>\right)
$$} \leftarrow f_{i}\left(\operatorname{Pa}\left(X_{i}\right), N_{i</p>
<p>where $\operatorname{Pa}\left(X_{i}\right) \subseteq\left{X_{1}, \ldots, X_{d}\right} \backslash\left{X_{i}\right}$ are called the parents of $X_{i}$, and the $N_{i}$ are independent noise random variables. We say that " $X_{i}$ causes $X_{j}$ " if $X_{i} \in \operatorname{Pa}\left(X_{j}\right)$. We call causal graph of $X$ to the graph obtained by drawing i) one node for each $X_{i}$, and ii) one edge from $X_{i}$ to $X_{j}$ if $X_{i} \in \operatorname{Pa}\left(X_{j}\right)$. We assume acyclic causal graphs.</p>
<p>By running the structural equations of a SEM $\mathcal{C}$ according to the topological ordering of its causal graph, we can draw samples from the observational distribution $P(X)$. In addition, we can manipulate (intervene) an unique SEM in different ways, indexed by $e$, to obtain different but related SEMs $\mathcal{C}^{e}$.</p>
<p>Definition 6. Consider a $S E M \mathcal{C}=(\mathcal{S}, N)$. An intervention $e$ on $\mathcal{C}$ consists of replacing one or several of its structural equations to obtain an intervened SEM $\mathcal{C}^{e}=\left(\mathcal{S}^{e}, N^{e}\right)$, with structural equations:</p>
<p>$$
S_{i}^{e}: X_{i}^{e} \leftarrow f_{i}^{e}\left(\operatorname{Pa}^{e}\left(X_{i}^{e}\right), N_{i}^{e}\right)
$$</p>
<p>The variable $X^{e}$ is intervened if $S_{i} \neq S_{i}^{e}$ or $N_{i} \neq N_{i}^{e}$.
Similarly, by running the structural equations of the intervened SEM $\mathcal{C}^{e}$, we can draw samples from the interventional distribution $P\left(X^{e}\right)$. For instance, we may consider Example 1 and intervene on $X_{2}$, by holding it constant to zero, thus replacing the structural equation of $X_{2}$ by $X_{2}^{e} \leftarrow 0$. Admitting a slight abuse of notation, each intervention $e$ generates a new environment $e$ with interventional distribution $P\left(X^{e}, Y^{e}\right)$. Valid interventions $e$, those that do not destroy too much information about the target variable $Y$, form the set of all environments $\mathcal{E}_{\text {all }}$.</p>
<p>Prior work [40] considered valid interventions as those that do not change the structural equation of $Y$, since arbitrary interventions on this equation render prediction impossible. In this work, we also allow changes in the noise variance of $Y$, since varying noise levels appear in real problems, and these do not affect the optimal prediction rule. We formalize this as follows.</p>
<p>Definition 7. Consider a SEM $\mathcal{C}$ governing the random vector $\left(X_{1}, \ldots, X_{d}, Y\right)$, and the learning goal of predicting $Y$ from $X$. Then, the set of all environments $\mathcal{E}<em _all="{all" _text="\text">{\text {all }}(\mathcal{C})$ indexes all the interventional distributions $P\left(X^{e}, Y^{e}\right)$ obtainable by valid interventions $e$. An intervention $e \in \mathcal{E}</em>(Y)\right]$ remains within a finite range.}}(\mathcal{C})$ is valid as long as (i) the causal graph remains acyclic, (ii) $\mathbb{E}\left[Y^{e} \mid \operatorname{Pa}(Y)\right]=\mathbb{E}[Y \mid \operatorname{Pa}(Y)]$, and (iii) $\mathbb{V}\left[Y^{e} \mid \operatorname{Pa</p>
<p>Condition (iii) can be waived if one takes into account environment specific baselines into the definition of $R^{\mathrm{OOD}}$, similar to those appearing in the robust learning objective $R^{\text {rob }}$. We leave additional quantifications of out-of-distribution generalization for future work.</p>
<p>The previous definitions establish fundamental links between causation and invariance. Moreover, one can show that a predictor $v: \mathcal{X} \rightarrow \mathcal{Y}$ is invariant across $\mathcal{E}<em N__Y="N_{Y">{\text {all }}(\mathcal{C})$ if and only if it attains optimal $R^{\mathrm{OOD}}$, and if and only if it uses only the direct causal parents of $Y$ to predict, that is, $v(x)=\mathbb{E}</em>\right)\right]$. The rest of this section follows on these ideas to showcase how invariance across training environments can enable out-of-distribution generalization across all environments.}}\left[f_{Y}\left(\operatorname{Pa}(Y), N_{Y</p>
<h1>4.1 Generalization theory for IRM</h1>
<p>The goal of IRM is to build predictors that generalize out-of-distribution, that is, achieving low error across $\mathcal{E}<em _text="\text" _tr="{tr">{\text {all }}$. To this end, IRM enforces low error and invariance across $\mathcal{E}</em>}}$. The bridge from low error and invariance across $\mathcal{E<em _all="{all" _text="\text">{\text {tr }}$ to low error across $\mathcal{E}</em>$ can be traversed in two steps.}</p>
<p>First, one can show that low error across $\mathcal{E}<em _all="{all" _text="\text">{\text {tr }}$ and invariance across $\mathcal{E}</em>}}$ leads to low error across $\mathcal{E<em _all="{all" _text="\text">{\text {all }}$. This is because, once the data representation $\Phi$ eliciting an invariant predictor $w \circ \Phi$ across $\mathcal{E}</em>}}$ is estimated, the generalization error of $w \circ \Phi$ respects standard error bounds. Second, we examine the remaining condition towards low error across $\mathcal{E<em _text="\text" _tr="{tr">{\text {all }}$ : namely, under which conditions does invariance across training environments $\mathcal{E}</em>$ ?}}$ imply invariance across all environments $\mathcal{E}_{\text {all }</p>
<p>For linear IRM, our starting point to answer this question is the theory of Invariant Causal Prediction (ICP) [40, Theorem 2]. There, the authors prove that ICP recovers the target invariance as long as the data (i) is Gaussian, (ii) satisfies a linear SEM, and (iii) is obtained by certain types of interventions. Theorem 9 shows that IRM learns such invariances even when these three assumptions fail to hold. In particular, we allow for non-Gaussian data, dealing with observations produced as a linear transformation of the variables with stable and spurious correlations, and do not require specific types of interventions or the existence of a causal graph.</p>
<p>The setting of the theorem is as follows. $Y^{e}$ has an invariant correlation with an unobserved latent variable $Z_{1}^{e}$ by a linear relationship $Y^{e}=Z_{1}^{e} \cdot \gamma+\epsilon^{e}$, with $\epsilon^{e}$ independent of $Z_{1}^{e}$. What we observe is $X^{e}$, which is a scrambled combination of $Z_{1}^{e}$ and another variable $Z_{2}^{e}$ that can be arbitrarily correlated with $Z_{1}^{e}$ and $\epsilon^{e}$. Simply regressing using all of $X^{e}$ will then recklessly exploit $Z_{2}^{e}$ (since it gives extra, but spurious, information on $\epsilon^{e}$ and thus $Y^{e}$ ). A particular instance of this setting is when $Z_{1}^{e}$ is the cause of $Y^{e}, Z_{2}^{e}$ is an effect, and $X^{e}$ contains both causes and effects. To generalize out of distribution the representation has to discard $Z_{2}^{e}$ and keep $Z_{1}^{e}$.</p>
<p>Before showing Theorem 9, we need to make our assumptions precise. To learn useful invariances, one must require some degree of diversity across training environments. On the one hand, extracting two random subsets of examples from a large dataset does not lead to diverse environments, as both subsets would follow the same distribution. On the other hand, splitting a large dataset by conditioning on arbitrary variables can generate diverse environments, but may introduce spurious correlations and destroy the invariance of interest [40, Section 3.3]. Therefore, we will require sets of training environments containing sufficient diversity and satisfying an underlying invariance. We formalize the diversity requirement as needing envirnments to lie in linear general position.</p>
<p>Assumption 8. A set of training environments $\mathcal{E}<em r="r" t="t">{t r}$ lie in linear general position of degree $r$ if $\left|\mathcal{E}</em>$ :}\right|&gt;d-r+\frac{d}{r}$ for some $r \in \mathbb{N}$, and for all non-zero $x \in \mathbb{R}^{d</p>
<p>$$
\operatorname{dim}\left(\operatorname{span}\left(\left{\mathbb{E}<em X_e="X^{e">{X^{e}}\left[X^{e} X^{e \top}\right] x-\mathbb{E}</em>\right]\right}}, \epsilon^{e}}\left[X^{e} \epsilon^{e<em r="r" t="t">{e \in \mathcal{E}</em>\right)\right)&gt;d-r
$$}</p>
<p>Intuitively, the assumption of linear general position limits the extent to which the training environments are co-linear. Each new environment laying in linear general position will remove one degree of freedom in the space of invariant solutions. Fortunately, Theorem 10 shows that the set of cross-products $\mathbb{E}_{X^{e}}\left[X^{e} X^{e \top}\right]$ not satisfying a linear general position has measure zero. Using the assumption of linear general position, we can show that the invariances that IRM learns across training environments transfer to all environments.</p>
<p>In words, the next theorem states the following. If one finds a representation $\Phi$ of rank $r$ eliciting an invariant predictor $w \circ \Phi$ across $\mathcal{E}<em _text="\text" _tr="{tr">{\text {tr }}$, and $\mathcal{E}</em>$.}}$ lie in linear general position of degree $r$, then $w \circ \Phi$ is invariant across $\mathcal{E}_{\text {all }</p>
<p>Theorem 9. Assume that</p>
<p>$$
\begin{aligned}
&amp; Y^{e}=Z_{1}^{e} \cdot \gamma+\epsilon^{e}, \quad Z_{1}^{e} \perp \epsilon^{e}, \quad \mathbb{E}\left[\epsilon^{e}\right]=0 \
&amp; X^{e}=S\left(Z_{1}^{e}, Z_{2}^{e}\right)
\end{aligned}
$$</p>
<p>Here, $\gamma \in \mathbb{R}^{c}, Z_{1}^{e}$ takes values in $\mathbb{R}^{c}, Z_{2}^{e}$ takes values in $\mathbb{R}^{q}$, and $S \in \mathbb{R}^{d \times(c+q)}$. Assume that the $Z_{1}$ component of $S$ is invertible: that there exists $\tilde{S} \in \mathbb{R}^{c \times d}$ such that $\tilde{S}\left(S\left(z_{1}, z_{2}\right)\right)=z_{1}$, for all $z_{1} \in \mathbb{R}^{c}, z_{2} \in \mathbb{R}^{q}$. Let $\Phi \in \mathbb{R}^{d \times d}$ have rank $r&gt;0$. Then, if at least $d-r+\frac{d}{r}$ training environments $\mathcal{E}<em _all="{all" _text="\text">{t r} \subseteq \mathcal{E}</em>$ lie in linear general position of degree $r$, we have that}</p>
<p>$$
\Phi \mathbb{E}<em X_e="X^{e">{X^{e}}\left[X^{e} X^{e \top}\right] \Phi^{\top} w=\Phi \mathbb{E}</em>\right]
$$}, Y^{e}}\left[X^{e} Y^{e</p>
<p>holds for all $e \in \mathcal{E}<em _all="{all" _text="\text">{t r}$ iff $\Phi$ elicits the invariant predictor $\Phi^{\top} w$ for all $e \in \mathcal{E}</em>$.
The assumptions about linearity, centered noise, and independence between the noise $\epsilon^{e}$ and the causal variables $Z_{1}$ from Theorem 9 also appear in ICP [40, Assumption 1], implying the invariance $\mathbb{E}\left[Y^{e} \mid Z_{1}^{e}=z_{1}\right]=z_{1} \cdot \gamma$. As in ICP, we allow}</p>
<p>correlations between $\epsilon^{e}$ and the non-causal variables $Z_{2}^{e}$, which leads ERM into absorbing spurious correlations (as in our Example 1, where $S=I$ and $Z_{2}^{e}=X_{2}^{e}$ ).</p>
<p>In addition, our result contains several novelties. First, we do not assume that the data is Gaussian, the existence of a causal graph, or that the training environments arise from specific types of interventions. Second, the result extends to "scrambled setups" where $S \neq I$. These are situations where the causal relations are not defined on the observable features $X$, but on a latent variable $\left(Z_{1}, Z_{2}\right)$ that IRM needs to recover and filter. Third, we show that representations $\Phi$ with higher rank need fewer training environments to generalize. This is encouraging, as representations with higher rank destroy less information about the learning problem at hand.</p>
<p>We close this section with two important observations. First, while robust learning generalizes across interpolations of training environments (recall Proposition 2), learning invariances with IRM buys extrapolation powers. We can observe this in Example 1 where, using two training environments, robust learning yields predictors that work well for $\sigma \in[10,20]$, while IRM yields predictors that work well for all $\sigma$. Finally, IRM is a differentiable function with respect to the covariances of the training environments. Therefore, in cases when the data follows an approximately invariant model, IRM should return an approximately invariant solution, being robust to mild model misspecification. This is in contrast to common causal discovery methods based on thresholding statistical hypothesis tests.</p>
<h1>4.2 On the nonlinear case and the number of environments</h1>
<p>In the same vein as the linear case, we could attempt to provide IRM with guarantees for the nonlinear regime. Namely, we could assume that each constraint $\left|\nabla_{w \mid w=1.0} R^{e}(w \cdot \Phi)\right|=0$ removes one degree of freedom from the possible set of solutions $\Phi$. Then, for a sufficiently large number of diverse training environments, we would elicit the invariant predictor. Unfortunately, we were unable to phrase such a "nonlinear general position" assumption and prove that it holds almost everywhere, as we did in Theorem 10 for the linear case. We leave this effort for future work.</p>
<p>While general, Theorem 9 is pessimistic, since it requires the number of training environments to scale linearly with the number of parameters in the representation matrix $\Phi$. Fortunately, as we will observe in our experiments from Section 5, it is often the case that two environments are sufficient to recover invariances. We believe that these are problems where $\mathbb{E}\left[Y^{e} \mid \Phi\left(X^{e}\right)\right]$ cannot match for two different environments $e \neq e^{\prime}$ unless $\Phi$ extracts the causal invariance. The discussion from Section 3.3 gains relevance here, since enforcing $\mathcal{W}$-invariance for larger families $\mathcal{W}$ should allow discarding more non-invariant predictors with fewer training environments. All in all, studying what problems allow the discovery of invariances from few environments is a promising line of work towards a learning theory of invariance.</p>
<h3>4.3 Causation as invariance</h3>
<p>We promote invariance as the main feature of causation. Unsurprisingly, we are not pioneers in doing so. To predict the outcome of an intervention, we rely on (i) the</p>
<p>properties of our intervention and (ii) the properties assumed invariant after the intervention. Pearl's do-calculus [39] on causal graphs is a framework that tells which conditionals remain invariant after an intervention. Rubin's ignorability [44] plays the same role. What's often described as autonomy of causal mechanisms [20, 1] is a specification of invariance under intervention. A large body of philosophical work $[47,42,38,12,54,13]$ studies the close link between invariance and causation. Some works in machine learning $[45,18,21,26,36,43,34,7]$ pursue similar questions.</p>
<p>The invariance view of causation transcends some of the difficulties of working with causal graphs. For instance, the ideal gas law $P V=n R T$ or Newton's universal gravitation $F=G \frac{m_{1} m_{2}}{c^{2}}$ are difficult to describe using structural equation models (What causes what?), but are prominent examples of laws that are invariant across experimental conditions. When collecting data about gases or celestial bodies, the universality of these laws will manifest as invariant correlations, which will sponsor valid predictions across environments, as well as the conception of scientific theories.</p>
<p>Another motivation supporting the invariance view of causation are the problems studied in machine learning. For instance, consider the task of image classification. Here, the observed variables are hundreds of thousands of correlated pixels. What is the causal graph governing them? It is reasonable to assume that causation does not happen between pixels, but between the real-world concepts captured by the camera. In these cases, invariant correlations in images are a proxy into the causation at play in the real world. To find those invariant correlations, we need methods which can disentangle the observed pixels into latent variables closer to the realm of causation, such as IRM. In rare occasions we are truly interested in the entire causal graph governing all the variables in our learning problem. Rather, our focus is often on the causal invariances improving generalization across novel distributions of examples.</p>
<h1>5 Experiments</h1>
<p>We perform two experiments to assess the generalization abilities of IRM across multiple environments. The source-code is available at
https://github.com/facebookresearch/InvariantRiskMinimization.</p>
<h3>5.1 Synthetic data</h3>
<p>As a first experiment, we extend our motivating Example 1. First, we increase the dimensionality of each of the two input features in $X=\left(X_{1}, X_{2}\right)$ to 10 dimensions. Second, as a form of model misspecification, we allow the existence of a 10-dimensional hidden confounder variable $H$. Third, in some cases the features $Z$ will not be directly observed, but only a scrambled version $X=S(Z)$. Figure 3 summarizes the SEM generating the data $\left(X^{e}, Y^{e}\right)$ for all environments $e$ in these experiments. More specifically, for environment $e \in \mathbb{R}$, we consider the following variations:</p>
<ul>
<li>
<p>Scrambled (S) observations, where $S$ is an orthogonal matrix, or unscrambled (U) observations, where $S=I$.</p>
</li>
<li>
<p>Fully-observed (F) graphs, where $W_{h \rightarrow 1}=W_{h \rightarrow y}=W_{h \rightarrow 2}=0$, or partially-observed (P) graphs, where $\left(W_{h \rightarrow 1}, W_{h \rightarrow y}, W_{h \rightarrow 2}\right)$ are Gaussian.</p>
</li>
<li>Homoskedastic (O) $Y$-noise, where $\sigma_{g}^{2}=e^{2}$ and $\sigma_{2}^{2}=1$, or heteroskedastic (E) $Y$-noise, where $\sigma_{g}^{2}=1$ and $\sigma_{2}^{2}=e^{2}$.
<img alt="img-2.jpeg" src="img-2.jpeg" /></li>
</ul>
<p>Figure 3: In our synthetic experiments, the task is to predict $Y^{e}$ from $X^{e}=S\left(Z_{1}^{e}, Z_{2}^{e}\right)$.
These variations lead to eight setups referred to by their initials. For instance, the setup "FOS" considers fully-observed (F), homoskedastic $Y$-noise (O), and scrambled observations (S). For all variants, $\left(W_{1 \rightarrow y}, W_{y \rightarrow 2}\right)$ have Gaussian entries. Each experiment draws 1000 samples from the three training environments $\mathcal{E}_{\text {tr }}={0.2,2,5}$. IRM follows the variant (IRMv1), and uses the environment $e=5$ to cross-validate the invariance regularizer $\lambda$. We compare to ERM and ICP [40].</p>
<p>Figure 4 summarizes the results of our experiments. We show two metrics for each estimated prediction rule $\hat{Y}=X_{1} \cdot \hat{W}<em 2="2">{1 \rightarrow y}+X</em>} \cdot \hat{W<em 1="1" _rightarrow="\rightarrow" y="y">{y \rightarrow 2}$. To this end, we consider a descrambled version of the estimated coefficients $\left(\hat{M}</em>}, \hat{M<em 1="1" _rightarrow="\rightarrow" y="y">{y \rightarrow 2}\right)=\left(\hat{W}</em>}, \hat{W<em 1="1" _rightarrow="\rightarrow" y="y">{y \rightarrow 2}\right)^{\top} S^{\top}$. First, the plain barplots shows the average squared error between $\hat{M}</em>}$ and $W_{1 \rightarrow y}$. This measures how well does a predictor recover the weights associated to the causal variables. Second, each striped barplot shows the norm of estimated weights $\hat{M<em 1="1" _rightarrow="\rightarrow" y="y">{y \rightarrow 2}$ associated to the non-causal variable. We would like this norm to be zero, as the desired invariant causal predictor is $\hat{Y}^{e}=\left(W</em>\right)$. In summary, IRM is able to estimate the most accurate causal and non-causal weights across all experimental conditions. In most cases, IRM is orders of magnitude more accurate than ERM (our $y$-axes are in log-scale). IRM also out-performs ICP, the previous state-of-the-art method, by a large margin. Our experiments also show the conservative behaviour of ICP (preferring to reject most covariates as direct causes), leading to large errors on causal weights and small errors on non-causal weights.}, 0\right)^{\top} S^{\top}\left(X_{1}^{e}, X_{2}^{e</p>
<h1>5.2 Colored MNIST</h1>
<p>We validate IRM at learning nonlinear invariant predictors with a synthetic binary classification task derived from MNIST. The goal is to predict a binary label assigned to each image based on the digit. Whereas MNIST images are grayscale, we color each image either red or green in a way that correlates strongly (but spuriously) with the class label. By construction, the label is more strongly correlated with the color than with the digit, so any algorithm purely minimizing training error will tend to exploit the color. Such algorithms will fail at test time because the direction of the</p>
<p><img alt="img-3.jpeg" src="img-3.jpeg" /></p>
<p>Figure 4: Average errors on causal (plain bars) and non-causal (striped bars) weights for our synthetic experiments. The $y$-axes are in log-scale. See main text for details.
correlation is reversed in the test environment. By observing that the strength of the correlation between color and label varies between the two training environments, we can hope to eliminate color as a predictive feature, resulting in better generalization.</p>
<p>We define three environments (two training, one test) from MNIST transforming each example as follows: first, assign a preliminary binary label $\tilde{y}$ to the image based on the digit: $\tilde{y}=0$ for digits $0-4$ and $\tilde{y}=1$ for $5-9$. Second, obtain the final label $y$ by flipping $\tilde{y}$ with probability 0.25 . Third, sample the color id $z$ by flipping $y$ with probability $p^{e}$, where $p^{e}$ is 0.2 in the first environment, 0.1 in the second, and 0.9 in the test one. Finally, color the image red if $z=1$ or green if $z=0$.</p>
<p>We train MLPs on the colored MNIST training environments using different objectives and report results in Table 1. For each result we report the mean and standard deviation across ten runs. Training with ERM returns a model with high accuracy in the training environments but below-chance accuracy in the test environment, since the ERM model classifies mainly based on color. Training with IRM results in a model that performs worse on the training environments, but relies less on the color and hence generalizes better to the test environments. An oracle that ignores color information by construction outperforms IRM only slightly.</p>
<p>To better understand the behavior of these models, we take advantage of the fact that $h=\Phi(x)$ (the logit) is one-dimensional and $y$ is binary, and plot $P(y=1 \mid h, e)$ as a function of $h$ for each environment and each model in Figure 5. We show each algorithm in a separate plot, and each environment in a separate color. The figure shows that, whether considering only the two training environments or all three</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Algorithm</th>
<th style="text-align: center;">Acc. train envs.</th>
<th style="text-align: right;">Acc. test env.</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ERM</td>
<td style="text-align: center;">$87.4 \pm 0.2$</td>
<td style="text-align: right;">$17.1 \pm 0.6$</td>
</tr>
<tr>
<td style="text-align: left;">IRM (ours)</td>
<td style="text-align: center;">$70.8 \pm 0.9$</td>
<td style="text-align: right;">$\mathbf{6 6 . 9} \pm \mathbf{2 . 5}$</td>
</tr>
<tr>
<td style="text-align: left;">Random guessing (hypothetical)</td>
<td style="text-align: center;">50</td>
<td style="text-align: right;">50</td>
</tr>
<tr>
<td style="text-align: left;">Optimal invariant model (hypothetical)</td>
<td style="text-align: center;">75</td>
<td style="text-align: right;">75</td>
</tr>
<tr>
<td style="text-align: left;">ERM, grayscale model (oracle)</td>
<td style="text-align: center;">$73.5 \pm 0.2$</td>
<td style="text-align: right;">$73.0 \pm 0.4$</td>
</tr>
</tbody>
</table>
<p>Table 1: Accuracy (\%) of different algorithms on the Colored MNIST synthetic task. ERM fails in the test environment because it relies on spurious color correlations to classify digits. IRM detects that the color has a spurious correlation with the label and thus uses only the digit to predict, obtaining better generalization to the new unseen test environment.
<img alt="img-4.jpeg" src="img-4.jpeg" /></p>
<p>Figure 5: $P(y=1 \mid h)$ as a function of $h$ for different models trained on Colored MNIST: (left) an ERM-trained model, (center) an IRM-trained model, and (right) an ERM-trained model which only sees grayscale images and therefore is perfectly invariant by construction. IRM learns approximate invariance from data alone and generalizes well to the test environment.
environments, the IRM model is closer to achieving invariance than the ERM model. Notably, the IRM model does not achieve perfect invariance, particularly at the tails of the $P(h)$. We suspect this is due to finite sample issues: given the small sample size at the tails, estimating (and hence minimizing) the small differences in $P(y \mid h, e)$ between training environments can be quite difficult, regardless of the method.</p>
<p>We note that conditional domain adaptation techniques which match $P(h \mid y, e)$ across environments could in principle solve this task equally well to IRM, which matches $P(y \mid h, e)$. This is because the distribution of the causal features (the digit shapes) and $P(y \mid e)$ both happen to be identical across environments. However, unlike IRM, conditional domain adaptation will fail if, for example, the distribution of the digits changes across environments. We discuss this further in Appendix C.</p>
<p>Finally, Figure 5 shows that $P(y=1 \mid h)$ cannot always be expressed with a linear classifier $w$. Enforcing nonlinear invariances (Section 3.3) could prove useful here.</p>
<h1>6 Looking forward: a concluding dialogue</h1>
<p>[ Eric and Irma are two graduate students studying the Invariant Risk Minimization (IRM) manuscript. Over a cup of coffee at a café in Palais-Royal, they discuss the advantages and caveats that invariance brings to Empirical Risk Minimization (ERM). ]</p>
<p>Irma: I have observed that predictors trained with ERM sometimes absorb biases and spurious correlations from data. This leads to undesirable behaviours when predicting about examples that do not follow the distribution of the training data.
Eric: I have observed that too, and I wonder what are the reasons behind such phenomena. After all, ERM is an optimal principle to learn predictors from empirical data!
Irma: It is, indeed. But even when your hypothesis class allows you to find the empirical risk minimizer efficiently, there are some assumptions at play. First, ERM assumes that training and testing data are identically and independently distributed according to the same distribution. Second, generalization bounds require that the ratio between the capacity of our hypothesis class and the number of training examples $n$ tends to zero, as $n \rightarrow \infty$. Third, ERM achieves zero test error only in the realizable case -that is, when there exists a function in our hypothesis class able to achieve zero error. I suspect that violating these assumptions leads ERM into absorbing spurious correlations, and that this is where invariance may prove useful.
Eric: Interesting. Should we study the three possibilities in turn?
Irma: Sure thing! But first, let's grab another cup of coffee.
[We also encourage the reader to grab a cup of coffee.]</p>
<p>Irma: First and foremost, we have the "identically and independently distributed" (iid) assumption. I once heard Professor Ghahramani refer to this assumption as "the big lie in machine learning". This is to say that all training and testing examples are drawn from the same distribution $P(X, Y)=P(Y \mid X) P(X)$.
Eric: I see. This is obviously not the case when learning from multiple environments, as in IRM. Given this factorization, I guess two things are subject to change: either the marginal distribution $P(X)$ of my inputs, or the conditional distribution $P(Y \mid X)$ mapping those inputs into my targets.
Irma: That's correct. Let's focus first on the case where $P\left(X^{e}\right)$ changes across environments $e$. Some researchers from the field of domain adaptation call this covariate shift. This situation is challenging when the supports of $P\left(X^{e}\right)$ are disjoint across environments. Actually, without a-priori knowledge, there is no reason to believe that our predictor will generalize outside the union of the supports of the training environments.</p>
<p>Eric: A daunting challenge, indeed. How could invariance help here?
Irma: Two things come to mind. On the one hand, we could try to transform our inputs into some features $\Phi\left(X^{e}\right)$, as to match the support of all the training environments. Then, we could learn an invariant classifier $w\left(\Phi\left(X^{e}\right)\right)$ on top of the transformed inputs. [Appendix D studies the shortcomings of this idea.] On the other hand, we could assume that the invariant predictor $w$ has a simple structure, that we can estimate given limited supports. The authors of IRM follow this route, by assuming linear classifiers on top of representations.
Eric: I see! Even though the $P\left(X^{e}\right)$ may be disjoint, if there is a simple invariance satisfied for all training environments separately, it may also hold in unobserved regions of the space. I wonder if we could go further by assuming some sort of compositional structure in $w$, the linear assumption of IRM is just the simplest kind. I say this since compositional assumptions often enable learning in one part of the input space, and evaluating on another.
Irma: It sounds reasonable! What about the case where $P\left(Y^{e} \mid X^{e}\right)$ changes? Does this happen in normal supervised learning? I remember attending a lecture by Professor Schölkopf [45, 25] where he mentioned that $P\left(Y^{e} \mid X^{e}\right)$ is often invariant across environments when $X^{e}$ is a cause of $Y^{e}$, and that it often varies when $X^{e}$ is an effect of $Y^{e}$. For instance, he explains that MNIST classification is anticausal: as in, the observed pixels are an effect of the mental concept that led the writer to draw the digit in the first place. IRM insists on this relation between invariance and causation, what do you think?
Eric: I saw that lecture too. Contrary to Professor Schölkopf, I believe that most supervised learning problems, such as image classification, are causal. In these problems we predict human annotations $Y^{e}$ from pixels $X^{e}$, hoping that the machine imitates this cognitive process. Furthermore, the annotation process often involves multiple humans in the interest of making $P\left(Y^{e} \mid X^{e}\right)$ deterministic. If the annotation process is close to deterministic and shared across environments, predicting annotations is a causal problem, with an invariant conditional expectation.
Irma: Oh! This means that in supervised learning problems about predicting annotations, $P\left(Y^{e} \mid X^{e}\right)$ is often stable across environments, so ERM has great chances of succeeding. This is good news: it explains why ERM is so good at supervised learning, and leaves less to worry about.
Eric: However, if any of the other problems appear (disjoint $P\left(X^{e}\right)$, not enough data, not enough capacity), ERM could get in trouble, right?
Irma: Indeed! Furthermore, in some supervised learning problems, the label is not necessarily created from the input. For instance, the input could be an X-ray image, and the target could be the result of a tumor biopsy on the same patient. Also, there are problems where we predict parts of the input from other parts of the input, like in self-supervised learning [14]. In some other cases, we don't even have labels! This could include</p>
<p>the unsupervised learning of the causal factors of variation behind $X^{e}$, which involves inverting the causal generative process of the data. In all of these cases, we could be dealing with anticausal problems, where the conditional distribution is subject to change across environments. Then, I expect searching for invariance may help by focusing on invariant predictors that generalize out-of-distribution.
Eric: That is an interesting divide between supervised and unsupervised learning! [Figure 6 illustrates the main elements of this discussion.]
<img alt="img-5.jpeg" src="img-5.jpeg" /></p>
<p>Figure 6: All learning problems use empirical observations, here referred to as "pixels". Following a causal and cognitive process, humans produce labels. Therefore, supervised learning problems predicting annotations from observations are causal, and therefore P(label) pixel) is often invariant. Conversely, types of unsupervised and self-supervised learning trying to disentangle the underlying data causal factors of variation (Nature variables) should to some extent reverse the process generating observations (Nature mechanisms). This leads to anticausal learning problems, possibly with varying conditional distributions; an opportunity to leverage invariance. Cat picture by www. flickr. com/photos/pustovit.</p>
<p>Eric: Secondly, what about the ratio between the capacity of our classifier and the number of training examples $n$ ? Neural networks often have a number of parameters on the same order of magnitude, or even greater, than the number of training examples [56]. In these cases, such ratio will not tend to zero as $n \rightarrow \infty$. So, ERM may be in trouble.
Irma: That is correct. Neural networks are often over-parametrized, and over-parametrization carries subtle consequences. For instance, consider that we are using the pseudo-inverse to solve an over-parametrized linear least-squares problem, or using SGD to train an over-parametrized neural network. Amongst all the zero training error solutions, these procedures will prefer the solution with the smallest capacity [53, 3]. Unfortunately, spurious correlations and biases are often simpler to detect than the true phenomenon of interest $[17,9,10,11]$. Therefore, low capacity solutions prefer exploiting those simple but spurious correlations. For instance, think about relying on large green textures to declare the presence of a cow on an image.</p>
<p>Eric: The cows again!
Irma: Always. Although I can give you a more concrete example. Consider predicting $Y^{e}$ from $X^{e}=\left(X_{1}^{e}, X_{2}^{e}\right)$, where:</p>
<p>$$
\begin{aligned}
&amp; Y^{e} \leftarrow 10^{6} \cdot X_{1}^{e} \alpha_{1} \
&amp; X_{2}^{e} \leftarrow 10^{6} \cdot Y^{e} \alpha_{2}^{T} \cdot e
\end{aligned}
$$</p>
<p>the coefficients satisfy $\left|\alpha_{1}\right|=\left|\alpha_{2}\right|=1$, the training environments are $e={1,10}$, and we have $n$ samples for the $2 n$-dimensional input $X$. In this over-parametrized problem, the invariant regression from the cause $X_{1}$ requires large capacity, while the spurious regression from the effect $X_{2}$ requires low capacity.
Eric: Oh! Then, the inductive bias of SGD would prefer to exploit the spurious correlation for prediction. In a nutshell, a deficit of training examples forces us into regularization, and regularization comes with the danger of absorbing easy spurious correlations. But, methods based on invariance should realize that, after removing the nuisance variable $X_{2}$, the regression from $X_{1}$ is invariant, and thus interesting for out-ofdistribution generalization. This means that invariance could sometimes help fight the issues of small data and over-parametrization. Neat!</p>
<p>Irma: As a final obstacle to ERM, we have the case where the capacity of our hypothesis class is insufficient to solve the learning problem at hand.
Eric: This sounds related to the previous point, in the sense that a model with low capacity will stick to spurious correlations, if these are easier to capture.
Irma: That is correct, although I can see an additional problem arising from insufficient capacity. For instance, the only linear invariant prediction rule to estimate the quadratic $Y^{e}=\left(X^{e}\right)^{2}$, where $X^{e} \sim \operatorname{Gaussian}(0, e)$, is the null predictor $Y=0 \cdot X$. Even though $X$ is the only, causal, and invariance-eliciting covariate!
Eric: Got it. Then, we should expect invariance to have a larger chance of success when allowing high capacity. For low-capacity problems, I would rely on cross-validation to lower the importance of the invariance penalty in IRM, and fall back to good old ERM.
Irma: ERM is really withstanding the test of time, isn't it?
Eric: Definitely. From what we have discussed before, I think ERM is specially useful in the realizable case, when there is a predictor in my hypothesis class achieving zero error.
Irma: Why so?
Eric: In the realizable case, the optimal invariant predictor has zero error across all environments. Therefore it makes sense, as an empirical principle, to look for zero training error across training environments. This possibly moves towards an optimal prediction rule on the union of</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:0">
<p>${ }^{2}$ We will also use the term "classifier" to denote the last layer $w$ for regression problems.&#160;<a class="footnote-backref" href="#fnref:0" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:0" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>            </div>
        </div>

    </div>
</body>
</html>