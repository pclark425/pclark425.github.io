<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extraction extraction-result-1281 - Theorizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="header">
        <a href="../index.html"><i class="fas fa-flask"></i> Theorizer</a>
    </div>

    <div class="content">
        <h1>Extracted Data Details for extraction-result-1281</h1>

        <div class="section">
            <h2>Extracted Data (Header)</h2>
            <div class="info-section">
                <p><strong>Extraction ID:</strong> extraction-result-1281</p>
                <p><strong>Extraction Schema Used (ID):</strong> <a href="../schemas/extraction-schema-25.html">extraction-schema-25</a></p>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI agents using adaptive experimental design methods in unknown or partially observable environments, including the specific adaptation strategies, environment characteristics, and performance results.</div>
                <p><strong>Paper ID:</strong> paper-1c167b1ce9928d46259937bb13dbc2c6ef7aed8f</p>
                <p><strong>Paper Title:</strong> <a href="https://www.semanticscholar.org/paper/1c167b1ce9928d46259937bb13dbc2c6ef7aed8f" target="_blank">The graphical brain: Belief propagation and active inference</a></p>
                <p><strong>Paper Venue:</strong> Network Neuroscience</p>
                <p><strong>Paper TL;DR:</strong> This paper formulate neuronal processing as belief propagation under deep generative models that can entertain both discrete and continuous states, leading to distinct schemes for belief updating that play out on the same (neuronal) architecture.</p>
                <p><strong>Paper Abstract:</strong> This paper considers functional integration in the brain from a computational perspective. We ask what sort of neuronal message passing is mandated by active inference—and what implications this has for context-sensitive connectivity at microscopic and macroscopic levels. In particular, we formulate neuronal processing as belief propagation under deep generative models. Crucially, these models can entertain both discrete and continuous states, leading to distinct schemes for belief updating that play out on the same (neuronal) architecture. Technically, we use Forney (normal) factor graphs to elucidate the requisite message passing in terms of its form and scheduling. To accommodate mixed generative models (of discrete and continuous states), one also has to consider link nodes or factors that enable discrete and continuous representations to talk to each other. When mapping the implicit computational architecture onto neuronal connectivity, several interesting features emerge. For example, Bayesian model averaging and comparison, which link discrete and continuous states, may be implemented in thalamocortical loops. These and other considerations speak to a computational connectome that is inherently state dependent and self-organizing in ways that yield to a principled (variational) account. We conclude with simulations of reading that illustrate the implicit neuronal message passing, with a special focus on how discrete (semantic) representations inform, and are informed by, continuous (visual) sampling of the sensorium. Author Summary This paper considers functional integration in the brain from a computational perspective. We ask what sort of neuronal message passing is mandated by active inference—and what implications this has for context-sensitive connectivity at microscopic and macroscopic levels. In particular, we formulate neuronal processing as belief propagation under deep generative models that can entertain both discrete and continuous states. This leads to distinct schemes for belief updating that play out on the same (neuronal) architecture. Technically, we use Forney (normal) factor graphs to characterize the requisite message passing, and link this formal characterization to canonical microcircuits and extrinsic connectivity in the brain.</p>
                <p><strong>Cost:</strong> 0.01</p>
            </div>
        </div>

        <div class="section">
            <h2>Extracted Data (Details)</h2>
            <div class="extraction-instance-container" id="e1281.0">
                <h3 class="extraction-instance">Extracted Data Instance 0 (e1281.0)</h3>
                <div class="extraction-query"><strong>Extraction Query:</strong> Extract any mentions of AI agents using adaptive experimental design methods in unknown or partially observable environments, including the specific adaptation strategies, environment characteristics, and performance results.</div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 30%;">Field</th>
                            <th style="width: 70%;">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>name_short</strong></td>
                            <td>Active Inference (Belief Propagation)</td>
                        </tr>
                        <tr>
                            <td><strong>name_full</strong></td>
                            <td>Active Inference agent implementing belief propagation under deep generative models</td>
                        </tr>
                        <tr>
                            <td><strong>brief_description</strong></td>
                            <td>An agentic scheme that selects action sequences (policies) by minimizing expected free energy, combining epistemic (information-seeking) and pragmatic (preference-seeking) terms; belief updating is implemented as variational message passing / loopy belief propagation on Forney factor graphs across discrete, continuous and mixed hierarchical levels.</td>
                        </tr>
                        <tr>
                            <td><strong>citation_title</strong></td>
                            <td>here</td>
                        </tr>
                        <tr>
                            <td><strong>mention_or_use</strong></td>
                            <td>use</td>
                        </tr>
                        <tr>
                            <td><strong>agent_name</strong></td>
                            <td>Active Inference agent (belief propagation / variational message passing)</td>
                        </tr>
                        <tr>
                            <td><strong>agent_description</strong></td>
                            <td>Agent embodies a hierarchical deep generative model with both discrete (categorical / policy-rich Markov decision processes) and continuous (generalized coordinates of motion) states. Inference is performed by iterative message passing (sum-product / variational message passing / generalized filtering) on Forney factor graphs; expectations (sufficient statistics) are represented and updated using softmax/gradient-descent dynamics mapped to neural-population-like units. Discrete and continuous levels are linked via a link node that implements Bayesian model averaging (descending empirical priors) and post hoc Bayesian model comparison (ascending posterior model probabilities). Policies are selected via a softmax over negative expected free energy.</td>
                        </tr>
                        <tr>
                            <td><strong>adaptive_design_method</strong></td>
                            <td>Information gain / expected information gain maximization (epistemic value) within active inference; Bayesian model averaging and post hoc Bayesian model comparison to adapt model selection</td>
                        </tr>
                        <tr>
                            <td><strong>adaptation_strategy_description</strong></td>
                            <td>The agent computes expected free energy for candidate policies, decomposed into intrinsic (epistemic) information gain and extrinsic (preference) terms, and selects policies with a softmax over -G (expected free energy). During enactment, it performs online belief updating via forward and backward messages (loopy belief propagation) and variational (generalized) filtering; descending messages provide empirical priors for subordinate continuous dynamics, while ascending messages accumulate evidence over time (integrated log evidence over ~200 ms in examples) to update posterior model probabilities. The agent therefore adapts where and how to sample (e.g., saccades / sensory sampling) to reduce uncertainty and maximize model evidence, using accumulated posterior confidence to change future policies and priors.</td>
                        </tr>
                        <tr>
                            <td><strong>environment_name</strong></td>
                            <td>Generative process / simulated sensorium (e.g., pictographic reading / saccadic visual sampling) as described in the paper</td>
                        </tr>
                        <tr>
                            <td><strong>environment_characteristics</strong></td>
                            <td>Partially observable (hidden states), stochastic, hierarchical, mixed discrete-continuous latent structure (discrete state transitions driving continuous trajectories), temporal depth (deep temporal/hierarchical timescales), noisy observations, unknown causes (agent has a generative model to infer them), sampling through actions (active perception).</td>
                        </tr>
                        <tr>
                            <td><strong>environment_complexity</strong></td>
                            <td>Qualitative description: hierarchical multi-timescale structure (higher discrete levels contextualize sequences of lower-level continuous trajectories), continuous-time generalized coordinates (position, velocity, acceleration, ...), discrete policy space of action sequences (depth equals policy horizon), episodes composed of sequences of sensory samples (e.g., sequences of saccades each integrating ~200 ms); the paper does not provide explicit numeric state/action counts or episode lengths.</td>
                        </tr>
                        <tr>
                            <td><strong>uses_adaptive_design</strong></td>
                            <td>True</td>
                        </tr>
                        <tr>
                            <td><strong>performance_with_adaptation</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>performance_without_adaptation</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>sample_efficiency</strong></td>
                            <td><span class="empty-note">null</span></td>
                        </tr>
                        <tr>
                            <td><strong>exploration_exploitation_tradeoff</strong></td>
                            <td>Balanced via expected free energy decomposition: intrinsic (epistemic) term drives exploration to reduce uncertainty (information gain / Bayesian surprise), extrinsic (pragmatic) term drives exploitation toward preferred outcomes; selection over policies implemented by a softmax over negative expected free energy yields an automatic trade-off depending on posterior beliefs and prior preferences. Evidence accumulation over time and Bayesian model averaging further modulate exploration (e.g., salience maps / policy expectations bias downward priors for subordinate levels).</td>
                        </tr>
                        <tr>
                            <td><strong>comparison_methods</strong></td>
                            <td>Conceptual and formal comparisons to predictive coding / generalized filtering (continuous case), Kalman / extended Kalman filtering (special cases), loopy belief propagation, variational message passing, expectation propagation, and standard Bayesian model comparison / averaging. No empirical comparisons to RL baselines with numeric metrics are provided in the text.</td>
                        </tr>
                        <tr>
                            <td><strong>key_results</strong></td>
                            <td>The paper demonstrates a principled adaptive experimental-design-like mechanism: policies are evaluated by expected free energy (which explicitly includes information gain), enabling epistemic foraging (e.g., saccadic sampling) within partially observed, hierarchical environments. It shows how adaptive action selection (policy selection) can be formulated as Bayesian decision-making (softmax over -G), how discrete and continuous inference can be coupled via Bayesian model averaging / post hoc model comparison (link node), and how the whole scheme can be mapped to neurally plausible message passing and microcircuit motifs. The mixed-model link affords categorization of continuous data into discrete outcomes and enables descending empirical priors to shape exploration of continuous dynamics.</td>
                        </tr>
                        <tr>
                            <td><strong>limitations_or_failures</strong></td>
                            <td>No quantitative performance metrics or empirical benchmarks are reported in this paper; inference is approximate (loopy belief propagation / mean-field / Laplace assumptions), so optimality is not guaranteed. Computational costs and scalability (policy horizon combinatorics, model complexity) are not quantified. The approach relies on correct specification of generative models (priors, likelihoods); misspecification could impair adaptation. The paper acknowledges approximate nature of inference (loopy BP) and makes no claims about performance in adversarial, highly non-stationary, or large-scale high-dimensional tasks.</td>
                        </tr>
                        <tr>
                            <td><strong>source_info</strong></td>
                            <td>{'paper_title': 'The graphical brain: Belief propagation and active inference', 'publication_date_yy_mm': '2017-12'}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>Potentially Relevant New Papers (mentioned by this paper)</h2>
            <ol>
                <li>Bayesian model averaging: A tutorial <em>(Rating: 2)</em></li>
                <li>Predictive coding in the visual cortex: a functional interpretation <em>(Rating: 2)</em></li>
            </ol>
        </div>

        <div class="section">
            <h2>Extracted Data (Debug)</h2>
            <pre><code>{
    "id": "extraction-result-1281",
    "paper_id": "paper-1c167b1ce9928d46259937bb13dbc2c6ef7aed8f",
    "extraction_schema_id": "extraction-schema-25",
    "extracted_data": [
        {
            "name_short": "Active Inference (Belief Propagation)",
            "name_full": "Active Inference agent implementing belief propagation under deep generative models",
            "brief_description": "An agentic scheme that selects action sequences (policies) by minimizing expected free energy, combining epistemic (information-seeking) and pragmatic (preference-seeking) terms; belief updating is implemented as variational message passing / loopy belief propagation on Forney factor graphs across discrete, continuous and mixed hierarchical levels.",
            "citation_title": "here",
            "mention_or_use": "use",
            "agent_name": "Active Inference agent (belief propagation / variational message passing)",
            "agent_description": "Agent embodies a hierarchical deep generative model with both discrete (categorical / policy-rich Markov decision processes) and continuous (generalized coordinates of motion) states. Inference is performed by iterative message passing (sum-product / variational message passing / generalized filtering) on Forney factor graphs; expectations (sufficient statistics) are represented and updated using softmax/gradient-descent dynamics mapped to neural-population-like units. Discrete and continuous levels are linked via a link node that implements Bayesian model averaging (descending empirical priors) and post hoc Bayesian model comparison (ascending posterior model probabilities). Policies are selected via a softmax over negative expected free energy.",
            "adaptive_design_method": "Information gain / expected information gain maximization (epistemic value) within active inference; Bayesian model averaging and post hoc Bayesian model comparison to adapt model selection",
            "adaptation_strategy_description": "The agent computes expected free energy for candidate policies, decomposed into intrinsic (epistemic) information gain and extrinsic (preference) terms, and selects policies with a softmax over -G (expected free energy). During enactment, it performs online belief updating via forward and backward messages (loopy belief propagation) and variational (generalized) filtering; descending messages provide empirical priors for subordinate continuous dynamics, while ascending messages accumulate evidence over time (integrated log evidence over ~200 ms in examples) to update posterior model probabilities. The agent therefore adapts where and how to sample (e.g., saccades / sensory sampling) to reduce uncertainty and maximize model evidence, using accumulated posterior confidence to change future policies and priors.",
            "environment_name": "Generative process / simulated sensorium (e.g., pictographic reading / saccadic visual sampling) as described in the paper",
            "environment_characteristics": "Partially observable (hidden states), stochastic, hierarchical, mixed discrete-continuous latent structure (discrete state transitions driving continuous trajectories), temporal depth (deep temporal/hierarchical timescales), noisy observations, unknown causes (agent has a generative model to infer them), sampling through actions (active perception).",
            "environment_complexity": "Qualitative description: hierarchical multi-timescale structure (higher discrete levels contextualize sequences of lower-level continuous trajectories), continuous-time generalized coordinates (position, velocity, acceleration, ...), discrete policy space of action sequences (depth equals policy horizon), episodes composed of sequences of sensory samples (e.g., sequences of saccades each integrating ~200 ms); the paper does not provide explicit numeric state/action counts or episode lengths.",
            "uses_adaptive_design": true,
            "performance_with_adaptation": null,
            "performance_without_adaptation": null,
            "sample_efficiency": null,
            "exploration_exploitation_tradeoff": "Balanced via expected free energy decomposition: intrinsic (epistemic) term drives exploration to reduce uncertainty (information gain / Bayesian surprise), extrinsic (pragmatic) term drives exploitation toward preferred outcomes; selection over policies implemented by a softmax over negative expected free energy yields an automatic trade-off depending on posterior beliefs and prior preferences. Evidence accumulation over time and Bayesian model averaging further modulate exploration (e.g., salience maps / policy expectations bias downward priors for subordinate levels).",
            "comparison_methods": "Conceptual and formal comparisons to predictive coding / generalized filtering (continuous case), Kalman / extended Kalman filtering (special cases), loopy belief propagation, variational message passing, expectation propagation, and standard Bayesian model comparison / averaging. No empirical comparisons to RL baselines with numeric metrics are provided in the text.",
            "key_results": "The paper demonstrates a principled adaptive experimental-design-like mechanism: policies are evaluated by expected free energy (which explicitly includes information gain), enabling epistemic foraging (e.g., saccadic sampling) within partially observed, hierarchical environments. It shows how adaptive action selection (policy selection) can be formulated as Bayesian decision-making (softmax over -G), how discrete and continuous inference can be coupled via Bayesian model averaging / post hoc model comparison (link node), and how the whole scheme can be mapped to neurally plausible message passing and microcircuit motifs. The mixed-model link affords categorization of continuous data into discrete outcomes and enables descending empirical priors to shape exploration of continuous dynamics.",
            "limitations_or_failures": "No quantitative performance metrics or empirical benchmarks are reported in this paper; inference is approximate (loopy belief propagation / mean-field / Laplace assumptions), so optimality is not guaranteed. Computational costs and scalability (policy horizon combinatorics, model complexity) are not quantified. The approach relies on correct specification of generative models (priors, likelihoods); misspecification could impair adaptation. The paper acknowledges approximate nature of inference (loopy BP) and makes no claims about performance in adversarial, highly non-stationary, or large-scale high-dimensional tasks.",
            "uuid": "e1281.0",
            "source_info": {
                "paper_title": "The graphical brain: Belief propagation and active inference",
                "publication_date_yy_mm": "2017-12"
            }
        }
    ],
    "potentially_relevant_new_papers": [
        {
            "paper_title": "Bayesian model averaging: A tutorial",
            "rating": 2
        },
        {
            "paper_title": "Predictive coding in the visual cortex: a functional interpretation",
            "rating": 2
        }
    ],
    "cost": 0.0102035,
    "model_str": "gpt-5-mini"
}</code></pre>
        </div>
        <div class="section">
            <h2>Paper</h2>
            <div class="paper-content"><p><img alt="img-0.jpeg" src="img-0.jpeg" /></p>
<p>N E T W O R K NEURO SCIENCE
an open access $\odot$ journal
<img alt="img-1.jpeg" src="img-1.jpeg" /></p>
<p>Citation: Friston, K. J., Parr, T., \&amp; de Vries, B. (2017). The graphical brain: Belief propagation and active inference. Network Neuroscience, $f(4), 381-414$. https://doi.org/10.1162/ netn_a_00018</p>
<p>DOI:
https://doi.org/10.1162/netn_a_00018
Supporting Information:
http://www.fil.ion.ucl.ac.uk/spm/
Received: 1 February 2017
Accepted: 10 May 2017
Competing Interests: The authors have declared that no competing interests exist.</p>
<p>Corresponding Author:
Karl Friston
k.friston@ucl.ac.uk</p>
<p>Handling Editor:
Randy McIntosh</p>
<p>Copyright: © 2017
Massachusetts Institute of Technology
Published under a Creative Commons Attribution 4.0 International (CC BY 4.0) license</p>
<h2>The graphical brain: Belief propagation and active inference</h2>
<p>Karl J. Friston ${ }^{1}$, Thomas Parr ${ }^{1}$, and Bert de Vries ${ }^{2,3}$<br>${ }^{1}$ Wellcome Trust Centre for Neuroimaging, Institute of Neurology, University College London, United Kingdom<br>${ }^{2}$ Eindhoven University of Technology, Department of Electrical Engineering, Eindhoven, The Netherlands<br>${ }^{3}$ GN Hearing, Eindhoven, The Netherlands</p>
<p>Keywords: Bayesian, Neuronal, Connectivity, Factor graphs, Free energy, Belief propagation, Message passing</p>
<h4>Abstract</h4>
<p>This paper considers functional integration in the brain from a computational perspective. We ask what sort of neuronal message passing is mandated by active inference-and what implications this has for context-sensitive connectivity at microscopic and macroscopic levels. In particular, we formulate neuronal processing as belief propagation under deep generative models. Crucially, these models can entertain both discrete and continuous states, leading to distinct schemes for belief updating that play out on the same (neuronal) architecture. Technically, we use Forney (normal) factor graphs to elucidate the requisite message passing in terms of its form and scheduling. To accommodate mixed generative models (of discrete and continuous states), one also has to consider link nodes or factors that enable discrete and continuous representations to talk to each other. When mapping the implicit computational architecture onto neuronal connectivity, several interesting features emerge. For example, Bayesian model averaging and comparison, which link discrete and continuous states, may be implemented in thalamocortical loops. These and other considerations speak to a computational connectome that is inherently state dependent and self-organizing in ways that yield to a principled (variational) account. We conclude with simulations of reading that illustrate the implicit neuronal message passing, with a special focus on how discrete (semantic) representations inform, and are informed by, continuous (visual) sampling of the sensorium.</p>
<h2>AUTHOR SUMMARY</h2>
<p>This paper considers functional integration in the brain from a computational perspective. We ask what sort of neuronal message passing is mandated by active inference-and what implications this has for context-sensitive connectivity at microscopic and macroscopic levels. In particular, we formulate neuronal processing as belief propagation under deep generative models that can entertain both discrete and continuous states. This leads to distinct schemes for belief updating that play out on the same (neuronal) architecture. Technically, we use Forney (normal) factor graphs to characterize the requisite message passing, and link this formal characterization to canonical microcircuits and extrinsic connectivity in the brain.</p>
<h2>INTRODUCTION</h2>
<p>This paper attempts to describe functional integration in the brain in terms of neuronal computations. We start by asking what the brain does, to see how far the implicit constraints on</p>
<p>Generative model:
Or forward model; a probabilistic mapping from causes to observed consequences (data). It is usually specified in terms of the likelihood of getting some data given their causes (parameters of a model) and priors on the parameters.</p>
<p>Generalized coordinates of motion: Cover the value of a variable, its motion, acceleration, jerk, and higher orders of motion. A point in generalized coordinates corresponds to a path or trajectory over time.</p>
<p>Factor graph:
A bipartite graph (where two distinct sets of nodes are connected by edges) representing the factorization of a function, usually a probability distribution function. Formulating a Bayesian network or model as a factor graph enables the efficient computation of marginal distributions, through the sum-product algorithm.</p>
<p>Bayesian network:
A Bayes network, model, or belief network is a probabilistic graphical model that represents a set of random variables and their conditional dependencies via a directed acyclic graph.
neuronal message passing can take us. In particular, we assume that the brain engages in some form of (Bayesian) inference-and can therefore be described as maximizing Bayesian model evidence (Clark, 2013; Friston, Kilner, \&amp; Harrison, 2006; Hohwy, 2016; Mumford, 1992). This implies that the brain embodies a generative model, for which it tries to gather the greatest evidence. On this view, to understand functional integration is to understand the form of the generative model and how it is used to make inferences about sensory data that are sampled actively from the world. Happily, there is an enormous amount known about the various schemes that can implement this form of (Bayesian) inference, thereby offering the possibility of developing a process theory (i.e., neuronally plausible scheme) that implements the normative principle of self-evidencing (Hohwy, 2016).</p>
<p>In brief, this (rather long) paper tries to integrate three themes to provide a rounded perspective on message passing or belief propagation in the brain. These themes include (a) the formal basis of belief propagation, from the perspective of the Bayesian brain and active inference; (b) the biological substrates of the implicit message passing; and (c) how discrete representations (e.g., semantics) might talk to representations of continuous quantities (e.g., visual contrast luminance). Technically, the key contributions are twofold: first, the derivation of belief propagation and Bayesian filtering in generalized coordinates of motion, under the framework afforded by factor graphs. This derivation highlights the similarities between representations of trajectories over future time points, in discrete models, and the representation of trajectories in generalized coordinates of motion in continuous models. Second, we described a fairly generic way in which discrete and continuous representations can be linked through Bayesian model selection and averaging. To leverage these technical developments, for an understanding of brain function, we highlight the constraints they offer on the structure and dynamics of neuronal message passing, using coarse-grained evidence from anatomy and neurophysiology. Finally, the nature of this message passing is illustrated using simulations of pictographic reading.</p>
<p>In what follows, we use graphical representations to characterize message passing under deep (hierarchical) generative models that might be used by the brain. We use three sorts of graphs to emphasize the form of generative models, the nature of Bayesian belief updating, and how this might be accomplished in neuronal circuits-both at the level of macroscopic cortical hierarchies and at the more detailed level of canonical microcircuits. The three sorts of graphs include Bayesian networks or dependency graphs (MacKay, 1995; Pearl, 1988), where nodes correspond to unknown variables that have to be inferred and the edges denote dependencies among these (random) variables. This provides a concise description of how (e.g., sensory) data are generated. To highlight the requisite message passing and computational architecture, we will use Forney or normal style factor graphs (Loeliger, 2002). In Forney factor graphs, the nodes now represent local functions or factors of a probability distribution over the random variables, while edges come to represent the variables per se (or more exactly a probability distribution over those variables). Finally, we will use neural networks or circuits where the nodes are constituted by the sufficient statistics of unknown variables and other auxiliary variables, such as prediction errors. The edges in these graphs denote an exchange of (functions of) sufficient statistics-of the sort one can interpret in terms of neuronal (axonal) connections. Crucially, these graphical representations are formally equivalent in the sense that any Bayesian network can be expressed as a factor graph. And any message passing on a factor graph can be depicted as a neural network. However, as we will see later, the various graphical formulations offer different perspectives on belief updating or propagation. We will leverage these perspectives to work from a purely normative theory (based upon the</p>
<p>Free energy:
An information theory measure that bounds (is greater than) the surprise on sampling some data, given a generative model.</p>
<p>Empirical prior:
Priors that are induced by hierarchical models; they provide constraints on the recognition density in the usual way but depend on the data.</p>
<p>Surprise:
Surprisal or self-information is the negative log probability of an outcome. An improbable outcome is therefore surprising.</p>
<p>Prior:
The probability distribution or density on the causes of data that encode beliefs about those causes prior to observing the data.</p>
<p>Conditional density:
Or posterior density, the probability distribution of causes or model parameters, given some data; that is, a probabilistic mapping from observed data (consequences) to causes.
maximization of Bayesian model evidence or minimization of variational free energy) towards a process theory (based upon belief propagation and the attractors of dynamical systems).</p>
<p>In this paper, we use Forney factor graphs for purely didactic purposes; namely, to illustrate the simplicity with which messages are composed in belief propagation-and to emphasize the recurrent aspect of message passing. However, articulating a generative model as a Forney factor graph has many practical advantages, especially in a computer science or implementational setting. Factor graphs are an important type of probabilistic graphical model because they facilitate the derivation of (approximate) Bayesian inference algorithms. When a generative model is specified as a factor graph, latent variables can often be inferred by executing a message passing schedule that can be derived automatically. Examples include the sumproduct algorithm (belief propagation) for exact inference, and variational message passing and expectation propagation (EP) for approximate inference (Dauwels, 2007). Probabilistic (hybrid or mixed) models (Buss, 2003) that include both continuous and discrete variables require a link factor, such as the logistic or probit link function. We will use a generic link factor that implements post hoc Bayesian model comparison and averaging (K. Friston \&amp; Penny, 2011; Hoeting, Madigan, Raftery, \&amp; Volinsky, 1999). Technically, equipping generative models of latent categorical states with the ability to handle continuous data means that one can categorize continuous data-and use posterior beliefs about categories as empirical priors for processing continuous data (e.g., time series). Clearly, this is something that the brain does all the time during perceptual categorization and action selection. For an introduction to Forney factor graphs, see Kschischang, Frey, and Loeliger (2001) and Loeliger (2002).</p>
<p>This paper comprises six sections. The first overviews active inference in terms of the (normative) imperative to minimize surprise, resolve uncertainty, and (implicitly) maximize model evidence. This section focuses on the selection of actions or policies (sequences of actions) that minimize expected free energy-and what this entails intuitively. Having established the basic premise that the brain engages in active (Bayesian) inference, we then turn to the generative models for which evidence is sought. The second section considers models where the states or causes of data are discrete or categorical in nature. In particular, it considers generative models based upon Markov decision processes, characterized in terms of Bayesian networks and Forney factor graphs. From these, we develop a putative (neural network) microcircuitry that could implement the requisite belief propagation. This section also takes the opportunity to distinguish between Bayesian inference and active inference by combining (Bayesian network and Forney factor) graphical formulations to show how the products of inference couple back to the process of generating (sensory) data, thereby enabling the brain to author the data or evidence that it accumulates. This section concludes by describing deep models that are composed of Markov decision processes, nested hierarchically over time.</p>
<p>The third section applies the same treatment to generative models with continuous states using a general formulation, based on generalized coordinates of motion (K. Friston, Stephan, Li, \&amp; Daunizeau, 2010). This treatment emphasizes the formal equivalence with belief propagation under discrete models. The fourth section considers generative models in which a Markov decision process is placed on top of a continuous state space model. This section deals with the special problem of how the two parts of the model are linked. The technical contribution of this paper is to link continuous states to discrete states through Bayesian model averages of discrete priors (over the causes of continuous dynamics). Conversely, the posterior probability density over these causes is converted into a discrete representation through Bayesian model comparison. The section concludes with a proposal for extrinsic (between-region) message passing in the brain that is consistent with the architecture of belief propagation under</p>
<p>mixed generative models. In particular, we highlight the possible role of message passing between cortical and subcortical (basal ganglia and thalamic) systems. The fifth section illustrates belief propagation and the attendant process theory using simulations of (metaphorical) reading. This section shows how message passing works and clarifies notions like hidden states, using letters, words, and sentences. Crucially, inferences made about (discrete) words and sentences use (continuous) sensory data solicited by saccadic eye movements that accrue visual (and proprioceptive) input over time. We conclude with a brief section on the implications for context-sensitive connectivity that can be induced under the belief propagation scheme. We focus on the modulation of intrinsic excitability; specifically, the afferents to superficial pyramidal cells-and, as a more abstract level, the implications for self-organized criticality of the sort entailed by dynamic fluctuations in connectivity (Aertsen, Gerstein, Habib, \&amp; Palm, 1989; Allen et al., 2012; Baker et al., 2014; Breakspear, 2004).</p>
<h1>ACTIVE INFERENCE: SELF-EVIDENCING AND EXPECTED FREE ENERGY</h1>
<p>All that follows is predicated on defining what the brain does or, more exactly, what properties it must possess to endure in a changing world. In this sense, the brain conforms to the imperatives for all sentient creatures; namely, to restrict itself to a limited number of attracting states (Friston, 2013). Mathematically, this can be cast as minimizing self-information or surprise (in information theoretic terms). Alternatively, this is equivalent to maximizing Bayesian model evidence; namely, the probability of sensory exchanges with the environment, under a model of how those sensations were caused. This is the essence of the free energy principle and its corollary-active inference-that can be neatly summarized as self-evidencing (Hohwy, 2016). Intuitively, self-evidencing means the brain can be described as inferring the causes of sensory samples while, at the same time, soliciting sensations that are the least surprising (e.g., not looking at the sun directly or maintaining thermoreceptor firing within a physiological range). Technically, this take on action and perception can be cast as minimizing a proxy for surprise; namely variational free energy. Crucially, active inference generalizes Bayesian inference in that the objective is not just to infer the latent or hidden states that cause sensations but to act in a way that will minimize expected surprise in the future. In information theory, expected surprise is known as entropy or uncertainty. This means that one can define optimal behavior as acting to resolve uncertainty (e.g., saccading to salient, or information rich, regimes of visual space or avoiding outcomes that are, a priori, costly or unattractive). In the same way that direct action and perception minimize surprise vicariously, through minimizing free energy, action can be specified in terms of policies that minimize the free energy expected when pursuing that policy.</p>
<h2>Expected Free Energy</h2>
<p>Expected free energy has a relatively simple form (see Supplementary Information: Friston, Parr, \&amp; de Vries, 2017), which can be decomposed into an epistemic, information seeking, uncertainty reducing part (intrinsic value) and a pragmatic, goal seeking, cost aversive part (extrinsic value). Formally, the expected free energy for a particular policy $\pi$ at time $\tau$ in the future can be expressed in terms of probabilistic beliefs $Q\left(s_{\tau}, o_{\tau} \mid \pi\right)$ about future states $s_{\tau}$ and outcomes $o_{\tau}$ (see Supplementary Information, Table 1 and Appendix 2: Friston, Parr, et al., 2017):</p>
<p>$$
G(\pi, \tau)=-\underbrace{E\left[\ln Q\left(s_{\tau} \mid o_{\tau}, \pi\right)-\ln Q\left(s_{\tau} \mid \pi\right)\right]}<em _tau="\tau">{\text {intrinsic value }}-\underbrace{E\left[\ln Q\left(o</em>
$$}\right)\right]}_{\text {extrinsic value }</p>
<p>(Kullback-Leibler) Divergence: Information divergence, information gain, or relative entropy is a noncommutative measure of the difference between two probability distributions.</p>
<p>Extrinsic (pragmatic) value is simply the expected value of a policy defined in terms of outcomes that are preferred a priori, where the equivalent cost corresponds to prior surprise (see glossary of terms in Table 1-Friston, Parr, et al., 2017). The more interesting part is the uncertainty resolving or intrinsic (epistemic) value, variously referred to as relative entropy, mutual information, information gain, Bayesian surprise, or value of information expected under a particular policy (Barlow, 1961; Howard, 1966; Itti \&amp; Baldi, 2009; Linsker, 1990; Optican \&amp; Richmond, 1987). An alternative formulation of expected free energy can be found in the Supplementary Information, Appendix 1 (Friston, Parr, et al., 2017), which shows that expected free energy is also the expected uncertainty about outcomes (i.e., ambiguity) plus the Kullback-Leibler divergence (i.e., relative entropy or risk) between predicted and preferred outcomes. This means that minimizing expected free energy is guaranteed to realize preferred outcomes, while resolving uncertainty about the states of the world generating those outcomes.</p>
<p>In what follows, we will be less concerned with the pragmatic or utilitarian aspect of expected free energy and focus on the epistemic drive to explore salient regimes of the sensorium. We have previously addressed this epistemic foraging in terms of saccadic eye movements, using a generalized Bayesian filter as a model of neuronal dynamics (Friston, Adams, Perrinet, \&amp; Breakspear, 2012). In this paper, we reproduce the same sort of behavior but much more efficiently, using a generative model that entertains both discrete and continuous states. In brief, we will use a discrete state space model to generate empirical priors or predictions about where to look next, and a continuous state space model to implement those predictions, thereby garnering (visual) information that enables a constructivist explanation for visual samples: namely scene construction (Hassabis \&amp; Maguire, 2007; Mirza, Adams, Mathys, \&amp; Friston, 2016). The penultimate section presents simulations of reading to illustrate the use of deep generative models in active inference. However, first we consider the nature of generative models and the belief updating that they entail. In what follows, it will be useful to keep in mind the distinction between a true generative process in the real world and an agent's generative model of that process. This distinction is important because active inference deals with how the generative model of a process and the process per se are coupled in a circular fashion to describe the perception-action cycle (Fuster, 2004; Tishby \&amp; Polani, 2010).</p>
<h2>DISCRETE GENERATIVE MODELS</h2>
<p>This section focuses on generative models of discrete outcomes caused by discrete states that cannot be observed directly (i.e., latent or hidden states). In brief, the unknown variables in these models correspond to states of the world that generate the outcomes of policies or sequences of actions. Note that policies have to be inferred. In other words, in active inference one has to infer what policy one is currently pursuing, where this inference can be biased by prior beliefs or preferences. It is these prior preferences that lend action a purposeful and goal-directed aspect.</p>
<p>Figure 1 describes the basic form of these generative models in complementary formats, and the implicit Bayesian belief updating following the observation of new (sensory) outcomes. The equations on the left specify the generative model in terms of a probability distribution over outcomes, states, and policies that can be expressed in terms of marginal densities or factors. These factors are conditional distributions that entail conditional dependencies, encoded by the edges in the Bayesian network on the upper right. The model in Figure 1 generates outcomes in the following way. First, a policy (i.e., action sequence) is selected at the highest level using a softmax function of the free energy expected under plausible policies. Sequences of hidden states are then generated using the probability transitions specified by the selected</p>
<p><img alt="img-2.jpeg" src="img-2.jpeg" /></p>
<p>Figure 1. Generative model for discrete states and outcomes. Upper left panel: These equations specify the generative model. A generative model is the joint probability of outcomes or consequences and their (latent or hidden) causes; see first equation. Usually, the model is expressed in terms of a likelihood (the probability of consequences given causes) and priors over causes. When a prior depends upon a random variable it is called an empirical prior. Here, the likelihood is specified by a matrix $\mathbf{A}$ whose elements are the probability of an outcome under every combination of hidden states. Cat denotes a categorical probability distribution. The empirical priors pertain to probabilistic transitions (in the $\mathbf{B}$ matrix) among hidden states that can depend upon actions, which are determined by policies (sequences of actions encoded by $\pi$ ). The key aspect of this generative model is that policies are more probable a priori if they minimize the (time integral of) expected free energy $\mathbf{G}$, which depends upon prior preferences about outcomes or costs encoded in $\mathbf{C}$ and the uncertainty or ambiguity about outcomes under each state, encoded by $\mathbf{H}$. Finally, the vector $\mathbf{D}$ specifies the initial state. This completes the specification of the model in terms of parameters that constitute $\mathbf{A}, \mathbf{B}, \mathbf{C}$, and $\mathbf{D}$. Bayesian model inversion refers to the inverse mapping from consequences to causes; that is, estimating the hidden states and other variables that cause outcomes. In approximate Bayesian inference, one specifies the form of an approximate posterior distribution. This particular form in this paper uses a mean field approximation, in which posterior beliefs are approximated by the product of marginal distributions over time points. Subscripts index time (or policy). See the main text and Table 1a in Friston, Parr, et al. (2017) for a detailed explanation of the variables (italic variables represent hidden states, while bold variables indicate expectations about those states). Upper right panel: This Bayesian network represents the conditional dependencies among hidden states and how they cause outcomes. Open circles are random variables (hidden states and policies), while filled circles denote observable outcomes. Squares indicate fixed or known variables, such as the model parameters. We have used a slightly unusual convention where parameters have been placed on top of the edges (conditional dependencies) that may mediate. Lower left panel: These equalities are the belief updates mediating approximate Bayesian inference and action selection. The (Iverson) brackets in the action selection panel return one if the condition in square brackets is satisfied and zero otherwise. Lower right panel: This is an equivalent representation of the Bayesian network in terms of a Forney or normal style factor graph. Here the nodes (square boxes) correspond to factors and the edges are associated with unknown variables. Filled squares denote observable outcomes. The edges are labeled in terms of the sufficient statistics of their marginal posteriors (see approximate posterior). Factors have been labeled intuitively in terms of the parameters encoding the associated probability distributions (on the upper left). The circled numbers correspond to the messages that are passed from nodes to edges (the labels are placed on the edge that carries the message from each node). These correspond to the messages implicit in the belief updates (on the lower left).
policy, which are encoded in $\mathbf{B}$ matrices. These encode probability transitions in terms of policy-specific categorical distributions. As the policy unfolds, the states generate probabilistic outcomes at each point in time. The likelihood of each outcome is encoded by $\mathbf{A}$ matrices, in terms of categorical distributions over outcomes, under each state.</p>
<p>The equivalent representation of this graphical model is shown as a Forney factor graph on the lower right. Here, the factors of the generative model (numbers in square boxes) now constitute the nodes and the (probability distribution over the) unknown states are associated with edges. The rules used to construct a factor graph are simple: The edge associated with each variable is connected to the factors in which it participates. If a variable appears in only one factor (e.g., policies), then the edge becomes a half-edge. If a variable appears in more than two factors (e.g., hidden states), then (copies of) the variable are associated with several edges that converge on a special node (labeled with " $=$ "). Known or observed variables are usually denoted with small field squares. Note the formal similarity between the Bayesian network and the Forney factor graph; however, also note the differences. In addition to the movement of random variables to the edges, the edges are undirected in the Forney factor graph. This reflects the fact that messages are sent over edges in both directions. In this sense, the Forney factor graph provides a concise summary of the message passing implicit in Bayesian inference.</p>
<p>Heuristically, to perform inference on these graphs, one clamps the outputs to a particular (observed) value and passes messages from each node to each edge until (if necessary) convergence. The messages from node $N$ to edge $V$, usually denoted by $\mu_{N \rightarrow V}$, comprise the sufficient statistics of the marginal probability distribution over the edge's variable. These sufficient statistics (e.g., expectations) encode the requisite posterior probability. To illustrate the composition of messages during belief updating, we will illustrate the derivation of the first update (on the lower left of Figure 1) for expectations about hidden states.</p>
<p>The key aspect of this graph is that it discloses the messages that contribute to the posterior marginal over hidden states; here, conditioned on each policy. These constitute (forward: 2) messages from representations of the past, (backward: 3) messages from the future, and (likelihood: 4) messages from the outcome. Crucially, the past and future are represented at all times so that as new outcomes become available, with passage of time, more likelihood messages participate in the message passing, thereby providing more informed (approximate) posteriors. This effectively performs online data assimilation (mediated by forwarding messages) that is informed by prior beliefs concerning future outcomes (mediated by backward messages). Note that the policy is associated with a half-edge. This is because it appears in only one factor; namely, the probability distribution over policies based upon expected free energy G. Furthermore, the policy does not appear to participate in the message passing; however, we will see below that policy expectations play a key role, when we couple the message passing to the generative process-to complete an active inference scheme (and later when we consider the coupling between levels in hierarchical models). The reason the policy is not required for belief propagation among hidden state factors is that we have lumped together the hidden states $\mathbf{s}$ under each policy as a single variable (and the associated probability factors $\mathbf{B}$ ) for clarity. This means that the message passing among the factors encoding hidden states proceeds in parallel for each policy, irrespective of how likely that policy is. Finally, note that the outcomes that inform the expected free energy are not the observed outcomes but predicted outcomes based upon expected states, under each policy (i.e., message 5).</p>
<h1>Belief Updating and Propagation</h1>
<p>Expressing the generative model as a factor graph enables one to see clearly the message passing or belief propagation entailed by inference. For example, the marginal posterior over</p>
<p>hidden states at any point in time is, by applying the sum-product rule, the product of all incoming messages to the associated factor node, where (ignoring constants)</p>
<p>$$
\begin{aligned}
&amp; Q\left(s_{\mathrm{T}} \mid \pi\right) \propto \mu_{\mathbf{B}<em _mathrm_T="\mathrm{T">{\pi, \tau-1} \rightarrow s</em>}} \mid \pi} \times \mu_{\mathbf{B<em _mathrm_T="\mathrm{T">{\pi, \tau} \rightarrow s</em> \Rightarrow \
&amp; \ln Q\left(s_{\mathrm{T}} \mid \pi\right)=\underbrace{\ln \mu_{\mathbf{B}}} \mid \pi} \times \mu_{\mathbf{A} \rightarrow s_{\mathrm{T}} \mid \pi<em _mathrm_T="\mathrm{T">{\pi, \tau-1} \rightarrow s</em>}} \mid \pi}<em _mathbf_B="\mathbf{B">{\text {forward }(2)}+\underbrace{\ln \mu</em><em _mathrm_T="\mathrm{T">{\pi, \tau} \rightarrow s</em>}} \mid \pi}<em _mathbf_A="\mathbf{A">{\text {backward }(3)}+\underbrace{\ln \mu</em> .
\end{aligned}
$$} \rightarrow s_{\mathrm{T}} \mid \pi}}_{\text {likelihood (4) }</p>
<p>These correspond to the messages encoding empirical priors from the previous state (forward message 2), the empirical priors from the subsequent state (backward message 3), and the likelihood (message 4). These messages are created by forward and backward matrix multiplications, enabling us to express belief propagation in terms of the sufficient statistics of the underlying probability distributions; namely, their expectations (see Figure 1, lower left panel):</p>
<p>$$
\begin{aligned}
\ln \mathbf{s}<em _mathrm_T="\mathrm{T" _pi_="\pi,">{\pi, \mathrm{T}} &amp; =\ln \mathbf{B}</em>}-1} \mathbf{s<em _mathrm_T="\mathrm{T" _pi_="\pi,">{\pi, \mathrm{T}-1}+\ln \mathbf{B}</em>}} \cdot \mathbf{s<em _mathrm_T="\mathrm{T">{\pi, \mathrm{T}+1}+\ln \mathbf{A} \cdot \boldsymbol{o}</em> \Rightarrow \
\mathbf{s}}<em _mathrm_T="\mathrm{T" _pi_="\pi,">{\pi, \mathrm{T}} &amp; =\sigma\left(\ln \mathbf{B}</em>}-1} \mathbf{s<em _mathrm_T="\mathrm{T" _pi_="\pi,">{\pi, \mathrm{T}-1}+\ln \mathbf{B}</em>}} \cdot \mathbf{s<em _mathrm_T="\mathrm{T">{\pi, \mathrm{T}+1}+\ln \mathbf{A} \cdot \boldsymbol{o}</em>\right)
\end{aligned}
$$}</p>
<p>The solution to this equality encodes posterior beliefs about hidden states. Here, $\sigma(\cdot)$ denotes the softmax operator, and backward matrix multiplication is denoted by the dot product $\mathbf{A} \cdot \mathbf{s}=\mathbf{A}^{\mathrm{T}} \mathbf{s}$, where boldface matrices denote conditional (proper) probabilities such that</p>
<p>$$
\mathbf{A}<em i="i" j="j">{i j}=\frac{A</em>}}{\sum_{k} A_{k j}}, \quad \mathbf{A<em i="i" j="j">{i j}^{T}=\frac{A</em>(A)
$$}}{\sum_{k} A_{j k}}, \quad P\left(o_{\mathrm{T}}, s_{\mathrm{T}}\right)=\operatorname{Cat</p>
<p>The same convention is used for the probability transitions matrices. The admixture of forward and backward messages in Eq. (2) renders this belief propagation akin to a Bayesian smoother or the forward-backward algorithm for hidden Markov models. However, unlike conventional schemes, the belief propagation here operates before seeing all the outcomes. In other words, expectations about hidden states are associated with successive time points during the enaction of a policy, equipping the model with a short-term memory of the past, and future. This means that a partially observed sequence of outcomes can inform expectations about the future, which are necessary to evaluate the expected free energy of a policy.</p>
<p>Figure 2 illustrates the recurrent nature of the message passing that mediates this predictive (and postdictive) inference using little arrows. One can see clearly that the first outcome can influence expectations about the final hidden state, and expectations about the final hidden state reach back and influence expectations about the initial state. This will become an important aspect of the deep temporal models considered later. In the present context, it means that we are dealing with loopy (cyclic) belief propagation because of the recurrent message passing. This renders the scheme approximate, as opposed to implementing exact Bayesian inference. It can be shown that the stationary point of iterative belief propagation in cyclic or loopy graphs minimizes (a marginal) free energy (Yedidia, Freeman, \&amp; Weiss, 2005). This highlights the close connection between variational message passing (Beal, 2003; MacKay, 2003), loopy belief propagation, and expectation propagation (Minka, 2001). The approximate nature of inference here rests on the fact that we are effectively optimizing marginal distributions over successive hidden states and are therefore approximating the real posterior with (see Figure 1)</p>
<p>$$
P\left(s_{1}, \ldots, s_{T} \mid o_{1}, \ldots, \pi\right)=\prod_{\mathrm{T}} P\left(s_{\mathrm{T}} \mid s_{\mathrm{T}-1}, \pi\right) \approx Q\left(s_{1}, \ldots, s_{T} \mid \pi\right)=\prod_{\mathrm{T}} Q\left(s_{\mathrm{T}} \mid \pi\right)
$$</p>
<p>The corresponding variational free energy for this variational approximation is provided in the Supplementary Information, Appendix 2 (Friston, Parr, et al., 2017), and is formally related to the marginal free energy minimized by belief propagation or the sum-product algorithm</p>
<p><img alt="img-3.jpeg" src="img-3.jpeg" /></p>
<p>Figure 2. The generative process and model. This figure reproduces the Bayesian network and Forney factor graph of Figure 1. However, here the Bayesian network describes the process generating data, as opposed to the generative model of data. This means that we can link the two graphs to show how the policy half-edge of Figure 1 now couples back to the generative process (by generating an action that determines state transitions). The selected action corresponds to the most probable action under posterior beliefs about action sequences or policies. Here, the message labels have been replaced with little arrows to emphasize the circular causality implicit in active inference: The real world (red box) generates a sequence of outcomes that induce message passing and belief propagation to inform (approximate) posterior beliefs about policies (that also depend upon prior preferences and epistemic value). These policies then determine action, which generate new outcomes as time progresses, thereby closing the action perception cycle.
described here (Friston, FitzGerald, Rigoli, Schwartenbeck, \&amp; Pezzulo, 2017; Yedidia et al., 2005).</p>
<p>Note that the Forney factor graph in Figure 1 posits separate messages for hidden states over time-and under each policy. This is consistent with what we know of neuronal representations; for example, distinct (place coded) representations of the past and future are implicit in the delay period activity shown in prefrontal cortical units during delayed matching to sample (Kojima \&amp; Goldman-Rakic, 1982); see Friston, FitzGerald, et al. (2017) for a discussion. Furthermore, separable (place coded) representations of policies are ubiquitous in the brain; for example, salience maps (Bender, 1981; Zelinsky \&amp; Bisley, 2015) or the encoding of (overt or covert) saccadic eye movements in the superior colliculus (Müller, Philiastides, \&amp; Newsome, 2005; Shen, Valero, Day, \&amp; Paré, 2011).</p>
<h1>The Active Bit of Active Inference</h1>
<p>Figure 2 combines Bayesian and Forney factor graphs to distinguish between the process generating outcomes and the concomitant inference that the outcomes induce. Crucially, the Bayesian network describing the generative process is not the Bayesian network describing the generative model, upon which the factor graph is based. In other words, in active inference the generative model and process are distinct. This is because the actual causes of data</p>
<p>Gradient descent:
An optimization scheme that finds a minimum of a function by changing its arguments in proportion to the negative of the gradient of the function at the current value.
depend upon action and action depends upon inference (about policies). In other words, the end point of inference is a belief about policies that specify actions-and actions affect the transitions among the true states generating data. In short, the inference scheme effectively chooses the data it uses for inference. This means that the hidden policies do not actually exist; they are fictive constructs that are realized through action. This is an important part of active inference and shows how policies are coupled to the real world through action to complete the perception and action cycle. It also highlights the circular causality mediated by message passing: Messages flow from outcome nodes to a factor corresponding to expected free energy that determines the probability distribution over policies, thereby producing purposeful (epistemic and goal-directed) behavior. In summary, there are several useful insights into the computational architecture afforded by graphical representations of belief propagation. However, what does this tell us about the brain?</p>
<h2>Belief Propagation and Neuronal Dynamics</h2>
<p>A robust and dynamic belief (or expectation) propagation scheme can be constructed easily by setting up ordinary differential equations whose solution satisfies Equation 3, whereby, substituting $\boldsymbol{v}<em _pi_="\pi," _tau="\tau">{\pi, \tau}=\ln s</em>$ and introducing an auxiliary variable (state prediction error), one obtains the following update scheme (see also Figure 3):</p>
<p>$$
\begin{aligned}
&amp; \boldsymbol{\varepsilon}<em _pi_="\pi," _tau-1="\tau-1">{\pi, \tau}=\ln \mathbf{B}</em>} \mathbf{s<em _pi_="\pi," _tau="\tau">{\pi, \tau-1}+\ln \mathbf{B}</em>} \cdot \mathbf{s<em _tau="\tau">{\pi, \tau+1}+\ln \mathbf{A} \cdot \boldsymbol{\sigma}</em>}-\ln \mathbf{s<em _pi_="\pi," _tau="\tau">{\pi, \tau} \
&amp; \bar{v}</em>}=\boldsymbol{\varepsilon<em _pi_="\pi," _tau="\tau">{\pi, \tau} \
&amp; \mathbf{s}</em>\right)
\end{aligned}
$$}=\boldsymbol{\sigma}\left(\mathbf{v}_{\pi, \tau</p>
<p>These differential equations correspond to a gradient descent on (marginal) variational free energy as described in Friston, FitzGerald, et al. (2017):</p>
<p>$$
\dot{\mathbf{v}}<em _pi_="\pi," _tau="\tau">{\pi, \tau}=\boldsymbol{\varepsilon}</em>}=-\frac{\partial \mathbf{F<em _pi_="\pi," _tau="\tau">{\pi}}{\partial \mathbf{s}</em>
$$}</p>
<p>Crucially, they also furnish a process theory for neuronal dynamics, in which the sigmoid function can be thought of as playing the role of a sigmoid (voltage - firing rate) activation function. This means log expectations about hidden states can be associated with depolarization of neurons or neuronal populations encoding expectations. The key point here is that belief propagation entails simple operations that map onto the operators commonly employed in neural networks; namely, the convergence of (mixtures of) presynaptic input, in terms of (nonnegative) firing, to mediate a postsynaptic depolarization-that then produces a firing rate response through a nonlinear activation function. This is the (convolution) form of neural mass models of population activity used to model electrophysiological responses (for example, Jansen \&amp; Rit, 1995). This formulation also has some construct validity in relation to theoretical proposals and empirical work on evidence accumulation (de Lafuente, Jazayeri, \&amp; Shadlen, 2015; Kira, Yang, \&amp; Shadlen, 2015) and the neuronal encoding of probabilities (Deneve, 2008). Interestingly, it also casts prediction error as a free energy gradient, which is effectively destroyed as the gradient descent reaches its attracting (stationary) point; see Tschacher and Haken (2007) for a synergetic perspective.</p>
<h2>Canonical Microcircuits for Belief Propagation</h2>
<p>The neural network in Figure 3 tries to align the message passing in the Forney factor graph with quantitative studies of intrinsic connections among cortical layers (Thomson \&amp; Bannister, 2003). This (speculative) assignment allows one to talk about the functional anatomy of</p>
<p><img alt="img-4.jpeg" src="img-4.jpeg" /></p>
<p>Figure 3. Belief propagation and intrinsic connectivity. Right panel: The schematic on the right represents the message passing implicit in the differential (update) equations on the left. The expectations have been associated with neuronal populations (colored balls) that are arranged to reproduce known intrinsic (within cortical area) connections. Red connections are excitatory, blue connections are inhibitory, and green connections are modulatory (i.e., involve a multiplication or weighting). Here, edges correspond to intrinsic connections that mediate the message passing on the left. Cyan units correspond to expectations about hidden states and (future) outcomes under each policy, while red states indicate their Bayesian model averages. Pink units correspond to (state and outcome) prediction errors that are averaged to evaluate expected free energy and subsequent policy expectations (in the lower part of the network). This (neural) network formulation of belief updating means that connection strengths correspond to the parameters of the generative model in Figure 1. Only exemplar connections are shown to avoid visual clutter. Furthermore, we have just shown neuronal populations encoding of hidden states under two policies over three time points (i.e., two transitions). Left panel: The differential equations on the left share the same stationary solution as the belief updates in previous figures and can therefore be interpreted as a gradient descent on (marginal) free energy. The equations have been expressed in terms of prediction errors that come in two flavors. The first, state prediction error, scores the difference between the (logarithms of) expected states under each policy and time point-and the corresponding predictions based upon outcomes and the (preceding and subsequent) hidden states. These represent empirical prior and likelihood terms respectively; namely, messages 2, 3, and 4. The prediction error drives depolarization in state units, where the expectation per se is obtained via a softmax operator. The second, outcome prediction error, reports the difference between the (logarithms of) expected outcomes and those predicted under prior beliefs. This prediction error is weighted by the expected outcomes to evaluate the expected free energy $\mathbf{G}$, via message 5 . These policy-specific free energies are combined to give the policy expectations via a softmax function, via message 1 .
intrinsic connectivity in terms of belief propagation. In this example, state prediction error units (pink) have been assigned to granular layers (e.g., spiny stellate populations) that are in receipt of ascending sensory information (the likelihood message). These project to units in supragranular layers that represent (policy specific) expected states (cyan), which are averaged to form Bayesian model averages-associated with superficial pyramidal cells (red). The expected states then send forward (intrinsic) connections to units encoding expected outcomes in infragranular layers, which in turn excite outcome prediction errors (necessary to evaluate expected free energy; see Appendix 2: Friston, Parr, et al., 2017). This nicely captures the forward (generally excitatory) intrinsic connectivity from granular, to supragranular, to infragranular populations that characterize the canonical cortical microcircuit (Bastos et al., 2012; Douglas \&amp; Martin, 1991; Haeusler \&amp; Maass, 2007; Heinzle, Hepp, \&amp; Martin, 2007; Shipp, 2016). Note also that reciprocal (backward) intrinsic connections from the expected states to</p>
<p>state prediction errors are inhibitory, suggesting that both excitatory and inhibitory interneurons in the supragranular layer encode (policy specific) expected states. Computationally, Equation 6 suggests this (interlaminar) connection is inhibitory because the last contribution (from expected states) to the prediction error is negative. Neurobiologically, this may correspond to a backward intrinsic pathway that is dominated by projections from inhibitory interneurons (Haeusler \&amp; Maass, 2007).</p>
<p>The particular formulation in Equation 6 distinguishes between the slower dynamics of populations encoding expectations of hidden states and the instantaneous responses of populations encoding prediction errors. This formulation leads to interesting hypotheses about the characteristic membrane time constants of spiny stellate cells encoding prediction errors, relative to pyramidal cells encoding expectations (e.g., Ballester-Rosado et al., 2010). Crucially, because prediction errors are a function of expectations and the rates of change of expectations are functions of prediction errors, one would expect to see the same sort of spectral differences in laminar-specific oscillations that have been previously discussed in the context of predictive coding (Bastos et al., 2012, 2015; Bosman et al., 2012).</p>
<p>This and subsequent neural networks should not be taken too seriously; they are offered as a starting point for refinement and deconstruction, based upon anatomy and neurophysiology. See Shipp (2016) for a nice example of this endeavor. The neural network above inherits a lot of its motivation from similar (more detailed) arguments about the laminar specificity of neuronal message passing in canonical microcircuits implied by predictive coding. Fuller accounts of the anatomical and neurophysiological evidence-upon which these arguments are based-can be found in Adam, Shipp, and Friston (2013), Bastos et al. (2012), Friston (2008), Mumford (1992), Shipp (2005, 2016), and Shipp, Adam, and Friston (2013). See Whittington and Bogacz (2017) for treatment that focuses on the role of intralaminar connectivity in learning and encoding uncertainty. One interesting component that the belief propagation scheme brings to the table (that is not in predictive coding; see Figures 7 and 10 below) is the encoding of outcome prediction errors in deep layers that send messages to (subcortical) nodes encoding expected free energy. This message passing could be mediated by corticostriatal projections, from layer 5 (and deep layer 3) pyramidal neurons, which are distributed in a patchy manner (Haber, 2016). We now move from local (intrinsic) message passing to consider the basic form of hierarchical message passing, of the sort that might be seen in cortical hierarchies.</p>
<h1>Deep Temporal Models</h1>
<p>The generative model in Figure 1 considers only a single timescale or temporal horizon specified by the depth of policies entertained. Clearly, the brain models the temporal succession of worldly states at multiple timescales, calling for hierarchical or deep models. An example is provided in Figure 4 that effectively composes a deep model by diverting some (or all) of the outputs of one model to specify the initial states of another (subordinate) model, with exactly the same form. The key aspect of this generative model is that state transitions proceed at different rates at different levels of the hierarchy. In other words, the transition from one hidden state to the next entails a sequence of transitions at the level below. This is a necessary consequence of conditioning the initial state at any level on the hidden states in the level above. Heuristically, this hierarchical model generates outcomes over nested timescales, like the second hand of a clock that completes a cycle for every tick of the minute hand that precesses more quickly than the hour hand. It is this particular construction that lends the generative model a deep temporal architecture. In other words, hidden states at higher levels contextualize transitions or trajectories of hidden states at lower levels to generate a deep narrative.</p>
<p><img alt="img-5.jpeg" src="img-5.jpeg" /></p>
<p>Figure 4. Deep generative models. This figure provides the Bayesian network and associated Forney factor graph for deep (temporal) generative models, described in terms of probability factors and belief updates on the left. The graphs adopt the same format as Figure 1; however, here the previous model has been extended hierarchically, where (bracketed) superscripts index the hierarchical level. The key aspect of this model is its hierarchical structure that represents sequences of hidden states over time or epochs. In this model, hidden states at higher levels generate the initial states for lower levels-that then unfold to generate a sequence of outcomes; cf. associative chaining (Page \&amp; Norris, 1998). Crucially, lower levels cycle over a sequence for each transition of the level above. This is indicated by the subgraphs enclosed in dashed boxes, which are "reused" as higher levels unfold. It is this scheduling that endows the model with deep temporal structure. In relation to the (shallow) models above, the probability distribution over initial states is now conditioned over the state (at the current time) of the level above. Practically, this means that $\mathbf{D}$ now becomes a matrix, as opposed to a vector. The messages passed from the corresponding factor node rest on Bayesian model averages that require the expected policies (message 1) and expected states under each policy. The resulting averages are then used to compose descending (message 2) and ascending (message 6) messages that mediate the exchange of empirical priors and posteriors between levels respectively.</p>
<p>In terms of message passing, the equivalent Forney factor graph (Figure 4: lower right) shows that the message passing within each level of the model is conserved. The only difference is that messages are sent in both directions along the edge connecting the factor $(\mathbf{D})$ representing the joint distribution over the initial state conditioned upon the state of the level above. These messages correspond to ascending and descending messages, respectively. The ascending message 6 effectively supplements the observations of the level above using the (Bayesian model) average of the states at the level below. Conversely, the descending message 2 plays a role of an empirical prior that induces expectations about the initial state of the level below, thereby contextualizing fast subordinate sequences within slower supraordinate narratives.</p>
<p>Crucially, the requisite Bayesian model averages depend on expected policies via message 1. In other words, the expected states that constitute descending priors are a weighted mixture of policy-specific expectations that, incidentally, mediate a Bayes optimal optimism bias (Friston et al., 2013; Sharot, Guitart-Masip, Korn, Chowdhury, \&amp; Dolan, 2012). This</p>
<p>Bayesian model averaging lends expected policies a role above and beyond action selection. This can be seen from the Forney factor graph representation, which shows that messages are passed from the expected free energy node $\mathbf{G}$ to the initial state factor $\mathbf{D}$. In short, policy expectations now exert a powerful influence over how successive hierarchical levels talk to each other. We will pursue this later from an anatomical perspective in terms of extrinsic connectivity and cortico-basal ganglia-thalamic loops. Before considering the implications for hierarchical architectures in the brain, we turn to the equivalent message passing for continuous variables, which transpires to be predictive coding (Rao \&amp; Ballard, 1999; Srinivasan, Laughlin, \&amp; Dubs, 1982).</p>
<h1>MODELS FOR CONTINUOUS STATES</h1>
<p>This section rehearses the treatment of the previous section using models of continuous states. We adopt a slightly unusual formulation of continuous states that both generalizes established Bayesian filtering schemes and, happily, has a similar form to generative models for discrete states. This generalized form rests upon describing trajectories in generalized coordinates of motion. These are common in physics (e.g., position and momentum). Here, we consider motion to arbitrarily high order (i.e., location, velocity, acceleration, jerk). A key thing to bear in mind, when dealing with generalized motion, is that the mean of the generalized motion is the motion of the mean when, and only when, free energy is minimized. This corresponds to Hamilton's principle of least action.</p>
<p>Figure 5 shows a generative model for a short sequence or trajectory described in terms of generalized motion. The upper panel (on the left) shows that an outcome is generated (with a static nonlinear mapping $g$ ) from the current state, with some random fluctuations; similarly for higher orders of motion. The motion of hidden states is a function (equation of motion or flow $f$ ) of the current state, plus random fluctuations. Higher-order motion is derived in a similar way using generalized equations of motion (in the upper left inset). The Bayesian network (on the upper right) has been written in a way that highlights its formal similarity with the equivalent network for discrete states (Figure 1). This entails lumping together the generalized hidden causes that are generated from a prior expectation. In this form, one can see that the probability transition matrices are replaced with generalized equations of motion, while the likelihood mapping becomes the static nonlinearity. The corresponding Forney factor graph is shown on the lower right, where we have introduced some special (local function) nodes corresponding to factors generating random fluctuations and their addition to predictions of observed trajectories and the flow of hidden states.</p>
<p>Following the derivation of the belief propagation for discrete states, we can pursue a similar construction for continuous states to derive a generalized (Bayesian or variational) filter. For example, using the notation $\bar{x}=\left(x, x^{\prime}, x^{\prime \prime}, \ldots\right)=\left(x^{[0]}, x^{[1]}, x^{[2]}, \ldots\right)$ for generalized states,</p>
<p>$$
\begin{aligned}
&amp; q\left(x^{[i]}\right) \propto \mu_{g^{[i]} \rightarrow x^{[i]}} \cdot \mu_{f^{[i]} \rightarrow x^{[i]}} \cdot \mu_{f^{[i-1]} \rightarrow x^{[i]}} \Rightarrow} \
&amp; \ln q\left(x^{[i]}\right)=\underbrace{\ln \mu_{g^{[i]} \rightarrow x^{[i]}}}<em f_i_="f^{[i]">{\text {likelihood (1) }}+\underbrace{\ln \mu</em>} \rightarrow x^{[i]}}<em f_i-1_="f^{[i-1]">{\text {backward (2) }}+\underbrace{\ln \mu</em>
\end{aligned}
$$} \rightarrow x^{[i]}}}_{\text {forward (3) }</p>
<p>$$
\begin{aligned}
&amp; =-\frac{1}{2}\left(\varepsilon_{a}^{[i]} \cdot \Pi_{a}^{[i]} \varepsilon_{a}^{[i]}+\varepsilon_{x}^{[i]} \cdot \Pi_{x}^{[i]} \varepsilon_{x}^{[i]}+\varepsilon_{x}^{[i-1]} \cdot \Pi_{x}^{[i-1]} \varepsilon_{x}^{[i-1]}\right) \
&amp; \varepsilon_{x}^{[i]}=x^{[i+1]}-f^{[i]}\left(x^{[i]}, v^{[i]}\right) \
&amp; \varepsilon_{a}^{[i]}=o_{a}^{[i]}-g^{[i]}\left(x^{[i]}\right)
\end{aligned}
$$</p>
<p><img alt="img-6.jpeg" src="img-6.jpeg" /></p>
<p>Figure 5. A generative model for continuous states. This figure describes a generative model for a continuous state space model in terms of generalized motion, using the same format as Figure 1. Here, outcomes are generated (with a static nonlinear mapping $g$ ) from the current state, with some random fluctuations; similarly for higher orders of motion. The motion of hidden states is a function (equation of motion or flow $f$ ) of the current state, plus random fluctuations. Higher-order motion is derived in a similar way using generalized equations of motion (in the upper left inset). The corresponding Bayesian network (on the upper right) shows that discrete probability transition matrices are replaced with generalized equations of motion, while the discrete likelihood mapping becomes the static nonlinearity. The corresponding Forney factor graph is shown on the lower right.</p>
<p>At the posterior expectation, the derivative of this density with respect to the unknown states must be zero; therefore,</p>
<p>$$
\begin{aligned}
\partial_{x^{[i]}} \ln q\left(\mu_{x}^{[i]}\right) &amp; =\partial_{x^{[i]}} g^{[i]} \cdot \Pi_{o}^{[i]} \varepsilon_{o}^{[i]}+\partial_{x^{[i]}} f^{[i]} \cdot \Pi_{x}^{[i]} \varepsilon_{x}^{[i]}+\Pi_{x}^{[i-1]} \varepsilon_{x}^{[i-1]} \
&amp; \Leftrightarrow \
\partial_{\bar{x}} \ln q\left(\bar{\mu}<em _bar_x="\bar{x">{x}\right) &amp; =\partial</em>}} \bar{g} \cdot \prod_{o} \bar{\varepsilon<em _bar_x="\bar{x">{o}+\partial</em>}} \bar{f} \cdot \prod_{x} \bar{\varepsilon<em x="x">{x}-\Delta \cdot \prod</em>} \bar{\varepsilon<em x="x">{x}=0 \
\bar{\varepsilon}</em>} &amp; =\Delta \bar{\mu<em x="x">{x}-\bar{f}\left(\bar{\mu}</em>}, \bar{\mu<em o="o">{v}\right) \
\bar{\varepsilon}</em>\right)
\end{aligned}
$$} &amp; =\delta-\bar{g}\left(\bar{\mu}_{x</p>
<p>Here, the (block matrix) operator $\Delta$ returns higher-order motion $\Delta \bar{x}=\left(x^{\prime}, x^{\prime \prime}, x^{\prime \prime \prime}, \ldots\right)$, while its transpose returns lower order motion $\Delta \cdot \bar{x}=\left(0, x^{\prime}, x^{\prime \prime}, \ldots\right)$. As before, we can now construct a differential equation whose solution satisfies the above equality:</p>
<p>$$
\hat{\mu}<em x="x">{x}-\Delta \bar{\mu}</em>}=\partial_{\bar{x}} \bar{g} \cdot \Pi_{o} \bar{\varepsilon<em _bar_x="\bar{x">{o}+\partial</em>}} \bar{f} \cdot \Pi_{x} \bar{\varepsilon<em x="x">{x}-\Delta \cdot \Pi</em>
$$} \bar{\varepsilon}_{x</p>
<p>The solution of this equation ensures that when Equation 9 is satisfied; the motion of the mean is the mean of the motion $\hat{\mu}<em x="x">{x}=\Delta \bar{\mu}</em>$. Crucially, this equation is a generalized gradient descent on variational free energy (Friston et al., 2010; Friston, 2008):</p>
<p>$$
\hat{\mu}<em x="x">{x}=\Delta \bar{\mu}</em> F
$$}-\partial_{\bar{x}</p>
<p>In this instance, belief propagation and variational message passing (i.e., variational filtering) are formally identical, because the messages in belief propagation are the same as those required from the Markov blanket of each random variable in the corresponding Bayesian network (Beal, 2003; Dauwels, 2007; Friston, 2008).</p>
<p>The ensuing generalized variational or Bayesian filtering scheme has several interesting special cases, including the (extended) Kalman (Bucy) filter, which falls out when we only consider generalized motion to first order. See Friston et al. (2010) for details. When expressed in terms of prediction errors, this generalized variational filtering corresponds to predictive coding (Rao \&amp; Ballard, 1999; Srinivasan et al., 1982) that has become an accepted metaphor for evidence accumulation in the brain. In terms of active inference, the minimization of free energy with respect to action or control states only has to consider the prediction errors on outcomes (because these are the only things that can be changed by action). This leads to the active inference scheme in Figure 6.
<img alt="img-7.jpeg" src="img-7.jpeg" /></p>
<p>Figure 6. Active inference with continuous states (and time). This figure uses the same format as Figure 2 to illustrate how action couples to the generative process. As before, action supplements or replaces hidden causes in the generative model-to complete the generative process. In this instance, action minimizes variational free energy directly, as opposed to minimizing expected free energy via inference over policies. For simplicity, we have removed any dependency of the observation on causes. This dependency is reinstated in subsequent figures.</p>
<p>As with the discrete models, action couples back to the generative process through affecting state transitions or flow. Note, as above, the generative process can be formally distinct from the generative model. This means the real equations of motion (denoted by boldface functions $\mathbf{f}$ ) become functions of action. In this context, one can see how the (fictive) hidden causes in the generative model are replaced by (or supplemented with) action; that is a product of inference. The joint minimization of free energy-or maximization of model evidence-by action and perception rests upon the implicit closure of conditional dependencies between the process (world) and model (brain). See K. Friston (2011) and K. Friston, Mattout, and Kilner (2011) for more details.</p>
<h1>Canonical Microcircuits for Predictive Coding</h1>
<p>Figure 7 depicts a neural network that might implement the message passing in Figure 6. This proposal is based upon the anatomy of intrinsic and extrinsic connections described in Bastos et al. (2012). This figure provides the update dynamics for a hierarchical generalization of the generative model in Figure 6, where the outputs of a higher level now become the hidden causes of the level below. In this hierarchical setting, the prediction errors include prediction errors on both hidden causes and states. As with the model for discrete states, the prediction errors have been assigned to granular layers that receive sensory afferents and ascending prediction errors from lower levels in the hierarchy. Given that the message passing requires prediction errors on hidden causes to be passed to higher levels, one can assume they are encoded by superficial pyramidal cells; that is, the source of ascending extrinsic connections (Bastos et al., 2012; Felleman \&amp; Van Essen, 1991; Markov et al., 2013). Similarly, the sources of descending extrinsic connections are largely restricted to deep pyramidal cells that
<img alt="img-8.jpeg" src="img-8.jpeg" /></p>
<p>Figure 7. Canonical microcircuits for predictive coding. This proposal is based upon the anatomy of intrinsic and extrinsic connections described in Bastos et al. (2012). This figure provides the update dynamics for a hierarchical generalization of the generative model in Figure 6, where the outputs of a higher level now become the hidden causes of the level below. In this hierarchical setting, the prediction errors include prediction errors on both hidden causes and states. As with the model for discrete states, the prediction errors have been assigned to granular layers that receive sensory afferents and ascending prediction errors from lower levels in the hierarchy.</p>
<p>can be associated with expected hidden causes. The ensuing neural network is again remarkably consistent with the known microcircuitry of extrinsic and intrinsic connections, with a series of forward (intrinsic connections from granular, to supragranular, to infragranular layers) and reciprocal inhibitory connections (Thomson \&amp; Bannister, 2003). A general prediction of this computational architecture is that no pyramidal cell (early in cortical hierarchies) can be the source of both forward and backward connections. This follows from the segregation of neuronal populations encoding expectations and errors respectively, where error units send ascending projections to the granular layers of a higher area, while pyramidal cells encoding expectations project back to error units in lower areas. This putative law of extrinsic connectivity has some empirical support as reviewed in Shipp (2016).</p>
<p>The main difference between the microcircuits for discrete and continuous states is that the superficial pyramidal cells encode state expectations and prediction errors respectively. This is because in discrete belief propagation ascending and descending messages convey posteriors (i.e., expected states computed by the lower level) and empirical priors (i.e., the states predicted by the higher level) respectively; whereas, in predictive coding, they convey prediction errors and predictions respectively. Furthermore, the encoding of expected outcomes is not necessary for predictive coding. This is because we have replaced policies with hidden causes. One might ask how predictive coding can support epistemic and purposeful behavior in the absence of policies that underwrite behavior. The answer pursued below is that the hidden causes (of continuous state models) are provided by the policy-rich predictions of (discrete state) models. In the next section, these enriched predictions are considered in terms of message passing and salience.</p>
<h1>MIXED MODELS</h1>
<p>This section considers the integration of discrete and continuous models, and what this implies for message passing in neuronal circuits. In brief, we will see that discrete outcomes select a specific model of continuous trajectories or dynamics-as specified by a prior over their hidden causes. Effectively, this generative model generates (discrete) sequences of short (continuous) trajectories defined in terms of their generalized motion. See Figure 8. Because state transitions occur discretely, the hidden causes generating dynamics switch periodically. This sort of model, if used by the brain, suggests the sensorium is constructed from discrete sequences of continuous dynamics (see also Linderman et al., 2016, for a recent machine learning perspective on this scenario). An obvious example here would be a sequence of saccadic eye movements, each providing a sample of the visual world and yet each constituted by carefully crafted oculomotor kinetics. In fact, this is an example that we will use below, where the discrete outcomes or priors on hidden causes specify a fixed-point attractor for proprioceptive (oculomotor) inference. In essence, this enables the discrete model to prescribe salient points of attraction for visual sampling.</p>
<p>In terms of belief propagation, Figure 9 shows that the descending messages comprise Bayesian model averages of predicted outcomes, while ascending messages from the lower, continuous, level of the hierarchical model are the posterior estimate of these outcomes, having sampled some continuous observations. In other words, the descending messages provide empirical priors over the dynamics of the lowest (continuous) level that returns the corresponding posterior distribution. This posterior distribution is interesting because it constitutes a Bayesian model comparison. This follows because we have treated each outcome as a particular model of dynamics, defined by plausible priors over hidden causes. Therefore, the posterior distribution over priors corresponds to the posterior probability for each model, given the continuous</p>
<p><img alt="img-9.jpeg" src="img-9.jpeg" /></p>
<p>Figure 8. Linking discrete and continuous state models. This figure uses the same format as previous figures but combines the discrete Bayesian network in Figure 1 with the continuous Bayesian network from Figure 5. Here, the outcomes of the discrete model are now used to select a particular (noisy generalized) hidden cause that determines the (noisy generalized) motion or flow of hidden states generating (noisy generalized) observations. These generalized observations described a trajectory in continuous time.
data at hand. From the point of view of the discrete model, each dynamic model corresponds to an outcome. From the point of view of the continuous level, each dynamic model corresponds to a particular prior on hidden causes.</p>
<p>The evaluation of the evidence for each alternative prior (i.e., outcome model) rests upon recent advances in post hoc model comparison. This means that ascending message can be computed directly (under the Laplace assumption) from the posterior over hidden causes and the prior (afforded by the descending message). In Figure 9, this is expressed as a softmax function of the free energy associated with each outcome model or prior. In practice, the dynamical system is actually integrated over a short period of time (about 200 ms in the examples below). This means the descending message corresponds to (literally) evidence accumulation over time:</p>
<p>$$
\begin{aligned}
&amp; \mathbf{E}(t)<em _tau_="\tau," m="m">{m}=-\ln \mathbf{o}</em>(t)}-\int_{0}^{\tau} \mathbf{L<em m="m">{m} d t \
&amp; \mathbf{L}(t)</em>\right)-\ln P(\delta(t) \mid \eta)
\end{aligned}
$$}=\ln P\left(\delta(t) \mid \eta_{m</p>
<p>This equation expresses the free energy $\mathbf{E}$ of competing outcome models as the prior surprise plus the log evidence for each outcome model (integrated over time). The log evidence is a relatively simple function of the posterior and prior (Gaussian) probability densities used to sample continuous observations and the prior that defines each outcome model. See K. Friston and Penny (2011) and Hoeting et al. (1999) for details. Note that if the posterior expectation coincides with the prior, its (relative) log evidence is zero (see the expression in Figure 9). In other words, the free energy for each outcome model $m$ scores its "goodness" in relation to the Bayesian model average (over predicted discrete models). Note further that if duration of evidence accumulation shrinks to zero $(T=0)$, the ascending posterior reduces to the descending prior.</p>
<p>In summary, the link factor that enables one to combine continuous and discrete (hierarchical) models corresponds to a distribution over models of dynamics-and mediates the</p>
<p><img alt="img-10.jpeg" src="img-10.jpeg" /></p>
<p>Figure 9. Mixed message passing. This figure combines the Forney factor graphs from Figures 1 and 5 to create a message passing scheme that integrates discrete and continuous models. The key aspect of this integration is the role of a link node (E) associated with the distribution over discrete outcomes-that can also be considered as (outcome) models from the perspective of the (subordinate) continuous level. The consequent message passing means that descending signals from the discrete to continuous levels comprise empirical prior beliefs about the dynamics below, while ascending messages constitute the posterior beliefs over the same set of outcome models. The corresponding messages are shown with little arrows that are reproduced alongside the link functions in the left panels. These linking updates entail two sorts of (Bayesian model) averages. First, expected outcomes under each policy are averaged over policies. Second, prior expectations about hidden causes are averaged over outcome models. These constitute the descending empirical priors. Conversely, ascending messages correspond to the posterior over outcomes models based upon a post hoc Bayesian model comparison. This treats each discrete hidden cause as a different model. The expressions in the lower left inset define the log likelihood of the continuous observations under each outcome model, relative to the log likelihood under their Bayesian model average.
transformation of descending model averages into ascending model posteriors-using Bayesian model averaging and comparison respectively. Effectively, this equips the associated belief propagation scheme with the ability to categorize continuous data into discrete categories and, in the context of the deep temporal models considered here, chunk continuous sensory flows into discrete sequential representations. We will exploit this faculty in simulations of reading below. However, first we consider the implications of this hierarchical generative model for extrinsic (hierarchical) message passing in the brain.</p>
<h1>Extrinsic Connectivity in the Brain</h1>
<p>Figure 10 sketches an architecture that comprises three levels of a discrete hierarchical model and a single continuous level. In this neural network, we have focused on the extrinsic (between-region) connections that pass ascending prediction errors and expectations about subordinate states-and descending predictions (of initial discrete states or causes of</p>
<p><img alt="img-11.jpeg" src="img-11.jpeg" /></p>
<p>Figure 10. Deep architectures in the brain. This schematic illustrates a putative mapping of belief updating onto recurrent interactions within the cortico (basal ganglia) thalamic loops. This neural architecture is based upon the functional neuroanatomy described in Jahanshahi et al. (2015), which assigns motor updates to motor and premotor cortex projecting to the putamen, associative loops to prefrontal cortical projections to the caudate, and limbic loops to projections to the ventral striatum. The striatum (caudate and putamen) receive inputs from several cortical and subcortical areas. The internal segment of the globus pallidus constitutes the main output nucleus from the basal ganglia. The basal ganglia are connected to motor areas (motor cortex, supplementary motor cortex, premotor cortex, cingulate motor area, and frontal eye fields) and associative cortical areas. The basal ganglia nuclei have similar (topologically organized) motor, associative, and limbic territories; the posterior putamen is engaged in sensorimotor function, while the anterior putamen (or caudate) and the ventral striatum are involved in associative (cognitive) and limbic (motivation and emotion) functions (Jahanshahi et al., 2015). Here, ascending and descending messages among discrete levels are passed between (Bayesian model) averages of expected hidden states (that have been duplicated in this figure to account for the known laminar specificity of extrinsic cortico-cortical connections). We have placed the outcome prediction errors in deep layers (Layer 5 pyramidal cells) that project to the medium spiny cells of the striatum (Arikuni \&amp; Kubota, 1986). These outcome prediction errors are used to compute expected free energy and consequent expectations about policies. Policy expectations are then used to form (Bayesian model) averages of hidden states that are necessary for message passing between discrete hierarchical levels. Similarly, expected outcomes under each policy are passed via corticothalamic connections to the thalamus to evaluate the free energy of each dynamic model, in conjunction with posterior expectations from the continuous level. The resulting posterior expectations are conveyed by thalamocortical projections to inform discrete (hierarchical) message passing. The little arrows referred to the corresponding messages in Figure 9.
dynamics). In virtue of assigning the sources of ascending messages to superficial pyramidal cells and the sources of descending messages to deep pyramidal cells, this recurrent extrinsic connectivity conforms to known neuroanatomy (Bastos et al., 2012; Felleman and Van Essen, 1991; Markov et al., 2013). An interesting exception here is the laminar specificity of higherlevel (discrete) descending projections that arise in deep layers but target state prediction errors</p>            </div>
        </div>

    </div>
</body>
</html>